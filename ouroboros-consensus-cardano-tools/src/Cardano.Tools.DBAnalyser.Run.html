<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns      #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Tools.DBAnalyser.Run</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Tools.DBAnalyser.Run.html#analyse"><span class="hs-identifier">analyse</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Decoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Decoder</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Codec.Serialise</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Serialise</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decode</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/mtl-2.2.2/src"><span class="hs-identifier">Control.Monad.Except</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier">runExceptT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Debug.Trace</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Debug</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Tracer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Tracer</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">nullTracer</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Config</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Fragment.InFuture</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InFuture</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Ledger.Extended</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Ledger.SupportsMempool</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LedgerSupportsMempool</span></span><span>
</span><span id="line-21"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">HasTxs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-diffusion-0.3.1.0/noopt/doc/html/ouroboros-consensus-diffusion/src"><span class="hs-identifier">Ouroboros.Consensus.Node</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Node</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Node.InitStorage</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Node</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Node.ProtocolInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">ProtocolInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Storage.Serialisation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">DecodeDisk</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Util.IOLike</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Util.Orphans</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Util.ResourceRegistry</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ChainDB</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB.Impl.Args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">fromChainDbArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Storage.ImmutableDB</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ImmutableDB</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Storage.LedgerDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">SnapshotInterval</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>                     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">defaultDiskPolicy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">readSnapshot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Storage.VolatileDB</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">VolatileDB</span></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Tools.DBAnalyser.Analysis.html"><span class="hs-identifier">Cardano.Tools.DBAnalyser.Analysis</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Tools.DBAnalyser.HasAnalysis.html"><span class="hs-identifier">Cardano.Tools.DBAnalyser.HasAnalysis</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Tools.DBAnalyser.Types.html"><span class="hs-identifier">Cardano.Tools.DBAnalyser.Types</span></a></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Analyse
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="annot"><a href="Cardano.Tools.DBAnalyser.Run.html#analyse"><span class="hs-identifier hs-type">analyse</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-47"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679410636"><span class="annot"><a href="#local-6989586621679410636"><span class="hs-identifier hs-type">blk</span></a></span></span><span> </span><span class="hs-operator">.</span><span>
</span><span id="line-48"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Node.RunNode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679410636"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-49"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679410636"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tools.DBAnalyser.HasAnalysis.html#HasAnalysis"><span class="hs-identifier hs-type">HasAnalysis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679410636"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-51"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Tools.DBAnalyser.HasAnalysis.html#HasProtocolInfo"><span class="hs-identifier hs-type">HasProtocolInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679410636"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-52"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerSupportsMempool.HasTxs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679410636"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-53"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Tools.DBAnalyser.Types.html#DBAnalyserConfig"><span class="hs-identifier hs-type">DBAnalyserConfig</span></a></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Tools.DBAnalyser.HasAnalysis.html#Args"><span class="hs-identifier hs-type">Args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679410636"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Cardano.Tools.DBAnalyser.Analysis.html#AnalysisResult"><span class="hs-identifier hs-type">AnalysisResult</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span id="analyse"><span class="annot"><span class="annottext">analyse :: DBAnalyserConfig -&gt; Args blk -&gt; IO (Maybe AnalysisResult)
</span><a href="Cardano.Tools.DBAnalyser.Run.html#analyse"><span class="hs-identifier hs-var hs-var">analyse</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Tools.DBAnalyser.Types.html#DBAnalyserConfig"><span class="hs-identifier hs-type">DBAnalyserConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621679410633"><span class="annot"><span class="annottext">AnalysisName
analysis :: DBAnalyserConfig -&gt; AnalysisName
analysis :: AnalysisName
</span><a href="Cardano.Tools.DBAnalyser.Types.html#analysis"><span class="hs-identifier hs-var hs-var">analysis</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410631"><span class="annot"><span class="annottext">Limit
confLimit :: DBAnalyserConfig -&gt; Limit
confLimit :: Limit
</span><a href="Cardano.Tools.DBAnalyser.Types.html#confLimit"><span class="hs-identifier hs-var hs-var">confLimit</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410629"><span class="annot"><span class="annottext">FilePath
dbDir :: DBAnalyserConfig -&gt; FilePath
dbDir :: FilePath
</span><a href="Cardano.Tools.DBAnalyser.Types.html#dbDir"><span class="hs-identifier hs-var hs-var">dbDir</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410627"><span class="annot"><span class="annottext">SelectDB
selectDB :: DBAnalyserConfig -&gt; SelectDB
selectDB :: SelectDB
</span><a href="Cardano.Tools.DBAnalyser.Types.html#selectDB"><span class="hs-identifier hs-var hs-var">selectDB</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410625"><span class="annot"><span class="annottext">Maybe ValidateBlocks
validation :: DBAnalyserConfig -&gt; Maybe ValidateBlocks
validation :: Maybe ValidateBlocks
</span><a href="Cardano.Tools.DBAnalyser.Types.html#validation"><span class="hs-identifier hs-var hs-var">validation</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679410623"><span class="annot"><span class="annottext">Bool
verbose :: DBAnalyserConfig -&gt; Bool
verbose :: Bool
</span><a href="Cardano.Tools.DBAnalyser.Types.html#verbose"><span class="hs-identifier hs-var hs-var">verbose</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679410621"><span class="annot"><span class="annottext">Args blk
</span><a href="#local-6989586621679410621"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="annottext">(ResourceRegistry IO -&gt; IO (Maybe AnalysisResult))
-&gt; IO (Maybe AnalysisResult)
forall (m :: * -&gt; *) a.
(IOLike m, HasCallStack) =&gt;
(ResourceRegistry m -&gt; m a) -&gt; m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">withRegistry</span></a></span><span> </span><span class="annot"><span class="annottext">((ResourceRegistry IO -&gt; IO (Maybe AnalysisResult))
 -&gt; IO (Maybe AnalysisResult))
-&gt; (ResourceRegistry IO -&gt; IO (Maybe AnalysisResult))
-&gt; IO (Maybe AnalysisResult)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679410619"><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621679410619"><span class="hs-identifier hs-var">registry</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span>      </span><span id="local-6989586621679410618"><span class="annot"><span class="annottext">Tracer IO (TraceEvent blk)
</span><a href="#local-6989586621679410618"><span class="hs-identifier hs-var">chainDBTracer</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO (Tracer IO (TraceEvent blk))
forall (m :: * -&gt; *) a.
(MonadMonotonicTime m, Show a) =&gt;
Bool -&gt; m (Tracer IO a)
</span><a href="#local-6989586621679410617"><span class="hs-identifier hs-var">mkTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679410623"><span class="hs-identifier hs-var">verbose</span></a></span><span>
</span><span id="line-61"></span><span>      </span><span id="local-6989586621679410616"><span class="annot"><span class="annottext">Tracer IO (TraceEvent blk)
</span><a href="#local-6989586621679410616"><span class="hs-identifier hs-var">analysisTracer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO (Tracer IO (TraceEvent blk))
forall (m :: * -&gt; *) a.
(MonadMonotonicTime m, Show a) =&gt;
Bool -&gt; m (Tracer IO a)
</span><a href="#local-6989586621679410617"><span class="hs-identifier hs-var">mkTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-62"></span><span>      </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ProtocolInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pInfoInitLedger :: forall (m :: * -&gt; *) b. ProtocolInfo m b -&gt; ExtLedgerState b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">pInfoInitLedger</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679410613"><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621679410613"><span class="hs-identifier hs-var">genesisLedger</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pInfoConfig :: forall (m :: * -&gt; *) b. ProtocolInfo m b -&gt; TopLevelConfig b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">pInfoConfig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679410611"><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679410611"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><span class="annottext">Args blk -&gt; IO (ProtocolInfo IO blk)
forall blk.
HasProtocolInfo blk =&gt;
Args blk -&gt; IO (ProtocolInfo IO blk)
</span><a href="Cardano.Tools.DBAnalyser.HasAnalysis.html#mkProtocolInfo"><span class="hs-identifier hs-var">mkProtocolInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Args blk
</span><a href="#local-6989586621679410621"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-64"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410609"><span class="annot"><span class="annottext">chunkInfo :: ChunkInfo
</span><a href="#local-6989586621679410609"><span class="hs-identifier hs-var hs-var">chunkInfo</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StorageConfig blk -&gt; ChunkInfo
forall blk. NodeInitStorage blk =&gt; StorageConfig blk -&gt; ChunkInfo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Node.nodeImmutableDbChunkInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; StorageConfig blk
forall blk. TopLevelConfig blk -&gt; StorageConfig blk
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">configStorage</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679410611"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>          </span><span id="local-6989586621679410606"><span class="annot"><span class="annottext">k :: SecurityParam
</span><a href="#local-6989586621679410606"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; SecurityParam
forall blk.
ConsensusProtocol (BlockProtocol blk) =&gt;
TopLevelConfig blk -&gt; SecurityParam
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">configSecurityParam</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679410611"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-66"></span><span>          </span><span id="local-6989586621679410604"><span class="annot"><span class="annottext">diskPolicy :: DiskPolicy
</span><a href="#local-6989586621679410604"><span class="hs-identifier hs-var hs-var">diskPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecurityParam -&gt; SnapshotInterval -&gt; DiskPolicy
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">defaultDiskPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">SecurityParam
</span><a href="#local-6989586621679410606"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotInterval
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">DefaultSnapshotInterval</span></a></span><span>
</span><span id="line-67"></span><span>          </span><span id="local-6989586621679410602"><span class="annot"><span class="annottext">args' :: ChainDbArgs Identity IO blk
</span><a href="#local-6989586621679410602"><span class="hs-identifier hs-var hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-68"></span><span>            </span><span class="annot"><span class="annottext">ResourceRegistry IO
-&gt; CheckInFuture IO blk
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; ChunkInfo
-&gt; ChainDbArgs Defaults IO blk
-&gt; ChainDbArgs Identity IO blk
forall (m :: * -&gt; *) blk.
(RunNode blk, IOLike m) =&gt;
ResourceRegistry m
-&gt; CheckInFuture m blk
-&gt; TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; ChunkInfo
-&gt; ChainDbArgs Defaults m blk
-&gt; ChainDbArgs Identity m blk
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-diffusion-0.3.1.0/noopt/doc/html/ouroboros-consensus-diffusion/src"><span class="hs-identifier hs-var">Node.mkChainDbArgs</span></a></span><span>
</span><span id="line-69"></span><span>              </span><span class="annot"><span class="annottext">ResourceRegistry IO
</span><a href="#local-6989586621679410619"><span class="hs-identifier hs-var">registry</span></a></span><span> </span><span class="annot"><span class="annottext">CheckInFuture IO blk
forall (m :: * -&gt; *) blk. Monad m =&gt; CheckInFuture m blk
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">InFuture.dontCheck</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679410611"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621679410613"><span class="hs-identifier hs-var">genesisLedger</span></a></span><span> </span><span class="annot"><span class="annottext">ChunkInfo
</span><a href="#local-6989586621679410609"><span class="hs-identifier hs-var">chunkInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainDbArgs Defaults IO blk -&gt; ChainDbArgs Identity IO blk)
-&gt; ChainDbArgs Defaults IO blk -&gt; ChainDbArgs Identity IO blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-70"></span><span>            </span><span class="annot"><span class="annottext">(RelativeMountPoint -&gt; SomeHasFS IO)
-&gt; DiskPolicy -&gt; ChainDbArgs Defaults IO blk
forall (m :: * -&gt; *) blk.
Monad m =&gt;
(RelativeMountPoint -&gt; SomeHasFS m)
-&gt; DiskPolicy -&gt; ChainDbArgs Defaults m blk
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ChainDB.defaultArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; RelativeMountPoint -&gt; SomeHasFS IO
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-diffusion-0.3.1.0/noopt/doc/html/ouroboros-consensus-diffusion/src"><span class="hs-identifier hs-var">Node.stdMkChainDbHasFS</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679410629"><span class="hs-identifier hs-var">dbDir</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DiskPolicy
</span><a href="#local-6989586621679410604"><span class="hs-identifier hs-var">diskPolicy</span></a></span><span>
</span><span id="line-71"></span><span>          </span><span id="local-6989586621679410597"><span class="annot"><span class="annottext">chainDbArgs :: ChainDbArgs Identity IO blk
</span><a href="#local-6989586621679410597"><span class="hs-identifier hs-var hs-var">chainDbArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk
</span><a href="#local-6989586621679410602"><span class="hs-identifier hs-var">args'</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-72"></span><span>              </span><span class="annot"><span class="annottext">cdbImmutableDbValidation :: ValidationPolicy
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ChainDB.cdbImmutableDbValidation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidationPolicy
</span><a href="#local-6989586621679410595"><span class="hs-identifier hs-var">immValidationPolicy</span></a></span><span>
</span><span id="line-73"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbVolatileDbValidation :: BlockValidationPolicy
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ChainDB.cdbVolatileDbValidation</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockValidationPolicy
</span><a href="#local-6989586621679410593"><span class="hs-identifier hs-var">volValidationPolicy</span></a></span><span>
</span><span id="line-74"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cdbTracer :: Tracer IO (TraceEvent blk)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ChainDB.cdbTracer</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO (TraceEvent blk)
</span><a href="#local-6989586621679410618"><span class="hs-identifier hs-var">chainDBTracer</span></a></span><span>
</span><span id="line-75"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-76"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679410591"><span class="annot"><span class="annottext">ImmutableDbArgs Identity IO blk
</span><a href="#local-6989586621679410591"><span class="hs-identifier hs-var">immutableDbArgs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VolatileDbArgs Identity IO blk
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LgrDbArgs Identity IO blk
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ChainDbSpecificArgs Identity IO blk
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk
-&gt; (ImmutableDbArgs Identity IO blk,
    VolatileDbArgs Identity IO blk, LgrDbArgs Identity IO blk,
    ChainDbSpecificArgs Identity IO blk)
forall (m :: * -&gt; *) blk (f :: * -&gt; *).
MapHKD f =&gt;
ChainDbArgs f m blk
-&gt; (ImmutableDbArgs f m blk, VolatileDbArgs f m blk,
    LgrDbArgs f m blk, ChainDbSpecificArgs f m blk)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">fromChainDbArgs</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk
</span><a href="#local-6989586621679410597"><span class="hs-identifier hs-var">chainDbArgs</span></a></span><span>
</span><span id="line-77"></span><span>          </span><span id="local-6989586621679410590"><span class="annot"><span class="annottext">ledgerDbFS :: SomeHasFS IO
</span><a href="#local-6989586621679410590"><span class="hs-identifier hs-var hs-var">ledgerDbFS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk -&gt; SomeHasFS IO
forall (f :: * -&gt; *) (m :: * -&gt; *) blk.
ChainDbArgs f m blk -&gt; SomeHasFS m
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var">ChainDB.cdbHasFSLgrDB</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk
</span><a href="#local-6989586621679410597"><span class="hs-identifier hs-var">chainDbArgs</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SelectDB
</span><a href="#local-6989586621679410627"><span class="hs-identifier hs-var">selectDB</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><a href="Cardano.Tools.DBAnalyser.Types.html#SelectImmutableDB"><span class="hs-identifier hs-type">SelectImmutableDB</span></a></span><span> </span><span id="local-6989586621679410587"><span class="annot"><span class="annottext">Maybe DiskSnapshot
</span><a href="#local-6989586621679410587"><span class="hs-identifier hs-var">initializeFrom</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-81"></span><span>          </span><span class="hs-comment">-- TODO we need to check if the snapshot exists. If not, print an</span><span>
</span><span id="line-82"></span><span>          </span><span class="hs-comment">-- error and ask the user if she wanted to create a snapshot first and</span><span>
</span><span id="line-83"></span><span>          </span><span class="hs-comment">-- how to do it.</span><span>
</span><span id="line-84"></span><span>          </span><span id="local-6989586621679410586"><span class="annot"><span class="annottext">Either ReadIncrementalErr (ExtLedgerState blk)
</span><a href="#local-6989586621679410586"><span class="hs-identifier hs-var">initLedgerErr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ReadIncrementalErr IO (ExtLedgerState blk)
-&gt; IO (Either ReadIncrementalErr (ExtLedgerState blk))
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ReadIncrementalErr IO (ExtLedgerState blk)
 -&gt; IO (Either ReadIncrementalErr (ExtLedgerState blk)))
-&gt; ExceptT ReadIncrementalErr IO (ExtLedgerState blk)
-&gt; IO (Either ReadIncrementalErr (ExtLedgerState blk))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe DiskSnapshot
</span><a href="#local-6989586621679410587"><span class="hs-identifier hs-var">initializeFrom</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-85"></span><span>            </span><span class="annot"><span class="annottext">Maybe DiskSnapshot
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ExtLedgerState blk
-&gt; ExceptT ReadIncrementalErr IO (ExtLedgerState blk)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621679410613"><span class="hs-identifier hs-var">genesisLedger</span></a></span><span>
</span><span id="line-86"></span><span>            </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679410585"><span class="annot"><span class="annottext">DiskSnapshot
</span><a href="#local-6989586621679410585"><span class="hs-identifier hs-var">snapshot</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeHasFS IO
-&gt; (forall s. Decoder s (ExtLedgerState blk))
-&gt; (forall s. Decoder s (HeaderHash blk))
-&gt; DiskSnapshot
-&gt; ExceptT ReadIncrementalErr IO (ExtLedgerState blk)
forall (m :: * -&gt; *) blk.
IOLike m =&gt;
SomeHasFS m
-&gt; (forall s. Decoder s (ExtLedgerState blk))
-&gt; (forall s. Decoder s (HeaderHash blk))
-&gt; DiskSnapshot
-&gt; ExceptT ReadIncrementalErr m (ExtLedgerState blk)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">readSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">SomeHasFS IO
</span><a href="#local-6989586621679410590"><span class="hs-identifier hs-var">ledgerDbFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; Decoder s (ExtLedgerState blk)
forall s. TopLevelConfig blk -&gt; Decoder s (ExtLedgerState blk)
</span><a href="#local-6989586621679410584"><span class="hs-identifier hs-var">decodeExtLedgerState'</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679410611"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall s. Decoder s (HeaderHash blk)
forall a s. Serialise a =&gt; Decoder s a
</span><span class="hs-identifier hs-var">decode</span></span><span> </span><span class="annot"><span class="annottext">DiskSnapshot
</span><a href="#local-6989586621679410585"><span class="hs-identifier hs-var">snapshot</span></a></span><span>
</span><span id="line-87"></span><span>              </span><span class="hs-comment">-- TODO @readSnapshot@ has type @ExceptT ReadIncrementalErr m</span><span>
</span><span id="line-88"></span><span>              </span><span class="hs-comment">-- (ExtLedgerState blk)@ but it also throws exceptions! This makes</span><span>
</span><span id="line-89"></span><span>              </span><span class="hs-comment">-- error handling more challenging than it ought to be. Maybe we</span><span>
</span><span id="line-90"></span><span>              </span><span class="hs-comment">-- can enrich the error that @readSnapthot@ return, so that it can</span><span>
</span><span id="line-91"></span><span>              </span><span class="hs-comment">-- contain the @HasFS@ errors as well.</span><span>
</span><span id="line-92"></span><span>          </span><span id="local-6989586621679410583"><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621679410583"><span class="hs-identifier hs-var">initLedger</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ReadIncrementalErr -&gt; IO (ExtLedgerState blk))
-&gt; (ExtLedgerState blk -&gt; IO (ExtLedgerState blk))
-&gt; Either ReadIncrementalErr (ExtLedgerState blk)
-&gt; IO (ExtLedgerState blk)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; IO (ExtLedgerState blk)
forall a. HasCallStack =&gt; FilePath -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO (ExtLedgerState blk))
-&gt; (ReadIncrementalErr -&gt; FilePath)
-&gt; ReadIncrementalErr
-&gt; IO (ExtLedgerState blk)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ReadIncrementalErr -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExtLedgerState blk -&gt; IO (ExtLedgerState blk)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Either ReadIncrementalErr (ExtLedgerState blk)
</span><a href="#local-6989586621679410586"><span class="hs-identifier hs-var">initLedgerErr</span></a></span><span>
</span><span id="line-93"></span><span>          </span><span class="hs-comment">-- This marker divides the &quot;loading&quot; phase of the program, where the</span><span>
</span><span id="line-94"></span><span>          </span><span class="hs-comment">-- system is principally occupied with reading snapshot data from</span><span>
</span><span id="line-95"></span><span>          </span><span class="hs-comment">-- disk, from the &quot;processing&quot; phase, where we are streaming blocks</span><span>
</span><span id="line-96"></span><span>          </span><span class="hs-comment">-- and running the ledger processing on them.</span><span>
</span><span id="line-97"></span><span>          </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Debug.traceMarkerIO</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;SNAPSHOT_LOADED&quot;</span></span><span>
</span><span id="line-98"></span><span>          </span><span class="annot"><span class="annottext">IO (ImmutableDB IO blk)
-&gt; (ImmutableDB IO blk -&gt; IO (Maybe AnalysisResult))
-&gt; IO (Maybe AnalysisResult)
forall (m :: * -&gt; *) blk a.
(HasCallStack, MonadThrow m) =&gt;
m (ImmutableDB m blk) -&gt; (ImmutableDB m blk -&gt; m a) -&gt; m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ImmutableDB.withDB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImmutableDbArgs Identity IO blk
-&gt; (forall st.
    WithTempRegistry st IO (ImmutableDB IO blk, st)
    -&gt; IO (ImmutableDB IO blk))
-&gt; IO (ImmutableDB IO blk)
forall (m :: * -&gt; *) blk ans.
(IOLike m, GetPrevHash blk, ConvertRawHash blk,
 ImmutableDbSerialiseConstraints blk, HasCallStack) =&gt;
ImmutableDbArgs Identity m blk
-&gt; (forall st.
    WithTempRegistry st m (ImmutableDB m blk, st) -&gt; ans)
-&gt; ans
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ImmutableDB.openDB</span></a></span><span> </span><span class="annot"><span class="annottext">ImmutableDbArgs Identity IO blk
</span><a href="#local-6989586621679410591"><span class="hs-identifier hs-var">immutableDbArgs</span></a></span><span> </span><span class="annot"><span class="annottext">forall st.
WithTempRegistry st IO (ImmutableDB IO blk, st)
-&gt; IO (ImmutableDB IO blk)
forall (m :: * -&gt; *) st a.
(IOLike m, HasCallStack) =&gt;
WithTempRegistry st m (a, st) -&gt; m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">runWithTempRegistry</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ImmutableDB IO blk -&gt; IO (Maybe AnalysisResult))
 -&gt; IO (Maybe AnalysisResult))
-&gt; (ImmutableDB IO blk -&gt; IO (Maybe AnalysisResult))
-&gt; IO (Maybe AnalysisResult)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679410574"><span class="annot"><span class="annottext">ImmutableDB IO blk
</span><a href="#local-6989586621679410574"><span class="hs-identifier hs-var">immutableDB</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-99"></span><span>            </span><span id="local-6989586621679410573"><span class="annot"><span class="annottext">Maybe AnalysisResult
</span><a href="#local-6989586621679410573"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AnalysisName -&gt; Analysis blk
forall blk.
(HasAnalysis blk, HasTxId (GenTx blk), HasTxs blk,
 LedgerSupportsMempool blk, LedgerSupportsProtocol blk,
 LgrDbSerialiseConstraints blk) =&gt;
AnalysisName -&gt; Analysis blk
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#runAnalysis"><span class="hs-identifier hs-var">runAnalysis</span></a></span><span> </span><span class="annot"><span class="annottext">AnalysisName
</span><a href="#local-6989586621679410633"><span class="hs-identifier hs-var">analysis</span></a></span><span> </span><span class="annot"><span class="annottext">Analysis blk -&gt; Analysis blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AnalysisEnv :: forall (m :: * -&gt; *) blk.
TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; Either (ImmutableDB IO blk) (ChainDB IO blk)
-&gt; ResourceRegistry IO
-&gt; SomeHasFS IO
-&gt; Limit
-&gt; Tracer m (TraceEvent blk)
-&gt; AnalysisEnv m blk
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#AnalysisEnv"><span class="hs-identifier hs-type">AnalysisEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-100"></span><span>                </span><span class="annot"><span class="annottext">TopLevelConfig blk
cfg :: TopLevelConfig blk
cfg :: TopLevelConfig blk
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#cfg"><span class="hs-identifier hs-var hs-var">cfg</span></a></span><span>
</span><span id="line-101"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExtLedgerState blk
initLedger :: ExtLedgerState blk
initLedger :: ExtLedgerState blk
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#initLedger"><span class="hs-identifier hs-var hs-var">initLedger</span></a></span><span>
</span><span id="line-102"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">db :: Either (ImmutableDB IO blk) (ChainDB IO blk)
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#db"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImmutableDB IO blk -&gt; Either (ImmutableDB IO blk) (ChainDB IO blk)
forall a b. a -&gt; Either a b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">ImmutableDB IO blk
</span><a href="#local-6989586621679410574"><span class="hs-identifier hs-var">immutableDB</span></a></span><span>
</span><span id="line-103"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ResourceRegistry IO
registry :: ResourceRegistry IO
registry :: ResourceRegistry IO
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#registry"><span class="hs-identifier hs-var hs-var">registry</span></a></span><span>
</span><span id="line-104"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ledgerDbFS :: SomeHasFS IO
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#ledgerDbFS"><span class="hs-identifier hs-var">ledgerDbFS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeHasFS IO
</span><a href="#local-6989586621679410590"><span class="hs-identifier hs-var">ledgerDbFS</span></a></span><span>
</span><span id="line-105"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">limit :: Limit
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#limit"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Limit
</span><a href="#local-6989586621679410631"><span class="hs-identifier hs-var">confLimit</span></a></span><span>
</span><span id="line-106"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tracer :: Tracer IO (TraceEvent blk)
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#tracer"><span class="hs-identifier hs-var">tracer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO (TraceEvent blk)
</span><a href="#local-6989586621679410616"><span class="hs-identifier hs-var">analysisTracer</span></a></span><span>
</span><span id="line-107"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-108"></span><span>            </span><span id="local-6989586621679410563"><span class="annot"><span class="annottext">Point blk
</span><a href="#local-6989586621679410563"><span class="hs-identifier hs-var">tipPoint</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM IO (Point blk) -&gt; IO (Point blk)
forall (m :: * -&gt; *) a.
(MonadSTM m, HasCallStack) =&gt;
STM m a -&gt; m a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM IO (Point blk) -&gt; IO (Point blk))
-&gt; STM IO (Point blk) -&gt; IO (Point blk)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ImmutableDB IO blk -&gt; STM IO (Point blk)
forall (m :: * -&gt; *) blk.
(MonadSTM m, HasCallStack) =&gt;
ImmutableDB m blk -&gt; STM m (Point blk)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ImmutableDB.getTipPoint</span></a></span><span> </span><span class="annot"><span class="annottext">ImmutableDB IO blk
</span><a href="#local-6989586621679410574"><span class="hs-identifier hs-var">immutableDB</span></a></span><span>
</span><span id="line-109"></span><span>            </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">putStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;ImmutableDB tip: &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Point blk -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Point blk
</span><a href="#local-6989586621679410563"><span class="hs-identifier hs-var">tipPoint</span></a></span><span>
</span><span id="line-110"></span><span>            </span><span class="annot"><span class="annottext">Maybe AnalysisResult -&gt; IO (Maybe AnalysisResult)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe AnalysisResult
</span><a href="#local-6989586621679410573"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="annottext">SelectDB
</span><a href="Cardano.Tools.DBAnalyser.Types.html#SelectChainDB"><span class="hs-identifier hs-var">SelectChainDB</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-112"></span><span>          </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk
-&gt; (ChainDB IO blk -&gt; IO (Maybe AnalysisResult))
-&gt; IO (Maybe AnalysisResult)
forall (m :: * -&gt; *) blk a.
(IOLike m, LedgerSupportsProtocol blk, InspectLedger blk,
 HasHardForkHistory blk, ConvertRawHash blk,
 SerialiseDiskConstraints blk) =&gt;
ChainDbArgs Identity m blk -&gt; (ChainDB m blk -&gt; m a) -&gt; m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ChainDB.withDB</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDbArgs Identity IO blk
</span><a href="#local-6989586621679410597"><span class="hs-identifier hs-var">chainDbArgs</span></a></span><span> </span><span class="annot"><span class="annottext">((ChainDB IO blk -&gt; IO (Maybe AnalysisResult))
 -&gt; IO (Maybe AnalysisResult))
-&gt; (ChainDB IO blk -&gt; IO (Maybe AnalysisResult))
-&gt; IO (Maybe AnalysisResult)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679410557"><span class="annot"><span class="annottext">ChainDB IO blk
</span><a href="#local-6989586621679410557"><span class="hs-identifier hs-var">chainDB</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>            </span><span id="local-6989586621679410556"><span class="annot"><span class="annottext">Maybe AnalysisResult
</span><a href="#local-6989586621679410556"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AnalysisName -&gt; Analysis blk
forall blk.
(HasAnalysis blk, HasTxId (GenTx blk), HasTxs blk,
 LedgerSupportsMempool blk, LedgerSupportsProtocol blk,
 LgrDbSerialiseConstraints blk) =&gt;
AnalysisName -&gt; Analysis blk
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#runAnalysis"><span class="hs-identifier hs-var">runAnalysis</span></a></span><span> </span><span class="annot"><span class="annottext">AnalysisName
</span><a href="#local-6989586621679410633"><span class="hs-identifier hs-var">analysis</span></a></span><span> </span><span class="annot"><span class="annottext">Analysis blk -&gt; Analysis blk
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AnalysisEnv :: forall (m :: * -&gt; *) blk.
TopLevelConfig blk
-&gt; ExtLedgerState blk
-&gt; Either (ImmutableDB IO blk) (ChainDB IO blk)
-&gt; ResourceRegistry IO
-&gt; SomeHasFS IO
-&gt; Limit
-&gt; Tracer m (TraceEvent blk)
-&gt; AnalysisEnv m blk
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#AnalysisEnv"><span class="hs-identifier hs-type">AnalysisEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-114"></span><span>                </span><span class="annot"><span class="annottext">TopLevelConfig blk
cfg :: TopLevelConfig blk
cfg :: TopLevelConfig blk
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#cfg"><span class="hs-identifier hs-var hs-var">cfg</span></a></span><span>
</span><span id="line-115"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">initLedger :: ExtLedgerState blk
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#initLedger"><span class="hs-identifier hs-var">initLedger</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExtLedgerState blk
</span><a href="#local-6989586621679410613"><span class="hs-identifier hs-var">genesisLedger</span></a></span><span>
</span><span id="line-116"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">db :: Either (ImmutableDB IO blk) (ChainDB IO blk)
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#db"><span class="hs-identifier hs-var">db</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainDB IO blk -&gt; Either (ImmutableDB IO blk) (ChainDB IO blk)
forall a b. b -&gt; Either a b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDB IO blk
</span><a href="#local-6989586621679410557"><span class="hs-identifier hs-var">chainDB</span></a></span><span>
</span><span id="line-117"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ResourceRegistry IO
registry :: ResourceRegistry IO
registry :: ResourceRegistry IO
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#registry"><span class="hs-identifier hs-var hs-var">registry</span></a></span><span>
</span><span id="line-118"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ledgerDbFS :: SomeHasFS IO
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#ledgerDbFS"><span class="hs-identifier hs-var">ledgerDbFS</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeHasFS IO
</span><a href="#local-6989586621679410590"><span class="hs-identifier hs-var">ledgerDbFS</span></a></span><span>
</span><span id="line-119"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">limit :: Limit
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#limit"><span class="hs-identifier hs-var">limit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Limit
</span><a href="#local-6989586621679410631"><span class="hs-identifier hs-var">confLimit</span></a></span><span>
</span><span id="line-120"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tracer :: Tracer IO (TraceEvent blk)
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#tracer"><span class="hs-identifier hs-var">tracer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO (TraceEvent blk)
</span><a href="#local-6989586621679410616"><span class="hs-identifier hs-var">analysisTracer</span></a></span><span>
</span><span id="line-121"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-122"></span><span>            </span><span id="local-6989586621679410555"><span class="annot"><span class="annottext">Point blk
</span><a href="#local-6989586621679410555"><span class="hs-identifier hs-var">tipPoint</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM IO (Point blk) -&gt; IO (Point blk)
forall (m :: * -&gt; *) a.
(MonadSTM m, HasCallStack) =&gt;
STM m a -&gt; m a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM IO (Point blk) -&gt; IO (Point blk))
-&gt; STM IO (Point blk) -&gt; IO (Point blk)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDB IO blk -&gt; STM IO (Point blk)
forall (m :: * -&gt; *) blk. ChainDB m blk -&gt; STM m (Point blk)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var">ChainDB.getTipPoint</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDB IO blk
</span><a href="#local-6989586621679410557"><span class="hs-identifier hs-var">chainDB</span></a></span><span>
</span><span id="line-123"></span><span>            </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">putStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;ChainDB tip: &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Point blk -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Point blk
</span><a href="#local-6989586621679410555"><span class="hs-identifier hs-var">tipPoint</span></a></span><span>
</span><span id="line-124"></span><span>            </span><span class="annot"><span class="annottext">Maybe AnalysisResult -&gt; IO (Maybe AnalysisResult)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe AnalysisResult
</span><a href="#local-6989586621679410556"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621679410617"><span class="annot"><span class="annottext">mkTracer :: Bool -&gt; m (Tracer IO a)
</span><a href="#local-6989586621679410617"><span class="hs-identifier hs-var hs-var">mkTracer</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tracer IO a -&gt; m (Tracer IO a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO a
forall (m :: * -&gt; *) a. Applicative m =&gt; Tracer m a
</span><span class="hs-identifier hs-var">nullTracer</span></span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><a href="#local-6989586621679410617"><span class="hs-identifier hs-var">mkTracer</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>      </span><span id="local-6989586621679410553"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679410553"><span class="hs-identifier hs-var">startTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Time
forall (m :: * -&gt; *). MonadMonotonicTime m =&gt; m Time
</span><span class="hs-identifier hs-var">getMonotonicTime</span></span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><span class="annottext">Tracer IO a -&gt; m (Tracer IO a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Tracer IO a -&gt; m (Tracer IO a)) -&gt; Tracer IO a -&gt; m (Tracer IO a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; IO ()) -&gt; Tracer IO a
forall (m :: * -&gt; *) a. (a -&gt; m ()) -&gt; Tracer m a
</span><span class="hs-identifier hs-var">Tracer</span></span><span> </span><span class="annot"><span class="annottext">((a -&gt; IO ()) -&gt; Tracer IO a) -&gt; (a -&gt; IO ()) -&gt; Tracer IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679410550"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410550"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-130"></span><span>        </span><span id="local-6989586621679410549"><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679410549"><span class="hs-identifier hs-var">traceTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Time
forall (m :: * -&gt; *). MonadMonotonicTime m =&gt; m Time
</span><span class="hs-identifier hs-var">getMonotonicTime</span></span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410548"><span class="annot"><span class="annottext">diff :: DiffTime
</span><a href="#local-6989586621679410548"><span class="hs-identifier hs-var hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Time -&gt; Time -&gt; DiffTime
</span><span class="hs-identifier hs-var">diffTime</span></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679410549"><span class="hs-identifier hs-var">traceTime</span></a></span><span> </span><span class="annot"><span class="annottext">Time
</span><a href="#local-6989586621679410553"><span class="hs-identifier hs-var">startTime</span></a></span><span>
</span><span id="line-132"></span><span>        </span><span class="annot"><span class="annottext">Handle -&gt; FilePath -&gt; IO ()
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">hPutStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">stderr</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; FilePath
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;[&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621679410548"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;] &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679410550"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">hFlush</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">stderr</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621679410595"><span class="annot"><span class="annottext">immValidationPolicy :: ValidationPolicy
</span><a href="#local-6989586621679410595"><span class="hs-identifier hs-var hs-var">immValidationPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnalysisName
</span><a href="#local-6989586621679410633"><span class="hs-identifier hs-var">analysis</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ValidateBlocks
</span><a href="#local-6989586621679410625"><span class="hs-identifier hs-var">validation</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-136"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnalysisName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ValidateBlocks
</span><a href="Cardano.Tools.DBAnalyser.Types.html#ValidateAllBlocks"><span class="hs-identifier hs-var">ValidateAllBlocks</span></a></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValidationPolicy
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ImmutableDB.ValidateAllChunks</span></a></span><span>
</span><span id="line-137"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnalysisName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ValidateBlocks
</span><a href="Cardano.Tools.DBAnalyser.Types.html#MinimumBlockValidation"><span class="hs-identifier hs-var">MinimumBlockValidation</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValidationPolicy
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ImmutableDB.ValidateMostRecentChunk</span></a></span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnalysisName
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#OnlyValidation"><span class="hs-identifier hs-var">OnlyValidation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ValidateBlocks
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValidationPolicy
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ImmutableDB.ValidateAllChunks</span></a></span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><span class="annottext">(AnalysisName, Maybe ValidateBlocks)
</span><span class="hs-identifier">_</span></span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValidationPolicy
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ImmutableDB.ValidateMostRecentChunk</span></a></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621679410593"><span class="annot"><span class="annottext">volValidationPolicy :: BlockValidationPolicy
</span><a href="#local-6989586621679410593"><span class="hs-identifier hs-var hs-var">volValidationPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnalysisName
</span><a href="#local-6989586621679410633"><span class="hs-identifier hs-var">analysis</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ValidateBlocks
</span><a href="#local-6989586621679410625"><span class="hs-identifier hs-var">validation</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-142"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnalysisName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ValidateBlocks
</span><a href="Cardano.Tools.DBAnalyser.Types.html#ValidateAllBlocks"><span class="hs-identifier hs-var">ValidateAllBlocks</span></a></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockValidationPolicy
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">VolatileDB.ValidateAll</span></a></span><span>
</span><span id="line-143"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnalysisName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ValidateBlocks
</span><a href="Cardano.Tools.DBAnalyser.Types.html#MinimumBlockValidation"><span class="hs-identifier hs-var">MinimumBlockValidation</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockValidationPolicy
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">VolatileDB.NoValidation</span></a></span><span>
</span><span id="line-144"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AnalysisName
</span><a href="Cardano.Tools.DBAnalyser.Analysis.html#OnlyValidation"><span class="hs-identifier hs-var">OnlyValidation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ValidateBlocks
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockValidationPolicy
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">VolatileDB.ValidateAll</span></a></span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><span class="annottext">(AnalysisName, Maybe ValidateBlocks)
</span><span class="hs-identifier">_</span></span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockValidationPolicy
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">VolatileDB.NoValidation</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><a href="#local-6989586621679410584"><span class="hs-identifier hs-type">decodeExtLedgerState'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679410733"><span class="annot"><a href="#local-6989586621679410733"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">TopLevelConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679410636"><span class="hs-identifier hs-type">blk</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679410733"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ExtLedgerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679410636"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621679410584"><span class="annot"><span class="annottext">decodeExtLedgerState' :: TopLevelConfig blk -&gt; Decoder s (ExtLedgerState blk)
</span><a href="#local-6989586621679410584"><span class="hs-identifier hs-var hs-var">decodeExtLedgerState'</span></a></span></span><span> </span><span id="local-6989586621679410535"><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679410535"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-149"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679410534"><span class="annot"><span class="annottext">ccfg :: CodecConfig blk
</span><a href="#local-6989586621679410534"><span class="hs-identifier hs-var hs-var">ccfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk -&gt; CodecConfig blk
forall blk. TopLevelConfig blk -&gt; CodecConfig blk
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">configCodec</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig blk
</span><a href="#local-6989586621679410535"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-150"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s (LedgerState blk))
-&gt; (forall s. Decoder s (ChainDepState (BlockProtocol blk)))
-&gt; (forall s. Decoder s (AnnTip blk))
-&gt; forall s. Decoder s (ExtLedgerState blk)
forall blk.
(forall s. Decoder s (LedgerState blk))
-&gt; (forall s. Decoder s (ChainDepState (BlockProtocol blk)))
-&gt; (forall s. Decoder s (AnnTip blk))
-&gt; forall s. Decoder s (ExtLedgerState blk)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeExtLedgerState</span></a></span><span>
</span><span id="line-151"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; forall s. Decoder s (LedgerState blk)
forall blk a.
DecodeDisk blk a =&gt;
CodecConfig blk -&gt; forall s. Decoder s a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679410534"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk
-&gt; forall s. Decoder s (ChainDepState (BlockProtocol blk))
forall blk a.
DecodeDisk blk a =&gt;
CodecConfig blk -&gt; forall s. Decoder s a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679410534"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecConfig blk -&gt; forall s. Decoder s (AnnTip blk)
forall blk a.
DecodeDisk blk a =&gt;
CodecConfig blk -&gt; forall s. Decoder s a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">decodeDisk</span></a></span><span> </span><span class="annot"><span class="annottext">CodecConfig blk
</span><a href="#local-6989586621679410534"><span class="hs-identifier hs-var">ccfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span></pre></body></html>