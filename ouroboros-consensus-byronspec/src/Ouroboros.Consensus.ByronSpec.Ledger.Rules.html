<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards     #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">-- | Thin wrapper around the Byron spec rules</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- Intended for qualified import</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- import qualified Ouroboros.Consensus.ByronSpec.Ledger.Rules as Rules</span><span>
</span><span id="line-13"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Rules</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Ledger</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#applyChainTick"><span class="hs-identifier">applyChainTick</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Lift STS transition rules to the chain level</span></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftCHAIN"><span class="hs-identifier">liftCHAIN</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftSDELEG"><span class="hs-identifier">liftSDELEG</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftUPIREG"><span class="hs-identifier">liftUPIREG</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftUPIVOTE"><span class="hs-identifier">liftUPIVOTE</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftUTXOW"><span class="hs-identifier">liftUTXOW</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="hs-comment">-- * STS initial rules</span></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#initStateCHAIN"><span class="hs-identifier">initStateCHAIN</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Rule context (exported for the benefit of the tests</span></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier">RuleContext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtCHAIN"><span class="hs-identifier">ctxtCHAIN</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtDELEG"><span class="hs-identifier">ctxtDELEG</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtEPOCH"><span class="hs-identifier">ctxtEPOCH</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtSDELEG"><span class="hs-identifier">ctxtSDELEG</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIREG"><span class="hs-identifier">ctxtUPIREG</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIVOTE"><span class="hs-identifier">ctxtUPIVOTE</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUTXOW"><span class="hs-identifier">ctxtUTXOW</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier">Control.Monad.Trans.Except</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Functor.Identity</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Chain.STS.Rule.BBody</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Chain.STS.Rule.Bupi</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Chain.STS.Rule.Chain</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Chain.STS.Rule.Epoch</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Ledger.Core</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Ledger.Delegation</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Ledger.STS.UTXO</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Ledger.STS.UTXOW</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Ledger.STS.UTXOWS</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Byron.Spec.Ledger.Update</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.State.Transition</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Spec</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html"><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Accessors</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html"><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Genesis</span></a></span><span>
</span><span id="line-55"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier">ByronSpecGenesis</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html"><span class="hs-identifier">Ouroboros.Consensus.ByronSpec.Ledger.Genesis</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Genesis</span></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Chain tick
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">-- | Chain tick</span><span>
</span><span id="line-63"></span><span class="hs-comment">--</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- There isn't something in the spec that directly corresponds to this, so we</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- have to combine a few different things:</span><span>
</span><span id="line-66"></span><span class="hs-comment">--</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- 1. Apply the epoch rule (update the update state)</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- 2. Apply any scheduled delegations</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- 3. Set the slot number</span><span>
</span><span id="line-70"></span><span class="hs-comment">--</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- This matches quite closely what 'applyChainTick' in</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- &quot;Ouroboros.Consensus.Ledger.Byron.Auxiliary&quot; does.</span><span>
</span><span id="line-73"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#applyChainTick"><span class="hs-identifier hs-type">applyChainTick</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span>
</span><span id="line-74"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.Slot</span></span><span>
</span><span id="line-75"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span>
</span><span id="line-76"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span>
</span><span id="line-77"></span><span id="applyChainTick"><span class="annot"><span class="annottext">applyChainTick :: ByronSpecGenesis -&gt; Slot -&gt; State CHAIN -&gt; State CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#applyChainTick"><span class="hs-identifier hs-var hs-var">applyChainTick</span></a></span></span><span> </span><span id="local-6989586621679225037"><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679225037"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621679225036"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679225036"><span class="hs-identifier hs-var">slot</span></a></span></span><span> </span><span id="local-6989586621679225035"><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679225035"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Except
  [ChainPredicateFailure]
  (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Either
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall e a. Except e a -&gt; Either e a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">runExcept</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State CHAIN -&gt; Except [PredicateFailure CHAIN] (State CHAIN)
</span><a href="#local-6989586621679225033"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679225035"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-79"></span><span>      </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span>  </span><span class="annot"><span class="annottext">[ChainPredicateFailure]
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;applyChainTick: unexpected failure&quot;</span></span><span>
</span><span id="line-80"></span><span>      </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679225031"><span class="annot"><span class="annottext">(Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
</span><a href="#local-6989586621679225031"><span class="hs-identifier hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
State CHAIN
</span><a href="#local-6989586621679225031"><span class="hs-identifier hs-var">st'</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="#local-6989586621679225033"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span>
</span><span id="line-83"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">Except</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Spec.PredicateFailure</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Spec.State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>    </span><span id="local-6989586621679225033"><span class="annot"><span class="annottext">go :: State CHAIN -&gt; Except [PredicateFailure CHAIN] (State CHAIN)
</span><a href="#local-6989586621679225033"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-comment">-- Apply EPOCH rule (deals with update proposals)</span><span>
</span><span id="line-85"></span><span>          </span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; LiftedRule EPOCH
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftEPOCH"><span class="hs-identifier hs-var">liftEPOCH</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679225037"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
Signal EPOCH
</span><a href="#local-6989586621679225036"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>          </span><span class="hs-comment">-- Apply scheduled delegations (empty list of new delegation certs)</span><span>
</span><span id="line-88"></span><span>      </span><span class="annot"><span class="annottext">((Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
 -&gt; Except
      [ChainPredicateFailure]
      (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState))
-&gt; ((Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
    -&gt; Except
         [ChainPredicateFailure]
         (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState))
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;=&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; LiftedRule DELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftDELEG"><span class="hs-identifier hs-var">liftDELEG</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679225037"><span class="hs-identifier hs-var">cfg</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Lift STS transition rules to the chain level
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Apply a block</span><span>
</span><span id="line-95"></span><span class="hs-comment">--</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- This is a &quot;trivial&quot; (identity) lift.</span><span>
</span><span id="line-97"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftCHAIN"><span class="hs-identifier hs-type">liftCHAIN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#LiftedRule"><span class="hs-identifier hs-type">LiftedRule</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span>
</span><span id="line-98"></span><span id="liftCHAIN"><span class="annot"><span class="annottext">liftCHAIN :: ByronSpecGenesis -&gt; LiftedRule CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftCHAIN"><span class="hs-identifier hs-var hs-var">liftCHAIN</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext CHAIN
-&gt; Block
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall sts.
(STS sts, BaseM sts ~ Identity) =&gt;
RuleContext sts -&gt; LiftedRule sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftRule"><span class="hs-identifier hs-var">liftRule</span></a></span><span> </span><span class="annot"><span class="annottext">(RuleContext CHAIN
 -&gt; Block
 -&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
 -&gt; Except
      [ChainPredicateFailure]
      (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState))
-&gt; (ByronSpecGenesis -&gt; RuleContext CHAIN)
-&gt; ByronSpecGenesis
-&gt; Block
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtCHAIN"><span class="hs-identifier hs-var">ctxtCHAIN</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | Apply delegation certificate</span><span>
</span><span id="line-101"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftSDELEG"><span class="hs-identifier hs-type">liftSDELEG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#LiftedRule"><span class="hs-identifier hs-type">LiftedRule</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.SDELEG</span></span><span>
</span><span id="line-102"></span><span id="liftSDELEG"><span class="annot"><span class="annottext">liftSDELEG :: ByronSpecGenesis -&gt; LiftedRule SDELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftSDELEG"><span class="hs-identifier hs-var hs-var">liftSDELEG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext SDELEG
-&gt; DCert
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall sts.
(STS sts, BaseM sts ~ Identity) =&gt;
RuleContext sts -&gt; LiftedRule sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftRule"><span class="hs-identifier hs-var">liftRule</span></a></span><span> </span><span class="annot"><span class="annottext">(RuleContext SDELEG
 -&gt; DCert
 -&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
 -&gt; Except
      [ChainPredicateFailure]
      (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState))
-&gt; (ByronSpecGenesis -&gt; RuleContext SDELEG)
-&gt; ByronSpecGenesis
-&gt; DCert
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext SDELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtSDELEG"><span class="hs-identifier hs-var">ctxtSDELEG</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- | Apply transaction</span><span>
</span><span id="line-105"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftUTXOW"><span class="hs-identifier hs-type">liftUTXOW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#LiftedRule"><span class="hs-identifier hs-type">LiftedRule</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.UTXOW</span></span><span>
</span><span id="line-106"></span><span id="liftUTXOW"><span class="annot"><span class="annottext">liftUTXOW :: ByronSpecGenesis -&gt; LiftedRule UTXOW
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftUTXOW"><span class="hs-identifier hs-var hs-var">liftUTXOW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext UTXOW
-&gt; Tx
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall sts.
(STS sts, BaseM sts ~ Identity) =&gt;
RuleContext sts -&gt; LiftedRule sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftRule"><span class="hs-identifier hs-var">liftRule</span></a></span><span> </span><span class="annot"><span class="annottext">(RuleContext UTXOW
 -&gt; Tx
 -&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
 -&gt; Except
      [ChainPredicateFailure]
      (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState))
-&gt; (ByronSpecGenesis -&gt; RuleContext UTXOW)
-&gt; ByronSpecGenesis
-&gt; Tx
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext UTXOW
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUTXOW"><span class="hs-identifier hs-var">ctxtUTXOW</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- | Apply update proposal</span><span>
</span><span id="line-109"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftUPIREG"><span class="hs-identifier hs-type">liftUPIREG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#LiftedRule"><span class="hs-identifier hs-type">LiftedRule</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.UPIREG</span></span><span>
</span><span id="line-110"></span><span id="liftUPIREG"><span class="annot"><span class="annottext">liftUPIREG :: ByronSpecGenesis -&gt; LiftedRule UPIREG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftUPIREG"><span class="hs-identifier hs-var hs-var">liftUPIREG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext UPIREG
-&gt; UProp
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall sts.
(STS sts, BaseM sts ~ Identity) =&gt;
RuleContext sts -&gt; LiftedRule sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftRule"><span class="hs-identifier hs-var">liftRule</span></a></span><span> </span><span class="annot"><span class="annottext">(RuleContext UPIREG
 -&gt; UProp
 -&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
 -&gt; Except
      [ChainPredicateFailure]
      (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState))
-&gt; (ByronSpecGenesis -&gt; RuleContext UPIREG)
-&gt; ByronSpecGenesis
-&gt; UProp
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext UPIREG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIREG"><span class="hs-identifier hs-var">ctxtUPIREG</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | Apply update vote</span><span>
</span><span id="line-113"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftUPIVOTE"><span class="hs-identifier hs-type">liftUPIVOTE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#LiftedRule"><span class="hs-identifier hs-type">LiftedRule</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.UPIVOTE</span></span><span>
</span><span id="line-114"></span><span id="liftUPIVOTE"><span class="annot"><span class="annottext">liftUPIVOTE :: ByronSpecGenesis -&gt; LiftedRule UPIVOTE
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftUPIVOTE"><span class="hs-identifier hs-var hs-var">liftUPIVOTE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext UPIVOTE
-&gt; Vote
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall sts.
(STS sts, BaseM sts ~ Identity) =&gt;
RuleContext sts -&gt; LiftedRule sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftRule"><span class="hs-identifier hs-var">liftRule</span></a></span><span> </span><span class="annot"><span class="annottext">(RuleContext UPIVOTE
 -&gt; Vote
 -&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
 -&gt; Except
      [ChainPredicateFailure]
      (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState))
-&gt; (ByronSpecGenesis -&gt; RuleContext UPIVOTE)
-&gt; ByronSpecGenesis
-&gt; Vote
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext UPIVOTE
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIVOTE"><span class="hs-identifier hs-var">ctxtUPIVOTE</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- | Apply the epoch transition rule</span><span>
</span><span id="line-117"></span><span class="hs-comment">--</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- This is used in 'applyChainTick' only.</span><span>
</span><span id="line-119"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftEPOCH"><span class="hs-identifier hs-type">liftEPOCH</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#LiftedRule"><span class="hs-identifier hs-type">LiftedRule</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.EPOCH</span></span><span>
</span><span id="line-120"></span><span id="liftEPOCH"><span class="annot"><span class="annottext">liftEPOCH :: ByronSpecGenesis -&gt; LiftedRule EPOCH
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftEPOCH"><span class="hs-identifier hs-var hs-var">liftEPOCH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext EPOCH
-&gt; Slot
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall sts.
(STS sts, BaseM sts ~ Identity) =&gt;
RuleContext sts -&gt; LiftedRule sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftRule"><span class="hs-identifier hs-var">liftRule</span></a></span><span> </span><span class="annot"><span class="annottext">(RuleContext EPOCH
 -&gt; Slot
 -&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
 -&gt; Except
      [ChainPredicateFailure]
      (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState))
-&gt; (ByronSpecGenesis -&gt; RuleContext EPOCH)
-&gt; ByronSpecGenesis
-&gt; Slot
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext EPOCH
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtEPOCH"><span class="hs-identifier hs-var">ctxtEPOCH</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | Apply top-level delegation rule</span><span>
</span><span id="line-123"></span><span class="hs-comment">--</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- This is used in 'applyChainTick' only</span><span>
</span><span id="line-125"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftDELEG"><span class="hs-identifier hs-type">liftDELEG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#LiftedRule"><span class="hs-identifier hs-type">LiftedRule</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.DELEG</span></span><span>
</span><span id="line-126"></span><span id="liftDELEG"><span class="annot"><span class="annottext">liftDELEG :: ByronSpecGenesis -&gt; LiftedRule DELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftDELEG"><span class="hs-identifier hs-var hs-var">liftDELEG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext DELEG
-&gt; [DCert]
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall sts.
(STS sts, BaseM sts ~ Identity) =&gt;
RuleContext sts -&gt; LiftedRule sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftRule"><span class="hs-identifier hs-var">liftRule</span></a></span><span> </span><span class="annot"><span class="annottext">(RuleContext DELEG
 -&gt; [DCert]
 -&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
 -&gt; Except
      [ChainPredicateFailure]
      (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState))
-&gt; (ByronSpecGenesis -&gt; RuleContext DELEG)
-&gt; ByronSpecGenesis
-&gt; [DCert]
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext DELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtDELEG"><span class="hs-identifier hs-var">ctxtDELEG</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Infrastructure for working with the STS transitions
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-comment">-- | Context required to apply a rule to the top-level CHAIN state</span><span>
</span><span id="line-133"></span><span class="hs-comment">--</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- The environment  for these rules pull in some information from the (abstract)</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- genesis config and some information from the state; the reason is that</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- although some values come from the state, as far as these rules are</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- concerned, they are constants.</span><span>
</span><span id="line-138"></span><span class="hs-keyword">data</span><span> </span><span id="RuleContext"><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-var">RuleContext</span></a></span></span><span> </span><span id="local-6989586621679225100"><span class="annot"><a href="#local-6989586621679225100"><span class="hs-identifier hs-type">sts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RuleContext"><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-var">RuleContext</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-139"></span><span>      </span><span id="getRuleState"><span class="annot"><span class="annottext">RuleContext sts -&gt; GetChainState (State sts)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleState"><span class="hs-identifier hs-var hs-var">getRuleState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#GetChainState"><span class="hs-identifier hs-type">GetChainState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Spec.State</span></span><span> </span><span class="annot"><a href="#local-6989586621679225100"><span class="hs-identifier hs-type">sts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="modRuleState"><span class="annot"><span class="annottext">RuleContext sts
-&gt; forall (m :: * -&gt; *).
   Applicative m =&gt;
   (State sts -&gt; m (State sts)) -&gt; State CHAIN -&gt; m (State CHAIN)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#modRuleState"><span class="hs-identifier hs-var hs-var">modRuleState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#ModChainState"><span class="hs-identifier hs-type">ModChainState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Spec.State</span></span><span> </span><span class="annot"><a href="#local-6989586621679225100"><span class="hs-identifier hs-type">sts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="liftFailure"><span class="annot"><span class="annottext">RuleContext sts -&gt; PredicateFailure sts -&gt; PredicateFailure CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftFailure"><span class="hs-identifier hs-var hs-var">liftFailure</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.PredicateFailure</span></span><span> </span><span class="annot"><a href="#local-6989586621679225100"><span class="hs-identifier hs-type">sts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.PredicateFailure</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="getRuleEnv"><span class="annot"><span class="annottext">RuleContext sts -&gt; State CHAIN -&gt; Environment sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleEnv"><span class="hs-identifier hs-var hs-var">getRuleEnv</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.Environment</span></span><span> </span><span class="annot"><a href="#local-6989586621679225100"><span class="hs-identifier hs-type">sts</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#applySTS"><span class="hs-identifier hs-type">applySTS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679225094"><span class="annot"><a href="#local-6989586621679225094"><span class="hs-identifier hs-type">sts</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Spec.STS</span></span><span> </span><span class="annot"><a href="#local-6989586621679225094"><span class="hs-identifier hs-type">sts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.BaseM</span></span><span> </span><span class="annot"><a href="#local-6989586621679225094"><span class="hs-identifier hs-type">sts</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Identity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679225094"><span class="hs-identifier hs-type">sts</span></a></span><span>
</span><span id="line-147"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.Environment</span></span><span> </span><span class="annot"><a href="#local-6989586621679225094"><span class="hs-identifier hs-type">sts</span></a></span><span>
</span><span id="line-148"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.Signal</span></span><span> </span><span class="annot"><a href="#local-6989586621679225094"><span class="hs-identifier hs-type">sts</span></a></span><span>
</span><span id="line-149"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.State</span></span><span> </span><span class="annot"><a href="#local-6989586621679225094"><span class="hs-identifier hs-type">sts</span></a></span><span>
</span><span id="line-150"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">Except</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Spec.PredicateFailure</span></span><span> </span><span class="annot"><a href="#local-6989586621679225094"><span class="hs-identifier hs-type">sts</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Spec.State</span></span><span> </span><span class="annot"><a href="#local-6989586621679225094"><span class="hs-identifier hs-type">sts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span id="applySTS"><span class="annot"><span class="annottext">applySTS :: Proxy sts
-&gt; Environment sts
-&gt; Signal sts
-&gt; State sts
-&gt; Except [PredicateFailure sts] (State sts)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#applySTS"><span class="hs-identifier hs-var hs-var">applySTS</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy sts
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679225019"><span class="annot"><span class="annottext">Environment sts
</span><a href="#local-6989586621679225019"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679225018"><span class="annot"><span class="annottext">Signal sts
</span><a href="#local-6989586621679225018"><span class="hs-identifier hs-var">signal</span></a></span></span><span> </span><span id="local-6989586621679225017"><span class="annot"><span class="annottext">State sts
</span><a href="#local-6989586621679225017"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either [PredicateFailure sts] (State sts)
-&gt; Except [PredicateFailure sts] (State sts)
forall (m :: * -&gt; *) e a. Monad m =&gt; Either e a -&gt; ExceptT e m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">except</span></a></span><span> </span><span class="annot"><span class="annottext">(Either [PredicateFailure sts] (State sts)
 -&gt; Except [PredicateFailure sts] (State sts))
-&gt; Either [PredicateFailure sts] (State sts)
-&gt; Except [PredicateFailure sts] (State sts)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="annottext">forall s (rtype :: RuleType).
(STS s, RuleTypeRep rtype, BaseM s ~ Identity) =&gt;
RuleContext rtype s -&gt; Either [PredicateFailure s] (State s)
forall (rtype :: RuleType).
(STS sts, RuleTypeRep rtype, BaseM sts ~ Identity) =&gt;
RuleContext rtype sts -&gt; Either [PredicateFailure sts] (State sts)
</span><span class="hs-identifier hs-var">Spec.applySTS</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679225094"><span class="hs-identifier hs-type">sts</span></a></span><span> </span><span class="annot"><span class="annottext">(RuleContext 'Transition sts
 -&gt; Either [PredicateFailure sts] (State sts))
-&gt; RuleContext 'Transition sts
-&gt; Either [PredicateFailure sts] (State sts)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Environment sts, State sts, Signal sts) -&gt; TRC sts
forall sts. (Environment sts, State sts, Signal sts) -&gt; TRC sts
</span><span class="hs-identifier hs-var">Spec.TRC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Environment sts
</span><a href="#local-6989586621679225019"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State sts
</span><a href="#local-6989586621679225017"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signal sts
</span><a href="#local-6989586621679225018"><span class="hs-identifier hs-var">signal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-keyword">type</span><span> </span><span id="LiftedRule"><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#LiftedRule"><span class="hs-identifier hs-var">LiftedRule</span></a></span></span><span> </span><span id="local-6989586621679225013"><span class="annot"><a href="#local-6989586621679225013"><span class="hs-identifier hs-type">sts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.Signal</span></span><span> </span><span class="annot"><a href="#local-6989586621679225013"><span class="hs-identifier hs-type">sts</span></a></span><span>
</span><span id="line-155"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span>
</span><span id="line-156"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-type">Except</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Spec.PredicateFailure</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span class="hs-special">]</span><span>
</span><span id="line-157"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Spec.State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- | Lift sub-STS rule to top-level CHAIN</span><span>
</span><span id="line-160"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftRule"><span class="hs-identifier hs-type">liftRule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679225141"><span class="annot"><a href="#local-6989586621679225141"><span class="hs-identifier hs-type">sts</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Spec.STS</span></span><span> </span><span class="annot"><a href="#local-6989586621679225141"><span class="hs-identifier hs-type">sts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.BaseM</span></span><span> </span><span class="annot"><a href="#local-6989586621679225141"><span class="hs-identifier hs-type">sts</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Identity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679225141"><span class="hs-identifier hs-type">sts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#LiftedRule"><span class="hs-identifier hs-type">LiftedRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679225141"><span class="hs-identifier hs-type">sts</span></a></span><span>
</span><span id="line-162"></span><span id="liftRule"><span class="annot"><span class="annottext">liftRule :: RuleContext sts -&gt; LiftedRule sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftRule"><span class="hs-identifier hs-var hs-var">liftRule</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span class="hs-special">{</span><span id="local-6989586621679225009"><span id="local-6989586621679225010"><span id="local-6989586621679225011"><span id="local-6989586621679225012"><span class="annot"><span class="annottext">PredicateFailure sts -&gt; PredicateFailure CHAIN
State CHAIN -&gt; Environment sts
GetChainState (State sts)
ModChainState (State sts)
getRuleEnv :: State CHAIN -&gt; Environment sts
liftFailure :: PredicateFailure sts -&gt; PredicateFailure CHAIN
modRuleState :: ModChainState (State sts)
getRuleState :: GetChainState (State sts)
getRuleEnv :: forall sts. RuleContext sts -&gt; State CHAIN -&gt; Environment sts
liftFailure :: forall sts.
RuleContext sts -&gt; PredicateFailure sts -&gt; PredicateFailure CHAIN
modRuleState :: forall sts.
RuleContext sts
-&gt; forall (m :: * -&gt; *).
   Applicative m =&gt;
   (State sts -&gt; m (State sts)) -&gt; State CHAIN -&gt; m (State CHAIN)
getRuleState :: forall sts. RuleContext sts -&gt; GetChainState (State sts)
</span><a href="#local-6989586621679225009"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679225008"><span class="annot"><span class="annottext">Signal sts
</span><a href="#local-6989586621679225008"><span class="hs-identifier hs-var">signal</span></a></span></span><span> </span><span id="local-6989586621679225007"><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679225007"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="annottext">([PredicateFailure sts] -&gt; [ChainPredicateFailure])
-&gt; Except
     [PredicateFailure sts]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall e e' a. (e -&gt; e') -&gt; Except e a -&gt; Except e' a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/transformers-0.5.6.2/src"><span class="hs-identifier hs-var">withExcept</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PredicateFailure sts -&gt; ChainPredicateFailure)
-&gt; [PredicateFailure sts] -&gt; [ChainPredicateFailure]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">PredicateFailure sts -&gt; ChainPredicateFailure
PredicateFailure sts -&gt; PredicateFailure CHAIN
</span><a href="#local-6989586621679225010"><span class="hs-identifier hs-var">liftFailure</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Except
   [PredicateFailure sts]
   (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
 -&gt; Except
      [ChainPredicateFailure]
      (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState))
-&gt; Except
     [PredicateFailure sts]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; Except
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-164"></span><span>      </span><span class="annot"><span class="annottext">(State sts -&gt; ExceptT [PredicateFailure sts] Identity (State sts))
-&gt; State CHAIN
-&gt; ExceptT [PredicateFailure sts] Identity (State CHAIN)
ModChainState (State sts)
</span><a href="#local-6989586621679225011"><span class="hs-identifier hs-var">modRuleState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy sts
-&gt; Environment sts
-&gt; Signal sts
-&gt; State sts
-&gt; ExceptT [PredicateFailure sts] Identity (State sts)
forall sts.
(STS sts, BaseM sts ~ Identity) =&gt;
Proxy sts
-&gt; Environment sts
-&gt; Signal sts
-&gt; State sts
-&gt; Except [PredicateFailure sts] (State sts)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#applySTS"><span class="hs-identifier hs-var">applySTS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy sts
forall k (t :: k). Proxy t
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679225141"><span class="hs-identifier hs-type">sts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State CHAIN -&gt; Environment sts
</span><a href="#local-6989586621679225009"><span class="hs-identifier hs-var">getRuleEnv</span></a></span><span> </span><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679225007"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Signal sts
</span><a href="#local-6989586621679225008"><span class="hs-identifier hs-var">signal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679225007"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Instances of 'RuleContext'
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtCHAIN"><span class="hs-identifier hs-type">ctxtCHAIN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span>
</span><span id="line-171"></span><span id="ctxtCHAIN"><span class="annot"><span class="annottext">ctxtCHAIN :: ByronSpecGenesis -&gt; RuleContext CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtCHAIN"><span class="hs-identifier hs-var hs-var">ctxtCHAIN</span></a></span></span><span> </span><span id="local-6989586621679225004"><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679225004"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext :: forall sts.
GetChainState (State sts)
-&gt; (forall (m :: * -&gt; *).
    Applicative m =&gt;
    (State sts -&gt; m (State sts)) -&gt; State CHAIN -&gt; m (State CHAIN))
-&gt; (PredicateFailure sts -&gt; PredicateFailure CHAIN)
-&gt; (State CHAIN -&gt; Environment sts)
-&gt; RuleContext sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><span class="annottext">getRuleState :: State CHAIN -&gt; State CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleState"><span class="hs-identifier hs-var">getRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State CHAIN -&gt; State CHAIN
forall a. a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">modRuleState :: ModChainState (State CHAIN)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#modRuleState"><span class="hs-identifier hs-var">modRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
ModChainState (State CHAIN)
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">liftFailure :: PredicateFailure CHAIN -&gt; PredicateFailure CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftFailure"><span class="hs-identifier hs-var">liftFailure</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PredicateFailure CHAIN -&gt; PredicateFailure CHAIN
forall a. a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getRuleEnv :: State CHAIN -&gt; Environment CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleEnv"><span class="hs-identifier hs-var">getRuleEnv</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679225002"><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679225002"><span class="hs-identifier hs-var">_st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; Environment CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#toChainEnv"><span class="hs-identifier hs-var">Genesis.toChainEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679225004"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtEPOCH"><span class="hs-identifier hs-type">ctxtEPOCH</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.EPOCH</span></span><span>
</span><span id="line-179"></span><span id="ctxtEPOCH"><span class="annot"><span class="annottext">ctxtEPOCH :: ByronSpecGenesis -&gt; RuleContext EPOCH
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtEPOCH"><span class="hs-identifier hs-var hs-var">ctxtEPOCH</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span class="hs-special">{</span><span id="local-6989586621679224995"><span id="local-6989586621679224996"><span id="local-6989586621679224997"><span id="local-6989586621679224998"><span id="local-6989586621679224999"><span class="annot"><span class="annottext">Natural
Set VKeyGenesis
PParams
UTxO
BlockCount
byronSpecGenesisSlotLength :: ByronSpecGenesis -&gt; Natural
byronSpecGenesisSecurityParam :: ByronSpecGenesis -&gt; BlockCount
byronSpecGenesisInitPParams :: ByronSpecGenesis -&gt; PParams
byronSpecGenesisInitUtxo :: ByronSpecGenesis -&gt; UTxO
byronSpecGenesisDelegators :: ByronSpecGenesis -&gt; Set VKeyGenesis
byronSpecGenesisSlotLength :: Natural
byronSpecGenesisSecurityParam :: BlockCount
byronSpecGenesisInitPParams :: PParams
byronSpecGenesisInitUtxo :: UTxO
byronSpecGenesisDelegators :: Set VKeyGenesis
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#byronSpecGenesisSlotLength"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext :: forall sts.
GetChainState (State sts)
-&gt; (forall (m :: * -&gt; *).
    Applicative m =&gt;
    (State sts -&gt; m (State sts)) -&gt; State CHAIN -&gt; m (State CHAIN))
-&gt; (PredicateFailure sts -&gt; PredicateFailure CHAIN)
-&gt; (State CHAIN -&gt; Environment sts)
-&gt; RuleContext sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-180"></span><span>      </span><span class="annot"><span class="annottext">getRuleState :: GetChainState (State EPOCH)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleState"><span class="hs-identifier hs-var">getRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GetChainState UPIState
GetChainState (State EPOCH)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getChainStateUPIState"><span class="hs-identifier hs-var">getChainStateUPIState</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">modRuleState :: ModChainState (State EPOCH)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#modRuleState"><span class="hs-identifier hs-var">modRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModChainState UPIState
ModChainState (State EPOCH)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#modChainStateUPIState"><span class="hs-identifier hs-var">modChainStateUPIState</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">liftFailure :: PredicateFailure EPOCH -&gt; PredicateFailure CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftFailure"><span class="hs-identifier hs-var">liftFailure</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PredicateFailure EPOCH -&gt; ChainPredicateFailure
PredicateFailure EPOCH -&gt; PredicateFailure CHAIN
</span><span class="hs-identifier hs-var">Spec.EpochFailure</span></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getRuleEnv :: State CHAIN -&gt; Environment EPOCH
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleEnv"><span class="hs-identifier hs-var">getRuleEnv</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679224986"><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679224986"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-184"></span><span>          </span><span class="hs-comment">-- The _current_ epoch</span><span>
</span><span id="line-185"></span><span>          </span><span class="hs-comment">-- This is needed to detect if the new slot introduces the next epoch</span><span>
</span><span id="line-186"></span><span>          </span><span class="annot"><span class="annottext">HasCallStack =&gt; Slot -&gt; BlockCount -&gt; Epoch
Slot -&gt; BlockCount -&gt; Epoch
</span><span class="hs-identifier hs-var">Spec.sEpoch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GetChainState Slot
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getChainStateSlot"><span class="hs-identifier hs-var">getChainStateSlot</span></a></span><span> </span><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679224986"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BlockCount
</span><a href="#local-6989586621679224996"><span class="hs-identifier hs-var">byronSpecGenesisSecurityParam</span></a></span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BlockCount
</span><a href="#local-6989586621679224996"><span class="hs-identifier hs-var">byronSpecGenesisSecurityParam</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtDELEG"><span class="hs-identifier hs-type">ctxtDELEG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.DELEG</span></span><span>
</span><span id="line-192"></span><span id="ctxtDELEG"><span class="annot"><span class="annottext">ctxtDELEG :: ByronSpecGenesis -&gt; RuleContext DELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtDELEG"><span class="hs-identifier hs-var hs-var">ctxtDELEG</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span class="hs-special">{</span><span id="local-6989586621679224979"><span id="local-6989586621679224980"><span id="local-6989586621679224981"><span id="local-6989586621679224982"><span id="local-6989586621679224983"><span class="annot"><span class="annottext">Natural
Set VKeyGenesis
PParams
UTxO
BlockCount
byronSpecGenesisSlotLength :: Natural
byronSpecGenesisSecurityParam :: BlockCount
byronSpecGenesisInitPParams :: PParams
byronSpecGenesisInitUtxo :: UTxO
byronSpecGenesisDelegators :: Set VKeyGenesis
byronSpecGenesisSlotLength :: ByronSpecGenesis -&gt; Natural
byronSpecGenesisSecurityParam :: ByronSpecGenesis -&gt; BlockCount
byronSpecGenesisInitPParams :: ByronSpecGenesis -&gt; PParams
byronSpecGenesisInitUtxo :: ByronSpecGenesis -&gt; UTxO
byronSpecGenesisDelegators :: ByronSpecGenesis -&gt; Set VKeyGenesis
</span><a href="#local-6989586621679224979"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext :: forall sts.
GetChainState (State sts)
-&gt; (forall (m :: * -&gt; *).
    Applicative m =&gt;
    (State sts -&gt; m (State sts)) -&gt; State CHAIN -&gt; m (State CHAIN))
-&gt; (PredicateFailure sts -&gt; PredicateFailure CHAIN)
-&gt; (State CHAIN -&gt; Environment sts)
-&gt; RuleContext sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-193"></span><span>      </span><span class="annot"><span class="annottext">getRuleState :: GetChainState (State DELEG)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleState"><span class="hs-identifier hs-var">getRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GetChainState (State DELEG)
GetChainState DIState
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getChainStateDIState"><span class="hs-identifier hs-var">getChainStateDIState</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">modRuleState :: ModChainState (State DELEG)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#modRuleState"><span class="hs-identifier hs-var">modRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModChainState (State DELEG)
ModChainState DIState
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#modChainStateDIState"><span class="hs-identifier hs-var">modChainStateDIState</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">liftFailure :: PredicateFailure DELEG -&gt; PredicateFailure CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftFailure"><span class="hs-identifier hs-var">liftFailure</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PredicateFailure DELEG -&gt; ChainPredicateFailure
PredicateFailure DELEG -&gt; PredicateFailure CHAIN
</span><span class="hs-identifier hs-var">Spec.LedgerDelegationFailure</span></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getRuleEnv :: State CHAIN -&gt; Environment DELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleEnv"><span class="hs-identifier hs-var">getRuleEnv</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679224975"><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679224975"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DSEnv :: Set VKeyGenesis -&gt; Epoch -&gt; Slot -&gt; BlockCount -&gt; DSEnv
</span><span class="hs-identifier hs-type">Spec.DSEnv</span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-197"></span><span>          </span><span class="annot"><span class="annottext">_dSEnvAllowedDelegators :: Set VKeyGenesis
</span><span class="hs-identifier hs-var">_dSEnvAllowedDelegators</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set VKeyGenesis
</span><a href="#local-6989586621679224983"><span class="hs-identifier hs-var">byronSpecGenesisDelegators</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_dSEnvEpoch :: Epoch
</span><span class="hs-identifier hs-var">_dSEnvEpoch</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Slot -&gt; BlockCount -&gt; Epoch
Slot -&gt; BlockCount -&gt; Epoch
</span><span class="hs-identifier hs-var">Spec.sEpoch</span></span><span>
</span><span id="line-199"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GetChainState Slot
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getChainStateSlot"><span class="hs-identifier hs-var">getChainStateSlot</span></a></span><span> </span><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679224975"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>                                      </span><span class="annot"><span class="annottext">BlockCount
</span><a href="#local-6989586621679224980"><span class="hs-identifier hs-var">byronSpecGenesisSecurityParam</span></a></span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_dSEnvSlot :: Slot
</span><span class="hs-identifier hs-var">_dSEnvSlot</span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GetChainState Slot
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getChainStateSlot"><span class="hs-identifier hs-var">getChainStateSlot</span></a></span><span> </span><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679224975"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_dSEnvK :: BlockCount
</span><span class="hs-identifier hs-var">_dSEnvK</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockCount
</span><a href="#local-6989586621679224980"><span class="hs-identifier hs-var">byronSpecGenesisSecurityParam</span></a></span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtSDELEG"><span class="hs-identifier hs-type">ctxtSDELEG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.SDELEG</span></span><span>
</span><span id="line-207"></span><span id="ctxtSDELEG"><span class="annot"><span class="annottext">ctxtSDELEG :: ByronSpecGenesis -&gt; RuleContext SDELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtSDELEG"><span class="hs-identifier hs-var hs-var">ctxtSDELEG</span></a></span></span><span> </span><span id="local-6989586621679224969"><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679224969"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext :: forall sts.
GetChainState (State sts)
-&gt; (forall (m :: * -&gt; *).
    Applicative m =&gt;
    (State sts -&gt; m (State sts)) -&gt; State CHAIN -&gt; m (State CHAIN))
-&gt; (PredicateFailure sts -&gt; PredicateFailure CHAIN)
-&gt; (State CHAIN -&gt; Environment sts)
-&gt; RuleContext sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-208"></span><span>      </span><span class="annot"><span class="annottext">getRuleState :: GetChainState (State SDELEG)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleState"><span class="hs-identifier hs-var">getRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DIState -&gt; DSState
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getDIStateDSState"><span class="hs-identifier hs-var">getDIStateDSState</span></a></span><span> </span><span class="annot"><span class="annottext">(DIState -&gt; DSState)
-&gt; ((Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
    -&gt; DIState)
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; DSState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RuleContext DELEG -&gt; GetChainState (State DELEG)
forall sts. RuleContext sts -&gt; GetChainState (State sts)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleState"><span class="hs-identifier hs-var hs-var">getRuleState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext DELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtDELEG"><span class="hs-identifier hs-var">ctxtDELEG</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679224969"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">modRuleState :: ModChainState (State SDELEG)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#modRuleState"><span class="hs-identifier hs-var">modRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext DELEG -&gt; ModChainState (State DELEG)
forall sts.
RuleContext sts
-&gt; forall (m :: * -&gt; *).
   Applicative m =&gt;
   (State sts -&gt; m (State sts)) -&gt; State CHAIN -&gt; m (State CHAIN)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#modRuleState"><span class="hs-identifier hs-var hs-var">modRuleState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext DELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtDELEG"><span class="hs-identifier hs-var">ctxtDELEG</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679224969"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((DIState -&gt; m DIState)
 -&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
 -&gt; m (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState))
-&gt; ((DSState -&gt; m DSState) -&gt; DIState -&gt; m DIState)
-&gt; (DSState -&gt; m DSState)
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; m (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(DSState -&gt; m DSState) -&gt; DIState -&gt; m DIState
forall (m :: * -&gt; *).
Applicative m =&gt;
(DSState -&gt; m DSState) -&gt; DIState -&gt; m DIState
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#modDIStateDSState"><span class="hs-identifier hs-var">modDIStateDSState</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">liftFailure :: PredicateFailure SDELEG -&gt; PredicateFailure CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftFailure"><span class="hs-identifier hs-var">liftFailure</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext DELEG
-&gt; PredicateFailure DELEG -&gt; PredicateFailure CHAIN
forall sts.
RuleContext sts -&gt; PredicateFailure sts -&gt; PredicateFailure CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftFailure"><span class="hs-identifier hs-var hs-var">liftFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext DELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtDELEG"><span class="hs-identifier hs-var">ctxtDELEG</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679224969"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>                   </span><span class="annot"><span class="annottext">(DelegPredicateFailure -&gt; ChainPredicateFailure)
-&gt; (SdelegPredicateFailure -&gt; DelegPredicateFailure)
-&gt; SdelegPredicateFailure
-&gt; ChainPredicateFailure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PredicateFailure SDELEGS -&gt; DelegPredicateFailure
SdelegsPredicateFailure -&gt; DelegPredicateFailure
</span><span class="hs-identifier hs-var">Spec.SDelegSFailure</span></span><span>
</span><span id="line-212"></span><span>                   </span><span class="annot"><span class="annottext">(SdelegsPredicateFailure -&gt; DelegPredicateFailure)
-&gt; (SdelegPredicateFailure -&gt; SdelegsPredicateFailure)
-&gt; SdelegPredicateFailure
-&gt; DelegPredicateFailure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PredicateFailure SDELEG -&gt; SdelegsPredicateFailure
SdelegPredicateFailure -&gt; SdelegsPredicateFailure
</span><span class="hs-identifier hs-var">Spec.SDelegFailure</span></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getRuleEnv :: State CHAIN -&gt; Environment SDELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleEnv"><span class="hs-identifier hs-var">getRuleEnv</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext DELEG -&gt; State CHAIN -&gt; Environment DELEG
forall sts. RuleContext sts -&gt; State CHAIN -&gt; Environment sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleEnv"><span class="hs-identifier hs-var hs-var">getRuleEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext DELEG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtDELEG"><span class="hs-identifier hs-var">ctxtDELEG</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679224969"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUTXOW"><span class="hs-identifier hs-type">ctxtUTXOW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.UTXOW</span></span><span>
</span><span id="line-217"></span><span id="ctxtUTXOW"><span class="annot"><span class="annottext">ctxtUTXOW :: ByronSpecGenesis -&gt; RuleContext UTXOW
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUTXOW"><span class="hs-identifier hs-var hs-var">ctxtUTXOW</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span class="hs-special">{</span><span id="local-6989586621679224960"><span id="local-6989586621679224961"><span id="local-6989586621679224962"><span id="local-6989586621679224963"><span id="local-6989586621679224964"><span class="annot"><span class="annottext">Natural
Set VKeyGenesis
PParams
UTxO
BlockCount
byronSpecGenesisSlotLength :: Natural
byronSpecGenesisSecurityParam :: BlockCount
byronSpecGenesisInitPParams :: PParams
byronSpecGenesisInitUtxo :: UTxO
byronSpecGenesisDelegators :: Set VKeyGenesis
byronSpecGenesisSlotLength :: ByronSpecGenesis -&gt; Natural
byronSpecGenesisSecurityParam :: ByronSpecGenesis -&gt; BlockCount
byronSpecGenesisInitPParams :: ByronSpecGenesis -&gt; PParams
byronSpecGenesisInitUtxo :: ByronSpecGenesis -&gt; UTxO
byronSpecGenesisDelegators :: ByronSpecGenesis -&gt; Set VKeyGenesis
</span><a href="#local-6989586621679224960"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext :: forall sts.
GetChainState (State sts)
-&gt; (forall (m :: * -&gt; *).
    Applicative m =&gt;
    (State sts -&gt; m (State sts)) -&gt; State CHAIN -&gt; m (State CHAIN))
-&gt; (PredicateFailure sts -&gt; PredicateFailure CHAIN)
-&gt; (State CHAIN -&gt; Environment sts)
-&gt; RuleContext sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-218"></span><span>       </span><span class="annot"><span class="annottext">getRuleState :: GetChainState (State UTXOW)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleState"><span class="hs-identifier hs-var">getRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GetChainState (State UTXOW)
GetChainState UTxOState
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getChainStateUtxoState"><span class="hs-identifier hs-var">getChainStateUtxoState</span></a></span><span>
</span><span id="line-219"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">modRuleState :: ModChainState (State UTXOW)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#modRuleState"><span class="hs-identifier hs-var">modRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModChainState (State UTXOW)
ModChainState UTxOState
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#modChainStateUtxoState"><span class="hs-identifier hs-var">modChainStateUtxoState</span></a></span><span>
</span><span id="line-220"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">liftFailure :: PredicateFailure UTXOW -&gt; PredicateFailure CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftFailure"><span class="hs-identifier hs-var">liftFailure</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UtxowsPredicateFailure -&gt; ChainPredicateFailure
PredicateFailure UTXOWS -&gt; ChainPredicateFailure
</span><span class="hs-identifier hs-var">Spec.LedgerUTxOFailure</span></span><span>
</span><span id="line-221"></span><span>                    </span><span class="annot"><span class="annottext">(UtxowsPredicateFailure -&gt; ChainPredicateFailure)
-&gt; (UtxowPredicateFailure -&gt; UtxowsPredicateFailure)
-&gt; UtxowPredicateFailure
-&gt; ChainPredicateFailure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PredicateFailure UTXOW -&gt; UtxowsPredicateFailure
UtxowPredicateFailure -&gt; UtxowsPredicateFailure
</span><span class="hs-identifier hs-var">Spec.UtxowFailure</span></span><span>
</span><span id="line-222"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getRuleEnv :: State CHAIN -&gt; Environment UTXOW
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleEnv"><span class="hs-identifier hs-var">getRuleEnv</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679224955"><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679224955"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOEnv :: UTxO -&gt; PParams -&gt; UTxOEnv
</span><span class="hs-identifier hs-type">Spec.UTxOEnv</span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-223"></span><span>          </span><span class="annot"><span class="annottext">utxo0 :: UTxO
</span><span class="hs-identifier hs-var">utxo0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679224963"><span class="hs-identifier hs-var">byronSpecGenesisInitUtxo</span></a></span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pps :: PParams
</span><span class="hs-identifier hs-var">pps</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UPIState -&gt; PParams
</span><span class="hs-identifier hs-var">Spec.protocolParameters</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GetChainState UPIState
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getChainStateUPIState"><span class="hs-identifier hs-var">getChainStateUPIState</span></a></span><span> </span><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679224955"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-226"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIREG"><span class="hs-identifier hs-type">ctxtUPIREG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.UPIREG</span></span><span>
</span><span id="line-229"></span><span id="ctxtUPIREG"><span class="annot"><span class="annottext">ctxtUPIREG :: ByronSpecGenesis -&gt; RuleContext UPIREG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIREG"><span class="hs-identifier hs-var hs-var">ctxtUPIREG</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span class="hs-special">{</span><span id="local-6989586621679224946"><span id="local-6989586621679224947"><span id="local-6989586621679224948"><span id="local-6989586621679224949"><span id="local-6989586621679224950"><span class="annot"><span class="annottext">Natural
Set VKeyGenesis
PParams
UTxO
BlockCount
byronSpecGenesisSlotLength :: Natural
byronSpecGenesisSecurityParam :: BlockCount
byronSpecGenesisInitPParams :: PParams
byronSpecGenesisInitUtxo :: UTxO
byronSpecGenesisDelegators :: Set VKeyGenesis
byronSpecGenesisSlotLength :: ByronSpecGenesis -&gt; Natural
byronSpecGenesisSecurityParam :: ByronSpecGenesis -&gt; BlockCount
byronSpecGenesisInitPParams :: ByronSpecGenesis -&gt; PParams
byronSpecGenesisInitUtxo :: ByronSpecGenesis -&gt; UTxO
byronSpecGenesisDelegators :: ByronSpecGenesis -&gt; Set VKeyGenesis
</span><a href="#local-6989586621679224946"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext :: forall sts.
GetChainState (State sts)
-&gt; (forall (m :: * -&gt; *).
    Applicative m =&gt;
    (State sts -&gt; m (State sts)) -&gt; State CHAIN -&gt; m (State CHAIN))
-&gt; (PredicateFailure sts -&gt; PredicateFailure CHAIN)
-&gt; (State CHAIN -&gt; Environment sts)
-&gt; RuleContext sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-230"></span><span>      </span><span class="annot"><span class="annottext">getRuleState :: GetChainState (State UPIREG)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleState"><span class="hs-identifier hs-var">getRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GetChainState UPIState
GetChainState (State UPIREG)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getChainStateUPIState"><span class="hs-identifier hs-var">getChainStateUPIState</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">modRuleState :: ModChainState (State UPIREG)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#modRuleState"><span class="hs-identifier hs-var">modRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModChainState UPIState
ModChainState (State UPIREG)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#modChainStateUPIState"><span class="hs-identifier hs-var">modChainStateUPIState</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">liftFailure :: PredicateFailure UPIREG -&gt; PredicateFailure CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftFailure"><span class="hs-identifier hs-var">liftFailure</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BbodyPredicateFailure -&gt; ChainPredicateFailure
PredicateFailure BBODY -&gt; ChainPredicateFailure
</span><span class="hs-identifier hs-var">Spec.BBodyFailure</span></span><span>
</span><span id="line-233"></span><span>                   </span><span class="annot"><span class="annottext">(BbodyPredicateFailure -&gt; ChainPredicateFailure)
-&gt; (UpiregPredicateFailure -&gt; BbodyPredicateFailure)
-&gt; UpiregPredicateFailure
-&gt; ChainPredicateFailure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PredicateFailure BUPI -&gt; BbodyPredicateFailure
BupiPredicateFailure -&gt; BbodyPredicateFailure
</span><span class="hs-identifier hs-var">Spec.BUPIFailure</span></span><span>
</span><span id="line-234"></span><span>                   </span><span class="annot"><span class="annottext">(BupiPredicateFailure -&gt; BbodyPredicateFailure)
-&gt; (UpiregPredicateFailure -&gt; BupiPredicateFailure)
-&gt; UpiregPredicateFailure
-&gt; BbodyPredicateFailure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PredicateFailure UPIREG -&gt; BupiPredicateFailure
UpiregPredicateFailure -&gt; BupiPredicateFailure
</span><span class="hs-identifier hs-var">Spec.UPIREGFailure</span></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getRuleEnv :: State CHAIN -&gt; Environment UPIREG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleEnv"><span class="hs-identifier hs-var">getRuleEnv</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679224942"><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679224942"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-236"></span><span>          </span><span class="annot"><span class="annottext">GetChainState Slot
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getChainStateSlot"><span class="hs-identifier hs-var">getChainStateSlot</span></a></span><span> </span><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679224942"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-237"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DIState -&gt; Bimap VKeyGenesis VKey
</span><span class="hs-identifier hs-var hs-var">Spec._dIStateDelegationMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GetChainState DIState
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Accessors.html#getChainStateDIState"><span class="hs-identifier hs-var">getChainStateDIState</span></a></span><span> </span><span class="annot"><span class="annottext">State CHAIN
</span><a href="#local-6989586621679224942"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BlockCount
</span><a href="#local-6989586621679224947"><span class="hs-identifier hs-var">byronSpecGenesisSecurityParam</span></a></span><span>
</span><span id="line-239"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; Int -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set VKeyGenesis -&gt; Int
forall a. Set a -&gt; Int
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">Set VKeyGenesis
</span><a href="#local-6989586621679224950"><span class="hs-identifier hs-var">byronSpecGenesisDelegators</span></a></span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIVOTE"><span class="hs-identifier hs-type">ctxtUPIVOTE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.UPIVOTE</span></span><span>
</span><span id="line-244"></span><span id="ctxtUPIVOTE"><span class="annot"><span class="annottext">ctxtUPIVOTE :: ByronSpecGenesis -&gt; RuleContext UPIVOTE
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIVOTE"><span class="hs-identifier hs-var hs-var">ctxtUPIVOTE</span></a></span></span><span> </span><span id="local-6989586621679224939"><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679224939"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext :: forall sts.
GetChainState (State sts)
-&gt; (forall (m :: * -&gt; *).
    Applicative m =&gt;
    (State sts -&gt; m (State sts)) -&gt; State CHAIN -&gt; m (State CHAIN))
-&gt; (PredicateFailure sts -&gt; PredicateFailure CHAIN)
-&gt; (State CHAIN -&gt; Environment sts)
-&gt; RuleContext sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext"><span class="hs-identifier hs-type">RuleContext</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-245"></span><span>      </span><span class="annot"><span class="annottext">getRuleState :: GetChainState (State UPIVOTE)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleState"><span class="hs-identifier hs-var">getRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext UPIREG -&gt; GetChainState (State UPIREG)
forall sts. RuleContext sts -&gt; GetChainState (State sts)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleState"><span class="hs-identifier hs-var hs-var">getRuleState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext UPIREG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIREG"><span class="hs-identifier hs-var">ctxtUPIREG</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679224939"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">modRuleState :: ModChainState (State UPIVOTE)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#modRuleState"><span class="hs-identifier hs-var">modRuleState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext UPIREG -&gt; ModChainState (State UPIREG)
forall sts.
RuleContext sts
-&gt; forall (m :: * -&gt; *).
   Applicative m =&gt;
   (State sts -&gt; m (State sts)) -&gt; State CHAIN -&gt; m (State CHAIN)
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#modRuleState"><span class="hs-identifier hs-var hs-var">modRuleState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext UPIREG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIREG"><span class="hs-identifier hs-var">ctxtUPIREG</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679224939"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">getRuleEnv :: State CHAIN -&gt; Environment UPIVOTE
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleEnv"><span class="hs-identifier hs-var">getRuleEnv</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RuleContext UPIREG -&gt; State CHAIN -&gt; Environment UPIREG
forall sts. RuleContext sts -&gt; State CHAIN -&gt; Environment sts
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#getRuleEnv"><span class="hs-identifier hs-var hs-var">getRuleEnv</span></a></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; RuleContext UPIREG
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIREG"><span class="hs-identifier hs-var">ctxtUPIREG</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679224939"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">liftFailure :: PredicateFailure UPIVOTE -&gt; PredicateFailure CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftFailure"><span class="hs-identifier hs-var">liftFailure</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BbodyPredicateFailure -&gt; ChainPredicateFailure
PredicateFailure BBODY -&gt; ChainPredicateFailure
</span><span class="hs-identifier hs-var">Spec.BBodyFailure</span></span><span>
</span><span id="line-249"></span><span>                   </span><span class="annot"><span class="annottext">(BbodyPredicateFailure -&gt; ChainPredicateFailure)
-&gt; (UpivotePredicateFailure -&gt; BbodyPredicateFailure)
-&gt; UpivotePredicateFailure
-&gt; ChainPredicateFailure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PredicateFailure BUPI -&gt; BbodyPredicateFailure
BupiPredicateFailure -&gt; BbodyPredicateFailure
</span><span class="hs-identifier hs-var">Spec.BUPIFailure</span></span><span>
</span><span id="line-250"></span><span>                   </span><span class="annot"><span class="annottext">(BupiPredicateFailure -&gt; BbodyPredicateFailure)
-&gt; (UpivotePredicateFailure -&gt; BupiPredicateFailure)
-&gt; UpivotePredicateFailure
-&gt; BbodyPredicateFailure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PredicateFailure UPIVOTES -&gt; BupiPredicateFailure
UpivotesPredicateFailure -&gt; BupiPredicateFailure
</span><span class="hs-identifier hs-var">Spec.UPIVOTESFailure</span></span><span>
</span><span id="line-251"></span><span>                   </span><span class="annot"><span class="annottext">(UpivotesPredicateFailure -&gt; BupiPredicateFailure)
-&gt; (UpivotePredicateFailure -&gt; UpivotesPredicateFailure)
-&gt; UpivotePredicateFailure
-&gt; BupiPredicateFailure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PredicateFailure APPLYVOTES -&gt; UpivotesPredicateFailure
ApplyVotesPredicateFailure -&gt; UpivotesPredicateFailure
</span><span class="hs-identifier hs-var">Spec.ApplyVotesFailure</span></span><span>
</span><span id="line-252"></span><span>                   </span><span class="annot"><span class="annottext">(ApplyVotesPredicateFailure -&gt; UpivotesPredicateFailure)
-&gt; (UpivotePredicateFailure -&gt; ApplyVotesPredicateFailure)
-&gt; UpivotePredicateFailure
-&gt; UpivotesPredicateFailure
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PredicateFailure UPIVOTE -&gt; ApplyVotesPredicateFailure
UpivotePredicateFailure -&gt; ApplyVotesPredicateFailure
</span><span class="hs-identifier hs-var">Spec.UpivoteFailure</span></span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  STS initial rules
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#initStateCHAIN"><span class="hs-identifier hs-type">initStateCHAIN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#ByronSpecGenesis"><span class="hs-identifier hs-type">ByronSpecGenesis</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.State</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span>
</span><span id="line-260"></span><span id="initStateCHAIN"><span class="annot"><span class="annottext">initStateCHAIN :: ByronSpecGenesis -&gt; State CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#initStateCHAIN"><span class="hs-identifier hs-var hs-var">initStateCHAIN</span></a></span></span><span> </span><span id="local-6989586621679224935"><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679224935"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><span class="annottext">Either
  [ChainPredicateFailure]
  (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall a b. Either a b -&gt; b
</span><a href="#local-6989586621679224934"><span class="hs-identifier hs-var">dontExpectError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either
   [ChainPredicateFailure]
   (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
 -&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState))
-&gt; Either
     [ChainPredicateFailure]
     (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
-&gt; (Slot, Seq VKeyGenesis, Hash, UTxOState, DIState, UPIState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><span class="annottext">forall s (rtype :: RuleType).
(STS s, RuleTypeRep rtype, BaseM s ~ Identity) =&gt;
RuleContext rtype s -&gt; Either [PredicateFailure s] (State s)
forall (rtype :: RuleType).
(STS CHAIN, RuleTypeRep rtype, BaseM CHAIN ~ Identity) =&gt;
RuleContext rtype CHAIN
-&gt; Either [PredicateFailure CHAIN] (State CHAIN)
</span><span class="hs-identifier hs-var">Spec.applySTS</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Spec.CHAIN</span></span><span> </span><span class="annot"><span class="annottext">(RuleContext 'Initial CHAIN
 -&gt; Either [PredicateFailure CHAIN] (State CHAIN))
-&gt; RuleContext 'Initial CHAIN
-&gt; Either [PredicateFailure CHAIN] (State CHAIN)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-263"></span><span>        </span><span class="annot"><span class="annottext">Environment CHAIN -&gt; IRC CHAIN
forall sts. Environment sts -&gt; IRC sts
</span><span class="hs-identifier hs-var">Spec.IRC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByronSpecGenesis -&gt; Environment CHAIN
</span><a href="Ouroboros.Consensus.ByronSpec.Ledger.Genesis.html#toChainEnv"><span class="hs-identifier hs-var">Genesis.toChainEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ByronSpecGenesis
</span><a href="#local-6989586621679224935"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621679225057"><span id="local-6989586621679225058"><span class="annot"><a href="#local-6989586621679224934"><span class="hs-identifier hs-type">dontExpectError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679225058"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679225057"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679225057"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-266"></span><span>    </span><span id="local-6989586621679224934"><span class="annot"><span class="annottext">dontExpectError :: Either a b -&gt; b
</span><a href="#local-6989586621679224934"><span class="hs-identifier hs-var hs-var">dontExpectError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; b
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;initStateCHAIN: unexpected error&quot;</span></span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="#local-6989586621679224934"><span class="hs-identifier hs-var">dontExpectError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679224932"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679224932"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679224932"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-268"></span></pre></body></html>