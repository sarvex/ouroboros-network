<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ouroboros.Consensus.ByronSpec.Ledger.Rules</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ouroboros-consensus-byronspec-0.4.0.0: ByronSpec ledger integration in the Ouroboros consensus layer</span><ul class="links" id="page-menu"><li><a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html">Source</a></li><li><a href="&quot;../index.html&quot;">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ouroboros.Consensus.ByronSpec.Ledger.Rules</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Ledger</a></li><li><a href="#g:2">Lift STS transition rules to the chain level</a></li><li><a href="#g:3">STS initial rules</a></li><li><a href="#g:4">Rule context (exported for the benefit of the tests</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Thin wrapper around the Byron spec rules</p><p>Intended for qualified import</p><p>import qualified Ouroboros.Consensus.ByronSpec.Ledger.Rules as Rules</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:applyChainTick">applyChainTick</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; Slot &#8594; State CHAIN &#8594; State CHAIN</li><li class="src short"><a href="#v:liftCHAIN">liftCHAIN</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; LiftedRule CHAIN</li><li class="src short"><a href="#v:liftSDELEG">liftSDELEG</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; LiftedRule SDELEG</li><li class="src short"><a href="#v:liftUPIREG">liftUPIREG</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; LiftedRule UPIREG</li><li class="src short"><a href="#v:liftUPIVOTE">liftUPIVOTE</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; LiftedRule UPIVOTE</li><li class="src short"><a href="#v:liftUTXOW">liftUTXOW</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; LiftedRule UTXOW</li><li class="src short"><a href="#v:initStateCHAIN">initStateCHAIN</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; State CHAIN</li><li class="src short"><span class="keyword">data</span> <a href="#t:RuleContext">RuleContext</a> sts = <a href="#v:RuleContext">RuleContext</a> {<ul class="subs"><li><a href="#v:getRuleState">getRuleState</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Accessors.html#t:GetChainState" title="Ouroboros.Consensus.ByronSpec.Ledger.Accessors">GetChainState</a> (State sts)</li><li><a href="#v:modRuleState">modRuleState</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Accessors.html#t:ModChainState" title="Ouroboros.Consensus.ByronSpec.Ledger.Accessors">ModChainState</a> (State sts)</li><li><a href="#v:liftFailure">liftFailure</a> &#8759; PredicateFailure sts &#8594; PredicateFailure CHAIN</li><li><a href="#v:getRuleEnv">getRuleEnv</a> &#8759; State CHAIN &#8594; Environment sts</li></ul>}</li><li class="src short"><a href="#v:ctxtCHAIN">ctxtCHAIN</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> CHAIN</li><li class="src short"><a href="#v:ctxtDELEG">ctxtDELEG</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> DELEG</li><li class="src short"><a href="#v:ctxtEPOCH">ctxtEPOCH</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> EPOCH</li><li class="src short"><a href="#v:ctxtSDELEG">ctxtSDELEG</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> SDELEG</li><li class="src short"><a href="#v:ctxtUPIREG">ctxtUPIREG</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> UPIREG</li><li class="src short"><a href="#v:ctxtUPIVOTE">ctxtUPIVOTE</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> UPIVOTE</li><li class="src short"><a href="#v:ctxtUTXOW">ctxtUTXOW</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> UTXOW</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Ledger</h1></a><div class="top"><p class="src"><a id="v:applyChainTick" class="def">applyChainTick</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; Slot &#8594; State CHAIN &#8594; State CHAIN <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#applyChainTick" class="link">Source</a> <a href="#v:applyChainTick" class="selflink">#</a></p><div class="doc"><p>Chain tick</p><p>There isn't something in the spec that directly corresponds to this, so we
 have to combine a few different things:</p><ol><li>Apply the epoch rule (update the update state)</li><li>Apply any scheduled delegations</li><li>Set the slot number</li></ol><p>This matches quite closely what <code><a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#v:applyChainTick" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">applyChainTick</a></code> in
 <a href="Ouroboros-Consensus-Ledger-Byron-Auxiliary.html">Ouroboros.Consensus.Ledger.Byron.Auxiliary</a> does.</p></div></div><a href="#g:2" id="g:2"><h1>Lift STS transition rules to the chain level</h1></a><div class="top"><p class="src"><a id="v:liftCHAIN" class="def">liftCHAIN</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; LiftedRule CHAIN <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftCHAIN" class="link">Source</a> <a href="#v:liftCHAIN" class="selflink">#</a></p><div class="doc"><p>Apply a block</p><p>This is a &quot;trivial&quot; (identity) lift.</p></div></div><div class="top"><p class="src"><a id="v:liftSDELEG" class="def">liftSDELEG</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; LiftedRule SDELEG <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftSDELEG" class="link">Source</a> <a href="#v:liftSDELEG" class="selflink">#</a></p><div class="doc"><p>Apply delegation certificate</p></div></div><div class="top"><p class="src"><a id="v:liftUPIREG" class="def">liftUPIREG</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; LiftedRule UPIREG <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftUPIREG" class="link">Source</a> <a href="#v:liftUPIREG" class="selflink">#</a></p><div class="doc"><p>Apply update proposal</p></div></div><div class="top"><p class="src"><a id="v:liftUPIVOTE" class="def">liftUPIVOTE</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; LiftedRule UPIVOTE <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftUPIVOTE" class="link">Source</a> <a href="#v:liftUPIVOTE" class="selflink">#</a></p><div class="doc"><p>Apply update vote</p></div></div><div class="top"><p class="src"><a id="v:liftUTXOW" class="def">liftUTXOW</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; LiftedRule UTXOW <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#liftUTXOW" class="link">Source</a> <a href="#v:liftUTXOW" class="selflink">#</a></p><div class="doc"><p>Apply transaction</p></div></div><a href="#g:3" id="g:3"><h1>STS initial rules</h1></a><div class="top"><p class="src"><a id="v:initStateCHAIN" class="def">initStateCHAIN</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; State CHAIN <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#initStateCHAIN" class="link">Source</a> <a href="#v:initStateCHAIN" class="selflink">#</a></p></div><a href="#g:4" id="g:4"><h1>Rule context (exported for the benefit of the tests</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:RuleContext" class="def">RuleContext</a> sts <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#RuleContext" class="link">Source</a> <a href="#t:RuleContext" class="selflink">#</a></p><div class="doc"><p>Context required to apply a rule to the top-level CHAIN state</p><p>The environment  for these rules pull in some information from the (abstract)
 genesis config and some information from the state; the reason is that
 although some values come from the state, as far as these rules are
 concerned, they are constants.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:RuleContext" class="def">RuleContext</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:getRuleState" class="def">getRuleState</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Accessors.html#t:GetChainState" title="Ouroboros.Consensus.ByronSpec.Ledger.Accessors">GetChainState</a> (State sts)</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:modRuleState" class="def">modRuleState</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Accessors.html#t:ModChainState" title="Ouroboros.Consensus.ByronSpec.Ledger.Accessors">ModChainState</a> (State sts)</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:liftFailure" class="def">liftFailure</a> &#8759; PredicateFailure sts &#8594; PredicateFailure CHAIN</dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:getRuleEnv" class="def">getRuleEnv</a> &#8759; State CHAIN &#8594; Environment sts</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:ctxtCHAIN" class="def">ctxtCHAIN</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> CHAIN <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtCHAIN" class="link">Source</a> <a href="#v:ctxtCHAIN" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:ctxtDELEG" class="def">ctxtDELEG</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> DELEG <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtDELEG" class="link">Source</a> <a href="#v:ctxtDELEG" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:ctxtEPOCH" class="def">ctxtEPOCH</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> EPOCH <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtEPOCH" class="link">Source</a> <a href="#v:ctxtEPOCH" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:ctxtSDELEG" class="def">ctxtSDELEG</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> SDELEG <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtSDELEG" class="link">Source</a> <a href="#v:ctxtSDELEG" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:ctxtUPIREG" class="def">ctxtUPIREG</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> UPIREG <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIREG" class="link">Source</a> <a href="#v:ctxtUPIREG" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:ctxtUPIVOTE" class="def">ctxtUPIVOTE</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> UPIVOTE <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUPIVOTE" class="link">Source</a> <a href="#v:ctxtUPIVOTE" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:ctxtUTXOW" class="def">ctxtUTXOW</a> &#8759; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Genesis.html#t:ByronSpecGenesis" title="Ouroboros.Consensus.ByronSpec.Ledger.Genesis">ByronSpecGenesis</a> &#8594; <a href="Ouroboros-Consensus-ByronSpec-Ledger-Rules.html#t:RuleContext" title="Ouroboros.Consensus.ByronSpec.Ledger.Rules">RuleContext</a> UTXOW <a href="src/Ouroboros.Consensus.ByronSpec.Ledger.Rules.html#ctxtUTXOW" class="link">Source</a> <a href="#v:ctxtUTXOW" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.2</p></div></body></html>