<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds                #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DisambiguateRecordFields #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE EmptyCase                #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts         #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances        #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE GADTs                    #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards          #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables      #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications         #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators            #-}</span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Embed.Nary</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier">Inject</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#inject%27"><span class="hs-identifier">inject'</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Defaults</span></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectHardForkState"><span class="hs-identifier">injectHardForkState</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectNestedCtxt_"><span class="hs-identifier">injectNestedCtxt_</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectQuery"><span class="hs-identifier">injectQuery</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Initial 'ExtLedgerState'</span></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectInitialExtLedgerState"><span class="hs-identifier">injectInitialExtLedgerState</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Bifunctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">first</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Coerce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier">Coercible</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier">coerce</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.SOP.Dict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Dict</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Data.SOP.Strict.html"><span class="hs-identifier">Data.SOP.Strict</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Block.html"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Config.html"><span class="hs-identifier">Ouroboros.Consensus.Config</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">History</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HeaderValidation.html"><span class="hs-identifier">Ouroboros.Consensus.HeaderValidation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HeaderValidation.html#AnnTip"><span class="hs-identifier">AnnTip</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HeaderValidation.html#HeaderState"><span class="hs-identifier">HeaderState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>                     </span><span class="annot"><a href="Ouroboros.Consensus.HeaderValidation.html#genesisHeaderState"><span class="hs-identifier">genesisHeaderState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Extended.html"><span class="hs-identifier">Ouroboros.Consensus.Ledger.Extended</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Extended.html#ExtLedgerState"><span class="hs-identifier">ExtLedgerState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Storage.Serialisation.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.Serialisation</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html"><span class="hs-identifier">Ouroboros.Consensus.TypeFamilyWrappers</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.html"><span class="hs-identifier">Ouroboros.Consensus.Util</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.html#.%3A"><span class="hs-operator">(.:)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html"><span class="hs-identifier">Ouroboros.Consensus.Util.Counting</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#Exactly"><span class="hs-identifier">Exactly</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html"><span class="hs-identifier">Ouroboros.Consensus.Util.SOP</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.State</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">State</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.Combinator.Util.InPairs</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InPairs</span></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Injection for a single block into a HardForkBlock
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">class</span><span> </span><span id="Inject"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-var">Inject</span></a></span></span><span> </span><span id="local-6989586621680061752"><span class="annot"><a href="#local-6989586621680061752"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>  </span><span id="inject"><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#inject"><span class="hs-identifier hs-type">inject</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-49"></span><span>       </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680061748"><span class="annot"><a href="#local-6989586621680061748"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680061750"><span class="annot"><a href="#local-6989586621680061750"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061750"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#Exactly"><span class="hs-identifier hs-type">Exactly</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061750"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Bound"><span class="hs-identifier hs-type">History.Bound</span></a></span><span>
</span><span id="line-51"></span><span>       </span><span class="hs-comment">-- ^ Start bound of each era</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061750"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061748"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680061752"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061748"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680061752"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkBlock"><span class="hs-identifier hs-type">HardForkBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061750"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#inject%27"><span class="hs-identifier hs-type">inject'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-57"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680061494"><span class="annot"><a href="#local-6989586621680061494"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680061493"><span class="annot"><a href="#local-6989586621680061493"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680061492"><span class="annot"><a href="#local-6989586621680061492"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621680061491"><span class="annot"><a href="#local-6989586621680061491"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680061490"><span class="annot"><a href="#local-6989586621680061490"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-58"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061494"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-59"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061490"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-60"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Coercible</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061493"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680061494"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061491"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Coercible</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061492"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680061494"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkBlock"><span class="hs-identifier hs-type">HardForkBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061490"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061494"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#Exactly"><span class="hs-identifier hs-type">Exactly</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061490"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Bound"><span class="hs-identifier hs-type">History.Bound</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061490"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061491"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680061493"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680061492"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-64"></span><span id="inject%27"><span class="annot"><span class="annottext">inject' :: Proxy f -&gt; Exactly xs Bound -&gt; Index xs x -&gt; a -&gt; b
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#inject%27"><span class="hs-identifier hs-var hs-var">inject'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy f
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680061489"><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061489"><span class="hs-identifier hs-var">startBounds</span></a></span></span><span> </span><span id="local-6989586621680061488"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061488"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f (HardForkBlock xs) -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">(f (HardForkBlock xs) -&gt; b)
-&gt; (a -&gt; f (HardForkBlock xs)) -&gt; a -&gt; b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound -&gt; Index xs x -&gt; f x -&gt; f (HardForkBlock xs)
forall (f :: * -&gt; *) x (xs :: [*]).
(Inject f, CanHardFork xs) =&gt;
Exactly xs Bound -&gt; Index xs x -&gt; f x -&gt; f (HardForkBlock xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#inject"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680061494"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061489"><span class="hs-identifier hs-var">startBounds</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061488"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">(f x -&gt; f (HardForkBlock xs))
-&gt; (a -&gt; f x) -&gt; a -&gt; f (HardForkBlock xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; f x
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">coerce</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Defaults (to ease implementation)
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectNestedCtxt_"><span class="hs-identifier hs-type">injectNestedCtxt_</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-71"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680061730"><span class="annot"><a href="#local-6989586621680061730"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680061731"><span class="annot"><a href="#local-6989586621680061731"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680061732"><span class="annot"><a href="#local-6989586621680061732"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span id="local-6989586621680061729"><span class="annot"><a href="#local-6989586621680061729"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-72"></span><span>     </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061732"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061731"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Block.NestedContent.html#NestedCtxt_"><span class="hs-identifier hs-type">NestedCtxt_</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061731"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061730"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061729"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Block.NestedContent.html#NestedCtxt_"><span class="hs-identifier hs-type">NestedCtxt_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkBlock"><span class="hs-identifier hs-type">HardForkBlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061732"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680061730"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061729"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-75"></span><span id="injectNestedCtxt_"><span class="annot"><span class="annottext">injectNestedCtxt_ :: Index xs x
-&gt; NestedCtxt_ x f a -&gt; NestedCtxt_ (HardForkBlock xs) f a
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectNestedCtxt_"><span class="hs-identifier hs-var hs-var">injectNestedCtxt_</span></a></span></span><span> </span><span id="local-6989586621680061486"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061486"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span id="local-6989586621680061485"><span class="annot"><span class="annottext">NestedCtxt_ x f a
</span><a href="#local-6989586621680061485"><span class="hs-identifier hs-var">nc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061486"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="annottext">Index xs x
</span><a href="Ouroboros.Consensus.Util.SOP.html#IZ"><span class="hs-identifier hs-var">IZ</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NestedCtxt_ x f a -&gt; NestedCtxt_ (HardForkBlock (x : xs)) f a
forall x (f :: * -&gt; *) a (xs :: [*]).
NestedCtxt_ x f a -&gt; NestedCtxt_ (HardForkBlock (x : xs)) f a
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Block.html#NCZ"><span class="hs-identifier hs-var">NCZ</span></a></span><span> </span><span class="annot"><span class="annottext">NestedCtxt_ x f a
</span><a href="#local-6989586621680061485"><span class="hs-identifier hs-var">nc</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span id="local-6989586621680061481"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061481"><span class="hs-identifier hs-var">idx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NestedCtxt_ (HardForkBlock xs) f a
-&gt; NestedCtxt_ (HardForkBlock (y : xs)) f a
forall (xs :: [*]) (f :: * -&gt; *) a x.
NestedCtxt_ (HardForkBlock xs) f a
-&gt; NestedCtxt_ (HardForkBlock (x : xs)) f a
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Block.html#NCS"><span class="hs-identifier hs-var">NCS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index xs x
-&gt; NestedCtxt_ x f a -&gt; NestedCtxt_ (HardForkBlock xs) f a
forall (f :: * -&gt; *) x (xs :: [*]) a.
Index xs x
-&gt; NestedCtxt_ x f a -&gt; NestedCtxt_ (HardForkBlock xs) f a
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectNestedCtxt_"><span class="hs-identifier hs-var">injectNestedCtxt_</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061481"><span class="hs-identifier hs-var">idx'</span></a></span><span> </span><span class="annot"><span class="annottext">NestedCtxt_ x f a
</span><a href="#local-6989586621680061485"><span class="hs-identifier hs-var">nc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectQuery"><span class="hs-identifier hs-type">injectQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-80"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680061714"><span class="annot"><a href="#local-6989586621680061714"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680061715"><span class="annot"><a href="#local-6989586621680061715"><span class="hs-identifier hs-type">xs</span></a></span></span><span> </span><span id="local-6989586621680061713"><span class="annot"><a href="#local-6989586621680061713"><span class="hs-identifier hs-type">result</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-81"></span><span>     </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061715"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061714"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Query.html#BlockQuery"><span class="hs-identifier hs-type">BlockQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061714"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061713"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Ledger.Query.html#QueryIfCurrent"><span class="hs-identifier hs-type">QueryIfCurrent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061715"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061713"><span class="hs-identifier hs-type">result</span></a></span><span>
</span><span id="line-84"></span><span id="injectQuery"><span class="annot"><span class="annottext">injectQuery :: Index xs x -&gt; BlockQuery x result -&gt; QueryIfCurrent xs result
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectQuery"><span class="hs-identifier hs-var hs-var">injectQuery</span></a></span></span><span> </span><span id="local-6989586621680061479"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061479"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span id="local-6989586621680061478"><span class="annot"><span class="annottext">BlockQuery x result
</span><a href="#local-6989586621680061478"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061479"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><span class="annottext">Index xs x
</span><a href="Ouroboros.Consensus.Util.SOP.html#IZ"><span class="hs-identifier hs-var">IZ</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BlockQuery x result -&gt; QueryIfCurrent (x : xs) result
forall x result (xs :: [*]).
BlockQuery x result -&gt; QueryIfCurrent (x : xs) result
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Ledger.Query.html#QZ"><span class="hs-identifier hs-var">QZ</span></a></span><span> </span><span class="annot"><span class="annottext">BlockQuery x result
</span><a href="#local-6989586621680061478"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span id="local-6989586621680061476"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061476"><span class="hs-identifier hs-var">idx'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QueryIfCurrent xs result -&gt; QueryIfCurrent (y : xs) result
forall (xs :: [*]) result x.
QueryIfCurrent xs result -&gt; QueryIfCurrent (x : xs) result
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Ledger.Query.html#QS"><span class="hs-identifier hs-var">QS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index xs x -&gt; BlockQuery x result -&gt; QueryIfCurrent xs result
forall x (xs :: [*]) result.
Index xs x -&gt; BlockQuery x result -&gt; QueryIfCurrent xs result
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectQuery"><span class="hs-identifier hs-var">injectQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061476"><span class="hs-identifier hs-var">idx'</span></a></span><span> </span><span class="annot"><span class="annottext">BlockQuery x result
</span><a href="#local-6989586621680061478"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectHardForkState"><span class="hs-identifier hs-type">injectHardForkState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-89"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680061584"><span class="annot"><a href="#local-6989586621680061584"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680061585"><span class="annot"><a href="#local-6989586621680061585"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680061586"><span class="annot"><a href="#local-6989586621680061586"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-90"></span><span>     </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#Exactly"><span class="hs-identifier hs-type">Exactly</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061586"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Bound"><span class="hs-identifier hs-type">History.Bound</span></a></span><span>
</span><span id="line-91"></span><span>     </span><span class="hs-comment">-- ^ Start bound of each era</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061586"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061585"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680061584"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061585"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-type">HardForkState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061584"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061586"><span class="hs-identifier hs-type">xs</span></a></span><span>
</span><span id="line-95"></span><span id="injectHardForkState"><span class="annot"><span class="annottext">injectHardForkState :: Exactly xs Bound -&gt; Index xs x -&gt; f x -&gt; HardForkState f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectHardForkState"><span class="hs-identifier hs-var hs-var">injectHardForkState</span></a></span></span><span> </span><span id="local-6989586621680061474"><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061474"><span class="hs-identifier hs-var">startBounds</span></a></span></span><span> </span><span id="local-6989586621680061473"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061473"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span id="local-6989586621680061472"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680061472"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><span class="annottext">Telescope (K Past) (Current f) xs -&gt; HardForkState f xs
forall (f :: * -&gt; *) (xs :: [*]).
Telescope (K Past) (Current f) xs -&gt; HardForkState f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#HardForkState"><span class="hs-identifier hs-var">HardForkState</span></a></span><span> </span><span class="annot"><span class="annottext">(Telescope (K Past) (Current f) xs -&gt; HardForkState f xs)
-&gt; Telescope (K Past) (Current f) xs -&gt; HardForkState f xs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound -&gt; Index xs x -&gt; Telescope (K Past) (Current f) xs
forall (xs' :: [*]).
Exactly xs' Bound
-&gt; Index xs' x -&gt; Telescope (K Past) (Current f) xs'
</span><a href="#local-6989586621680061470"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061474"><span class="hs-identifier hs-var">startBounds</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061473"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621680061699"><span class="annot"><a href="#local-6989586621680061470"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-99"></span><span>         </span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#Exactly"><span class="hs-identifier hs-type">Exactly</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061699"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Bound"><span class="hs-identifier hs-type">History.Bound</span></a></span><span>
</span><span id="line-100"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061699"><span class="hs-identifier hs-type">xs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061585"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-101"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#Telescope"><span class="hs-identifier hs-type">Telescope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">K</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Past"><span class="hs-identifier hs-type">State.Past</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">State.Current</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061584"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680061699"><span class="hs-identifier hs-type">xs'</span></a></span></span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621680061470"><span class="annot"><span class="annottext">go :: Exactly xs' Bound
-&gt; Index xs' x -&gt; Telescope (K Past) (Current f) xs'
</span><a href="#local-6989586621680061470"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#ExactlyCons"><span class="hs-identifier hs-type">ExactlyCons</span></a></span><span> </span><span id="local-6989586621680061468"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680061468"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Index xs' x
</span><a href="Ouroboros.Consensus.Util.SOP.html#IZ"><span class="hs-identifier hs-var">IZ</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-103"></span><span>        </span><span class="annot"><span class="annottext">Current f x -&gt; Telescope (K Past) (Current f) (x : xs)
forall a (f :: a -&gt; *) (x :: a) (g :: a -&gt; *) (xs :: [a]).
f x -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TZ"><span class="hs-identifier hs-var">TZ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Current :: forall (f :: * -&gt; *) blk. Bound -&gt; f blk -&gt; Current f blk
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Current"><span class="hs-identifier hs-type">State.Current</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">currentStart :: Bound
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentStart"><span class="hs-identifier hs-var">currentStart</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680061468"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">currentState :: f x
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#currentState"><span class="hs-identifier hs-var">currentState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621680061472"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="#local-6989586621680061470"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#ExactlyCons"><span class="hs-identifier hs-type">ExactlyCons</span></a></span><span> </span><span id="local-6989586621680061463"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680061463"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621680061462"><span class="annot"><span class="annottext">startBounds' :: Exactly xs Bound
</span><a href="#local-6989586621680061462"><span class="hs-identifier hs-var">startBounds'</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#ExactlyCons"><span class="hs-identifier hs-type">ExactlyCons</span></a></span><span> </span><span id="local-6989586621680061461"><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680061461"><span class="hs-identifier hs-var">nextStart</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span id="local-6989586621680061460"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061460"><span class="hs-identifier hs-var">idx'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="annottext">K Past x
-&gt; Telescope (K Past) (Current f) xs
-&gt; Telescope (K Past) (Current f) (x : xs)
forall a (g :: a -&gt; *) (x :: a) (f :: a -&gt; *) (xs :: [a]).
g x -&gt; Telescope g f xs -&gt; Telescope g f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.Telescope.html#TS"><span class="hs-identifier hs-var">TS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Past -&gt; K Past x
forall k a (b :: k). a -&gt; K a b
</span><span class="hs-identifier hs-var">K</span></span><span> </span><span class="annot"><span class="annottext">Past :: Bound -&gt; Bound -&gt; Past
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#Past"><span class="hs-identifier hs-type">State.Past</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pastStart :: Bound
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#pastStart"><span class="hs-identifier hs-var">pastStart</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680061463"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pastEnd :: Bound
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Types.html#pastEnd"><span class="hs-identifier hs-var">pastEnd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bound
</span><a href="#local-6989586621680061461"><span class="hs-identifier hs-var">nextStart</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exactly xs Bound -&gt; Index xs x -&gt; Telescope (K Past) (Current f) xs
forall (xs' :: [*]).
Exactly xs' Bound
-&gt; Index xs' x -&gt; Telescope (K Past) (Current f) xs'
</span><a href="#local-6989586621680061470"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061462"><span class="hs-identifier hs-var">startBounds'</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
Index xs x
</span><a href="#local-6989586621680061460"><span class="hs-identifier hs-var">idx'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="#local-6989586621680061470"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.Counting.html#ExactlyCons"><span class="hs-identifier hs-type">ExactlyCons</span></a></span><span> </span><span class="annot"><span class="annottext">Bound
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="Ouroboros.Consensus.Util.Counting.html#ExactlyNil"><span class="hs-identifier hs-var">ExactlyNil</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#IS"><span class="hs-identifier hs-type">IS</span></a></span><span> </span><span id="local-6989586621680061453"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061453"><span class="hs-identifier hs-var">idx'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061453"><span class="hs-identifier hs-var">idx'</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="#local-6989586621680061470"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs' Bound
</span><a href="Ouroboros.Consensus.Util.Counting.html#ExactlyNil"><span class="hs-identifier hs-var">ExactlyNil</span></a></span><span> </span><span id="local-6989586621680061452"><span class="annot"><span class="annottext">Index xs' x
</span><a href="#local-6989586621680061452"><span class="hs-identifier hs-var">idx'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Index xs' x
</span><a href="#local-6989586621680061452"><span class="hs-identifier hs-var">idx'</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Instances
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">I</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>  </span><span id="local-6989586621680061449"><span class="annot"><span class="annottext">inject :: Exactly xs Bound -&gt; Index xs x -&gt; I x -&gt; I (HardForkBlock xs)
</span><a href="#local-6989586621680061449"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy I -&gt; Index xs x -&gt; I x -&gt; I (HardForkBlock xs)
forall a1 (f :: a1 -&gt; *) a2 b (x :: a1) (xs :: [a1]).
(Coercible a2 (f x), Coercible b (NS f xs)) =&gt;
Proxy f -&gt; Index xs x -&gt; a2 -&gt; b
</span><a href="Ouroboros.Consensus.Util.SOP.html#injectNS%27"><span class="hs-identifier hs-var">injectNS'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy I
forall k (t :: k). Proxy t
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">I</span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>  </span><span id="local-6989586621680061445"><span class="annot"><span class="annottext">inject :: Exactly xs Bound
-&gt; Index xs x -&gt; Header x -&gt; Header (HardForkBlock xs)
</span><a href="#local-6989586621680061445"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy Header -&gt; Index xs x -&gt; Header x -&gt; Header (HardForkBlock xs)
forall a1 (f :: a1 -&gt; *) a2 b (x :: a1) (xs :: [a1]).
(Coercible a2 (f x), Coercible b (NS f xs)) =&gt;
Proxy f -&gt; Index xs x -&gt; a2 -&gt; b
</span><a href="Ouroboros.Consensus.Util.SOP.html#injectNS%27"><span class="hs-identifier hs-var">injectNS'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy Header
forall k (t :: k). Proxy t
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Storage.Serialisation.html#SerialisedHeader"><span class="hs-identifier hs-type">SerialisedHeader</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>  </span><span id="local-6989586621680061443"><span class="annot"><span class="annottext">inject :: Exactly xs Bound
-&gt; Index xs x
-&gt; SerialisedHeader x
-&gt; SerialisedHeader (HardForkBlock xs)
</span><a href="#local-6989586621680061443"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680061442"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061442"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><span class="annottext">(SomeSecond (NestedCtxt Header) (HardForkBlock xs), ByteString)
-&gt; SerialisedHeader (HardForkBlock xs)
forall blk.
(SomeSecond (NestedCtxt Header) blk, ByteString)
-&gt; SerialisedHeader blk
</span><a href="Ouroboros.Consensus.Storage.Serialisation.html#serialisedHeaderFromPair"><span class="hs-identifier hs-var">serialisedHeaderFromPair</span></a></span><span>
</span><span id="line-123"></span><span>      </span><span class="annot"><span class="annottext">((SomeSecond (NestedCtxt Header) (HardForkBlock xs), ByteString)
 -&gt; SerialisedHeader (HardForkBlock xs))
-&gt; (SerialisedHeader x
    -&gt; (SomeSecond (NestedCtxt Header) (HardForkBlock xs), ByteString))
-&gt; SerialisedHeader x
-&gt; SerialisedHeader (HardForkBlock xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeSecond (NestedCtxt Header) x
 -&gt; SomeSecond (NestedCtxt Header) (HardForkBlock xs))
-&gt; (SomeSecond (NestedCtxt Header) x, ByteString)
-&gt; (SomeSecond (NestedCtxt Header) (HardForkBlock xs), ByteString)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall a.
 NestedCtxt_ x Header a -&gt; NestedCtxt_ (HardForkBlock xs) Header a)
-&gt; SomeSecond (NestedCtxt Header) x
-&gt; SomeSecond (NestedCtxt Header) (HardForkBlock xs)
forall blk (f :: * -&gt; *) blk' (f' :: * -&gt; *).
(forall a. NestedCtxt_ blk f a -&gt; NestedCtxt_ blk' f' a)
-&gt; SomeSecond (NestedCtxt f) blk -&gt; SomeSecond (NestedCtxt f') blk'
</span><a href="Ouroboros.Consensus.Block.NestedContent.html#mapSomeNestedCtxt"><span class="hs-identifier hs-var">mapSomeNestedCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index xs x
-&gt; NestedCtxt_ x Header a
-&gt; NestedCtxt_ (HardForkBlock xs) Header a
forall (f :: * -&gt; *) x (xs :: [*]) a.
Index xs x
-&gt; NestedCtxt_ x f a -&gt; NestedCtxt_ (HardForkBlock xs) f a
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectNestedCtxt_"><span class="hs-identifier hs-var">injectNestedCtxt_</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061442"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>      </span><span class="annot"><span class="annottext">((SomeSecond (NestedCtxt Header) x, ByteString)
 -&gt; (SomeSecond (NestedCtxt Header) (HardForkBlock xs), ByteString))
-&gt; (SerialisedHeader x
    -&gt; (SomeSecond (NestedCtxt Header) x, ByteString))
-&gt; SerialisedHeader x
-&gt; (SomeSecond (NestedCtxt Header) (HardForkBlock xs), ByteString)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SerialisedHeader x
-&gt; (SomeSecond (NestedCtxt Header) x, ByteString)
forall blk.
SerialisedHeader blk
-&gt; (SomeSecond (NestedCtxt Header) blk, ByteString)
</span><a href="Ouroboros.Consensus.Storage.Serialisation.html#serialisedHeaderToPair"><span class="hs-identifier hs-var">serialisedHeaderToPair</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapHeaderHash"><span class="hs-identifier hs-type">WrapHeaderHash</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-127"></span><span>  </span><span id="local-6989586621680061437"><span class="annot"><span class="annottext">inject :: Exactly xs Bound
-&gt; Index xs x
-&gt; WrapHeaderHash x
-&gt; WrapHeaderHash (HardForkBlock xs)
</span><a href="#local-6989586621680061437"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680061435"><span id="local-6989586621680061436"><span id="local-6989586621680061434"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061434"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Util.SOP.html#Index"><span class="hs-identifier hs-type">Index</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061436"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061435"><span class="hs-identifier hs-type">x</span></a></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Proxy SingleEraBlock -&gt; Index xs x -&gt; Dict SingleEraBlock x
forall k (c :: k -&gt; Constraint) (xs :: [k]) (x :: k).
All c xs =&gt;
Proxy c -&gt; Index xs x -&gt; Dict c x
</span><a href="Ouroboros.Consensus.Util.SOP.html#dictIndexAll"><span class="hs-identifier hs-var">dictIndexAll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy SingleEraBlock
forall k (t :: k). Proxy t
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.SingleEraBlock.html#SingleEraBlock"><span class="hs-identifier hs-type">SingleEraBlock</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061434"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><span class="annottext">Dict SingleEraBlock x
</span><span class="hs-identifier hs-var">Dict</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>          </span><span class="annot"><span class="annottext">OneEraHash xs -&gt; WrapHeaderHash (HardForkBlock xs)
forall blk. HeaderHash blk -&gt; WrapHeaderHash blk
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapHeaderHash"><span class="hs-identifier hs-var">WrapHeaderHash</span></a></span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="annottext">(OneEraHash xs -&gt; WrapHeaderHash (HardForkBlock xs))
-&gt; (WrapHeaderHash x -&gt; OneEraHash xs)
-&gt; WrapHeaderHash x
-&gt; WrapHeaderHash (HardForkBlock xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; OneEraHash xs
forall k (xs :: [k]). ShortByteString -&gt; OneEraHash xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.AcrossEras.html#OneEraHash"><span class="hs-identifier hs-var">OneEraHash</span></a></span><span>
</span><span id="line-132"></span><span>        </span><span class="annot"><span class="annottext">(ShortByteString -&gt; OneEraHash xs)
-&gt; (WrapHeaderHash x -&gt; ShortByteString)
-&gt; WrapHeaderHash x
-&gt; OneEraHash xs
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy x -&gt; HeaderHash x -&gt; ShortByteString
forall blk (proxy :: * -&gt; *).
ConvertRawHash blk =&gt;
proxy blk -&gt; HeaderHash blk -&gt; ShortByteString
</span><a href="Ouroboros.Consensus.Block.Abstract.html#toShortRawHash"><span class="hs-identifier hs-var">toShortRawHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy x
forall k (t :: k). Proxy t
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680061435"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">(HeaderHash x -&gt; ShortByteString)
-&gt; (WrapHeaderHash x -&gt; HeaderHash x)
-&gt; WrapHeaderHash x
-&gt; ShortByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WrapHeaderHash x -&gt; HeaderHash x
forall blk. WrapHeaderHash blk -&gt; HeaderHash blk
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#unwrapHeaderHash"><span class="hs-identifier hs-var hs-var">unwrapHeaderHash</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-136"></span><span>  </span><span id="local-6989586621680061426"><span class="annot"><span class="annottext">inject :: Exactly xs Bound
-&gt; Index xs x -&gt; GenTx x -&gt; GenTx (HardForkBlock xs)
</span><a href="#local-6989586621680061426"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy GenTx -&gt; Index xs x -&gt; GenTx x -&gt; GenTx (HardForkBlock xs)
forall a1 (f :: a1 -&gt; *) a2 b (x :: a1) (xs :: [a1]).
(Coercible a2 (f x), Coercible b (NS f xs)) =&gt;
Proxy f -&gt; Index xs x -&gt; a2 -&gt; b
</span><a href="Ouroboros.Consensus.Util.SOP.html#injectNS%27"><span class="hs-identifier hs-var">injectNS'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy GenTx
forall k (t :: k). Proxy t
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Consensus.Ledger.SupportsMempool.html#GenTx"><span class="hs-identifier hs-type">GenTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapGenTxId"><span class="hs-identifier hs-type">WrapGenTxId</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-139"></span><span>  </span><span id="local-6989586621680061424"><span class="annot"><span class="annottext">inject :: Exactly xs Bound
-&gt; Index xs x -&gt; WrapGenTxId x -&gt; WrapGenTxId (HardForkBlock xs)
</span><a href="#local-6989586621680061424"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy WrapGenTxId
-&gt; Index xs x -&gt; WrapGenTxId x -&gt; WrapGenTxId (HardForkBlock xs)
forall a1 (f :: a1 -&gt; *) a2 b (x :: a1) (xs :: [a1]).
(Coercible a2 (f x), Coercible b (NS f xs)) =&gt;
Proxy f -&gt; Index xs x -&gt; a2 -&gt; b
</span><a href="Ouroboros.Consensus.Util.SOP.html#injectNS%27"><span class="hs-identifier hs-var">injectNS'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy WrapGenTxId
forall k (t :: k). Proxy t
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapGenTxId"><span class="hs-identifier hs-type">WrapGenTxId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapApplyTxErr"><span class="hs-identifier hs-type">WrapApplyTxErr</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-142"></span><span>  </span><span id="local-6989586621680061422"><span class="annot"><span class="annottext">inject :: Exactly xs Bound
-&gt; Index xs x
-&gt; WrapApplyTxErr x
-&gt; WrapApplyTxErr (HardForkBlock xs)
</span><a href="#local-6989586621680061422"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HardForkApplyTxErr xs -&gt; WrapApplyTxErr (HardForkBlock xs)
forall blk. ApplyTxErr blk -&gt; WrapApplyTxErr blk
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapApplyTxErr"><span class="hs-identifier hs-var">WrapApplyTxErr</span></a></span><span> </span><span class="annot"><span class="annottext">(HardForkApplyTxErr xs -&gt; WrapApplyTxErr (HardForkBlock xs))
-&gt; (OneEraApplyTxErr xs -&gt; HardForkApplyTxErr xs)
-&gt; OneEraApplyTxErr xs
-&gt; WrapApplyTxErr (HardForkBlock xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">OneEraApplyTxErr xs -&gt; HardForkApplyTxErr xs
forall (xs :: [*]). OneEraApplyTxErr xs -&gt; HardForkApplyTxErr xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Mempool.html#HardForkApplyTxErrFromEra"><span class="hs-identifier hs-var">HardForkApplyTxErrFromEra</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><span class="annottext">(OneEraApplyTxErr xs -&gt; WrapApplyTxErr (HardForkBlock xs))
-&gt; (Index xs x -&gt; WrapApplyTxErr x -&gt; OneEraApplyTxErr xs)
-&gt; Index xs x
-&gt; WrapApplyTxErr x
-&gt; WrapApplyTxErr (HardForkBlock xs)
forall y z x0 x1. (y -&gt; z) -&gt; (x0 -&gt; x1 -&gt; y) -&gt; x0 -&gt; x1 -&gt; z
</span><a href="Ouroboros.Consensus.Util.html#.%3A"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy WrapApplyTxErr
-&gt; Index xs x -&gt; WrapApplyTxErr x -&gt; OneEraApplyTxErr xs
forall a1 (f :: a1 -&gt; *) a2 b (x :: a1) (xs :: [a1]).
(Coercible a2 (f x), Coercible b (NS f xs)) =&gt;
Proxy f -&gt; Index xs x -&gt; a2 -&gt; b
</span><a href="Ouroboros.Consensus.Util.SOP.html#injectNS%27"><span class="hs-identifier hs-var">injectNS'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy WrapApplyTxErr
forall k (t :: k). Proxy t
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapApplyTxErr"><span class="hs-identifier hs-type">WrapApplyTxErr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.html#SomeSecond"><span class="hs-identifier hs-type">SomeSecond</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Query.html#BlockQuery"><span class="hs-identifier hs-type">BlockQuery</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-147"></span><span>  </span><span id="local-6989586621680061418"><span class="annot"><span class="annottext">inject :: Exactly xs Bound
-&gt; Index xs x
-&gt; SomeSecond BlockQuery x
-&gt; SomeSecond BlockQuery (HardForkBlock xs)
</span><a href="#local-6989586621680061418"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680061417"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061417"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.Util.html#SomeSecond"><span class="hs-identifier hs-type">SomeSecond</span></a></span><span> </span><span id="local-6989586621680061415"><span class="annot"><span class="annottext">BlockQuery x b
</span><a href="#local-6989586621680061415"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockQuery (HardForkBlock xs) (HardForkQueryResult xs b)
-&gt; SomeSecond BlockQuery (HardForkBlock xs)
forall (f :: * -&gt; * -&gt; *) a b. f a b -&gt; SomeSecond f a
</span><a href="Ouroboros.Consensus.Util.html#SomeSecond"><span class="hs-identifier hs-var">SomeSecond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QueryIfCurrent xs b
-&gt; BlockQuery (HardForkBlock xs) (HardForkQueryResult xs b)
forall (xs :: [*]) result.
QueryIfCurrent xs result
-&gt; BlockQuery (HardForkBlock xs) (HardForkQueryResult xs result)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Ledger.Query.html#QueryIfCurrent"><span class="hs-identifier hs-var">QueryIfCurrent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index xs x -&gt; BlockQuery x b -&gt; QueryIfCurrent xs b
forall x (xs :: [*]) result.
Index xs x -&gt; BlockQuery x result -&gt; QueryIfCurrent xs result
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectQuery"><span class="hs-identifier hs-var">injectQuery</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061417"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">BlockQuery x b
</span><a href="#local-6989586621680061415"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HeaderValidation.html#AnnTip"><span class="hs-identifier hs-type">AnnTip</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>  </span><span id="local-6989586621680061412"><span class="annot"><span class="annottext">inject :: Exactly xs Bound
-&gt; Index xs x -&gt; AnnTip x -&gt; AnnTip (HardForkBlock xs)
</span><a href="#local-6989586621680061412"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NS AnnTip xs -&gt; AnnTip (HardForkBlock xs)
forall (xs :: [*]).
SListI xs =&gt;
NS AnnTip xs -&gt; AnnTip (HardForkBlock xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Block.html#undistribAnnTip"><span class="hs-identifier hs-var">undistribAnnTip</span></a></span><span> </span><span class="annot"><span class="annottext">(NS AnnTip xs -&gt; AnnTip (HardForkBlock xs))
-&gt; (Index xs x -&gt; AnnTip x -&gt; NS AnnTip xs)
-&gt; Index xs x
-&gt; AnnTip x
-&gt; AnnTip (HardForkBlock xs)
forall y z x0 x1. (y -&gt; z) -&gt; (x0 -&gt; x1 -&gt; y) -&gt; x0 -&gt; x1 -&gt; z
</span><a href="Ouroboros.Consensus.Util.html#.%3A"><span class="hs-operator hs-var">.:</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy AnnTip -&gt; Index xs x -&gt; AnnTip x -&gt; NS AnnTip xs
forall a1 (f :: a1 -&gt; *) a2 b (x :: a1) (xs :: [a1]).
(Coercible a2 (f x), Coercible b (NS f xs)) =&gt;
Proxy f -&gt; Index xs x -&gt; a2 -&gt; b
</span><a href="Ouroboros.Consensus.Util.SOP.html#injectNS%27"><span class="hs-identifier hs-var">injectNS'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy AnnTip
forall k (t :: k). Proxy t
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Consensus.HeaderValidation.html#AnnTip"><span class="hs-identifier hs-type">AnnTip</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Basics.html#LedgerState"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621680061409"><span class="annot"><span class="annottext">inject :: Exactly xs Bound
-&gt; Index xs x -&gt; LedgerState x -&gt; LedgerState (HardForkBlock xs)
</span><a href="#local-6989586621680061409"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span id="local-6989586621680061408"><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061408"><span class="hs-identifier hs-var">startBounds</span></a></span></span><span> </span><span id="local-6989586621680061407"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061407"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><span class="annottext">HardForkState LedgerState xs -&gt; LedgerState (HardForkBlock xs)
forall (xs :: [*]).
HardForkState LedgerState xs -&gt; LedgerState (HardForkBlock xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkLedgerState"><span class="hs-identifier hs-var">HardForkLedgerState</span></a></span><span> </span><span class="annot"><span class="annottext">(HardForkState LedgerState xs -&gt; LedgerState (HardForkBlock xs))
-&gt; (LedgerState x -&gt; HardForkState LedgerState xs)
-&gt; LedgerState x
-&gt; LedgerState (HardForkBlock xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
-&gt; Index xs x -&gt; LedgerState x -&gt; HardForkState LedgerState xs
forall (f :: * -&gt; *) x (xs :: [*]).
Exactly xs Bound -&gt; Index xs x -&gt; f x -&gt; HardForkState f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectHardForkState"><span class="hs-identifier hs-var">injectHardForkState</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061408"><span class="hs-identifier hs-var">startBounds</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061407"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-type">WrapChainDepState</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621680061404"><span class="annot"><span class="annottext">inject :: Exactly xs Bound
-&gt; Index xs x
-&gt; WrapChainDepState x
-&gt; WrapChainDepState (HardForkBlock xs)
</span><a href="#local-6989586621680061404"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span id="local-6989586621680061403"><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061403"><span class="hs-identifier hs-var">startBounds</span></a></span></span><span> </span><span id="local-6989586621680061402"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061402"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-158"></span><span>      </span><span class="annot"><span class="annottext">HardForkState WrapChainDepState xs
-&gt; WrapChainDepState (HardForkBlock xs)
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">coerce</span></a></span><span> </span><span class="annot"><span class="annottext">(HardForkState WrapChainDepState xs
 -&gt; WrapChainDepState (HardForkBlock xs))
-&gt; (WrapChainDepState x -&gt; HardForkState WrapChainDepState xs)
-&gt; WrapChainDepState x
-&gt; WrapChainDepState (HardForkBlock xs)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
-&gt; Index xs x
-&gt; WrapChainDepState x
-&gt; HardForkState WrapChainDepState xs
forall (f :: * -&gt; *) x (xs :: [*]).
Exactly xs Bound -&gt; Index xs x -&gt; f x -&gt; HardForkState f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectHardForkState"><span class="hs-identifier hs-var">injectHardForkState</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061403"><span class="hs-identifier hs-var">startBounds</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061402"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HeaderValidation.html#HeaderState"><span class="hs-identifier hs-type">HeaderState</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>  </span><span id="local-6989586621680061400"><span class="annot"><span class="annottext">inject :: Exactly xs Bound
-&gt; Index xs x -&gt; HeaderState x -&gt; HeaderState (HardForkBlock xs)
</span><a href="#local-6989586621680061400"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span id="local-6989586621680061399"><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061399"><span class="hs-identifier hs-var">startBounds</span></a></span></span><span> </span><span id="local-6989586621680061398"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061398"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HeaderValidation.html#HeaderState"><span class="hs-identifier hs-type">HeaderState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680061395"><span id="local-6989586621680061396"><span class="annot"><span class="annottext">WithOrigin (AnnTip x)
ChainDepState (BlockProtocol x)
headerStateChainDep :: forall blk. HeaderState blk -&gt; ChainDepState (BlockProtocol blk)
headerStateTip :: forall blk. HeaderState blk -&gt; WithOrigin (AnnTip blk)
headerStateChainDep :: ChainDepState (BlockProtocol x)
headerStateTip :: WithOrigin (AnnTip x)
</span><a href="Ouroboros.Consensus.HeaderValidation.html#headerStateChainDep"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderState :: forall blk.
WithOrigin (AnnTip blk)
-&gt; ChainDepState (BlockProtocol blk) -&gt; HeaderState blk
</span><a href="Ouroboros.Consensus.HeaderValidation.html#HeaderState"><span class="hs-identifier hs-type">HeaderState</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><span class="annottext">headerStateTip :: WithOrigin (AnnTip (HardForkBlock xs))
</span><a href="Ouroboros.Consensus.HeaderValidation.html#headerStateTip"><span class="hs-identifier hs-var">headerStateTip</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
-&gt; Index xs x -&gt; AnnTip x -&gt; AnnTip (HardForkBlock xs)
forall (f :: * -&gt; *) x (xs :: [*]).
(Inject f, CanHardFork xs) =&gt;
Exactly xs Bound -&gt; Index xs x -&gt; f x -&gt; f (HardForkBlock xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#inject"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061399"><span class="hs-identifier hs-var">startBounds</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061398"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">(AnnTip x -&gt; AnnTip (HardForkBlock xs))
-&gt; WithOrigin (AnnTip x) -&gt; WithOrigin (AnnTip (HardForkBlock xs))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">WithOrigin (AnnTip x)
</span><a href="#local-6989586621680061396"><span class="hs-identifier hs-var">headerStateTip</span></a></span><span>
</span><span id="line-163"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">headerStateChainDep :: ChainDepState (BlockProtocol (HardForkBlock xs))
</span><a href="Ouroboros.Consensus.HeaderValidation.html#headerStateChainDep"><span class="hs-identifier hs-var">headerStateChainDep</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WrapChainDepState (HardForkBlock xs)
-&gt; ChainDepState (BlockProtocol (HardForkBlock xs))
forall blk.
WrapChainDepState blk -&gt; ChainDepState (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#unwrapChainDepState"><span class="hs-identifier hs-var hs-var">unwrapChainDepState</span></a></span><span>
</span><span id="line-164"></span><span>                            </span><span class="annot"><span class="annottext">(WrapChainDepState (HardForkBlock xs)
 -&gt; ChainDepState (BlockProtocol (HardForkBlock xs)))
-&gt; WrapChainDepState (HardForkBlock xs)
-&gt; ChainDepState (BlockProtocol (HardForkBlock xs))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
-&gt; Index xs x
-&gt; WrapChainDepState x
-&gt; WrapChainDepState (HardForkBlock xs)
forall (f :: * -&gt; *) x (xs :: [*]).
(Inject f, CanHardFork xs) =&gt;
Exactly xs Bound -&gt; Index xs x -&gt; f x -&gt; f (HardForkBlock xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#inject"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061399"><span class="hs-identifier hs-var">startBounds</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061398"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-165"></span><span>                            </span><span class="annot"><span class="annottext">(WrapChainDepState x -&gt; WrapChainDepState (HardForkBlock xs))
-&gt; WrapChainDepState x -&gt; WrapChainDepState (HardForkBlock xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDepState (BlockProtocol x) -&gt; WrapChainDepState x
forall blk.
ChainDepState (BlockProtocol blk) -&gt; WrapChainDepState blk
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-var">WrapChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDepState (BlockProtocol x)
</span><a href="#local-6989586621680061395"><span class="hs-identifier hs-var">headerStateChainDep</span></a></span><span>
</span><span id="line-166"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Extended.html#ExtLedgerState"><span class="hs-identifier hs-type">ExtLedgerState</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-169"></span><span>  </span><span id="local-6989586621680061388"><span class="annot"><span class="annottext">inject :: Exactly xs Bound
-&gt; Index xs x
-&gt; ExtLedgerState x
-&gt; ExtLedgerState (HardForkBlock xs)
</span><a href="#local-6989586621680061388"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span id="local-6989586621680061387"><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061387"><span class="hs-identifier hs-var">startBounds</span></a></span></span><span> </span><span id="local-6989586621680061386"><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061386"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Extended.html#ExtLedgerState"><span class="hs-identifier hs-type">ExtLedgerState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680061383"><span id="local-6989586621680061384"><span class="annot"><span class="annottext">LedgerState x
HeaderState x
headerState :: forall blk. ExtLedgerState blk -&gt; HeaderState blk
ledgerState :: forall blk. ExtLedgerState blk -&gt; LedgerState blk
headerState :: HeaderState x
ledgerState :: LedgerState x
</span><a href="Ouroboros.Consensus.Ledger.Extended.html#headerState"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExtLedgerState :: forall blk.
LedgerState blk -&gt; HeaderState blk -&gt; ExtLedgerState blk
</span><a href="Ouroboros.Consensus.Ledger.Extended.html#ExtLedgerState"><span class="hs-identifier hs-type">ExtLedgerState</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-170"></span><span>        </span><span class="annot"><span class="annottext">ledgerState :: LedgerState (HardForkBlock xs)
</span><a href="Ouroboros.Consensus.Ledger.Extended.html#ledgerState"><span class="hs-identifier hs-var">ledgerState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
-&gt; Index xs x -&gt; LedgerState x -&gt; LedgerState (HardForkBlock xs)
forall (f :: * -&gt; *) x (xs :: [*]).
(Inject f, CanHardFork xs) =&gt;
Exactly xs Bound -&gt; Index xs x -&gt; f x -&gt; f (HardForkBlock xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#inject"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061387"><span class="hs-identifier hs-var">startBounds</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061386"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState x
</span><a href="#local-6989586621680061384"><span class="hs-identifier hs-var">ledgerState</span></a></span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">headerState :: HeaderState (HardForkBlock xs)
</span><a href="Ouroboros.Consensus.Ledger.Extended.html#headerState"><span class="hs-identifier hs-var">headerState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
-&gt; Index xs x -&gt; HeaderState x -&gt; HeaderState (HardForkBlock xs)
forall (f :: * -&gt; *) x (xs :: [*]).
(Inject f, CanHardFork xs) =&gt;
Exactly xs Bound -&gt; Index xs x -&gt; f x -&gt; f (HardForkBlock xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#inject"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">Exactly xs Bound
</span><a href="#local-6989586621680061387"><span class="hs-identifier hs-var">startBounds</span></a></span><span> </span><span class="annot"><span class="annottext">Index xs x
</span><a href="#local-6989586621680061386"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderState x
</span><a href="#local-6989586621680061383"><span class="hs-identifier hs-var">headerState</span></a></span><span>
</span><span id="line-172"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">{-------------------------------------------------------------------------------
  Initial ExtLedgerState
-------------------------------------------------------------------------------}</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | Inject the first era's initial 'ExtLedgerState' and trigger any</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- translations that should take place in the very first slot.</span><span>
</span><span id="line-180"></span><span class="hs-comment">--</span><span>
</span><span id="line-181"></span><span class="hs-comment">-- Performs any hard forks scheduled via 'TriggerHardForkAtEpoch'.</span><span>
</span><span id="line-182"></span><span class="hs-comment">--</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- Note: we can translate across multiple eras when computing the initial ledger</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- state, but we do not support translation across multiple eras in general;</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- extending 'applyChainTick' to translate across more than one era is not</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- problematic, but extending 'ledgerViewForecastAt' is a lot more subtle; see</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- @forecastNotFinal@.</span><span>
</span><span id="line-188"></span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectInitialExtLedgerState"><span class="hs-identifier hs-type">injectInitialExtLedgerState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-189"></span><span>     </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680061380"><span class="annot"><a href="#local-6989586621680061380"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680061379"><span class="annot"><a href="#local-6989586621680061379"><span class="hs-identifier hs-type">xs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#CanHardFork"><span class="hs-identifier hs-type">CanHardFork</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680061380"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680061379"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Config.html#TopLevelConfig"><span class="hs-identifier hs-type">TopLevelConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkBlock"><span class="hs-identifier hs-type">HardForkBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680061380"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680061379"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Extended.html#ExtLedgerState"><span class="hs-identifier hs-type">ExtLedgerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680061380"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Extended.html#ExtLedgerState"><span class="hs-identifier hs-type">ExtLedgerState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkBlock"><span class="hs-identifier hs-type">HardForkBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680061380"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680061379"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span id="injectInitialExtLedgerState"><span class="annot"><span class="annottext">injectInitialExtLedgerState :: TopLevelConfig (HardForkBlock (x : xs))
-&gt; ExtLedgerState x -&gt; ExtLedgerState (HardForkBlock (x : xs))
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Embed.Nary.html#injectInitialExtLedgerState"><span class="hs-identifier hs-var hs-var">injectInitialExtLedgerState</span></a></span></span><span> </span><span id="local-6989586621680061378"><span class="annot"><span class="annottext">TopLevelConfig (HardForkBlock (x : xs))
</span><a href="#local-6989586621680061378"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span id="local-6989586621680061377"><span class="annot"><span class="annottext">ExtLedgerState x
</span><a href="#local-6989586621680061377"><span class="hs-identifier hs-var">extLedgerState0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="annottext">ExtLedgerState :: forall blk.
LedgerState blk -&gt; HeaderState blk -&gt; ExtLedgerState blk
</span><a href="Ouroboros.Consensus.Ledger.Extended.html#ExtLedgerState"><span class="hs-identifier hs-type">ExtLedgerState</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">ledgerState :: LedgerState (HardForkBlock (x : xs))
</span><a href="Ouroboros.Consensus.Ledger.Extended.html#ledgerState"><span class="hs-identifier hs-var">ledgerState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerState (HardForkBlock (x : xs))
</span><a href="#local-6989586621680061376"><span class="hs-identifier hs-var">targetEraLedgerState</span></a></span><span>
</span><span id="line-196"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">headerState :: HeaderState (HardForkBlock (x : xs))
</span><a href="Ouroboros.Consensus.Ledger.Extended.html#headerState"><span class="hs-identifier hs-var">headerState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderState (HardForkBlock (x : xs))
</span><a href="#local-6989586621680061375"><span class="hs-identifier hs-var">targetEraHeaderState</span></a></span><span>
</span><span id="line-197"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="#local-6989586621680061374"><span class="hs-identifier hs-type">cfgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Data.SOP.Strict.html#NP"><span class="hs-identifier hs-type">NP</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Config.html#TopLevelConfig"><span class="hs-identifier hs-type">TopLevelConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680061380"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680061379"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>    </span><span id="local-6989586621680061374"><span class="annot"><span class="annottext">cfgs :: NP TopLevelConfig (x : xs)
</span><a href="#local-6989586621680061374"><span class="hs-identifier hs-var hs-var">cfgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><span class="annottext">EpochInfo (Except PastHorizonException)
-&gt; TopLevelConfig (HardForkBlock (x : xs))
-&gt; NP TopLevelConfig (x : xs)
forall (xs :: [*]).
All SingleEraBlock xs =&gt;
EpochInfo (Except PastHorizonException)
-&gt; TopLevelConfig (HardForkBlock xs) -&gt; NP TopLevelConfig xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#distribTopLevelConfig"><span class="hs-identifier hs-var">distribTopLevelConfig</span></a></span><span>
</span><span id="line-202"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HardForkLedgerConfig (x : xs)
-&gt; HardForkState LedgerState (x : xs)
-&gt; EpochInfo (Except PastHorizonException)
forall (xs :: [*]).
All SingleEraBlock xs =&gt;
HardForkLedgerConfig xs
-&gt; HardForkState LedgerState xs
-&gt; EpochInfo (Except PastHorizonException)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.html#epochInfoLedger"><span class="hs-identifier hs-var">State.epochInfoLedger</span></a></span><span>
</span><span id="line-203"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig (HardForkBlock (x : xs))
-&gt; LedgerConfig (HardForkBlock (x : xs))
forall blk. TopLevelConfig blk -&gt; LedgerConfig blk
</span><a href="Ouroboros.Consensus.Config.html#configLedger"><span class="hs-identifier hs-var">configLedger</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig (HardForkBlock (x : xs))
</span><a href="#local-6989586621680061378"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LedgerState (HardForkBlock (x : xs))
-&gt; HardForkState LedgerState (x : xs)
forall (xs :: [*]).
LedgerState (HardForkBlock xs) -&gt; HardForkState LedgerState xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#hardForkLedgerStatePerEra"><span class="hs-identifier hs-var hs-var">hardForkLedgerStatePerEra</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState (HardForkBlock (x : xs))
</span><a href="#local-6989586621680061376"><span class="hs-identifier hs-var">targetEraLedgerState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>          </span><span class="annot"><span class="annottext">TopLevelConfig (HardForkBlock (x : xs))
</span><a href="#local-6989586621680061378"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><a href="#local-6989586621680061376"><span class="hs-identifier hs-type">targetEraLedgerState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Ledger.Basics.html#LedgerState"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkBlock"><span class="hs-identifier hs-type">HardForkBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680061380"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680061379"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621680061376"><span class="annot"><span class="annottext">targetEraLedgerState :: LedgerState (HardForkBlock (x : xs))
</span><a href="#local-6989586621680061376"><span class="hs-identifier hs-var hs-var">targetEraLedgerState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>        </span><span class="annot"><span class="annottext">HardForkState LedgerState (x : xs)
-&gt; LedgerState (HardForkBlock (x : xs))
forall (xs :: [*]).
HardForkState LedgerState xs -&gt; LedgerState (HardForkBlock xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkLedgerState"><span class="hs-identifier hs-var">HardForkLedgerState</span></a></span><span> </span><span class="annot"><span class="annottext">(HardForkState LedgerState (x : xs)
 -&gt; LedgerState (HardForkBlock (x : xs)))
-&gt; HardForkState LedgerState (x : xs)
-&gt; LedgerState (HardForkBlock (x : xs))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-210"></span><span>          </span><span class="hs-comment">-- We can immediately extend it to the right slot, executing any</span><span>
</span><span id="line-211"></span><span>          </span><span class="hs-comment">-- scheduled hard forks in the first slot</span><span>
</span><span id="line-212"></span><span>          </span><span class="annot"><span class="annottext">HardForkLedgerConfig (x : xs)
-&gt; SlotNo
-&gt; HardForkState LedgerState (x : xs)
-&gt; HardForkState LedgerState (x : xs)
forall (xs :: [*]).
CanHardFork xs =&gt;
HardForkLedgerConfig xs
-&gt; SlotNo
-&gt; HardForkState LedgerState xs
-&gt; HardForkState LedgerState xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.html#extendToSlot"><span class="hs-identifier hs-var">State.extendToSlot</span></a></span><span>
</span><span id="line-213"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelConfig (HardForkBlock (x : xs))
-&gt; LedgerConfig (HardForkBlock (x : xs))
forall blk. TopLevelConfig blk -&gt; LedgerConfig blk
</span><a href="Ouroboros.Consensus.Config.html#configLedger"><span class="hs-identifier hs-var">configLedger</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig (HardForkBlock (x : xs))
</span><a href="#local-6989586621680061378"><span class="hs-identifier hs-var">cfg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; SlotNo
</span><span class="hs-identifier hs-var">SlotNo</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LedgerState x -&gt; HardForkState LedgerState (x : xs)
forall (f :: * -&gt; *) x (xs :: [*]). f x -&gt; HardForkState f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#initHardForkState"><span class="hs-identifier hs-var">initHardForkState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExtLedgerState x -&gt; LedgerState x
forall blk. ExtLedgerState blk -&gt; LedgerState blk
</span><a href="Ouroboros.Consensus.Ledger.Extended.html#ledgerState"><span class="hs-identifier hs-var hs-var">ledgerState</span></a></span><span> </span><span class="annot"><span class="annottext">ExtLedgerState x
</span><a href="#local-6989586621680061377"><span class="hs-identifier hs-var">extLedgerState0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><a href="#local-6989586621680061366"><span class="hs-identifier hs-type">firstEraChainDepState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkChainDepState"><span class="hs-identifier hs-type">HardForkChainDepState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680061380"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680061379"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>    </span><span id="local-6989586621680061366"><span class="annot"><span class="annottext">firstEraChainDepState :: HardForkChainDepState (x : xs)
</span><a href="#local-6989586621680061366"><span class="hs-identifier hs-var hs-var">firstEraChainDepState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>        </span><span class="annot"><span class="annottext">WrapChainDepState x -&gt; HardForkChainDepState (x : xs)
forall (f :: * -&gt; *) x (xs :: [*]). f x -&gt; HardForkState f (x : xs)
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#initHardForkState"><span class="hs-identifier hs-var">initHardForkState</span></a></span><span> </span><span class="annot"><span class="annottext">(WrapChainDepState x -&gt; HardForkChainDepState (x : xs))
-&gt; WrapChainDepState x -&gt; HardForkChainDepState (x : xs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-220"></span><span>          </span><span class="annot"><span class="annottext">ChainDepState (BlockProtocol x) -&gt; WrapChainDepState x
forall blk.
ChainDepState (BlockProtocol blk) -&gt; WrapChainDepState blk
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapChainDepState"><span class="hs-identifier hs-var">WrapChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainDepState (BlockProtocol x) -&gt; WrapChainDepState x)
-&gt; ChainDepState (BlockProtocol x) -&gt; WrapChainDepState x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-221"></span><span>            </span><span class="annot"><span class="annottext">HeaderState x -&gt; ChainDepState (BlockProtocol x)
forall blk. HeaderState blk -&gt; ChainDepState (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.HeaderValidation.html#headerStateChainDep"><span class="hs-identifier hs-var hs-var">headerStateChainDep</span></a></span><span> </span><span class="annot"><span class="annottext">(HeaderState x -&gt; ChainDepState (BlockProtocol x))
-&gt; HeaderState x -&gt; ChainDepState (BlockProtocol x)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-222"></span><span>              </span><span class="annot"><span class="annottext">ExtLedgerState x -&gt; HeaderState x
forall blk. ExtLedgerState blk -&gt; HeaderState blk
</span><a href="Ouroboros.Consensus.Ledger.Extended.html#headerState"><span class="hs-identifier hs-var hs-var">headerState</span></a></span><span> </span><span class="annot"><span class="annottext">ExtLedgerState x
</span><a href="#local-6989586621680061377"><span class="hs-identifier hs-var">extLedgerState0</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><a href="#local-6989586621680061365"><span class="hs-identifier hs-type">targetEraChainDepState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Protocol.html#HardForkChainDepState"><span class="hs-identifier hs-type">HardForkChainDepState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680061380"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680061379"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>    </span><span id="local-6989586621680061365"><span class="annot"><span class="annottext">targetEraChainDepState :: HardForkChainDepState (x : xs)
</span><a href="#local-6989586621680061365"><span class="hs-identifier hs-var hs-var">targetEraChainDepState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-226"></span><span>        </span><span class="hs-comment">-- Align the 'ChainDepState' with the ledger state of the target era.</span><span>
</span><span id="line-227"></span><span>        </span><span class="annot"><span class="annottext">InPairs (Translate WrapChainDepState) (x : xs)
-&gt; NP
     (LedgerState -.-&gt; (WrapChainDepState -.-&gt; WrapChainDepState))
     (x : xs)
-&gt; HardForkState LedgerState (x : xs)
-&gt; HardForkChainDepState (x : xs)
-&gt; HardForkChainDepState (x : xs)
forall (xs :: [*]) (f :: * -&gt; *) (f' :: * -&gt; *) (f'' :: * -&gt; *).
All SingleEraBlock xs =&gt;
InPairs (Translate f) xs
-&gt; NP (f' -.-&gt; (f -.-&gt; f'')) xs
-&gt; HardForkState f' xs
-&gt; HardForkState f xs
-&gt; HardForkState f'' xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.State.Infra.html#align"><span class="hs-identifier hs-var">State.align</span></a></span><span>
</span><span id="line-228"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NP WrapConsensusConfig (x : xs)
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     (x : xs)
-&gt; InPairs (Translate WrapChainDepState) (x : xs)
forall k (h :: k -&gt; *) (xs :: [k]) (f :: k -&gt; k -&gt; *).
NP h xs -&gt; InPairs (RequiringBoth h f) xs -&gt; InPairs f xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Util.InPairs.html#requiringBoth"><span class="hs-identifier hs-var">InPairs.requiringBoth</span></a></span><span>
</span><span id="line-229"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall a. TopLevelConfig a -&gt; WrapConsensusConfig a)
-&gt; NP TopLevelConfig (x : xs) -&gt; NP WrapConsensusConfig (x : xs)
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: k -&gt; *)
       (f' :: k -&gt; *).
(SListIN (Prod h) xs, HAp h) =&gt;
(forall (a :: k). f a -&gt; f' a) -&gt; h f xs -&gt; h f' xs
</span><span class="hs-identifier hs-var">hmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConsensusConfig (BlockProtocol a) -&gt; WrapConsensusConfig a
forall blk.
ConsensusConfig (BlockProtocol blk) -&gt; WrapConsensusConfig blk
</span><a href="Ouroboros.Consensus.TypeFamilyWrappers.html#WrapConsensusConfig"><span class="hs-identifier hs-var">WrapConsensusConfig</span></a></span><span> </span><span class="annot"><span class="annottext">(ConsensusConfig (BlockProtocol a) -&gt; WrapConsensusConfig a)
-&gt; (TopLevelConfig a -&gt; ConsensusConfig (BlockProtocol a))
-&gt; TopLevelConfig a
-&gt; WrapConsensusConfig a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelConfig a -&gt; ConsensusConfig (BlockProtocol a)
forall blk.
TopLevelConfig blk -&gt; ConsensusConfig (BlockProtocol blk)
</span><a href="Ouroboros.Consensus.Config.html#configConsensus"><span class="hs-identifier hs-var">configConsensus</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NP TopLevelConfig (x : xs)
</span><a href="#local-6989586621680061374"><span class="hs-identifier hs-var">cfgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EraTranslation (x : xs)
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     (x : xs)
forall (xs :: [*]).
EraTranslation xs
-&gt; InPairs
     (RequiringBoth WrapConsensusConfig (Translate WrapChainDepState))
     xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Translation.html#translateChainDepState"><span class="hs-identifier hs-var hs-var">translateChainDepState</span></a></span><span> </span><span class="annot"><span class="annottext">EraTranslation (x : xs)
forall (xs :: [*]). CanHardFork xs =&gt; EraTranslation xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Abstract.CanHardFork.html#hardForkEraTranslation"><span class="hs-identifier hs-var">hardForkEraTranslation</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall a.
 (-.-&gt;) LedgerState (WrapChainDepState -.-&gt; WrapChainDepState) a)
-&gt; NP
     (LedgerState -.-&gt; (WrapChainDepState -.-&gt; WrapChainDepState))
     (x : xs)
forall k l (h :: (k -&gt; *) -&gt; l -&gt; *) (xs :: l) (f :: k -&gt; *).
(HPure h, SListIN h xs) =&gt;
(forall (a :: k). f a) -&gt; h f xs
</span><span class="hs-identifier hs-var">hpure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LedgerState a -&gt; WrapChainDepState a -&gt; WrapChainDepState a)
-&gt; (-.-&gt;) LedgerState (WrapChainDepState -.-&gt; WrapChainDepState) a
forall k (f :: k -&gt; *) (a :: k) (f' :: k -&gt; *) (f'' :: k -&gt; *).
(f a -&gt; f' a -&gt; f'' a) -&gt; (-.-&gt;) f (f' -.-&gt; f'') a
</span><span class="hs-identifier hs-var">fn_2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">LedgerState a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680061355"><span class="annot"><span class="annottext">WrapChainDepState a
</span><a href="#local-6989586621680061355"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WrapChainDepState a
</span><a href="#local-6989586621680061355"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LedgerState (HardForkBlock (x : xs))
-&gt; HardForkState LedgerState (x : xs)
forall (xs :: [*]).
LedgerState (HardForkBlock xs) -&gt; HardForkState LedgerState xs
</span><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#hardForkLedgerStatePerEra"><span class="hs-identifier hs-var hs-var">hardForkLedgerStatePerEra</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState (HardForkBlock (x : xs))
</span><a href="#local-6989586621680061376"><span class="hs-identifier hs-var">targetEraLedgerState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>          </span><span class="annot"><span class="annottext">HardForkChainDepState (x : xs)
</span><a href="#local-6989586621680061366"><span class="hs-identifier hs-var">firstEraChainDepState</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><a href="#local-6989586621680061375"><span class="hs-identifier hs-type">targetEraHeaderState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.HeaderValidation.html#HeaderState"><span class="hs-identifier hs-type">HeaderState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Consensus.HardFork.Combinator.Basics.html#HardForkBlock"><span class="hs-identifier hs-type">HardForkBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680061380"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680061379"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621680061375"><span class="annot"><span class="annottext">targetEraHeaderState :: HeaderState (HardForkBlock (x : xs))
</span><a href="#local-6989586621680061375"><span class="hs-identifier hs-var hs-var">targetEraHeaderState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainDepState (BlockProtocol (HardForkBlock (x : xs)))
-&gt; HeaderState (HardForkBlock (x : xs))
forall blk. ChainDepState (BlockProtocol blk) -&gt; HeaderState blk
</span><a href="Ouroboros.Consensus.HeaderValidation.html#genesisHeaderState"><span class="hs-identifier hs-var">genesisHeaderState</span></a></span><span> </span><span class="annot"><span class="annottext">ChainDepState (BlockProtocol (HardForkBlock (x : xs)))
HardForkChainDepState (x : xs)
</span><a href="#local-6989586621680061365"><span class="hs-identifier hs-var">targetEraChainDepState</span></a></span><span>
</span><span id="line-237"></span></pre></body></html>