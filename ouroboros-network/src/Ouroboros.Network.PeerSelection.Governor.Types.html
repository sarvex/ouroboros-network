<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveFunctor             #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts          #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs                     #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns            #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms           #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards           #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables       #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving        #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Network.PeerSelection.Governor.Types</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * P2P governor policies</span></span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionPolicy"><span class="hs-identifier">PeerSelectionPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier">PeerSelectionTargets</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#nullPeerSelectionTargets"><span class="hs-identifier">nullPeerSelectionTargets</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#sanePeerSelectionTargets"><span class="hs-identifier">sanePeerSelectionTargets</span></a></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier">PickPolicy</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#pickPeers"><span class="hs-identifier">pickPeers</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- * P2P governor low level API</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-comment">-- These records are needed to run the peer selection.</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerStateActions"><span class="hs-identifier">PeerStateActions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionActions"><span class="hs-identifier">PeerSelectionActions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#ChurnMode"><span class="hs-identifier">ChurnMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><span class="hs-comment">-- * P2P governor internals</span></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier">PeerSelectionState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#emptyPeerSelectionState"><span class="hs-identifier">emptyPeerSelectionState</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#assertPeerSelectionState"><span class="hs-identifier">assertPeerSelectionState</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeersStatus"><span class="hs-identifier">establishedPeersStatus</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier">Guarded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier">GuardedSkip</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier">Guarded</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier">Decision</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TimedDecision"><span class="hs-identifier">TimedDecision</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#MkGuardedDecision"><span class="hs-identifier">MkGuardedDecision</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Completion"><span class="hs-identifier">Completion</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier">PeerSelectionCounters</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#peerStateToCounters"><span class="hs-identifier">peerStateToCounters</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Traces</span></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePeerSelection"><span class="hs-identifier">TracePeerSelection</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#DebugPeerSelection"><span class="hs-identifier">DebugPeerSelection</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-framework-0.3.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">Data.Cache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-framework-0.3.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier">Cache</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fromMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/monoidal-synchronisation-0.1.0.2/noopt/doc/html/monoidal-synchronisation/src"><span class="hs-identifier">Data.Monoid.Synchronisation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/monoidal-synchronisation-0.1.0.2/noopt/doc/html/monoidal-synchronisation/src"><span class="hs-identifier">FirstToFinish</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Min</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Applicative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Alternative</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/network-mux-0.3.0.0/noopt/doc/html/network-mux/src"><span class="hs-identifier">Control.Concurrent.JobPool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/network-mux-0.3.0.0/noopt/doc/html/network-mux/src"><span class="hs-identifier">Job</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">SomeException</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">assert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadSTM</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadTime</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.Random</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">StdGen</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.ExitPolicy.html"><span class="hs-identifier">Ouroboros.Network.ExitPolicy</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.EstablishedPeers</span></a></span><span>
</span><span id="line-59"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#EstablishedPeers"><span class="hs-identifier">EstablishedPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.EstablishedPeers</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EstablishedPeers</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.KnownPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.KnownPeers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#KnownPeers"><span class="hs-identifier">KnownPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.KnownPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.KnownPeers</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">KnownPeers</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.LocalRootPeers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#LocalRootPeers"><span class="hs-identifier">LocalRootPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.LocalRootPeers</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LocalRootPeers</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html"><span class="hs-identifier">Ouroboros.Network.PeerSelection.Types</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- | A peer pick policy is an action that picks a subset of elements from a</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- map of peers.</span><span>
</span><span id="line-70"></span><span class="hs-comment">--</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- The pre-condition is that the map of available choices will be non-empty,</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- and the requested number to pick will be strictly positive.</span><span>
</span><span id="line-73"></span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- The post-condition is that the picked set is non-empty but must not be</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- bigger than the requested number.</span><span>
</span><span id="line-76"></span><span class="hs-comment">--</span><span>
</span><span id="line-77"></span><span class="hs-keyword">type</span><span> </span><span id="PickPolicy"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-var">PickPolicy</span></a></span></span><span> </span><span id="local-6989586621679252972"><span class="annot"><a href="#local-6989586621679252972"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679252971"><span class="annot"><a href="#local-6989586621679252971"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>         </span><span class="hs-comment">-- Extra peer attributes available to use in the picking policy.</span><span>
</span><span id="line-79"></span><span>         </span><span class="hs-comment">-- As more attributes are needed, extend this with more such functions.</span><span>
</span><span id="line-80"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252972"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerSource"><span class="hs-identifier hs-type">PeerSource</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Where the peer is known from</span><span>
</span><span id="line-81"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252972"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- Connection failure count</span><span>
</span><span id="line-82"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252972"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- Found to be tepid flag</span><span>
</span><span id="line-83"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252972"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>             </span><span class="hs-comment">-- The set to pick from</span><span>
</span><span id="line-84"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>                      </span><span class="hs-comment">-- Max number to choose, fewer is ok.</span><span>
</span><span id="line-85"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679252971"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252972"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- The set picked.</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionPolicy"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionPolicy"><span class="hs-identifier hs-var">PeerSelectionPolicy</span></a></span></span><span> </span><span id="local-6989586621679252970"><span class="annot"><a href="#local-6989586621679252970"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679252969"><span class="annot"><a href="#local-6989586621679252969"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionPolicy"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionPolicy"><span class="hs-identifier hs-var">PeerSelectionPolicy</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>       </span><span id="policyPickKnownPeersForGossip"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickKnownPeersForGossip"><span class="hs-identifier hs-var hs-var">policyPickKnownPeersForGossip</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252970"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252969"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>       </span><span id="policyPickColdPeersToPromote"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickColdPeersToPromote"><span class="hs-identifier hs-var hs-var">policyPickColdPeersToPromote</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252970"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252969"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>       </span><span id="policyPickWarmPeersToPromote"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickWarmPeersToPromote"><span class="hs-identifier hs-var hs-var">policyPickWarmPeersToPromote</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252970"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252969"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>       </span><span id="policyPickHotPeersToDemote"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickHotPeersToDemote"><span class="hs-identifier hs-var hs-var">policyPickHotPeersToDemote</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252970"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252969"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>       </span><span id="policyPickWarmPeersToDemote"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickWarmPeersToDemote"><span class="hs-identifier hs-var hs-var">policyPickWarmPeersToDemote</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252970"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252969"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>       </span><span id="policyPickColdPeersToForget"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; PickPolicy peeraddr m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyPickColdPeersToForget"><span class="hs-identifier hs-var hs-var">policyPickColdPeersToForget</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PickPolicy"><span class="hs-identifier hs-type">PickPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252970"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252969"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>       </span><span id="policyFindPublicRootTimeout"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyFindPublicRootTimeout"><span class="hs-identifier hs-var hs-var">policyFindPublicRootTimeout</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>       </span><span id="policyMaxInProgressGossipReqs"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyMaxInProgressGossipReqs"><span class="hs-identifier hs-var hs-var">policyMaxInProgressGossipReqs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>       </span><span id="policyGossipRetryTime"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyGossipRetryTime"><span class="hs-identifier hs-var hs-var">policyGossipRetryTime</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>       </span><span id="policyGossipBatchWaitTime"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyGossipBatchWaitTime"><span class="hs-identifier hs-var hs-var">policyGossipBatchWaitTime</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>       </span><span id="policyGossipOverallTimeout"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyGossipOverallTimeout"><span class="hs-identifier hs-var hs-var">policyGossipOverallTimeout</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>       </span><span class="hs-comment">-- | Reconnection delay, passed from `ExitPolicy`.</span><span>
</span><span id="line-104"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-105"></span><span>       </span><span id="policyErrorDelay"><span class="annot"><span class="annottext">PeerSelectionPolicy peeraddr m -&gt; DiffTime
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#policyErrorDelay"><span class="hs-identifier hs-var hs-var">policyErrorDelay</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-106"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- | Adjustable targets for the peer selection mechanism.</span><span>
</span><span id="line-110"></span><span class="hs-comment">--</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- These are used by the peer selection governor as targets. They are used by</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- the peer churn governor loop as knobs to adjust, to influence the peer</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- selection governor.</span><span>
</span><span id="line-114"></span><span class="hs-comment">--</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- The /known/, /established/ and /active/ peer targets are targets both from</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- below and from above: the governor will attempt to grow or shrink the sets</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- to hit these targets.</span><span>
</span><span id="line-118"></span><span class="hs-comment">--</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- Unlike the other targets, the /root/ peer target is \&quot;one sided\&quot;, it is</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- only a target from below. The governor does not try to shrink the root set</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- to hit it, it simply stops looking for more.</span><span>
</span><span id="line-122"></span><span class="hs-comment">--</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- There is also an implicit target that enough local root peers are selected</span><span>
</span><span id="line-124"></span><span class="hs-comment">-- as active. This comes from the configuration for local roots, and is not an</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- independently adjustable target.</span><span>
</span><span id="line-126"></span><span class="hs-comment">--</span><span>
</span><span id="line-127"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionTargets"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-var">PeerSelectionTargets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionTargets"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-var">PeerSelectionTargets</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>       </span><span id="targetNumberOfRootPeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfRootPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfRootPeers</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-130"></span><span>       </span><span id="targetNumberOfKnownPeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfKnownPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfKnownPeers</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>       </span><span id="targetNumberOfEstablishedPeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfEstablishedPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfEstablishedPeers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-132"></span><span>       </span><span id="targetNumberOfActivePeers"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfActivePeers"><span class="hs-identifier hs-var hs-var">targetNumberOfActivePeers</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>       </span><span class="hs-comment">-- Expressed as intervals rather than frequencies</span><span>
</span><span id="line-135"></span><span class="hs-comment">--     targetChurnIntervalKnownPeers       :: !DiffTime,</span><span>
</span><span id="line-136"></span><span class="hs-comment">--     targetChurnIntervalEstablishedPeers :: !DiffTime,</span><span>
</span><span id="line-137"></span><span class="hs-comment">--     targetChurnIntervalActivePeers      :: !DiffTime</span><span>
</span><span id="line-138"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252947"><span id="local-6989586621679252949"><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
(PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool)
-&gt; (PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool)
-&gt; Eq PeerSelectionTargets
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
$c/= :: PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
== :: PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
$c== :: PeerSelectionTargets -&gt; PeerSelectionTargets -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252940"><span id="local-6989586621679252942"><span id="local-6989586621679252944"><span class="annot"><span class="annottext">Int -&gt; PeerSelectionTargets -&gt; ShowS
[PeerSelectionTargets] -&gt; ShowS
PeerSelectionTargets -&gt; String
(Int -&gt; PeerSelectionTargets -&gt; ShowS)
-&gt; (PeerSelectionTargets -&gt; String)
-&gt; ([PeerSelectionTargets] -&gt; ShowS)
-&gt; Show PeerSelectionTargets
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [PeerSelectionTargets] -&gt; ShowS
$cshowList :: [PeerSelectionTargets] -&gt; ShowS
show :: PeerSelectionTargets -&gt; String
$cshow :: PeerSelectionTargets -&gt; String
showsPrec :: Int -&gt; PeerSelectionTargets -&gt; ShowS
$cshowsPrec :: Int -&gt; PeerSelectionTargets -&gt; ShowS
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#nullPeerSelectionTargets"><span class="hs-identifier hs-type">nullPeerSelectionTargets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span>
</span><span id="line-142"></span><span id="nullPeerSelectionTargets"><span class="annot"><span class="annottext">nullPeerSelectionTargets :: PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#nullPeerSelectionTargets"><span class="hs-identifier hs-var hs-var">nullPeerSelectionTargets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="annottext">PeerSelectionTargets :: Int -&gt; Int -&gt; Int -&gt; Int -&gt; PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-144"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfRootPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfRootPeers"><span class="hs-identifier hs-var">targetNumberOfRootPeers</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfKnownPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfKnownPeers"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-146"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfEstablishedPeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfEstablishedPeers"><span class="hs-identifier hs-var">targetNumberOfEstablishedPeers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>       </span><span class="annot"><span class="annottext">targetNumberOfActivePeers :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfActivePeers"><span class="hs-identifier hs-var">targetNumberOfActivePeers</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-148"></span><span class="hs-comment">--     targetChurnIntervalKnownPeers       = 0,</span><span>
</span><span id="line-149"></span><span class="hs-comment">--     targetChurnIntervalEstablishedPeers = 0,</span><span>
</span><span id="line-150"></span><span class="hs-comment">--     targetChurnIntervalActivePeers      = 0</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#sanePeerSelectionTargets"><span class="hs-identifier hs-type">sanePeerSelectionTargets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-154"></span><span id="sanePeerSelectionTargets"><span class="annot"><span class="annottext">sanePeerSelectionTargets :: PeerSelectionTargets -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#sanePeerSelectionTargets"><span class="hs-identifier hs-var hs-var">sanePeerSelectionTargets</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span class="hs-special">{</span><span id="local-6989586621679252935"><span id="local-6989586621679252936"><span id="local-6989586621679252937"><span id="local-6989586621679252938"><span class="annot"><span class="annottext">Int
targetNumberOfActivePeers :: Int
targetNumberOfEstablishedPeers :: Int
targetNumberOfKnownPeers :: Int
targetNumberOfRootPeers :: Int
targetNumberOfActivePeers :: PeerSelectionTargets -&gt; Int
targetNumberOfEstablishedPeers :: PeerSelectionTargets -&gt; Int
targetNumberOfKnownPeers :: PeerSelectionTargets -&gt; Int
targetNumberOfRootPeers :: PeerSelectionTargets -&gt; Int
</span><a href="#local-6989586621679252935"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-155"></span><span>                                 </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252935"><span class="hs-identifier hs-var">targetNumberOfActivePeers</span></a></span><span>
</span><span id="line-156"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252935"><span class="hs-identifier hs-var">targetNumberOfActivePeers</span></a></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252936"><span class="hs-identifier hs-var">targetNumberOfEstablishedPeers</span></a></span><span>
</span><span id="line-157"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252936"><span class="hs-identifier hs-var">targetNumberOfEstablishedPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252937"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span>
</span><span id="line-158"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>      </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252938"><span class="hs-identifier hs-var">targetNumberOfRootPeers</span></a></span><span>   </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252937"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span>
</span><span id="line-159"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>                              </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252938"><span class="hs-identifier hs-var">targetNumberOfRootPeers</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252935"><span class="hs-identifier hs-var">targetNumberOfActivePeers</span></a></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span>
</span><span id="line-162"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252936"><span class="hs-identifier hs-var">targetNumberOfEstablishedPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1000</span></span><span>
</span><span id="line-163"></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252937"><span class="hs-identifier hs-var">targetNumberOfKnownPeers</span></a></span><span>       </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10000</span></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">-- | Actions performed by the peer selection governor.</span><span>
</span><span id="line-167"></span><span class="hs-comment">--</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- These being pluggable allows:</span><span>
</span><span id="line-169"></span><span class="hs-comment">--</span><span>
</span><span id="line-170"></span><span class="hs-comment">-- * choice of known peer root sets</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- * running both in simulation and for real</span><span>
</span><span id="line-172"></span><span class="hs-comment">--</span><span>
</span><span id="line-173"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionActions"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionActions"><span class="hs-identifier hs-var">PeerSelectionActions</span></a></span></span><span> </span><span id="local-6989586621679252932"><span class="annot"><a href="#local-6989586621679252932"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679252931"><span class="annot"><a href="#local-6989586621679252931"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span id="local-6989586621679252930"><span class="annot"><a href="#local-6989586621679252930"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionActions"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionActions"><span class="hs-identifier hs-var">PeerSelectionActions</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>       </span><span id="readPeerSelectionTargets"><span class="annot"><span class="annottext">PeerSelectionActions peeraddr peerconn m
-&gt; STM m PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#readPeerSelectionTargets"><span class="hs-identifier hs-var hs-var">readPeerSelectionTargets</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679252930"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>       </span><span class="hs-comment">-- | Read the current set of locally or privately known root peers.</span><span>
</span><span id="line-178"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-179"></span><span>       </span><span class="hs-comment">-- In general this is expected to be updated asynchronously by some</span><span>
</span><span id="line-180"></span><span>       </span><span class="hs-comment">-- other thread. It is intended to cover the use case of peers from</span><span>
</span><span id="line-181"></span><span>       </span><span class="hs-comment">-- local configuration. It could be dynamic due to DNS resolution, or</span><span>
</span><span id="line-182"></span><span>       </span><span class="hs-comment">-- due to dynamic configuration updates.</span><span>
</span><span id="line-183"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-184"></span><span>       </span><span class="hs-comment">-- It is structured as a collection of (non-overlapping) groups of peers</span><span>
</span><span id="line-185"></span><span>       </span><span class="hs-comment">-- where we are supposed to select n from each group.</span><span>
</span><span id="line-186"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-187"></span><span>       </span><span id="readLocalRootPeers"><span class="annot"><span class="annottext">PeerSelectionActions peeraddr peerconn m
-&gt; STM m [(Int, Map peeraddr PeerAdvertise)]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#readLocalRootPeers"><span class="hs-identifier hs-var hs-var">readLocalRootPeers</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679252930"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252932"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerAdvertise"><span class="hs-identifier hs-type">PeerAdvertise</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>       </span><span class="hs-comment">-- | Request a sample of public root peers.</span><span>
</span><span id="line-190"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-191"></span><span>       </span><span class="hs-comment">-- It is intended to cover use cases including:</span><span>
</span><span id="line-192"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-193"></span><span>       </span><span class="hs-comment">-- * federated relays from a DNS pool</span><span>
</span><span id="line-194"></span><span>       </span><span class="hs-comment">-- * stake pool relays published in the blockchain</span><span>
</span><span id="line-195"></span><span>       </span><span class="hs-comment">-- * a pre-distributed snapshot of stake pool relays from the blockchain</span><span>
</span><span id="line-196"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-197"></span><span>       </span><span id="requestPublicRootPeers"><span class="annot"><span class="annottext">PeerSelectionActions peeraddr peerconn m
-&gt; Int -&gt; m (Set peeraddr, DiffTime)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#requestPublicRootPeers"><span class="hs-identifier hs-var hs-var">requestPublicRootPeers</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252930"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252932"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>       </span><span class="hs-comment">-- | The action to contact a known peer and request a sample of its</span><span>
</span><span id="line-200"></span><span>       </span><span class="hs-comment">-- known peers.</span><span>
</span><span id="line-201"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-202"></span><span>       </span><span class="hs-comment">-- This is synchronous, but it should expect to be interrupted by a</span><span>
</span><span id="line-203"></span><span>       </span><span class="hs-comment">-- timeout asynchronous exception. Failures are throw as exceptions.</span><span>
</span><span id="line-204"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-205"></span><span>       </span><span id="requestPeerGossip"><span class="annot"><span class="annottext">PeerSelectionActions peeraddr peerconn m
-&gt; peeraddr -&gt; m [peeraddr]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#requestPeerGossip"><span class="hs-identifier hs-var hs-var">requestPeerGossip</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679252932"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252930"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679252932"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>       </span><span class="hs-comment">-- | Core actions run by the governor to change 'PeerStatus'.</span><span>
</span><span id="line-208"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-209"></span><span>       </span><span id="peerStateActions"><span class="annot"><span class="annottext">PeerSelectionActions peeraddr peerconn m
-&gt; PeerStateActions peeraddr peerconn m
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#peerStateActions"><span class="hs-identifier hs-var hs-var">peerStateActions</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerStateActions"><span class="hs-identifier hs-type">PeerStateActions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252932"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252931"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252930"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-210"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- | Callbacks which are performed to change peer state.</span><span>
</span><span id="line-213"></span><span class="hs-comment">--</span><span>
</span><span id="line-214"></span><span class="hs-keyword">data</span><span> </span><span id="PeerStateActions"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerStateActions"><span class="hs-identifier hs-var">PeerStateActions</span></a></span></span><span> </span><span id="local-6989586621679252923"><span class="annot"><a href="#local-6989586621679252923"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679252922"><span class="annot"><a href="#local-6989586621679252922"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span id="local-6989586621679252921"><span class="annot"><a href="#local-6989586621679252921"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerStateActions"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerStateActions"><span class="hs-identifier hs-var">PeerStateActions</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-comment">-- | Monitor peer state.  Must be non-blocking.</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-217"></span><span>    </span><span id="monitorPeerConnection"><span class="annot"><span class="annottext">PeerStateActions peeraddr peerconn m
-&gt; peerconn -&gt; STM m (PeerStatus, Maybe ReconnectDelay)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#monitorPeerConnection"><span class="hs-identifier hs-var hs-var">monitorPeerConnection</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679252922"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679252921"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier hs-type">PeerStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.ExitPolicy.html#ReconnectDelay"><span class="hs-identifier hs-type">ReconnectDelay</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-comment">-- | Establish new connection: cold to warm.</span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-221"></span><span>    </span><span id="establishPeerConnection"><span class="annot"><span class="annottext">PeerStateActions peeraddr peerconn m -&gt; peeraddr -&gt; m peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishPeerConnection"><span class="hs-identifier hs-var hs-var">establishPeerConnection</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679252923"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252921"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252922"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-comment">-- | Activate a connection: warm to hot promotion.</span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-225"></span><span>    </span><span id="activatePeerConnection"><span class="annot"><span class="annottext">PeerStateActions peeraddr peerconn m -&gt; peerconn -&gt; m ()
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activatePeerConnection"><span class="hs-identifier hs-var hs-var">activatePeerConnection</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679252922"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252921"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-comment">-- | Deactive a peer: hot to warm demotion.</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-229"></span><span>    </span><span id="deactivatePeerConnection"><span class="annot"><span class="annottext">PeerStateActions peeraddr peerconn m -&gt; peerconn -&gt; m ()
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#deactivatePeerConnection"><span class="hs-identifier hs-var hs-var">deactivatePeerConnection</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679252922"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252921"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-comment">-- | Close a connection: warm to cold transition.</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-233"></span><span>    </span><span id="closePeerConnection"><span class="annot"><span class="annottext">PeerStateActions peeraddr peerconn m -&gt; peerconn -&gt; m ()
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#closePeerConnection"><span class="hs-identifier hs-var hs-var">closePeerConnection</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679252922"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252921"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- Peer Selection State</span><span>
</span><span id="line-238"></span><span class="hs-comment">--</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="hs-comment">-- | The internal state used by the 'peerSelectionGovernor'.</span><span>
</span><span id="line-241"></span><span class="hs-comment">--</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- The local and public root sets are disjoint, and their union is the</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- overall root set.</span><span>
</span><span id="line-244"></span><span class="hs-comment">--</span><span>
</span><span id="line-245"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionState"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-var">PeerSelectionState</span></a></span></span><span> </span><span id="local-6989586621679253075"><span class="annot"><a href="#local-6989586621679253075"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679253074"><span class="annot"><a href="#local-6989586621679253074"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionState"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-var">PeerSelectionState</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>       </span><span id="targets"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targets"><span class="hs-identifier hs-var hs-var">targets</span></a></span></span><span>                  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>       </span><span class="hs-comment">-- | The current set of local root peers. This is structured as a</span><span>
</span><span id="line-250"></span><span>       </span><span class="hs-comment">-- bunch of groups, with a target for each group. This gives us a set of</span><span>
</span><span id="line-251"></span><span>       </span><span class="hs-comment">-- n-of-m choices, e.g. \&quot;pick 2 from this group and 1 from this group\&quot;.</span><span>
</span><span id="line-252"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-253"></span><span>       </span><span class="hs-comment">-- The targets must of course be achievable, and to keep things simple,</span><span>
</span><span id="line-254"></span><span>       </span><span class="hs-comment">-- the groups must be disjoint.</span><span>
</span><span id="line-255"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-256"></span><span>       </span><span id="localRootPeers"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; LocalRootPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#localRootPeers"><span class="hs-identifier hs-var hs-var">localRootPeers</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#LocalRootPeers"><span class="hs-identifier hs-type">LocalRootPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253075"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>       </span><span id="publicRootPeers"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootPeers"><span class="hs-identifier hs-var hs-var">publicRootPeers</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253075"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>       </span><span class="hs-comment">-- |</span><span>
</span><span id="line-261"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-262"></span><span>       </span><span id="knownPeers"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#knownPeers"><span class="hs-identifier hs-var hs-var">knownPeers</span></a></span></span><span>               </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#KnownPeers"><span class="hs-identifier hs-type">KnownPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253075"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>       </span><span class="hs-comment">-- |</span><span>
</span><span id="line-265"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-266"></span><span>       </span><span id="establishedPeers"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeers"><span class="hs-identifier hs-var hs-var">establishedPeers</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#EstablishedPeers"><span class="hs-identifier hs-type">EstablishedPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253075"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253074"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>       </span><span class="hs-comment">-- |</span><span>
</span><span id="line-269"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-270"></span><span>       </span><span id="activePeers"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activePeers"><span class="hs-identifier hs-var hs-var">activePeers</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253075"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>       </span><span class="hs-comment">-- | A counter to manage the exponential backoff strategy for when to</span><span>
</span><span id="line-273"></span><span>       </span><span class="hs-comment">-- retry querying for more public root peers. It is negative for retry</span><span>
</span><span id="line-274"></span><span>       </span><span class="hs-comment">-- counts after failure, and positive for retry counts that are</span><span>
</span><span id="line-275"></span><span>       </span><span class="hs-comment">-- successful but make no progress.</span><span>
</span><span id="line-276"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-277"></span><span>       </span><span id="publicRootBackoffs"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootBackoffs"><span class="hs-identifier hs-var hs-var">publicRootBackoffs</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>       </span><span class="hs-comment">-- | The earliest time we would be prepared to request more public root</span><span>
</span><span id="line-280"></span><span>       </span><span class="hs-comment">-- peers. This is used with the 'publicRootBackoffs' to manage the</span><span>
</span><span id="line-281"></span><span>       </span><span class="hs-comment">-- exponential backoff.</span><span>
</span><span id="line-282"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-283"></span><span>       </span><span id="publicRootRetryTime"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Time
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootRetryTime"><span class="hs-identifier hs-var hs-var">publicRootRetryTime</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">,</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>       </span><span id="inProgressPublicRootsReq"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPublicRootsReq"><span class="hs-identifier hs-var hs-var">inProgressPublicRootsReq</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-286"></span><span>       </span><span id="inProgressGossipReqs"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressGossipReqs"><span class="hs-identifier hs-var hs-var">inProgressGossipReqs</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-287"></span><span>       </span><span id="inProgressPromoteCold"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPromoteCold"><span class="hs-identifier hs-var hs-var">inProgressPromoteCold</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253075"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-288"></span><span>       </span><span id="inProgressPromoteWarm"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPromoteWarm"><span class="hs-identifier hs-var hs-var">inProgressPromoteWarm</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253075"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-289"></span><span>       </span><span id="inProgressDemoteWarm"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteWarm"><span class="hs-identifier hs-var hs-var">inProgressDemoteWarm</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253075"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-290"></span><span>       </span><span id="inProgressDemoteHot"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteHot"><span class="hs-identifier hs-var hs-var">inProgressDemoteHot</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253075"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>       </span><span class="hs-comment">-- | Rng for fuzzy delay</span><span>
</span><span id="line-293"></span><span>       </span><span id="fuzzRng"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; StdGen
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#fuzzRng"><span class="hs-identifier hs-var hs-var">fuzzRng</span></a></span></span><span>                  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span class="hs-special">,</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>       </span><span class="hs-comment">-- | 'PeerSelectionCounters' counters cache. Allows to only trace</span><span>
</span><span id="line-296"></span><span>       </span><span class="hs-comment">-- values when necessary.</span><span>
</span><span id="line-297"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-298"></span><span>       </span><span id="countersCache"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Cache PeerSelectionCounters
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#countersCache"><span class="hs-identifier hs-var hs-var">countersCache</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-framework-0.3.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-type">Cache</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier hs-type">PeerSelectionCounters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-comment">--     TODO: need something like this to distinguish between lots of bad peers</span><span>
</span><span id="line-301"></span><span class="hs-comment">--     and us getting disconnected from the network locally. We don't want a</span><span>
</span><span id="line-302"></span><span class="hs-comment">--     network disconnect to cause us to flush our full known peer set by</span><span>
</span><span id="line-303"></span><span class="hs-comment">--     considering them all to have bad connectivity.</span><span>
</span><span id="line-304"></span><span class="hs-comment">--     Should also take account of DNS failures for root peer set.</span><span>
</span><span id="line-305"></span><span class="hs-comment">--     lastSuccessfulNetworkEvent :: Time</span><span>
</span><span id="line-306"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252892"><span id="local-6989586621679252894"><span id="local-6989586621679252896"><span class="annot"><span class="annottext">Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS
[PeerSelectionState peeraddr peerconn] -&gt; ShowS
PeerSelectionState peeraddr peerconn -&gt; String
(Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS)
-&gt; (PeerSelectionState peeraddr peerconn -&gt; String)
-&gt; ([PeerSelectionState peeraddr peerconn] -&gt; ShowS)
-&gt; Show (PeerSelectionState peeraddr peerconn)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall peeraddr peerconn.
(Ord peeraddr, Show peeraddr, Show peerconn) =&gt;
Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS
forall peeraddr peerconn.
(Ord peeraddr, Show peeraddr, Show peerconn) =&gt;
[PeerSelectionState peeraddr peerconn] -&gt; ShowS
forall peeraddr peerconn.
(Ord peeraddr, Show peeraddr, Show peerconn) =&gt;
PeerSelectionState peeraddr peerconn -&gt; String
showList :: [PeerSelectionState peeraddr peerconn] -&gt; ShowS
$cshowList :: forall peeraddr peerconn.
(Ord peeraddr, Show peeraddr, Show peerconn) =&gt;
[PeerSelectionState peeraddr peerconn] -&gt; ShowS
show :: PeerSelectionState peeraddr peerconn -&gt; String
$cshow :: forall peeraddr peerconn.
(Ord peeraddr, Show peeraddr, Show peerconn) =&gt;
PeerSelectionState peeraddr peerconn -&gt; String
showsPrec :: Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS
$cshowsPrec :: forall peeraddr peerconn.
(Ord peeraddr, Show peeraddr, Show peerconn) =&gt;
Int -&gt; PeerSelectionState peeraddr peerconn -&gt; ShowS
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252888"><span id="local-6989586621679252890"><span class="annot"><span class="annottext">a -&gt; PeerSelectionState peeraddr b -&gt; PeerSelectionState peeraddr a
(a -&gt; b)
-&gt; PeerSelectionState peeraddr a -&gt; PeerSelectionState peeraddr b
(forall a b.
 (a -&gt; b)
 -&gt; PeerSelectionState peeraddr a -&gt; PeerSelectionState peeraddr b)
-&gt; (forall a b.
    a
    -&gt; PeerSelectionState peeraddr b -&gt; PeerSelectionState peeraddr a)
-&gt; Functor (PeerSelectionState peeraddr)
forall a b.
a -&gt; PeerSelectionState peeraddr b -&gt; PeerSelectionState peeraddr a
forall a b.
(a -&gt; b)
-&gt; PeerSelectionState peeraddr a -&gt; PeerSelectionState peeraddr b
forall peeraddr a b.
a -&gt; PeerSelectionState peeraddr b -&gt; PeerSelectionState peeraddr a
forall peeraddr a b.
(a -&gt; b)
-&gt; PeerSelectionState peeraddr a -&gt; PeerSelectionState peeraddr b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; PeerSelectionState peeraddr b -&gt; PeerSelectionState peeraddr a
$c&lt;$ :: forall peeraddr a b.
a -&gt; PeerSelectionState peeraddr b -&gt; PeerSelectionState peeraddr a
fmap :: (a -&gt; b)
-&gt; PeerSelectionState peeraddr a -&gt; PeerSelectionState peeraddr b
$cfmap :: forall peeraddr a b.
(a -&gt; b)
-&gt; PeerSelectionState peeraddr a -&gt; PeerSelectionState peeraddr b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="hs-keyword">data</span><span> </span><span id="PeerSelectionCounters"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier hs-var">PeerSelectionCounters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PeerSelectionCounters"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier hs-var">PeerSelectionCounters</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-310"></span><span>      </span><span id="coldPeers"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#coldPeers"><span class="hs-identifier hs-var hs-var">coldPeers</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-311"></span><span>      </span><span id="warmPeers"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#warmPeers"><span class="hs-identifier hs-var hs-var">warmPeers</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-312"></span><span>      </span><span id="hotPeers"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#hotPeers"><span class="hs-identifier hs-var hs-var">hotPeers</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-313"></span><span>      </span><span id="localRoots"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; [(Int, Int)]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#localRoots"><span class="hs-identifier hs-var hs-var">localRoots</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252878"><span id="local-6989586621679252880"><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool
(PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool)
-&gt; (PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool)
-&gt; Eq PeerSelectionCounters
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool
$c/= :: PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool
== :: PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool
$c== :: PeerSelectionCounters -&gt; PeerSelectionCounters -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252872"><span id="local-6989586621679252874"><span id="local-6989586621679252876"><span class="annot"><span class="annottext">Int -&gt; PeerSelectionCounters -&gt; ShowS
[PeerSelectionCounters] -&gt; ShowS
PeerSelectionCounters -&gt; String
(Int -&gt; PeerSelectionCounters -&gt; ShowS)
-&gt; (PeerSelectionCounters -&gt; String)
-&gt; ([PeerSelectionCounters] -&gt; ShowS)
-&gt; Show PeerSelectionCounters
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [PeerSelectionCounters] -&gt; ShowS
$cshowList :: [PeerSelectionCounters] -&gt; ShowS
show :: PeerSelectionCounters -&gt; String
$cshow :: PeerSelectionCounters -&gt; String
showsPrec :: Int -&gt; PeerSelectionCounters -&gt; ShowS
$cshowsPrec :: Int -&gt; PeerSelectionCounters -&gt; ShowS
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span id="local-6989586621679252870"><span id="local-6989586621679252871"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#peerStateToCounters"><span class="hs-identifier hs-type">peerStateToCounters</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252871"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252871"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252870"><span class="hs-identifier hs-type">peerconn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier hs-type">PeerSelectionCounters</span></a></span></span></span><span>
</span><span id="line-317"></span><span id="peerStateToCounters"><span class="annot"><span class="annottext">peerStateToCounters :: PeerSelectionState peeraddr peerconn -&gt; PeerSelectionCounters
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#peerStateToCounters"><span class="hs-identifier hs-var hs-var">peerStateToCounters</span></a></span></span><span> </span><span id="local-6989586621679252869"><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
</span><a href="#local-6989586621679252869"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSelectionCounters :: Int -&gt; Int -&gt; Int -&gt; [(Int, Int)] -&gt; PeerSelectionCounters
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier hs-type">PeerSelectionCounters</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Int
coldPeers :: Int
coldPeers :: Int
</span><a href="#local-6989586621679252868"><span class="hs-identifier hs-var hs-var">coldPeers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
warmPeers :: Int
warmPeers :: Int
</span><a href="#local-6989586621679252867"><span class="hs-identifier hs-var hs-var">warmPeers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
hotPeers :: Int
hotPeers :: Int
</span><a href="#local-6989586621679252866"><span class="hs-identifier hs-var hs-var">hotPeers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
localRoots :: [(Int, Int)]
localRoots :: [(Int, Int)]
</span><a href="#local-6989586621679252865"><span class="hs-identifier hs-var hs-var">localRoots</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-319"></span><span>    </span><span id="local-6989586621679252864"><span class="annot"><span class="annottext">knownPeersSet :: Set peeraddr
</span><a href="#local-6989586621679252864"><span class="hs-identifier hs-var hs-var">knownPeersSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Set peeraddr
forall peeraddr. KnownPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#toSet"><span class="hs-identifier hs-var">KnownPeers.toSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#knownPeers"><span class="hs-identifier hs-var hs-var">knownPeers</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
</span><a href="#local-6989586621679252869"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>    </span><span id="local-6989586621679252862"><span class="annot"><span class="annottext">establishedPeersSet :: Set peeraddr
</span><a href="#local-6989586621679252862"><span class="hs-identifier hs-var hs-var">establishedPeersSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#toSet"><span class="hs-identifier hs-var">EstablishedPeers.toSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeers"><span class="hs-identifier hs-var hs-var">establishedPeers</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
</span><a href="#local-6989586621679252869"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>    </span><span id="local-6989586621679252868"><span class="annot"><span class="annottext">coldPeers :: Int
</span><a href="#local-6989586621679252868"><span class="hs-identifier hs-var hs-var">coldPeers</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Int) -&gt; Set peeraddr -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252864"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252862"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span>
</span><span id="line-322"></span><span>    </span><span id="local-6989586621679252867"><span class="annot"><span class="annottext">warmPeers :: Int
</span><a href="#local-6989586621679252867"><span class="hs-identifier hs-var hs-var">warmPeers</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Int) -&gt; Set peeraddr -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252862"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activePeers"><span class="hs-identifier hs-var hs-var">activePeers</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
</span><a href="#local-6989586621679252869"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-323"></span><span>    </span><span id="local-6989586621679252866"><span class="annot"><span class="annottext">hotPeers :: Int
</span><a href="#local-6989586621679252866"><span class="hs-identifier hs-var hs-var">hotPeers</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Int) -&gt; Set peeraddr -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activePeers"><span class="hs-identifier hs-var hs-var">activePeers</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
</span><a href="#local-6989586621679252869"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span id="local-6989586621679252865"><span class="annot"><span class="annottext">localRoots :: [(Int, Int)]
</span><a href="#local-6989586621679252865"><span class="hs-identifier hs-var hs-var">localRoots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252858"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252857"><span class="hs-identifier hs-var">active</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252858"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252858"><span class="hs-identifier hs-var">target</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252856"><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252856"><span class="hs-identifier hs-var">members</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr -&gt; [(Int, Set peeraddr)]
forall peeraddr. LocalRootPeers peeraddr -&gt; [(Int, Set peeraddr)]
</span><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#toGroupSets"><span class="hs-identifier hs-var">LocalRootPeers.toGroupSets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; LocalRootPeers peeraddr
forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; LocalRootPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#localRootPeers"><span class="hs-identifier hs-var hs-var">localRootPeers</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
</span><a href="#local-6989586621679252869"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679252857"><span class="annot"><span class="annottext">active :: Int
</span><a href="#local-6989586621679252857"><span class="hs-identifier hs-var hs-var">active</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252856"><span class="hs-identifier hs-var">members</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-operator hs-var">`Set.intersection`</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activePeers"><span class="hs-identifier hs-var hs-var">activePeers</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionState peeraddr peerconn
</span><a href="#local-6989586621679252869"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span id="local-6989586621679252852"><span id="local-6989586621679252853"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#emptyPeerSelectionState"><span class="hs-identifier hs-type">emptyPeerSelectionState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span>
</span><span id="line-331"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-332"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252853"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252852"><span class="hs-identifier hs-type">peerconn</span></a></span></span></span><span>
</span><span id="line-333"></span><span id="emptyPeerSelectionState"><span class="annot"><span class="annottext">emptyPeerSelectionState :: StdGen -&gt; [(Int, Int)] -&gt; PeerSelectionState peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#emptyPeerSelectionState"><span class="hs-identifier hs-var hs-var">emptyPeerSelectionState</span></a></span></span><span> </span><span id="local-6989586621679252851"><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679252851"><span class="hs-identifier hs-var">rng</span></a></span></span><span> </span><span id="local-6989586621679252850"><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679252850"><span class="hs-identifier hs-var">localRoots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-334"></span><span>    </span><span class="annot"><span class="annottext">PeerSelectionState :: forall peeraddr peerconn.
PeerSelectionTargets
-&gt; LocalRootPeers peeraddr
-&gt; Set peeraddr
-&gt; KnownPeers peeraddr
-&gt; EstablishedPeers peeraddr peerconn
-&gt; Set peeraddr
-&gt; Int
-&gt; Time
-&gt; Bool
-&gt; Int
-&gt; Set peeraddr
-&gt; Set peeraddr
-&gt; Set peeraddr
-&gt; Set peeraddr
-&gt; StdGen
-&gt; Cache PeerSelectionCounters
-&gt; PeerSelectionState peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-335"></span><span>      </span><span class="annot"><span class="annottext">targets :: PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targets"><span class="hs-identifier hs-var">targets</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSelectionTargets
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#nullPeerSelectionTargets"><span class="hs-identifier hs-var">nullPeerSelectionTargets</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-336"></span><span>      </span><span class="annot"><span class="annottext">localRootPeers :: LocalRootPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#localRootPeers"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
forall peeraddr. LocalRootPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#empty"><span class="hs-identifier hs-var">LocalRootPeers.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-337"></span><span>      </span><span class="annot"><span class="annottext">publicRootPeers :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootPeers"><span class="hs-identifier hs-var">publicRootPeers</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-338"></span><span>      </span><span class="annot"><span class="annottext">knownPeers :: KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#knownPeers"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
forall peeraddr. KnownPeers peeraddr
</span><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#empty"><span class="hs-identifier hs-var">KnownPeers.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-339"></span><span>      </span><span class="annot"><span class="annottext">establishedPeers :: EstablishedPeers peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeers"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
forall peeraddr perconn. EstablishedPeers peeraddr perconn
</span><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#empty"><span class="hs-identifier hs-var">EstablishedPeers.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-340"></span><span>      </span><span class="annot"><span class="annottext">activePeers :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#activePeers"><span class="hs-identifier hs-var">activePeers</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-341"></span><span>      </span><span class="annot"><span class="annottext">publicRootBackoffs :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootBackoffs"><span class="hs-identifier hs-var">publicRootBackoffs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-342"></span><span>      </span><span class="annot"><span class="annottext">publicRootRetryTime :: Time
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#publicRootRetryTime"><span class="hs-identifier hs-var">publicRootRetryTime</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; Time
</span><span class="hs-identifier hs-var">Time</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-343"></span><span>      </span><span class="annot"><span class="annottext">inProgressPublicRootsReq :: Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPublicRootsReq"><span class="hs-identifier hs-var">inProgressPublicRootsReq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-344"></span><span>      </span><span class="annot"><span class="annottext">inProgressGossipReqs :: Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressGossipReqs"><span class="hs-identifier hs-var">inProgressGossipReqs</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span>
</span><span id="line-345"></span><span>      </span><span class="annot"><span class="annottext">inProgressPromoteCold :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPromoteCold"><span class="hs-identifier hs-var">inProgressPromoteCold</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-346"></span><span>      </span><span class="annot"><span class="annottext">inProgressPromoteWarm :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressPromoteWarm"><span class="hs-identifier hs-var">inProgressPromoteWarm</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-347"></span><span>      </span><span class="annot"><span class="annottext">inProgressDemoteWarm :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteWarm"><span class="hs-identifier hs-var">inProgressDemoteWarm</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-348"></span><span>      </span><span class="annot"><span class="annottext">inProgressDemoteHot :: Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#inProgressDemoteHot"><span class="hs-identifier hs-var">inProgressDemoteHot</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
forall a. Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-349"></span><span>      </span><span class="annot"><span class="annottext">fuzzRng :: StdGen
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#fuzzRng"><span class="hs-identifier hs-var">fuzzRng</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679252851"><span class="hs-identifier hs-var">rng</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-350"></span><span>      </span><span class="annot"><span class="annottext">countersCache :: Cache PeerSelectionCounters
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#countersCache"><span class="hs-identifier hs-var">countersCache</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSelectionCounters -&gt; Cache PeerSelectionCounters
forall a. a -&gt; Cache a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-framework-0.3.0.0/noopt/doc/html/ouroboros-network-framework/src"><span class="hs-identifier hs-var">Cache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; [(Int, Int)] -&gt; PeerSelectionCounters
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionCounters"><span class="hs-identifier hs-var">PeerSelectionCounters</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[(Int, Int)]
</span><a href="#local-6989586621679252850"><span class="hs-identifier hs-var">localRoots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span id="local-6989586621679252841"><span id="local-6989586621679252842"><span id="local-6989586621679252843"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#assertPeerSelectionState"><span class="hs-identifier hs-type">assertPeerSelectionState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252843"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-355"></span><span>                         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252843"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252842"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-356"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252841"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252841"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-357"></span><span id="assertPeerSelectionState"><span class="annot"><span class="annottext">assertPeerSelectionState :: PeerSelectionState peeraddr peerconn -&gt; a -&gt; a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#assertPeerSelectionState"><span class="hs-identifier hs-var hs-var">assertPeerSelectionState</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679252825"><span id="local-6989586621679252826"><span id="local-6989586621679252827"><span id="local-6989586621679252828"><span id="local-6989586621679252829"><span id="local-6989586621679252830"><span id="local-6989586621679252831"><span id="local-6989586621679252832"><span id="local-6989586621679252833"><span id="local-6989586621679252834"><span id="local-6989586621679252835"><span id="local-6989586621679252836"><span id="local-6989586621679252837"><span id="local-6989586621679252838"><span id="local-6989586621679252839"><span id="local-6989586621679252840"><span class="annot"><span class="annottext">Bool
Int
Set peeraddr
StdGen
Cache PeerSelectionCounters
Time
EstablishedPeers peeraddr peerconn
KnownPeers peeraddr
LocalRootPeers peeraddr
PeerSelectionTargets
countersCache :: Cache PeerSelectionCounters
fuzzRng :: StdGen
inProgressDemoteHot :: Set peeraddr
inProgressDemoteWarm :: Set peeraddr
inProgressPromoteWarm :: Set peeraddr
inProgressPromoteCold :: Set peeraddr
inProgressGossipReqs :: Int
inProgressPublicRootsReq :: Bool
publicRootRetryTime :: Time
publicRootBackoffs :: Int
activePeers :: Set peeraddr
establishedPeers :: EstablishedPeers peeraddr peerconn
knownPeers :: KnownPeers peeraddr
publicRootPeers :: Set peeraddr
localRootPeers :: LocalRootPeers peeraddr
targets :: PeerSelectionTargets
countersCache :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Cache PeerSelectionCounters
fuzzRng :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; StdGen
inProgressDemoteHot :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
inProgressDemoteWarm :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
inProgressPromoteWarm :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
inProgressPromoteCold :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
inProgressGossipReqs :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Int
inProgressPublicRootsReq :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Bool
publicRootRetryTime :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Time
publicRootBackoffs :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Int
activePeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
establishedPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
knownPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
publicRootPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
localRootPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; LocalRootPeers peeraddr
targets :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; PeerSelectionTargets
</span><a href="#local-6989586621679252825"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Bool
forall peeraddr. Ord peeraddr =&gt; KnownPeers peeraddr -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#invariant"><span class="hs-identifier hs-var">KnownPeers.invariant</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679252837"><span class="hs-identifier hs-var">knownPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Bool
forall peeraddr peerconn.
Ord peeraddr =&gt;
EstablishedPeers peeraddr peerconn -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#invariant"><span class="hs-identifier hs-var">EstablishedPeers.invariant</span></a></span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679252836"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalRootPeers peeraddr -&gt; Bool
forall peeraddr. Ord peeraddr =&gt; LocalRootPeers peeraddr -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#invariant"><span class="hs-identifier hs-var">LocalRootPeers.invariant</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
</span><a href="#local-6989586621679252839"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>    </span><span class="hs-comment">-- The activePeers is a subset of the establishedPeers</span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-comment">-- which is a subset of the known peers</span><span>
</span><span id="line-364"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252819"><span class="hs-identifier hs-var">activePeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252818"><span class="hs-identifier hs-var">establishedReadySet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252817"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252816"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>   </span><span class="hs-comment">-- The localRootPeers and publicRootPeers must not overlap.</span><span>
</span><span id="line-368"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252814"><span class="hs-identifier hs-var">localRootPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252838"><span class="hs-identifier hs-var">publicRootPeers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-comment">-- The localRootPeers are a subset of the knownPeers,</span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-comment">-- and with correct source info in the knownPeers (either</span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-comment">-- 'PeerSroucePublicRoot' or 'PeerSourceLocalRoot', as local and public</span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-comment">-- root peers might overlap).</span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252814"><span class="hs-identifier hs-var">localRootPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252816"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-comment">-- The publicRootPeers are a subset of the knownPeers,</span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-comment">-- and with correct source info in the knownPeers.</span><span>
</span><span id="line-378"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252838"><span class="hs-identifier hs-var">publicRootPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252816"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-comment">-- The targets should respect the containment relationships of the root,</span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-comment">-- known, established and active peers</span><span>
</span><span id="line-382"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#sanePeerSelectionTargets"><span class="hs-identifier hs-var">sanePeerSelectionTargets</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionTargets
</span><a href="#local-6989586621679252840"><span class="hs-identifier hs-var">targets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-comment">-- All the local root peers are always a subset of the known peers. The</span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-comment">-- target for known peers is a target from both below and above. Thus the</span><span>
</span><span id="line-386"></span><span>    </span><span class="hs-comment">-- number of local root peers must be less than or equal to the known peers</span><span>
</span><span id="line-387"></span><span>    </span><span class="hs-comment">-- target, otherwise we could get stuck.</span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalRootPeers peeraddr -&gt; Int
forall peeraddr. LocalRootPeers peeraddr -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#size"><span class="hs-identifier hs-var">LocalRootPeers.size</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
</span><a href="#local-6989586621679252839"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionTargets -&gt; Int
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#targetNumberOfKnownPeers"><span class="hs-identifier hs-var hs-var">targetNumberOfKnownPeers</span></a></span><span> </span><span class="annot"><span class="annottext">PeerSelectionTargets
</span><a href="#local-6989586621679252840"><span class="hs-identifier hs-var">targets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-comment">-- Interestingly, although the local root peers are also a subset of the</span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-comment">-- root peers, the equivalent constraint does not apply to the target</span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-comment">-- number of root peers. The reason is that the root peers target is only</span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-comment">-- a target from below, not from above. It is ok to have more than the</span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-comment">-- target number of root peers.</span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-comment">--That is, we do /not/ need or want this invariant:</span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-comment">--    LocalRootPeers.size   localRootPeers &lt;= targetNumberOfRootPeers</span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-comment">-- It is also not necessary for all the targets to be achievable. It is</span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-comment">-- just necessary that we do not get stuck. So although we have an implicit</span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-comment">-- target that all local root peers become established, and a certain</span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-comment">-- number of them become active, these targets do not need to be achievable.</span><span>
</span><span id="line-403"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-404"></span><span>    </span><span class="hs-comment">--That is, we do /not/ need or want this invariant:</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-comment">--    LocalRootPeers.size   localRootPeers &lt;= targetNumberOfEstablishedPeers</span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-comment">--    LocalRootPeers.target localRootPeers &lt;= targetNumberOfActivePeers</span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-comment">-- All currently established peers are in the availableToConnect set since</span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-comment">-- the alternative is a record of failure, but these are not (yet) failed.</span><span>
</span><span id="line-411"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252817"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Set peeraddr
forall peeraddr. KnownPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#availableToConnect"><span class="hs-identifier hs-var hs-var">KnownPeers.availableToConnect</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679252837"><span class="hs-identifier hs-var">knownPeers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-comment">-- No constraint for publicRootBackoffs, publicRootRetryTime</span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-comment">-- or inProgressPublicRootsReq</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252831"><span class="hs-identifier hs-var">inProgressGossipReqs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252830"><span class="hs-identifier hs-var">inProgressPromoteCold</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252811"><span class="hs-identifier hs-var">coldPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252829"><span class="hs-identifier hs-var">inProgressPromoteWarm</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252810"><span class="hs-identifier hs-var">warmPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252828"><span class="hs-identifier hs-var">inProgressDemoteWarm</span></a></span><span>  </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252810"><span class="hs-identifier hs-var">warmPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.isSubsetOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252827"><span class="hs-identifier hs-var">inProgressDemoteHot</span></a></span><span>   </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252809"><span class="hs-identifier hs-var">hotPeersSet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>  </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; a -&gt; a
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252829"><span class="hs-identifier hs-var">inProgressPromoteWarm</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252828"><span class="hs-identifier hs-var">inProgressDemoteWarm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-423"></span><span>    </span><span id="local-6989586621679252816"><span class="annot"><span class="annottext">knownPeersSet :: Set peeraddr
</span><a href="#local-6989586621679252816"><span class="hs-identifier hs-var hs-var">knownPeersSet</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr -&gt; Set peeraddr
forall peeraddr. KnownPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#toSet"><span class="hs-identifier hs-var">KnownPeers.toSet</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679252837"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>
</span><span id="line-424"></span><span>    </span><span id="local-6989586621679252814"><span class="annot"><span class="annottext">localRootPeersSet :: Set peeraddr
</span><a href="#local-6989586621679252814"><span class="hs-identifier hs-var hs-var">localRootPeersSet</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr -&gt; Set peeraddr
forall peeraddr. LocalRootPeers peeraddr -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#keysSet"><span class="hs-identifier hs-var">LocalRootPeers.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
</span><a href="#local-6989586621679252839"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span>
</span><span id="line-425"></span><span>    </span><span id="local-6989586621679252817"><span class="annot"><span class="annottext">establishedPeersSet :: Set peeraddr
</span><a href="#local-6989586621679252817"><span class="hs-identifier hs-var hs-var">establishedPeersSet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#toSet"><span class="hs-identifier hs-var">EstablishedPeers.toSet</span></a></span><span>      </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679252836"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span id="local-6989586621679252818"><span class="annot"><span class="annottext">establishedReadySet :: Set peeraddr
</span><a href="#local-6989586621679252818"><span class="hs-identifier hs-var hs-var">establishedReadySet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
Ord peeraddr =&gt;
EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#readyPeers"><span class="hs-identifier hs-var">EstablishedPeers.readyPeers</span></a></span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679252836"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span>
</span><span id="line-427"></span><span>    </span><span id="local-6989586621679252819"><span class="annot"><span class="annottext">activePeersSet :: Set peeraddr
</span><a href="#local-6989586621679252819"><span class="hs-identifier hs-var hs-var">activePeersSet</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252835"><span class="hs-identifier hs-var">activePeers</span></a></span><span>
</span><span id="line-428"></span><span>    </span><span id="local-6989586621679252811"><span class="annot"><span class="annottext">coldPeersSet :: Set peeraddr
</span><a href="#local-6989586621679252811"><span class="hs-identifier hs-var hs-var">coldPeersSet</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252816"><span class="hs-identifier hs-var">knownPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252817"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span>
</span><span id="line-429"></span><span>    </span><span id="local-6989586621679252810"><span class="annot"><span class="annottext">warmPeersSet :: Set peeraddr
</span><a href="#local-6989586621679252810"><span class="hs-identifier hs-var hs-var">warmPeersSet</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252817"><span class="hs-identifier hs-var">establishedPeersSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Set peeraddr
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-operator hs-var">Set.\\</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252819"><span class="hs-identifier hs-var">activePeersSet</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span id="local-6989586621679252809"><span class="annot"><span class="annottext">hotPeersSet :: Set peeraddr
</span><a href="#local-6989586621679252809"><span class="hs-identifier hs-var hs-var">hotPeersSet</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252819"><span class="hs-identifier hs-var">activePeersSet</span></a></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="hs-comment">-- | A view of the status of each established peer, for testing and debugging.</span><span>
</span><span id="line-434"></span><span class="hs-comment">--</span><span>
</span><span id="line-435"></span><span id="local-6989586621679252805"><span id="local-6989586621679252806"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeersStatus"><span class="hs-identifier hs-type">establishedPeersStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252806"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-436"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252806"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252805"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-437"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252806"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier hs-type">PeerStatus</span></a></span></span></span><span>
</span><span id="line-438"></span><span id="establishedPeersStatus"><span class="annot"><span class="annottext">establishedPeersStatus :: PeerSelectionState peeraddr peerconn -&gt; Map peeraddr PeerStatus
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#establishedPeersStatus"><span class="hs-identifier hs-var hs-var">establishedPeersStatus</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679252804"><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
establishedPeers :: EstablishedPeers peeraddr peerconn
establishedPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn
-&gt; EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679252804"><span class="hs-identifier hs-var hs-var">establishedPeers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252803"><span class="annot"><span class="annottext">Set peeraddr
activePeers :: Set peeraddr
activePeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="#local-6989586621679252803"><span class="hs-identifier hs-var hs-var">activePeers</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-comment">-- map union-override, left to right</span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><span class="annottext">(peeraddr -&gt; PeerStatus) -&gt; Set peeraddr -&gt; Map peeraddr PeerStatus
forall k a. (k -&gt; a) -&gt; Set k -&gt; Map k a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Map.fromSet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">peeraddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PeerStatus
</span><a href="Ouroboros.Network.PeerSelection.Types.html#PeerHot"><span class="hs-identifier hs-var">PeerHot</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252803"><span class="hs-identifier hs-var">activePeers</span></a></span><span>
</span><span id="line-441"></span><span> </span><span class="annot"><span class="annottext">Map peeraddr PeerStatus
-&gt; Map peeraddr PeerStatus -&gt; Map peeraddr PeerStatus
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(peeraddr -&gt; PeerStatus) -&gt; Set peeraddr -&gt; Map peeraddr PeerStatus
forall k a. (k -&gt; a) -&gt; Set k -&gt; Map k a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Map.fromSet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">peeraddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PeerStatus
</span><a href="Ouroboros.Network.PeerSelection.Types.html#PeerWarm"><span class="hs-identifier hs-var">PeerWarm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
forall peeraddr peerconn.
EstablishedPeers peeraddr peerconn -&gt; Set peeraddr
</span><a href="Ouroboros.Network.PeerSelection.EstablishedPeers.html#toSet"><span class="hs-identifier hs-var">EstablishedPeers.toSet</span></a></span><span> </span><span class="annot"><span class="annottext">EstablishedPeers peeraddr peerconn
</span><a href="#local-6989586621679252804"><span class="hs-identifier hs-var">establishedPeers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="hs-comment">--------------------------------</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- PickPolicy wrapper function</span><span>
</span><span id="line-446"></span><span class="hs-comment">--</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="hs-comment">-- | Check pre-conditions and post-conditions on the pick policies,</span><span>
</span><span id="line-449"></span><span class="hs-comment">-- and supply additional peer atributes from the current state.</span><span>
</span><span id="line-450"></span><span class="hs-comment">--</span><span>
</span><span id="line-451"></span><span id="local-6989586621679252797"><span id="local-6989586621679252798"><span id="local-6989586621679252799"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#pickPeers"><span class="hs-identifier hs-type">pickPeers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252799"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252798"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252799"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252797"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-453"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252799"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerSource"><span class="hs-identifier hs-type">PeerSource</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252799"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252799"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252799"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252798"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252799"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252799"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252798"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252799"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-458"></span><span id="pickPeers"><span class="annot"><span class="annottext">pickPeers :: PeerSelectionState peeraddr peerconn
-&gt; ((peeraddr -&gt; PeerSource)
    -&gt; (peeraddr -&gt; Int)
    -&gt; (peeraddr -&gt; Bool)
    -&gt; Set peeraddr
    -&gt; Int
    -&gt; m (Set peeraddr))
-&gt; Set peeraddr
-&gt; Int
-&gt; m (Set peeraddr)
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#pickPeers"><span class="hs-identifier hs-var hs-var">pickPeers</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679252796"><span class="annot"><span class="annottext">LocalRootPeers peeraddr
localRootPeers :: LocalRootPeers peeraddr
localRootPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; LocalRootPeers peeraddr
</span><a href="#local-6989586621679252796"><span class="hs-identifier hs-var hs-var">localRootPeers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252795"><span class="annot"><span class="annottext">Set peeraddr
publicRootPeers :: Set peeraddr
publicRootPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; Set peeraddr
</span><a href="#local-6989586621679252795"><span class="hs-identifier hs-var hs-var">publicRootPeers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252794"><span class="annot"><span class="annottext">KnownPeers peeraddr
knownPeers :: KnownPeers peeraddr
knownPeers :: forall peeraddr peerconn.
PeerSelectionState peeraddr peerconn -&gt; KnownPeers peeraddr
</span><a href="#local-6989586621679252794"><span class="hs-identifier hs-var hs-var">knownPeers</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-459"></span><span>          </span><span id="local-6989586621679252793"><span class="annot"><span class="annottext">(peeraddr -&gt; PeerSource)
-&gt; (peeraddr -&gt; Int)
-&gt; (peeraddr -&gt; Bool)
-&gt; Set peeraddr
-&gt; Int
-&gt; m (Set peeraddr)
</span><a href="#local-6989586621679252793"><span class="hs-identifier hs-var">pick</span></a></span></span><span> </span><span id="local-6989586621679252792"><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252792"><span class="hs-identifier hs-var">available</span></a></span></span><span> </span><span id="local-6989586621679252791"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252791"><span class="hs-identifier hs-var">num</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-460"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m (Set peeraddr) -&gt; m (Set peeraddr)
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679252790"><span class="hs-identifier hs-var">precondition</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Set peeraddr) -&gt; m (Set peeraddr))
-&gt; m (Set peeraddr) -&gt; m (Set peeraddr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-461"></span><span>    </span><span class="annot"><span class="annottext">(Set peeraddr -&gt; Set peeraddr)
-&gt; m (Set peeraddr) -&gt; m (Set peeraddr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679252789"><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252789"><span class="hs-identifier hs-var">picked</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set peeraddr -&gt; Set peeraddr
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
</span><a href="#local-6989586621679252788"><span class="hs-identifier hs-var">postcondition</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252789"><span class="hs-identifier hs-var">picked</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252789"><span class="hs-identifier hs-var">picked</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(peeraddr -&gt; PeerSource)
-&gt; (peeraddr -&gt; Int)
-&gt; (peeraddr -&gt; Bool)
-&gt; Set peeraddr
-&gt; Int
-&gt; m (Set peeraddr)
</span><a href="#local-6989586621679252793"><span class="hs-identifier hs-var">pick</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr -&gt; PeerSource
</span><a href="#local-6989586621679252787"><span class="hs-identifier hs-var">peerSource</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr -&gt; Int
</span><a href="#local-6989586621679252786"><span class="hs-identifier hs-var">peerConnectFailCount</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr -&gt; Bool
</span><a href="#local-6989586621679252785"><span class="hs-identifier hs-var">peerTepidFlag</span></a></span><span>
</span><span id="line-463"></span><span>               </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252792"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252784"><span class="hs-identifier hs-var">numClamped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-465"></span><span>    </span><span id="local-6989586621679252790"><span class="annot"><span class="annottext">precondition :: Bool
</span><a href="#local-6989586621679252790"><span class="hs-identifier hs-var hs-var">precondition</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252792"><span class="hs-identifier hs-var">available</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252791"><span class="hs-identifier hs-var">num</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-466"></span><span>    </span><span id="local-6989586621679252788"><span class="annot"><span class="annottext">postcondition :: Set peeraddr -&gt; Bool
</span><a href="#local-6989586621679252788"><span class="hs-identifier hs-var hs-var">postcondition</span></a></span></span><span> </span><span id="local-6989586621679252781"><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252781"><span class="hs-identifier hs-var">picked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Bool
forall a. Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252781"><span class="hs-identifier hs-var">picked</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252781"><span class="hs-identifier hs-var">picked</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252784"><span class="hs-identifier hs-var">numClamped</span></a></span><span>
</span><span id="line-468"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252781"><span class="hs-identifier hs-var">picked</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-operator hs-var">`Set.isSubsetOf`</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252792"><span class="hs-identifier hs-var">available</span></a></span><span>
</span><span id="line-469"></span><span>    </span><span id="local-6989586621679252784"><span class="annot"><span class="annottext">numClamped :: Int
</span><a href="#local-6989586621679252784"><span class="hs-identifier hs-var hs-var">numClamped</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">min</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252791"><span class="hs-identifier hs-var">num</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set peeraddr -&gt; Int
forall a. Set a -&gt; Int
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252792"><span class="hs-identifier hs-var">available</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span>    </span><span id="local-6989586621679252787"><span class="annot"><span class="annottext">peerSource :: peeraddr -&gt; PeerSource
</span><a href="#local-6989586621679252787"><span class="hs-identifier hs-var hs-var">peerSource</span></a></span></span><span> </span><span id="local-6989586621679252779"><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679252779"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-472"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">peeraddr -&gt; LocalRootPeers peeraddr -&gt; Bool
forall peeraddr.
Ord peeraddr =&gt;
peeraddr -&gt; LocalRootPeers peeraddr -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#member"><span class="hs-identifier hs-var">LocalRootPeers.member</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679252779"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRootPeers peeraddr
</span><a href="#local-6989586621679252796"><span class="hs-identifier hs-var">localRootPeers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSource
</span><a href="Ouroboros.Network.PeerSelection.Types.html#PeerSourceLocalRoot"><span class="hs-identifier hs-var">PeerSourceLocalRoot</span></a></span><span>
</span><span id="line-473"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">peeraddr -&gt; Set peeraddr -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Set.member</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679252779"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Set peeraddr
</span><a href="#local-6989586621679252795"><span class="hs-identifier hs-var">publicRootPeers</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSource
</span><a href="Ouroboros.Network.PeerSelection.Types.html#PeerSourcePublicRoot"><span class="hs-identifier hs-var">PeerSourcePublicRoot</span></a></span><span>
</span><span id="line-474"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">peeraddr -&gt; KnownPeers peeraddr -&gt; Bool
forall peeraddr.
Ord peeraddr =&gt;
peeraddr -&gt; KnownPeers peeraddr -&gt; Bool
</span><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#member"><span class="hs-identifier hs-var">KnownPeers.member</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679252779"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679252794"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSource
</span><a href="Ouroboros.Network.PeerSelection.Types.html#PeerSourceGossip"><span class="hs-identifier hs-var">PeerSourceGossip</span></a></span><span>
</span><span id="line-475"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PeerSource
forall a. a
</span><a href="#local-6989586621679252772"><span class="hs-identifier hs-var">errorUnavailable</span></a></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span>    </span><span id="local-6989586621679252786"><span class="annot"><span class="annottext">peerConnectFailCount :: peeraddr -&gt; Int
</span><a href="#local-6989586621679252786"><span class="hs-identifier hs-var hs-var">peerConnectFailCount</span></a></span></span><span> </span><span id="local-6989586621679252771"><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679252771"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-478"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; Int
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Int
forall a. a
</span><a href="#local-6989586621679252772"><span class="hs-identifier hs-var">errorUnavailable</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Int) -&gt; Maybe Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-479"></span><span>          </span><span class="annot"><span class="annottext">peeraddr -&gt; KnownPeers peeraddr -&gt; Maybe Int
forall peeraddr.
Ord peeraddr =&gt;
peeraddr -&gt; KnownPeers peeraddr -&gt; Maybe Int
</span><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#lookupFailCount"><span class="hs-identifier hs-var">KnownPeers.lookupFailCount</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679252771"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679252794"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span>    </span><span id="local-6989586621679252785"><span class="annot"><span class="annottext">peerTepidFlag :: peeraddr -&gt; Bool
</span><a href="#local-6989586621679252785"><span class="hs-identifier hs-var hs-var">peerTepidFlag</span></a></span></span><span> </span><span id="local-6989586621679252769"><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679252769"><span class="hs-identifier hs-var">p</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span>
</span><span id="line-482"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
forall a. a
</span><a href="#local-6989586621679252772"><span class="hs-identifier hs-var">errorUnavailable</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool) -&gt; Maybe Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-483"></span><span>          </span><span class="annot"><span class="annottext">peeraddr -&gt; KnownPeers peeraddr -&gt; Maybe Bool
forall peeraddr.
Ord peeraddr =&gt;
peeraddr -&gt; KnownPeers peeraddr -&gt; Maybe Bool
</span><a href="Ouroboros.Network.PeerSelection.KnownPeers.html#lookupTepidFlag"><span class="hs-identifier hs-var">KnownPeers.lookupTepidFlag</span></a></span><span> </span><span class="annot"><span class="annottext">peeraddr
</span><a href="#local-6989586621679252769"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">KnownPeers peeraddr
</span><a href="#local-6989586621679252794"><span class="hs-identifier hs-var">knownPeers</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>    </span><span id="local-6989586621679252772"><span class="annot"><span class="annottext">errorUnavailable :: a
</span><a href="#local-6989586621679252772"><span class="hs-identifier hs-var hs-var">errorUnavailable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-486"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; a
forall a. (?callStack::CallStack) =&gt; String -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; a) -&gt; String -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A pick policy requested an attribute for peer address &quot;</span></span><span>
</span><span id="line-487"></span><span>             </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; which is outside of the set given to pick from&quot;</span></span><span>
</span><span id="line-488"></span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-491"></span><span class="hs-comment">-- Peer Selection Decisions</span><span>
</span><span id="line-492"></span><span class="hs-comment">--</span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span class="hs-comment">-- | The governor is using @Guarded m (Decision m peeraddr peerconn)@ where 'm'</span><span>
</span><span id="line-496"></span><span class="hs-comment">-- is an 'STM' monad, to drive its progress.</span><span>
</span><span id="line-497"></span><span class="hs-comment">--</span><span>
</span><span id="line-498"></span><span class="hs-keyword">data</span><span> </span><span id="Guarded"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-var">Guarded</span></a></span></span><span> </span><span id="local-6989586621679253012"><span class="annot"><a href="#local-6989586621679253012"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679253011"><span class="annot"><a href="#local-6989586621679253011"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-comment">-- | 'GuardedSkip' is used to instruct that there is no action to be made</span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-comment">-- by the governor.</span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-502"></span><span>    </span><span class="hs-comment">-- Let us note that the combined value which is computed by</span><span>
</span><span id="line-503"></span><span>    </span><span class="hs-comment">-- @guardedDecisions@ term in</span><span>
</span><span id="line-504"></span><span>    </span><span class="hs-comment">-- 'Ouroboros.Newtork.PeerSelection.Governor.peerSelectionGovernorLoop' will</span><span>
</span><span id="line-505"></span><span>    </span><span class="hs-comment">-- never return it: this is bacause there are monitoring decisions which</span><span>
</span><span id="line-506"></span><span>    </span><span class="hs-comment">-- never return this constructor, e.g.  'Monitor.targetPeers',</span><span>
</span><span id="line-507"></span><span>    </span><span class="hs-comment">-- 'Monitor.jobs', 'Monitor.connections', and thus the governor has always</span><span>
</span><span id="line-508"></span><span>    </span><span class="hs-comment">-- something to do.</span><span>
</span><span id="line-509"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-510"></span><span>    </span><span id="GuardedSkip"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-var">GuardedSkip</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Min</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-comment">-- | 'Guarded' is used to provide an action through 'FirstToFinish'</span><span>
</span><span id="line-513"></span><span>    </span><span class="hs-comment">-- synchronisation, possibly with a timeout, to</span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-comment">-- the governor main loop.</span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-516"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Guarded%27"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-var">Guarded'</span></a></span></span><span>   </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Min</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/monoidal-synchronisation-0.1.0.2/noopt/doc/html/monoidal-synchronisation/src"><span class="hs-identifier hs-type">FirstToFinish</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253012"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253011"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="hs-comment">-- | 'Guarded' constructor which provides an action, possibly with a timeout,</span><span>
</span><span id="line-520"></span><span class="hs-comment">-- to the governor main loop.  It hides the use of 'FirstToFinish'</span><span>
</span><span id="line-521"></span><span class="hs-comment">-- synchronisation.</span><span>
</span><span id="line-522"></span><span class="hs-comment">--</span><span>
</span><span id="line-523"></span><span id="local-6989586621679253019"><span id="local-6989586621679253020"><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Min</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679253020"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253019"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253020"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679253019"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-524"></span><span class="hs-keyword">pattern</span><span> </span><span id="%24bGuarded"><span id="%24mGuarded"><span id="Guarded"><span class="annot"><span class="annottext">$bGuarded :: Maybe (Min Time) -&gt; m a -&gt; Guarded m a
$mGuarded :: forall r (m :: * -&gt; *) a.
Guarded m a -&gt; (Maybe (Min Time) -&gt; m a -&gt; r) -&gt; (Void# -&gt; r) -&gt; r
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#%24bGuarded"><span class="hs-identifier hs-var hs-var hs-var hs-var">Guarded</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621679252763"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252762"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-type">Guarded'</span></a></span><span> </span><span id="local-6989586621679252763"><span class="annot"><a href="#local-6989586621679252763"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/monoidal-synchronisation-0.1.0.2/noopt/doc/html/monoidal-synchronisation/src"><span class="hs-identifier hs-type">FirstToFinish</span></a></span><span> </span><span id="local-6989586621679252762"><span class="annot"><a href="#local-6989586621679252762"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-526"></span><span>    </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-var">Guarded</span></a></span><span> </span><span id="local-6989586621679252760"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252760"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679252759"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679252759"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
forall (m :: * -&gt; *) a.
Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-var">Guarded'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252760"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m a -&gt; FirstToFinish m a
forall (m :: * -&gt; *) a. m a -&gt; FirstToFinish m a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/monoidal-synchronisation-0.1.0.2/noopt/doc/html/monoidal-synchronisation/src"><span class="hs-identifier hs-var">FirstToFinish</span></a></span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621679252759"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span class="hs-pragma">{-# COMPLETE</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-pragma hs-type">GuardedSkip</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-pragma hs-type">Guarded</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="hs-comment">-- | 'Guarded' constructor is absorbing in the sense that</span><span>
</span><span id="line-531"></span><span class="hs-comment">--</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- &gt; Guarded x y &lt;&gt; a = Guarded x' y'</span><span>
</span><span id="line-533"></span><span class="hs-comment">-- &gt; a &lt;&gt; Guarded x y = Guarded x' y'</span><span>
</span><span id="line-534"></span><span class="hs-comment">--</span><span>
</span><span id="line-535"></span><span class="hs-comment">-- In the algebraic sense, @'Guarded' (Just minBound) (return x)@ is a left</span><span>
</span><span id="line-536"></span><span class="hs-comment">-- absorbing element when &quot;m ~ STM m'@ for some monad @m'@.  There is no right</span><span>
</span><span id="line-537"></span><span class="hs-comment">-- absorbing element since there is no right absorbing elemnt in @STM m'@.</span><span>
</span><span id="line-538"></span><span class="hs-comment">--</span><span>
</span><span id="line-539"></span><span class="hs-comment">-- Ref. [absorbing element](https://en.wikipedia.org/wiki/Absorbing_element)</span><span>
</span><span id="line-540"></span><span class="hs-comment">--</span><span>
</span><span id="line-541"></span><span id="local-6989586621679252757"><span id="local-6989586621679252758"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679252752"><span id="local-6989586621679252754"><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Alternative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252758"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252758"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252757"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-542"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-type">Guarded'</span></a></span><span>    </span><span id="local-6989586621679252750"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252750"><span class="hs-identifier hs-var">ta</span></a></span></span><span> </span><span id="local-6989586621679252749"><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679252749"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679252748"><span class="annot"><span class="annottext">&lt;&gt; :: Guarded m a -&gt; Guarded m a -&gt; Guarded m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-type">Guarded'</span></a></span><span>    </span><span id="local-6989586621679252747"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252747"><span class="hs-identifier hs-var">tb</span></a></span></span><span> </span><span id="local-6989586621679252746"><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679252746"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
forall (m :: * -&gt; *) a.
Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-var">Guarded'</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252750"><span class="hs-identifier hs-var">ta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Maybe (Min Time) -&gt; Maybe (Min Time)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252747"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679252749"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">FirstToFinish m a -&gt; FirstToFinish m a -&gt; FirstToFinish m a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679252746"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-type">Guarded'</span></a></span><span>    </span><span id="local-6989586621679252745"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252745"><span class="hs-identifier hs-var">ta</span></a></span></span><span> </span><span id="local-6989586621679252744"><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679252744"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-type">GuardedSkip</span></a></span><span> </span><span id="local-6989586621679252743"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252743"><span class="hs-identifier hs-var">tb</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
forall (m :: * -&gt; *) a.
Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-var">Guarded'</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252745"><span class="hs-identifier hs-var">ta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Maybe (Min Time) -&gt; Maybe (Min Time)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252743"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679252744"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-544"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-type">GuardedSkip</span></a></span><span> </span><span id="local-6989586621679252742"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252742"><span class="hs-identifier hs-var">ta</span></a></span></span><span>   </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-type">Guarded'</span></a></span><span>    </span><span id="local-6989586621679252741"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252741"><span class="hs-identifier hs-var">tb</span></a></span></span><span> </span><span id="local-6989586621679252740"><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679252740"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
forall (m :: * -&gt; *) a.
Maybe (Min Time) -&gt; FirstToFinish m a -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded%27"><span class="hs-identifier hs-var">Guarded'</span></a></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252742"><span class="hs-identifier hs-var">ta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Maybe (Min Time) -&gt; Maybe (Min Time)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252741"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">FirstToFinish m a
</span><a href="#local-6989586621679252740"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-545"></span><span>  </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-type">GuardedSkip</span></a></span><span> </span><span id="local-6989586621679252739"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252739"><span class="hs-identifier hs-var">ta</span></a></span></span><span>   </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-type">GuardedSkip</span></a></span><span> </span><span id="local-6989586621679252738"><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252738"><span class="hs-identifier hs-var">tb</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Guarded m a
forall (m :: * -&gt; *) a. Maybe (Min Time) -&gt; Guarded m a
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#GuardedSkip"><span class="hs-identifier hs-var">GuardedSkip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252739"><span class="hs-identifier hs-var">ta</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time) -&gt; Maybe (Min Time) -&gt; Maybe (Min Time)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Min Time)
</span><a href="#local-6989586621679252738"><span class="hs-identifier hs-var">tb</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span class="hs-keyword">data</span><span> </span><span id="Decision"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier hs-var">Decision</span></a></span></span><span> </span><span id="local-6989586621679252737"><span class="annot"><a href="#local-6989586621679252737"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679252736"><span class="annot"><a href="#local-6989586621679252736"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679252735"><span class="annot"><a href="#local-6989586621679252735"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Decision"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier hs-var">Decision</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-549"></span><span>         </span><span class="hs-comment">-- | A trace event to classify the decision and action</span><span>
</span><span id="line-550"></span><span>       </span><span id="decisionTrace"><span class="annot"><span class="annottext">Decision m peeraddr peerconn -&gt; [TracePeerSelection peeraddr]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#decisionTrace"><span class="hs-identifier hs-var hs-var">decisionTrace</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePeerSelection"><span class="hs-identifier hs-type">TracePeerSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252736"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span>         </span><span class="hs-comment">-- | An updated state to use immediately</span><span>
</span><span id="line-553"></span><span>       </span><span id="decisionState"><span class="annot"><span class="annottext">Decision m peeraddr peerconn
-&gt; PeerSelectionState peeraddr peerconn
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#decisionState"><span class="hs-identifier hs-var hs-var">decisionState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252736"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252735"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span>       </span><span class="hs-comment">-- | An optional 'Job' to execute asynchronously. This job leads to</span><span>
</span><span id="line-556"></span><span>       </span><span class="hs-comment">-- a further 'Decision'. This gives a state update to apply upon</span><span>
</span><span id="line-557"></span><span>       </span><span class="hs-comment">-- completion, but also allows chaining further job actions.</span><span>
</span><span id="line-558"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-559"></span><span>       </span><span id="decisionJobs"><span class="annot"><span class="annottext">Decision m peeraddr peerconn
-&gt; [Job () m (Completion m peeraddr peerconn)]
</span><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#decisionJobs"><span class="hs-identifier hs-var hs-var">decisionJobs</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/network-mux-0.3.0.0/noopt/doc/html/network-mux/src"><span class="hs-identifier hs-type">Job</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252737"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Completion"><span class="hs-identifier hs-type">Completion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252737"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252736"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252735"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-560"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span class="hs-comment">-- | Decision which has access to the current time, rather than the time when</span><span>
</span><span id="line-563"></span><span class="hs-comment">-- the governor's loop blocked to make a decision.</span><span>
</span><span id="line-564"></span><span class="hs-comment">--</span><span>
</span><span id="line-565"></span><span class="hs-keyword">type</span><span> </span><span id="TimedDecision"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TimedDecision"><span class="hs-identifier hs-var">TimedDecision</span></a></span></span><span> </span><span id="local-6989586621679252730"><span class="annot"><a href="#local-6989586621679252730"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679252729"><span class="annot"><a href="#local-6989586621679252729"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679252728"><span class="annot"><a href="#local-6989586621679252728"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier hs-type">Decision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252730"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252729"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252728"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="hs-comment">-- | Type alias for function types which are used to create governor decisions.</span><span>
</span><span id="line-568"></span><span class="hs-comment">-- Allmost all decisions are following this pattern.</span><span>
</span><span id="line-569"></span><span class="hs-comment">--</span><span>
</span><span id="line-570"></span><span class="hs-keyword">type</span><span> </span><span id="MkGuardedDecision"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#MkGuardedDecision"><span class="hs-identifier hs-var">MkGuardedDecision</span></a></span></span><span> </span><span id="local-6989586621679252727"><span class="annot"><a href="#local-6989586621679252727"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679252726"><span class="annot"><a href="#local-6989586621679252726"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span id="local-6989586621679252725"><span class="annot"><a href="#local-6989586621679252725"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-571"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionPolicy"><span class="hs-identifier hs-type">PeerSelectionPolicy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252727"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252725"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252727"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252726"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Guarded"><span class="hs-identifier hs-type">Guarded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679252725"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TimedDecision"><span class="hs-identifier hs-type">TimedDecision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252725"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252727"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252726"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="hs-keyword">newtype</span><span> </span><span id="Completion"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Completion"><span class="hs-identifier hs-var">Completion</span></a></span></span><span> </span><span id="local-6989586621679252724"><span class="annot"><a href="#local-6989586621679252724"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679252723"><span class="annot"><a href="#local-6989586621679252723"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679252722"><span class="annot"><a href="#local-6989586621679252722"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-577"></span><span>        </span><span id="Completion"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Completion"><span class="hs-identifier hs-var">Completion</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252723"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252722"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-578"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#Decision"><span class="hs-identifier hs-type">Decision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252724"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252723"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252722"><span class="hs-identifier hs-type">peerconn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span class="hs-keyword">data</span><span> </span><span id="TracePeerSelection"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePeerSelection"><span class="hs-identifier hs-var">TracePeerSelection</span></a></span></span><span> </span><span id="local-6989586621679252720"><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-581"></span><span>       </span><span id="TraceLocalRootPeersChanged"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceLocalRootPeersChanged"><span class="hs-identifier hs-var">TraceLocalRootPeersChanged</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#LocalRootPeers"><span class="hs-identifier hs-type">LocalRootPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.LocalRootPeers.html#LocalRootPeers"><span class="hs-identifier hs-type">LocalRootPeers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceTargetsChanged"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceTargetsChanged"><span class="hs-identifier hs-var">TraceTargetsChanged</span></a></span></span><span>     </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionTargets"><span class="hs-identifier hs-type">PeerSelectionTargets</span></a></span><span>
</span><span id="line-584"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePublicRootsRequest"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePublicRootsRequest"><span class="hs-identifier hs-var">TracePublicRootsRequest</span></a></span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-585"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePublicRootsResults"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePublicRootsResults"><span class="hs-identifier hs-var">TracePublicRootsResults</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-586"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePublicRootsFailure"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePublicRootsFailure"><span class="hs-identifier hs-var">TracePublicRootsFailure</span></a></span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-587"></span><span>     </span><span class="hs-comment">-- | target known peers, actual known peers, peers available for gossip,</span><span>
</span><span id="line-588"></span><span>     </span><span class="hs-comment">-- peers selected for gossip</span><span>
</span><span id="line-589"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceGossipRequests"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceGossipRequests"><span class="hs-identifier hs-var">TraceGossipRequests</span></a></span></span><span>     </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceGossipResults"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceGossipResults"><span class="hs-identifier hs-var">TraceGossipResults</span></a></span></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">SomeException</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">--TODO: classify failures</span><span>
</span><span id="line-591"></span><span>     </span><span class="hs-comment">-- | target known peers, actual known peers, selected peer</span><span>
</span><span id="line-592"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceForgetColdPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceForgetColdPeers"><span class="hs-identifier hs-var">TraceForgetColdPeers</span></a></span></span><span>    </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>     </span><span class="hs-comment">-- | target established, actual established, selected peers</span><span>
</span><span id="line-594"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdPeers"><span class="hs-identifier hs-var">TracePromoteColdPeers</span></a></span></span><span>   </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>     </span><span class="hs-comment">-- | target local established, actual local established, selected peers</span><span>
</span><span id="line-596"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdLocalPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdLocalPeers"><span class="hs-identifier hs-var">TracePromoteColdLocalPeers</span></a></span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>     </span><span class="hs-comment">-- | target established, actual established, peer, delay until next</span><span>
</span><span id="line-598"></span><span>     </span><span class="hs-comment">-- promotion, reason</span><span>
</span><span id="line-599"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdFailed"><span class="hs-identifier hs-var">TracePromoteColdFailed</span></a></span></span><span>  </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">SomeException</span></a></span><span>
</span><span id="line-600"></span><span>     </span><span class="hs-comment">-- | target established, actual established, peer</span><span>
</span><span id="line-601"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteColdDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteColdDone"><span class="hs-identifier hs-var">TracePromoteColdDone</span></a></span></span><span>    </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-602"></span><span>     </span><span class="hs-comment">-- | target active, actual active, selected peers</span><span>
</span><span id="line-603"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmPeers"><span class="hs-identifier hs-var">TracePromoteWarmPeers</span></a></span></span><span>   </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>     </span><span class="hs-comment">-- | Promote local peers to warm</span><span>
</span><span id="line-605"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmLocalPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmLocalPeers"><span class="hs-identifier hs-var">TracePromoteWarmLocalPeers</span></a></span></span><span>
</span><span id="line-606"></span><span>         </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- ^ local per-group `(target active, actual active)`,</span><span>
</span><span id="line-607"></span><span>                        </span><span class="hs-comment">-- only limited to groups which are below their target.</span><span>
</span><span id="line-608"></span><span>         </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ selected peers</span><span>
</span><span id="line-609"></span><span>     </span><span class="hs-comment">-- | target active, actual active, peer, reason</span><span>
</span><span id="line-610"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmFailed"><span class="hs-identifier hs-var">TracePromoteWarmFailed</span></a></span></span><span>  </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">SomeException</span></a></span><span>
</span><span id="line-611"></span><span>     </span><span class="hs-comment">-- | target active, actual active, peer</span><span>
</span><span id="line-612"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmDone"><span class="hs-identifier hs-var">TracePromoteWarmDone</span></a></span></span><span>    </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-613"></span><span>     </span><span class="hs-comment">-- | aborted promotion of a warm peer; likely it was asynchronously</span><span>
</span><span id="line-614"></span><span>     </span><span class="hs-comment">-- demoted in the meantime.</span><span>
</span><span id="line-615"></span><span>     </span><span class="hs-comment">--</span><span>
</span><span id="line-616"></span><span>     </span><span class="hs-comment">-- target active, actual active, peer</span><span>
</span><span id="line-617"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TracePromoteWarmAborted"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TracePromoteWarmAborted"><span class="hs-identifier hs-var">TracePromoteWarmAborted</span></a></span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-618"></span><span>     </span><span class="hs-comment">-- | target established, actual established, selected peers</span><span>
</span><span id="line-619"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteWarmPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteWarmPeers"><span class="hs-identifier hs-var">TraceDemoteWarmPeers</span></a></span></span><span>    </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>     </span><span class="hs-comment">-- | target established, actual established, peer, reason</span><span>
</span><span id="line-621"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteWarmFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteWarmFailed"><span class="hs-identifier hs-var">TraceDemoteWarmFailed</span></a></span></span><span>   </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">SomeException</span></a></span><span>
</span><span id="line-622"></span><span>     </span><span class="hs-comment">-- | target established, actual established, peer</span><span>
</span><span id="line-623"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteWarmDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteWarmDone"><span class="hs-identifier hs-var">TraceDemoteWarmDone</span></a></span></span><span>     </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-624"></span><span>     </span><span class="hs-comment">-- | target active, actual active, selected peers</span><span>
</span><span id="line-625"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteHotPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteHotPeers"><span class="hs-identifier hs-var">TraceDemoteHotPeers</span></a></span></span><span>     </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>     </span><span class="hs-comment">-- | local per-group (target active, actual active), selected peers</span><span>
</span><span id="line-627"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteLocalHotPeers"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteLocalHotPeers"><span class="hs-identifier hs-var">TraceDemoteLocalHotPeers</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>     </span><span class="hs-comment">-- | target active, actual active, peer, reason</span><span>
</span><span id="line-629"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteHotFailed"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteHotFailed"><span class="hs-identifier hs-var">TraceDemoteHotFailed</span></a></span></span><span>    </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">SomeException</span></a></span><span>
</span><span id="line-630"></span><span>     </span><span class="hs-comment">-- | target active, actual active, peer</span><span>
</span><span id="line-631"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteHotDone"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteHotDone"><span class="hs-identifier hs-var">TraceDemoteHotDone</span></a></span></span><span>      </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-632"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteAsynchronous"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteAsynchronous"><span class="hs-identifier hs-var">TraceDemoteAsynchronous</span></a></span></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier hs-type">PeerStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.ExitPolicy.html#ReconnectDelay"><span class="hs-identifier hs-type">ReconnectDelay</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceDemoteLocalAsynchronous"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceDemoteLocalAsynchronous"><span class="hs-identifier hs-var">TraceDemoteLocalAsynchronous</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252720"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Types.html#PeerStatus"><span class="hs-identifier hs-type">PeerStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.ExitPolicy.html#ReconnectDelay"><span class="hs-identifier hs-type">ReconnectDelay</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceGovernorWakeup"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceGovernorWakeup"><span class="hs-identifier hs-var">TraceGovernorWakeup</span></a></span></span><span>
</span><span id="line-635"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceChurnWait"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceChurnWait"><span class="hs-identifier hs-var">TraceChurnWait</span></a></span></span><span>          </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-636"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span id="TraceChurnMode"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceChurnMode"><span class="hs-identifier hs-var">TraceChurnMode</span></a></span></span><span>          </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#ChurnMode"><span class="hs-identifier hs-type">ChurnMode</span></a></span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679252685"><span id="local-6989586621679252687"><span id="local-6989586621679252689"><span class="annot"><span class="annottext">Int -&gt; TracePeerSelection peeraddr -&gt; ShowS
[TracePeerSelection peeraddr] -&gt; ShowS
TracePeerSelection peeraddr -&gt; String
(Int -&gt; TracePeerSelection peeraddr -&gt; ShowS)
-&gt; (TracePeerSelection peeraddr -&gt; String)
-&gt; ([TracePeerSelection peeraddr] -&gt; ShowS)
-&gt; Show (TracePeerSelection peeraddr)
forall peeraddr.
(Show peeraddr, Ord peeraddr) =&gt;
Int -&gt; TracePeerSelection peeraddr -&gt; ShowS
forall peeraddr.
(Show peeraddr, Ord peeraddr) =&gt;
[TracePeerSelection peeraddr] -&gt; ShowS
forall peeraddr.
(Show peeraddr, Ord peeraddr) =&gt;
TracePeerSelection peeraddr -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [TracePeerSelection peeraddr] -&gt; ShowS
$cshowList :: forall peeraddr.
(Show peeraddr, Ord peeraddr) =&gt;
[TracePeerSelection peeraddr] -&gt; ShowS
show :: TracePeerSelection peeraddr -&gt; String
$cshow :: forall peeraddr.
(Show peeraddr, Ord peeraddr) =&gt;
TracePeerSelection peeraddr -&gt; String
showsPrec :: Int -&gt; TracePeerSelection peeraddr -&gt; ShowS
$cshowsPrec :: forall peeraddr.
(Show peeraddr, Ord peeraddr) =&gt;
Int -&gt; TracePeerSelection peeraddr -&gt; ShowS
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span class="hs-keyword">data</span><span> </span><span id="DebugPeerSelection"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#DebugPeerSelection"><span class="hs-identifier hs-var">DebugPeerSelection</span></a></span></span><span> </span><span id="local-6989586621679252684"><span class="annot"><a href="#local-6989586621679252684"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-640"></span><span>  </span><span id="TraceGovernorState"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#TraceGovernorState"><span class="hs-identifier hs-var">TraceGovernorState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252682"><span class="annot"><a href="#local-6989586621679252682"><span class="hs-identifier hs-type">peeraddr</span></a></span></span><span> </span><span id="local-6989586621679252681"><span class="annot"><a href="#local-6989586621679252681"><span class="hs-identifier hs-type">peerconn</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-641"></span><span>                        </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252681"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-642"></span><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Time</span></span><span>            </span><span class="hs-comment">-- blocked time</span><span>
</span><span id="line-643"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>  </span><span class="hs-comment">-- wait time</span><span>
</span><span id="line-644"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#PeerSelectionState"><span class="hs-identifier hs-type">PeerSelectionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252682"><span class="hs-identifier hs-type">peeraddr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252681"><span class="hs-identifier hs-type">peerconn</span></a></span><span>
</span><span id="line-645"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#DebugPeerSelection"><span class="hs-identifier hs-type">DebugPeerSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252682"><span class="hs-identifier hs-type">peeraddr</span></a></span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span id="local-6989586621679252674"><span id="local-6989586621679252676"><span id="local-6989586621679252678"><span id="local-6989586621679252680"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252680"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252680"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#DebugPeerSelection"><span class="hs-identifier hs-type">DebugPeerSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252680"><span class="hs-identifier hs-type">peeraddr</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span class="hs-keyword">data</span><span> </span><span id="ChurnMode"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#ChurnMode"><span class="hs-identifier hs-var">ChurnMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ChurnModeBulkSync"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#ChurnModeBulkSync"><span class="hs-identifier hs-var">ChurnModeBulkSync</span></a></span></span><span>
</span><span id="line-651"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span id="ChurnModeNormal"><span class="annot"><a href="Ouroboros.Network.PeerSelection.Governor.Types.html#ChurnModeNormal"><span class="hs-identifier hs-var">ChurnModeNormal</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679252666"><span id="local-6989586621679252668"><span id="local-6989586621679252670"><span class="annot"><span class="annottext">Int -&gt; ChurnMode -&gt; ShowS
[ChurnMode] -&gt; ShowS
ChurnMode -&gt; String
(Int -&gt; ChurnMode -&gt; ShowS)
-&gt; (ChurnMode -&gt; String)
-&gt; ([ChurnMode] -&gt; ShowS)
-&gt; Show ChurnMode
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ChurnMode] -&gt; ShowS
$cshowList :: [ChurnMode] -&gt; ShowS
show :: ChurnMode -&gt; String
$cshow :: ChurnMode -&gt; String
showsPrec :: Int -&gt; ChurnMode -&gt; ShowS
$cshowsPrec :: Int -&gt; ChurnMode -&gt; ShowS
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span></pre></body></html>