<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ouroboros.Network.BlockFetch.Client</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ouroboros-network-0.4.0.1: A networking layer for the Ouroboros blockchain protocol</span><ul class="links" id="page-menu"><li><a href="src/Ouroboros.Network.BlockFetch.Client.html">Source</a></li><li><a href="&quot;../index.html&quot;">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ouroboros.Network.BlockFetch.Client</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Block fetch protocol client implementation</a></li><li><a href="#g:2">Exception types</a></li></ul></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:blockFetchClient">blockFetchClient</a> &#8759; &#8704; header block versionNumber m. (MonadSTM m, MonadThrow m, MonadTime m, <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:HasHeader" title="Ouroboros.Network.Block">HasHeader</a> header, <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:HasHeader" title="Ouroboros.Network.Block">HasHeader</a> block, <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:HeaderHash" title="Ouroboros.Network.Block">HeaderHash</a> header ~ <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:HeaderHash" title="Ouroboros.Network.Block">HeaderHash</a> block) &#8658; versionNumber &#8594; <a href="Ouroboros-Network-NodeToNode.html#t:ControlMessageSTM" title="Ouroboros.Network.NodeToNode">ControlMessageSTM</a> m &#8594; <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-PeerSelection-PeerMetric-Type.html#t:FetchedMetricsTracer" title="Ouroboros.Network.PeerSelection.PeerMetric.Type">FetchedMetricsTracer</a> m &#8594; <a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchClientContext" title="Ouroboros.Network.BlockFetch.Client">FetchClientContext</a> header block m &#8594; PeerPipelined (<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-protocols-0.3.0.0/noopt/doc/html/ouroboros-network-protocols/Ouroboros-Network-Protocol-BlockFetch-Type.html#t:BlockFetch" title="Ouroboros.Network.Protocol.BlockFetch.Type">BlockFetch</a> block (<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> block)) AsClient <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-protocols-0.3.0.0/noopt/doc/html/ouroboros-network-protocols/Ouroboros-Network-Protocol-BlockFetch-Type.html#v:BFIdle" title="Ouroboros.Network.Protocol.BlockFetch.Type">BFIdle</a> m ()</li><li class="src short"><span class="keyword">type</span> <a href="#t:BlockFetchClient">BlockFetchClient</a> header block m a = <a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchClientContext" title="Ouroboros.Network.BlockFetch.Client">FetchClientContext</a> header block m &#8594; PeerPipelined (<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-protocols-0.3.0.0/noopt/doc/html/ouroboros-network-protocols/Ouroboros-Network-Protocol-BlockFetch-Type.html#t:BlockFetch" title="Ouroboros.Network.Protocol.BlockFetch.Type">BlockFetch</a> block (<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> block)) AsClient <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-protocols-0.3.0.0/noopt/doc/html/ouroboros-network-protocols/Ouroboros-Network-Protocol-BlockFetch-Type.html#v:BFIdle" title="Ouroboros.Network.Protocol.BlockFetch.Type">BFIdle</a> m a</li><li class="src short"><span class="keyword">data</span> <a href="#t:FetchClientContext">FetchClientContext</a> header block m</li><li class="src short"><span class="keyword">data</span> <a href="#t:TraceFetchClientState">TraceFetchClientState</a> header</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:FetchRequest">FetchRequest</a> header = <a href="#v:FetchRequest">FetchRequest</a> {<ul class="subs"><li><a href="#v:fetchRequestFragments">fetchRequestFragments</a> &#8759; [<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header]</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:FetchClientStateVars">FetchClientStateVars</a> m header</li><li class="src short"><span class="keyword">data</span> <a href="#t:BlockFetchProtocolFailure">BlockFetchProtocolFailure</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Block fetch protocol client implementation</h1></a><div class="top"><p class="src"><a id="v:blockFetchClient" class="def">blockFetchClient</a> &#8759; &#8704; header block versionNumber m. (MonadSTM m, MonadThrow m, MonadTime m, <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:HasHeader" title="Ouroboros.Network.Block">HasHeader</a> header, <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:HasHeader" title="Ouroboros.Network.Block">HasHeader</a> block, <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:HeaderHash" title="Ouroboros.Network.Block">HeaderHash</a> header ~ <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:HeaderHash" title="Ouroboros.Network.Block">HeaderHash</a> block) &#8658; versionNumber &#8594; <a href="Ouroboros-Network-NodeToNode.html#t:ControlMessageSTM" title="Ouroboros.Network.NodeToNode">ControlMessageSTM</a> m &#8594; <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-PeerSelection-PeerMetric-Type.html#t:FetchedMetricsTracer" title="Ouroboros.Network.PeerSelection.PeerMetric.Type">FetchedMetricsTracer</a> m &#8594; <a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchClientContext" title="Ouroboros.Network.BlockFetch.Client">FetchClientContext</a> header block m &#8594; PeerPipelined (<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-protocols-0.3.0.0/noopt/doc/html/ouroboros-network-protocols/Ouroboros-Network-Protocol-BlockFetch-Type.html#t:BlockFetch" title="Ouroboros.Network.Protocol.BlockFetch.Type">BlockFetch</a> block (<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> block)) AsClient <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-protocols-0.3.0.0/noopt/doc/html/ouroboros-network-protocols/Ouroboros-Network-Protocol-BlockFetch-Type.html#v:BFIdle" title="Ouroboros.Network.Protocol.BlockFetch.Type">BFIdle</a> m () <a href="src/Ouroboros.Network.BlockFetch.Client.html#blockFetchClient" class="link">Source</a> <a href="#v:blockFetchClient" class="selflink">#</a></p><div class="doc"><p>The implementation of the client side of block fetch protocol designed to
 work in conjunction with our fetch logic.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:BlockFetchClient" class="def">BlockFetchClient</a> header block m a = <a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchClientContext" title="Ouroboros.Network.BlockFetch.Client">FetchClientContext</a> header block m &#8594; PeerPipelined (<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-protocols-0.3.0.0/noopt/doc/html/ouroboros-network-protocols/Ouroboros-Network-Protocol-BlockFetch-Type.html#t:BlockFetch" title="Ouroboros.Network.Protocol.BlockFetch.Type">BlockFetch</a> block (<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:Point" title="Ouroboros.Network.Block">Point</a> block)) AsClient <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-protocols-0.3.0.0/noopt/doc/html/ouroboros-network-protocols/Ouroboros-Network-Protocol-BlockFetch-Type.html#v:BFIdle" title="Ouroboros.Network.Protocol.BlockFetch.Type">BFIdle</a> m a <a href="src/Ouroboros.Network.BlockFetch.Client.html#BlockFetchClient" class="link">Source</a> <a href="#t:BlockFetchClient" class="selflink">#</a></p><div class="doc"><p>TODO: use a fetch client wrapper type rather than the raw
         PeerPipelined, and eliminate this alias. It is only here
         to avoid large types leaking into the consensus layer.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:FetchClientContext" class="def">FetchClientContext</a> header block m <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#FetchClientContext" class="link">Source</a> <a href="#t:FetchClientContext" class="selflink">#</a></p><div class="doc"><p>The context that is passed into the block fetch protocol client when it
 is started.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:TraceFetchClientState" class="def">TraceFetchClientState</a> header <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#TraceFetchClientState" class="link">Source</a> <a href="#t:TraceFetchClientState" class="selflink">#</a></p><div class="doc"><p>Tracing types for the various events that change the state
 (i.e. <code><a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchClientStateVars" title="Ouroboros.Network.BlockFetch.Client">FetchClientStateVars</a></code>) for a block fetch client.</p><p>Note that while these are all state changes, the <code><a href="Ouroboros-Network-BlockFetch-ClientState.html#v:AddedFetchRequest" title="Ouroboros.Network.BlockFetch.ClientState">AddedFetchRequest</a></code> occurs
 in the decision thread while the other state changes occur in the block
 fetch client threads.</p></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:TraceFetchClientState">Instances</h4><details id="i:TraceFetchClientState" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:TraceFetchClientState:Show:1"></span> (<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:StandardHash" title="Ouroboros.Network.Block">StandardHash</a> header, <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:Show" title="Text.Show">Show</a> header) &#8658; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Ouroboros-Network-BlockFetch-Client.html#t:TraceFetchClientState" title="Ouroboros.Network.BlockFetch.Client">TraceFetchClientState</a> header)</span> <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#line-426" class="link">Source</a> <a href="#t:TraceFetchClientState" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:TraceFetchClientState:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ClientState.html">Ouroboros.Network.BlockFetch.ClientState</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Ouroboros-Network-BlockFetch-Client.html#t:TraceFetchClientState" title="Ouroboros.Network.BlockFetch.Client">TraceFetchClientState</a> header &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Ouroboros-Network-BlockFetch-Client.html#t:TraceFetchClientState" title="Ouroboros.Network.BlockFetch.Client">TraceFetchClientState</a> header &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Ouroboros-Network-BlockFetch-Client.html#t:TraceFetchClientState" title="Ouroboros.Network.BlockFetch.Client">TraceFetchClientState</a> header] &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:FetchRequest" class="def">FetchRequest</a> header <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#FetchRequest" class="link">Source</a> <a href="#t:FetchRequest" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:FetchRequest" class="def">FetchRequest</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:fetchRequestFragments" class="def">fetchRequestFragments</a> &#8759; [<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-AnchoredFragment.html#t:AnchoredFragment" title="Ouroboros.Network.AnchoredFragment">AnchoredFragment</a> header]</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:FetchRequest">Instances</h4><details id="i:FetchRequest" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FetchRequest:Show:1"></span> (<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:StandardHash" title="Ouroboros.Network.Block">StandardHash</a> header, <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:Show" title="Text.Show">Show</a> header) &#8658; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.Client">FetchRequest</a> header)</span> <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#line-320" class="link">Source</a> <a href="#t:FetchRequest" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FetchRequest:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ClientState.html">Ouroboros.Network.BlockFetch.ClientState</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.Client">FetchRequest</a> header &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.Client">FetchRequest</a> header &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.Client">FetchRequest</a> header] &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FetchRequest:Semigroup:2"></span> <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/Ouroboros-Network-Block.html#t:HasHeader" title="Ouroboros.Network.Block">HasHeader</a> header &#8658; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Prelude.html#t:Semigroup" title="Prelude">Semigroup</a> (<a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.Client">FetchRequest</a> header)</span> <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#line-340" class="link">Source</a> <a href="#t:FetchRequest" class="selflink">#</a></td><td class="doc"><p>We sometimes have the opportunity to merge fetch request fragments to
 reduce the number of separate range request messages that we send. We send
 one message per fragment. It is better to send fewer requests for bigger
 ranges, rather than lots of requests for small ranges.</p><p>We never expect fetch requests to overlap (ie have blocks in common) but we
 do expect a common case that requests will &quot;touch&quot; so that two ranges
 could be merged into a single contiguous range.</p><p>This semigroup instance implements this merging when possible, otherwise the
 two lists of fragments are just appended.</p><p>A consequence of merging and sending fewer request messages is that tracking
 the number of requests in-flight a bit more subtle. To track this accurately
 we have to look at the <em>old request</em> as well a the updated request after any
 merging. We meed to account for the <em>difference</em> in the number of fragments
 in the existing request (if any) and in new request.</p></td></tr><tr><td colspan="2"><details id="i:id:FetchRequest:Semigroup:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-ClientState.html">Ouroboros.Network.BlockFetch.ClientState</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-60--62-">(&lt;&gt;)</a> &#8759; <a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.Client">FetchRequest</a> header &#8594; <a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.Client">FetchRequest</a> header &#8594; <a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.Client">FetchRequest</a> header <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:-60--62-" class="selflink">#</a></p><p class="src"><a href="#v:sconcat">sconcat</a> &#8759; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-List-NonEmpty.html#t:NonEmpty" title="Data.List.NonEmpty">NonEmpty</a> (<a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.Client">FetchRequest</a> header) &#8594; <a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.Client">FetchRequest</a> header <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:sconcat" class="selflink">#</a></p><p class="src"><a href="#v:stimes">stimes</a> &#8759; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Prelude.html#t:Integral" title="Prelude">Integral</a> b &#8658; b &#8594; <a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.Client">FetchRequest</a> header &#8594; <a href="Ouroboros-Network-BlockFetch-Client.html#t:FetchRequest" title="Ouroboros.Network.BlockFetch.Client">FetchRequest</a> header <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:stimes" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:FetchClientStateVars" class="def">FetchClientStateVars</a> m header <a href="src/Ouroboros.Network.BlockFetch.ClientState.html#FetchClientStateVars" class="link">Source</a> <a href="#t:FetchClientStateVars" class="selflink">#</a></p><div class="doc"><p>A set of variables shared between the block fetch logic thread and each
 thread executing the client side of the block fetch protocol. That is, these
 are the shared variables per peer. The <code>FetchClientRegistry</code> contains the
 mapping of these for all peers.</p><p>The variables are used for communicating from the protocol thread to the
 decision making thread the status of things with that peer. And in the other
 direction one shared variable is for providing new fetch requests.</p></div></div><a href="#g:2" id="g:2"><h1>Exception types</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:BlockFetchProtocolFailure" class="def">BlockFetchProtocolFailure</a> <a href="src/Ouroboros.Network.BlockFetch.Client.html#BlockFetchProtocolFailure" class="link">Source</a> <a href="#t:BlockFetchProtocolFailure" class="selflink">#</a></p><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:BlockFetchProtocolFailure">Instances</h4><details id="i:BlockFetchProtocolFailure" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:BlockFetchProtocolFailure:Eq:1"></span> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a></span> <a href="src/Ouroboros.Network.BlockFetch.Client.html#line-61" class="link">Source</a> <a href="#t:BlockFetchProtocolFailure" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:BlockFetchProtocolFailure:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-Client.html">Ouroboros.Network.BlockFetch.Client</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> &#8759; <a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a> &#8594; <a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a> &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src" class="link">Source</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> &#8759; <a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a> &#8594; <a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a> &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src" class="link">Source</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:BlockFetchProtocolFailure:Show:2"></span> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a></span> <a href="src/Ouroboros.Network.BlockFetch.Client.html#line-61" class="link">Source</a> <a href="#t:BlockFetchProtocolFailure" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:BlockFetchProtocolFailure:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-Client.html">Ouroboros.Network.BlockFetch.Client</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a> &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a> &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a>] &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:BlockFetchProtocolFailure:Exception:3"></span> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Control-Exception-Base.html#t:Exception" title="Control.Exception.Base">Exception</a> <a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a></span> <a href="src/Ouroboros.Network.BlockFetch.Client.html#line-63" class="link">Source</a> <a href="#t:BlockFetchProtocolFailure" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:BlockFetchProtocolFailure:Exception:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-BlockFetch-Client.html">Ouroboros.Network.BlockFetch.Client</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:toException">toException</a> &#8759; <a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a> &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Control-Exception-Base.html#t:SomeException" title="Control.Exception.Base">SomeException</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:toException" class="selflink">#</a></p><p class="src"><a href="#v:fromException">fromException</a> &#8759; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Control-Exception-Base.html#t:SomeException" title="Control.Exception.Base">SomeException</a> &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:fromException" class="selflink">#</a></p><p class="src"><a href="#v:displayException">displayException</a> &#8759; <a href="Ouroboros-Network-BlockFetch-Client.html#t:BlockFetchProtocolFailure" title="Ouroboros.Network.BlockFetch.Client">BlockFetchProtocolFailure</a> &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:displayException" class="selflink">#</a></p></div></details></td></tr></table></details></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.2</p></div></body></html>