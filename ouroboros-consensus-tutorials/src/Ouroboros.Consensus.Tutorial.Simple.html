<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-operator">%</span><span> </span><span class="hs-identifier">Example</span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">Implementing</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">Simple</span><span> </span><span class="hs-identifier">Protocol</span><span> </span><span class="hs-identifier">Using</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ouroborus</span><span class="hs-glyph">-</span><span class="hs-identifier">consensus</span><span class="hs-special">`</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-identifier">Generating</span><span> </span><span class="hs-identifier">Documentation</span><span> </span><span class="hs-identifier">From</span><span> </span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">File</span><span>
</span><span id="line-4"></span><span class="hs-operator">=======================================</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">written</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">markdown</span><span class="hs-operator">+</span><span class="hs-identifier">lhs</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">style</span><span> </span><span class="hs-identifier">understood</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">pandoc</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">To</span><span>
</span><span id="line-7"></span><span class="hs-identifier">generate</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">document</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">simple</span><span> </span><span class="hs-keyword">as</span><span class="hs-glyph">:</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-special">`</span><span class="hs-special">`</span><span class="hs-special">`</span><span>
</span><span id="line-10"></span><span> </span><span class="hs-identifier">pandoc</span><span> </span><span class="hs-glyph">-</span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-</span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">markdown</span><span class="hs-operator">+</span><span class="hs-identifier">lhs</span><span> </span><span class="hs-identifier">Tutorial.lhs</span><span> </span><span class="hs-glyph">-</span><span class="hs-identifier">o</span><span> </span><span class="hs-operator">&lt;</span><span class="hs-identifier">output</span><span> </span><span class="hs-identifier">file</span><span class="hs-operator">&gt;</span><span>
</span><span id="line-11"></span><span class="hs-special">`</span><span class="hs-special">`</span><span class="hs-special">`</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-identifier">Which</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">work</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">many</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">output</span><span> </span><span class="hs-identifier">types</span><span> </span><span class="hs-identifier">supported</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">pandoc</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-identifier">Introduction</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">Motivation</span><span>
</span><span id="line-17"></span><span class="hs-operator">===========================</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">example</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">compilable</span><span> </span><span class="hs-identifier">Literate</span><span> </span><span class="hs-identifier">Haskell</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-operator">.</span><span class="hs-identifier">lhs</span><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">file</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">instantiates</span><span>
</span><span id="line-20"></span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">typeclass</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">serve</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">example</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-21"></span><span class="hs-identifier">high</span><span class="hs-glyph">-</span><span class="hs-identifier">level</span><span> </span><span class="hs-identifier">concepts</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ouroboros</span><span class="hs-glyph">-</span><span class="hs-identifier">consensus</span><span class="hs-special">`</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">example</span><span> </span><span class="hs-identifier">uses</span><span> </span><span class="hs-identifier">several</span><span> </span><span class="hs-identifier">extensions</span><span class="hs-glyph">:</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unused-top-binds   #-}</span><span>
</span><span id="line-26"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-pragma">{-# LANGUAGE TypeFamilies               #-}</span><span>
</span><span id="line-27"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-pragma">{-# LANGUAGE DerivingVia                #-}</span><span>
</span><span id="line-28"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-pragma">{-# LANGUAGE DataKinds                  #-}</span><span>
</span><span id="line-29"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric              #-}</span><span>
</span><span id="line-30"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances          #-}</span><span>
</span><span id="line-31"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass             #-}</span><span>
</span><span id="line-32"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses      #-}</span><span>
</span><span id="line-33"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving         #-}</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.Tutorial.Simple</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-identifier">First</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">imports</span><span> </span><span class="hs-identifier">we'll</span><span> </span><span class="hs-identifier">need</span><span class="hs-glyph">:</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Void</span></a></span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Set</span></a></span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-42"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Word</span></a></span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word64</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word8</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Codec.Serialise</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Serialise</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">NoThunks.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NoThunks</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">OnlyCheckWhnfNamed</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Block.Abstract</span></a></span><span>
</span><span id="line-47"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">blockNo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">blockPoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">castHeaderFields</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">castPoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">BlockNo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SlotNo</span></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span class="hs-operator">&gt;</span><span>    </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">BlockConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">BlockProtocol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">CodecConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">GetHeader</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">GetPrevHash</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span class="hs-operator">&gt;</span><span>    </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Header</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">StorageConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">ChainHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">HasHeader</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">HeaderFields</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span class="hs-operator">&gt;</span><span>    </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">HeaderHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">Point</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">StandardHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Protocol.Abstract</span></a></span><span>
</span><span id="line-52"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">SecurityParam</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">ConsensusConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">ConsensusProtocol</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Ticked</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ticked</span></a></span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">TickedTrivial</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a></span><span>
</span><span id="line-55"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">BlockSupportsProtocol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">selectView</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">validateView</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Ledger.Abstract</span></a></span><span>
</span><span id="line-57"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">GetTip</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">IsLedger</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">LedgerCfg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span class="hs-operator">&gt;</span><span>    </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">LedgerResult</span></a></span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">LedgerResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">lrEvents</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">lrResult</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span class="hs-operator">&gt;</span><span>    </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">LedgerState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">ApplyBlock</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">UpdateLedger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Ledger.SupportsProtocol</span></a></span><span>
</span><span id="line-61"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">LedgerSupportsProtocol</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.Forecast</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">trivialForecast</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">Ouroboros.Consensus.HeaderValidation</span></a></span><span>
</span><span id="line-64"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">ValidateEnvelope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">BasicEnvelopeValidation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier">HasAnnTip</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-identifier">Conceptual</span><span> </span><span class="hs-identifier">Overview</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">Definitions</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">Key</span><span> </span><span class="hs-identifier">Terms</span><span>
</span><span id="line-67"></span><span class="hs-operator">================================================</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">object</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">interest</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">consensus</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-operator">**</span><span class="hs-identifier">blockchain</span><span class="hs-operator">**.</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="hs-identifier">Within</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">context</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">discussion</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">blockchain</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">linked</span><span class="hs-glyph">-</span><span class="hs-identifier">list</span><span class="hs-glyph">-</span><span class="hs-identifier">style</span><span> </span><span class="hs-identifier">chain</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-72"></span><span class="hs-operator">**</span><span class="hs-identifier">blocks</span><span class="hs-operator">**</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">but</span><span> </span><span class="hs-identifier">its</span><span> </span><span class="hs-identifier">behavior</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">subject</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">integer</span><span class="hs-glyph">-</span><span class="hs-identifier">valued</span><span> </span><span class="hs-identifier">logical</span><span> </span><span class="hs-identifier">clock</span><span>
</span><span id="line-73"></span><span class="hs-identifier">whose</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">known</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-operator">**</span><span class="hs-identifier">slot</span><span class="hs-operator">**.</span><span>  </span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">event</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">increments</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">clock</span><span> </span><span class="hs-identifier">is</span><span>
</span><span id="line-74"></span><span class="hs-identifier">called</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-operator">**</span><span class="hs-identifier">tick</span><span class="hs-operator">**.</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-identifier">Each</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">associated</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">single</span><span> </span><span class="hs-identifier">slot</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">though</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">every</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">associated</span><span>
</span><span id="line-77"></span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">No</span><span> </span><span class="hs-identifier">two</span><span> </span><span class="hs-identifier">blocks</span><span> </span><span class="hs-identifier">have</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">same</span><span> </span><span class="hs-identifier">slot</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">With</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">mind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">another</span><span> </span><span class="hs-identifier">way</span><span>
</span><span id="line-78"></span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">consider</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">structure</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">chain</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">think</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">list</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">blocks</span><span>
</span><span id="line-79"></span><span class="hs-identifier">each</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">separated</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">one</span><span> </span><span class="hs-identifier">or</span><span> </span><span class="hs-identifier">more</span><span> </span><span class="hs-identifier">ticks</span><span class="hs-operator">.</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-identifier">We</span><span> </span><span class="hs-identifier">can</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">think</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">folding</span><span> </span><span class="hs-identifier">over</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">blockchain</span><span> </span><span class="hs-identifier">structure</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">compute</span><span> </span><span class="hs-identifier">some</span><span>
</span><span id="line-82"></span><span class="hs-identifier">value</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">summarizes</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">entire</span><span> </span><span class="hs-identifier">history</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">chain</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">blocks</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">ticks</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">some</span><span>
</span><span id="line-83"></span><span class="hs-identifier">way</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">same</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-identifier">might</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">determine</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">subsequent</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">is</span><span>
</span><span id="line-84"></span><span class="hs-identifier">valid</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Computing</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">responsibility</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-operator">**</span><span class="hs-identifier">ledger</span><span class="hs-operator">**</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-85"></span><span class="hs-operator">**</span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">state</span><span class="hs-operator">**</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">computed</span><span> </span><span class="hs-identifier">value</span><span class="hs-operator">.</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-special">`</span><span class="hs-identifier">ouroborus</span><span class="hs-glyph">-</span><span class="hs-identifier">consensus</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">combines</span><span> </span><span class="hs-identifier">features</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">much</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">infrastructure</span><span> </span><span class="hs-identifier">taking</span><span>
</span><span id="line-88"></span><span class="hs-special">(</span><span class="hs-identifier">possibly</span><span> </span><span class="hs-identifier">simplified</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">views</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">blocks</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">using</span><span> </span><span class="hs-identifier">them</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">decide</span><span>
</span><span id="line-89"></span><span class="hs-identifier">between</span><span> </span><span class="hs-identifier">different</span><span> </span><span class="hs-identifier">proposed</span><span> </span><span class="hs-identifier">chains</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">implement</span><span> </span><span class="hs-identifier">eventual</span><span> </span><span class="hs-identifier">consistency</span><span> </span><span class="hs-identifier">across</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-90"></span><span class="hs-identifier">nodes</span><span class="hs-operator">.</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ticked</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">Family</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">Modeling</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">Passage</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">Time</span><span>
</span><span id="line-93"></span><span class="hs-comment">--------------------------------------------------</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-identifier">Instances</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ticked</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span class="hs-identifier">represents</span><span> </span><span class="hs-identifier">things</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">can</span><span> </span><span class="hs-identifier">evolve</span><span> </span><span class="hs-identifier">with</span><span>
</span><span id="line-96"></span><span class="hs-identifier">respect</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ticked</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">representing</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">a</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">at</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">number</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-97"></span><span class="hs-identifier">slots</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">future</span><span class="hs-operator">.</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-identifier">In</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">tutorial</span><span> </span><span class="hs-identifier">none</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">implementations</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ticked</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">especially</span><span>
</span><span id="line-100"></span><span class="hs-identifier">interesting</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">more</span><span> </span><span class="hs-identifier">or</span><span> </span><span class="hs-identifier">less</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">isomorphic</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Identity</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">functor</span><span class="hs-operator">.</span><span>
</span><span id="line-101"></span><span class="hs-identifier">Even</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">case</span><span class="hs-special">,</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ticked</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">helps</span><span> </span><span class="hs-identifier">us</span><span> </span><span class="hs-identifier">maintain</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">invariants</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">such</span><span> </span><span class="hs-keyword">as</span><span>
</span><span id="line-102"></span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">being</span><span> </span><span class="hs-identifier">important</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">at</span><span> </span><span class="hs-identifier">least</span><span> </span><span class="hs-identifier">one</span><span> </span><span class="hs-identifier">tick</span><span> </span><span class="hs-identifier">happens</span><span> </span><span class="hs-identifier">between</span><span> </span><span class="hs-identifier">blocks</span><span class="hs-operator">.</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">typeclass</span><span>
</span><span id="line-106"></span><span class="hs-operator">=================================</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">central</span><span> </span><span class="hs-identifier">abstraction</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ouroborus</span><span class="hs-glyph">-</span><span class="hs-identifier">consensus</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span>
</span><span id="line-109"></span><span class="hs-identifier">typeclass</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">This</span><span> </span><span class="hs-keyword">class</span><span> </span><span class="hs-identifier">captures</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">relationship</span><span> </span><span class="hs-identifier">between</span><span> </span><span class="hs-identifier">consensus</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">rest</span><span>
</span><span id="line-110"></span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">system</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">particular</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">ledger</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">set</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">families</span><span class="hs-operator">.</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-identifier">To</span><span> </span><span class="hs-identifier">demonstrate</span><span> </span><span class="hs-identifier">these</span><span> </span><span class="hs-identifier">relationships</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">begin</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">defining</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">simple</span><span> </span><span class="hs-identifier">protocol</span><span>
</span><span id="line-113"></span><span class="hs-identifier">creatively</span><span> </span><span class="hs-identifier">named</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-identifier">First</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">define</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-identifier">itself</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-keyword">type</span><span class="hs-glyph">-</span><span class="hs-identifier">level</span><span> </span><span class="hs-string">&quot;tag&quot;</span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">does</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">exist</span><span> </span><span class="hs-identifier">at</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-identifier">level</span><span class="hs-operator">.</span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">data</span><span> </span><span id="SP"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-var">SP</span></a></span></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">static</span><span> </span><span class="hs-identifier">configuration</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">defined</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">defining</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-121"></span><span class="hs-special">`</span><span class="hs-identifier">ConsensusConfig</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Some</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">methods</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">class</span><span>
</span><span id="line-122"></span><span class="hs-identifier">such</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">checkIsLeader</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">require</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">associated</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusConfig</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">so</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">define</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-123"></span><span class="hs-identifier">simple</span><span> </span><span class="hs-identifier">one</span><span> </span><span class="hs-identifier">here</span><span class="hs-glyph">:</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="ConsensusConfig"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ConsensusConfig</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-type">SP</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-126"></span><span class="hs-operator">&gt;</span><span>   </span><span id="SP_Config"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP_Config"><span class="hs-identifier hs-var">SP_Config</span></a></span></span><span>  </span><span class="hs-special">{</span><span> </span><span id="cfgsp_slotsLedByMe"><span class="annot"><span class="annottext">ConsensusConfig SP -&gt; Set SlotNo
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#cfgsp_slotsLedByMe"><span class="hs-identifier hs-var hs-var">cfgsp_slotsLedByMe</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-127"></span><span class="hs-operator">&gt;</span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-identifier">Next</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">instantiate</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span class="hs-glyph">:</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ConsensusProtocol</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-type">SP</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-132"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">type</span><span> </span><span id="SelectView"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">SelectView</span></a></span></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-type">SP</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BlockNo</span></span><span>
</span><span id="line-133"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-134"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">type</span><span> </span><span id="LedgerView"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">LedgerView</span></a></span></span><span>    </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-type">SP</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-136"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">type</span><span> </span><span id="IsLeader"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">IsLeader</span></a></span></span><span>      </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-type">SP</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP_IsLeader"><span class="hs-identifier hs-type">SP_IsLeader</span></a></span><span>
</span><span id="line-137"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">type</span><span> </span><span id="CanBeLeader"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">CanBeLeader</span></a></span></span><span>   </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-type">SP</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP_CanBeLeader"><span class="hs-identifier hs-type">SP_CanBeLeader</span></a></span><span>
</span><span id="line-138"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-139"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">type</span><span> </span><span id="ChainDepState"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ChainDepState</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-type">SP</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">type</span><span> </span><span id="ValidateView"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ValidateView</span></a></span></span><span>  </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-type">SP</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">type</span><span> </span><span id="ValidationErr"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">ValidationErr</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-type">SP</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span>
</span><span id="line-142"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-143"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131407"><span class="annot"><span class="annottext">checkIsLeader :: ConsensusConfig SP
-&gt; CanBeLeader SP
-&gt; SlotNo
-&gt; Ticked (ChainDepState SP)
-&gt; Maybe (IsLeader SP)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">checkIsLeader</span></a></span></span><span> </span><span id="local-6989586621679131405"><span class="annot"><span class="annottext">ConsensusConfig SP
</span><a href="#local-6989586621679131405"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="annot"><span class="annottext">CanBeLeader SP
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP_CanBeLeader"><span class="hs-identifier hs-var">SP_CanBeLeader</span></a></span><span> </span><span id="local-6989586621679131403"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679131403"><span class="hs-identifier hs-var">slot</span></a></span></span><span> </span><span id="local-6989586621679131402"><span class="annot"><span class="annottext">Ticked (ChainDepState SP)
</span><a href="#local-6989586621679131402"><span class="hs-identifier hs-var">_tcds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679131403"><span class="hs-identifier hs-var">slot</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Set SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">ConsensusConfig SP -&gt; Set SlotNo
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#cfgsp_slotsLedByMe"><span class="hs-identifier hs-var hs-var">cfgsp_slotsLedByMe</span></a></span><span> </span><span class="annot"><span class="annottext">ConsensusConfig SP
</span><a href="#local-6989586621679131405"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-145"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SP_IsLeader -&gt; Maybe SP_IsLeader
forall a. a -&gt; Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SP_IsLeader
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP_IsLeader"><span class="hs-identifier hs-var">SP_IsLeader</span></a></span><span>
</span><span id="line-146"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (IsLeader SP)
forall a. Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-147"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-148"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131399"><span class="annot"><span class="annottext">protocolSecurityParam :: ConsensusConfig SP -&gt; SecurityParam
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">protocolSecurityParam</span></a></span></span><span> </span><span id="local-6989586621679131397"><span class="annot"><span class="annottext">ConsensusConfig SP
</span><a href="#local-6989586621679131397"><span class="hs-identifier hs-var">_cfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecurityParam
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#k"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-149"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-150"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131395"><span class="annot"><span class="annottext">tickChainDepState :: ConsensusConfig SP
-&gt; Ticked (LedgerView SP)
-&gt; SlotNo
-&gt; ChainDepState SP
-&gt; Ticked (ChainDepState SP)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">tickChainDepState</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConsensusConfig SP
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ticked (LedgerView SP)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ChainDepState SP
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ticked ()
Ticked (ChainDepState SP)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">TickedTrivial</span></a></span><span>
</span><span id="line-151"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-152"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131393"><span class="annot"><span class="annottext">updateChainDepState :: ConsensusConfig SP
-&gt; ValidateView SP
-&gt; SlotNo
-&gt; Ticked (ChainDepState SP)
-&gt; Except (ValidationErr SP) (ChainDepState SP)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">updateChainDepState</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConsensusConfig SP
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ValidateView SP
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ticked (ChainDepState SP)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; ExceptT Void Identity ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-154"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131391"><span class="annot"><span class="annottext">reupdateChainDepState :: ConsensusConfig SP
-&gt; ValidateView SP
-&gt; SlotNo
-&gt; Ticked (ChainDepState SP)
-&gt; ChainDepState SP
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">reupdateChainDepState</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConsensusConfig SP
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ValidateView SP
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Ticked (ChainDepState SP)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-identifier">Finally</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">define</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">few</span><span> </span><span class="hs-identifier">extra</span><span> </span><span class="hs-identifier">things</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">instantiation</span><span class="hs-glyph">:</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">data</span><span> </span><span id="SP_CanBeLeader"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP_CanBeLeader"><span class="hs-identifier hs-var">SP_CanBeLeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SP_CanBeLeader"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP_CanBeLeader"><span class="hs-identifier hs-var">SP_CanBeLeader</span></a></span></span><span> </span><span class="hs-comment">-- Evidence that we /can/ be a leader</span><span>
</span><span id="line-159"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">data</span><span> </span><span id="SP_IsLeader"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP_IsLeader"><span class="hs-identifier hs-var">SP_IsLeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SP_IsLeader"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP_IsLeader"><span class="hs-identifier hs-var">SP_IsLeader</span></a></span></span><span>       </span><span class="hs-comment">-- Evidence that we /are/ leader</span><span>
</span><span id="line-160"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-161"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#k"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SecurityParam</span></a></span><span>
</span><span id="line-162"></span><span class="hs-operator">&gt;</span><span> </span><span id="k"><span class="annot"><span class="annottext">k :: SecurityParam
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#k"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SecurityParam :: Word64 -&gt; SecurityParam
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">SecurityParam</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">maxRollbacks :: Word64
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">maxRollbacks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-identifier">Let's</span><span> </span><span class="hs-identifier">examine</span><span> </span><span class="hs-identifier">each</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">these</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">turn</span><span class="hs-glyph">:</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-identifier">Chain</span><span> </span><span class="hs-identifier">Selection</span><span class="hs-glyph">:</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SelectView</span><span class="hs-special">`</span><span>
</span><span id="line-167"></span><span class="hs-comment">-----------------------------</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-identifier">One</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">major</span><span> </span><span class="hs-identifier">decisions</span><span> </span><span class="hs-identifier">when</span><span> </span><span class="hs-identifier">implementing</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">consensus</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">encoding</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-170"></span><span class="hs-identifier">policy</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">chain</span><span> </span><span class="hs-identifier">selection</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SelectView</span><span> </span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">represents</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">information</span><span>
</span><span id="line-171"></span><span class="hs-identifier">necessary</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">header</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">help</span><span> </span><span class="hs-identifier">make</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">decision</span><span class="hs-operator">.</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">other</span><span> </span><span class="hs-identifier">half</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">explains</span><span> </span><span class="hs-identifier">how</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SelectView</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">derived</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-174"></span><span class="hs-identifier">particular</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">expressed</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">block's</span><span> </span><span class="hs-identifier">implementation</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-175"></span><span class="hs-special">`</span><span class="hs-identifier">BlockSupportsProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">typeclass</span><span class="hs-operator">.</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">preferCandidate</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ouroboros.Consensus.Protocol.Abstract</span><span class="hs-special">`</span><span>
</span><span id="line-178"></span><span class="hs-identifier">demonstrates</span><span> </span><span class="hs-identifier">how</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">used</span><span class="hs-operator">.</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-identifier">Note</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">instantiations</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">p</span><span class="hs-special">`</span><span>
</span><span id="line-181"></span><span class="hs-identifier">consequently</span><span> </span><span class="hs-identifier">requires</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ord</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">SelectView</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-identifier">For</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">use</span><span> </span><span class="hs-identifier">only</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockNo</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">implement</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">simplest</span><span> </span><span class="hs-identifier">rule</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-184"></span><span class="hs-identifier">preferring</span><span> </span><span class="hs-identifier">longer</span><span> </span><span class="hs-identifier">chains</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">shorter</span><span> </span><span class="hs-identifier">chains</span><span class="hs-operator">.</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-identifier">Ledger</span><span> </span><span class="hs-identifier">Integration</span><span class="hs-glyph">:</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerView</span><span class="hs-special">`</span><span>
</span><span id="line-188"></span><span class="hs-comment">--------------------------------</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-identifier">Some</span><span> </span><span class="hs-identifier">decisions</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">consensus</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-identifier">needs</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">make</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">depend</span><span> </span><span class="hs-identifier">on</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-191"></span><span class="hs-identifier">ledger's</span><span> </span><span class="hs-identifier">state</span><span class="hs-special">,</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span> </span><span class="hs-identifier">blk</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">The</span><span> </span><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">required</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-192"></span><span class="hs-keyword">type</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerView</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span class="hs-operator">.</span><span class="hs-identifier">e</span><span class="hs-operator">.</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-identifier">determines</span><span> </span><span class="hs-identifier">what</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">needed</span><span class="hs-special">)</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Similar</span><span> </span><span class="hs-identifier">to</span><span>
</span><span id="line-193"></span><span class="hs-special">`</span><span class="hs-identifier">SelectView</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">projection</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span> </span><span class="hs-identifier">blk</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">into</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerView</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">exists</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-194"></span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">typeclass</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">namely</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerSupportsProtocol</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-identifier">For</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">require</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-identifier">information</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">make</span><span> </span><span class="hs-identifier">decisions</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-197"></span><span class="hs-identifier">any</span><span> </span><span class="hs-identifier">kind</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">In</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">Praos</span><span> </span><span class="hs-identifier">protocol</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerView</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">contains</span><span> </span><span class="hs-identifier">information</span><span> </span><span class="hs-identifier">about</span><span>
</span><span id="line-198"></span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">stake</span><span> </span><span class="hs-identifier">distribution</span><span> </span><span class="hs-identifier">among</span><span> </span><span class="hs-identifier">other</span><span> </span><span class="hs-identifier">things</span><span class="hs-operator">.</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-identifier">Notably</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">tickChainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">elsewhere</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-201"></span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-identifier">Protocol</span><span> </span><span class="hs-identifier">State</span><span class="hs-glyph">:</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ChainDepState</span><span class="hs-special">`</span><span class="hs-special">,</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ValidateView</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ValidationErr</span><span class="hs-special">`</span><span>
</span><span id="line-205"></span><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-special">`</span><span class="hs-identifier">ChainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">describes</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">state</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">evolves</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">chain</span><span class="hs-operator">.</span><span>
</span><span id="line-208"></span><span class="hs-identifier">Note</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Cardano</span><span> </span><span class="hs-identifier">Consensus</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">Storage</span><span> </span><span class="hs-identifier">Layer</span><span class="hs-special">]</span><span class="hs-glyph">:</span><span> </span><span class="hs-special">`</span><span class="hs-special">`</span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">referring</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-keyword">as</span><span>
</span><span id="line-209"></span><span class="hs-identifier">the</span><span class=""> &#8220;chain dependent state&#8221; to emphasize that this is state that evolves with
</span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">chain</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">indeed</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">subject</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">rollback</span><span> </span><span class="hs-identifier">when</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">switch</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">alternatives</span><span>
</span><span id="line-211"></span><span class="hs-identifier">forks</span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">distinguishes</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">chain</span><span> </span><span class="hs-identifier">independent</span><span> </span><span class="hs-identifier">state</span><span> </span><span class="hs-identifier">such</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">evolving</span><span>
</span><span id="line-212"></span><span class="hs-identifier">private</span><span> </span><span class="hs-identifier">keys</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">updated</span><span> </span><span class="hs-identifier">independently</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">blocks</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">subject</span><span> </span><span class="hs-identifier">to</span><span>
</span><span id="line-213"></span><span class="hs-identifier">rollback</span><span class="hs-operator">.</span><span class="hs-special">''</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-special">`</span><span class="hs-identifier">ValidateView</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">view'</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">header</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">providing</span><span> </span><span class="hs-identifier">enough</span><span> </span><span class="hs-identifier">information</span><span> </span><span class="hs-identifier">to</span><span>
</span><span id="line-216"></span><span class="hs-identifier">validate</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">header</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">It</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">called</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ValidateView</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">because</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">functions</span><span>
</span><span id="line-217"></span><span class="hs-identifier">used</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">compute</span><span> </span><span class="hs-identifier">new</span><span> </span><span class="hs-identifier">states</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">combination</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">prior</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ChainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">and</span><span>
</span><span id="line-218"></span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ValidateView</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">can</span><span> </span><span class="hs-identifier">_fail_</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">producing</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ValidationErr</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="hs-identifier">There</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">interesting</span><span> </span><span class="hs-identifier">constraints</span><span> </span><span class="hs-identifier">governing</span><span> </span><span class="hs-identifier">what</span><span> </span><span class="hs-identifier">can</span><span> </span><span class="hs-identifier">appropriately</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">used</span><span>
</span><span id="line-221"></span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">fulfilling</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">requirements</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ValidateView</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">particular</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">fact</span><span>
</span><span id="line-222"></span><span class="hs-identifier">that</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">instances</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">sometimes</span><span> </span><span class="hs-identifier">called</span><span> </span><span class="hs-identifier">upon</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">_prediction_</span><span>
</span><span id="line-223"></span><span class="hs-identifier">rather</span><span> </span><span class="hs-identifier">than</span><span> </span><span class="hs-identifier">just</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-identifier">summary</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">history</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">such</span><span> </span><span class="hs-identifier">may</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">able</span><span> </span><span class="hs-identifier">to</span><span>
</span><span id="line-224"></span><span class="hs-identifier">witness</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">chain</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">its</span><span> </span><span class="hs-identifier">entirety</span><span class="hs-operator">.</span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-identifier">For</span><span> </span><span class="hs-identifier">more</span><span> </span><span class="hs-identifier">details</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">see</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">definition</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-identifier">Protocol</span><span> </span><span class="hs-identifier">State</span><span class="hs-glyph">:</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">tickChainDepState</span><span class="hs-special">`</span><span class="hs-special">,</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">updateChainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">reupdateChainDepState</span><span class="hs-special">`</span><span>
</span><span id="line-230"></span><span class="hs-comment">-----------------------------------------------------------------------------------</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-identifier">These</span><span> </span><span class="hs-identifier">three</span><span> </span><span class="hs-identifier">functions</span><span> </span><span class="hs-identifier">model</span><span> </span><span class="hs-identifier">state</span><span> </span><span class="hs-identifier">transitions</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">values</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ChainDepState</span><span class="hs-special">`</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-special">`</span><span class="hs-identifier">tickChainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">computes</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">new</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ChainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">prior</span><span> </span><span class="hs-identifier">state</span><span> </span><span class="hs-identifier">though</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-235"></span><span class="hs-identifier">computation</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">models</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">logical</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">passage</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">time</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">In</span><span> </span><span class="hs-identifier">particular</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">it</span><span>
</span><span id="line-236"></span><span class="hs-identifier">evolves</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">chainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">number</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-identifier">given</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SlotNo</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">argument</span><span class="hs-operator">.</span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="hs-identifier">Unlike</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">updateChainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">cannot</span><span> </span><span class="hs-identifier">fail</span><span> </span><span class="hs-identifier">under</span><span> </span><span class="hs-identifier">normal</span><span> </span><span class="hs-identifier">circumstances</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">it</span><span>
</span><span id="line-239"></span><span class="hs-identifier">could</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">would</span><span> </span><span class="hs-identifier">mean</span><span> </span><span class="hs-identifier">there</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">failure</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">inevitable</span><span> </span><span class="hs-identifier">given</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-240"></span><span class="hs-identifier">passage</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">time</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">there</span><span> </span><span class="hs-identifier">would</span><span> </span><span class="hs-identifier">have</span><span> </span><span class="hs-identifier">been</span><span> </span><span class="hs-identifier">no</span><span> </span><span class="hs-identifier">reason</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">to</span><span>
</span><span id="line-241"></span><span class="hs-identifier">throw</span><span> </span><span class="hs-identifier">such</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-identifier">immediately</span><span class="hs-operator">.</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-special">`</span><span class="hs-identifier">updateChainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">better</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-identifier">would</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-string">&quot;applyHeader&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">computes</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">new</span><span>
</span><span id="line-244"></span><span class="hs-special">`</span><span class="hs-identifier">ChainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">prior</span><span> </span><span class="hs-identifier">state</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">needed</span><span> </span><span class="hs-identifier">view</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">header</span><span class="hs-special">,</span><span>
</span><span id="line-245"></span><span class="hs-special">`</span><span class="hs-identifier">ValidateView</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">could</span><span> </span><span class="hs-identifier">fail</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">producing</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ValidationErr</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">instead</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-246"></span><span class="hs-special">`</span><span class="hs-identifier">ChainDepState</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">`</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span class="hs-special">`</span><span class="hs-identifier">reupdateChainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">optimization</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">updateChainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">is</span><span>
</span><span id="line-249"></span><span class="hs-identifier">called</span><span> </span><span class="hs-identifier">when</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">header</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">known</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">good</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">e</span><span class="hs-operator">.</span><span class="hs-identifier">g</span><span class="hs-operator">.</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">previous</span><span> </span><span class="hs-identifier">call</span><span> </span><span class="hs-identifier">to</span><span>
</span><span id="line-250"></span><span class="hs-special">`</span><span class="hs-identifier">updateChainDepState</span><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">header</span><span> </span><span class="hs-identifier">check</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">unneeded</span><span class="hs-operator">.</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-identifier">In</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">since</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">chainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-special">`</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">these</span><span> </span><span class="hs-identifier">functions</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">not</span><span>
</span><span id="line-253"></span><span class="hs-identifier">very</span><span> </span><span class="hs-identifier">interesting</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">In</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">tickChainDepState</span><span class="hs-special">`</span><span class="hs-special">,</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">TickedTrivial</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">simply</span><span>
</span><span id="line-254"></span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ticked</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-special">`</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="hs-identifier">Leader</span><span> </span><span class="hs-identifier">Selection</span><span class="hs-glyph">:</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">IsLeader</span><span class="hs-special">`</span><span class="hs-special">,</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">CanBeLeader</span><span class="hs-special">`</span><span class="hs-special">,</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">checkIsLeader</span><span class="hs-special">`</span><span>
</span><span id="line-257"></span><span class="hs-comment">------------------------------------------------------------</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="hs-identifier">The</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">CanBeLeader</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">represents</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">ability</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">particular</span><span> </span><span class="hs-identifier">node</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-260"></span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">leader</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">slot</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Put</span><span> </span><span class="hs-identifier">another</span><span> </span><span class="hs-identifier">way</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-261"></span><span class="hs-special">`</span><span class="hs-identifier">CanBeLeader</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">particular</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">p</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">witnesses</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">potential</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">consensus</span><span>
</span><span id="line-262"></span><span class="hs-identifier">participant</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">leader</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">particular</span><span> </span><span class="hs-identifier">slot</span><span class="hs-operator">.</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-identifier">In</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">same</span><span> </span><span class="hs-identifier">way</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">IsLeader</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">witnesses</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">fact</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">particular</span><span> </span><span class="hs-identifier">node</span><span> </span><span class="hs-identifier">is</span><span>
</span><span id="line-265"></span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">leader</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">slot</span><span class="hs-operator">.</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">notion</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">leadership</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">validate</span><span> </span><span class="hs-identifier">whether</span><span> </span><span class="hs-identifier">blocks</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">correct</span><span> </span><span class="hs-identifier">with</span><span>
</span><span id="line-268"></span><span class="hs-identifier">respect</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">having</span><span> </span><span class="hs-identifier">been</span><span> </span><span class="hs-identifier">provably</span><span> </span><span class="hs-identifier">created</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">leader</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">block</span><span>
</span><span id="line-269"></span><span class="hs-identifier">appears</span><span> </span><span class="hs-keyword">in</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">However</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">what</span><span> </span><span class="hs-identifier">constitutes</span><span> </span><span class="hs-identifier">proof</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">specific</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-270"></span><span class="hs-identifier">particular</span><span> </span><span class="hs-identifier">blockchain</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">why</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">dealt</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">abstractly</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-271"></span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Generally</span><span> </span><span class="hs-identifier">values</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">CanBeLeader</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">IsLeader</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">are</span><span>
</span><span id="line-272"></span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">sort</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">cryptographic</span><span> </span><span class="hs-identifier">evidence</span><span> </span><span class="hs-identifier">substantiating</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">claim</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">leadership</span><span class="hs-operator">.</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-identifier">However</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">since</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">less</span><span> </span><span class="hs-identifier">concerned</span><span> </span><span class="hs-identifier">about</span><span> </span><span class="hs-identifier">security</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">use</span><span> </span><span class="hs-identifier">two</span><span>
</span><span id="line-275"></span><span class="hs-identifier">simple</span><span> </span><span class="hs-identifier">singleton</span><span> </span><span class="hs-identifier">types</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">nothing</span><span> </span><span class="hs-identifier">cryptographic</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">happening</span><span> </span><span class="hs-identifier">at</span><span> </span><span class="hs-identifier">all</span><span class="hs-operator">.</span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">checkIsLeader</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">uses</span><span> </span><span class="hs-identifier">these</span><span> </span><span class="hs-identifier">types</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">its</span><span> </span><span class="hs-identifier">determination</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">whether</span><span> </span><span class="hs-identifier">or</span><span>
</span><span id="line-278"></span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">node</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">leader</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">returning</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Nothing</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">node</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-279"></span><span class="hs-identifier">slot</span><span> </span><span class="hs-identifier">leader</span><span> </span><span class="hs-identifier">or</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">IsLeader</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">)</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">is</span><span class="hs-operator">.</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">implements</span><span> </span><span class="hs-identifier">leadership</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">specifying</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">static</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ProtocolConfig</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">for</span><span>
</span><span id="line-282"></span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">set</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">slots</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">particular</span><span> </span><span class="hs-identifier">node</span><span> </span><span class="hs-identifier">running</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-283"></span><span class="hs-identifier">leader</span><span class="hs-operator">.</span><span>  </span><span class="hs-special">`</span><span class="hs-identifier">checkIsLeader</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">looks</span><span> </span><span class="hs-identifier">up</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-identifier">number</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">set</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">returns</span><span>
</span><span id="line-284"></span><span class="hs-special">`</span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">SP_IsLeader</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">aka</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">IsLeader</span><span> </span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">node</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">configured</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">leader</span><span>
</span><span id="line-285"></span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">slot</span><span class="hs-operator">.</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">Security</span><span> </span><span class="hs-identifier">Parameter</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">k</span><span class="hs-special">`</span><span class="hs-glyph">:</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">protocolSecurityParam</span><span class="hs-special">`</span><span>
</span><span id="line-289"></span><span class="hs-comment">---------------------------------------------------</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">requires</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">its</span><span> </span><span class="hs-identifier">static</span><span> </span><span class="hs-identifier">configuration</span><span> </span><span class="hs-comment">-- which is to say</span><span>
</span><span id="line-292"></span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">associated</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusConfig</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">particular</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">`</span><span> </span><span class="hs-comment">--</span><span>
</span><span id="line-293"></span><span class="hs-identifier">provide</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">security</span><span> </span><span class="hs-identifier">parameter</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier">SecurityParam</span><span class="hs-special">`</span><span class="hs-special">)</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">requirement</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">embodied</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-294"></span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">protocolSecurityParam</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">method</span><span class="hs-operator">.</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="hs-identifier">For</span><span> </span><span class="hs-identifier">all</span><span> </span><span class="hs-identifier">known</span><span class="hs-operator">/</span><span class="hs-identifier">current</span><span> </span><span class="hs-identifier">protocols</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">security</span><span> </span><span class="hs-identifier">parameter</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">fixed</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">each</span><span>
</span><span id="line-297"></span><span class="hs-identifier">blockchain</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-identifier">could</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">instantiated</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">different</span><span> </span><span class="hs-identifier">k's</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">but</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">should</span><span>
</span><span id="line-298"></span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">configured</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">same</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">each</span><span> </span><span class="hs-identifier">node</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">blockchain</span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">maxRollbacks</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">field</span><span> </span><span class="hs-identifier">on</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SecurityParam</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">record</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">often</span><span> </span><span class="hs-identifier">referred</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-keyword">as</span><span>
</span><span id="line-301"></span><span class="hs-special">`</span><span class="hs-identifier">k</span><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">describes</span><span> </span><span class="hs-identifier">how</span><span> </span><span class="hs-identifier">many</span><span> </span><span class="hs-identifier">blocks</span><span> </span><span class="hs-identifier">can</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">rolled</span><span> </span><span class="hs-identifier">back</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-identifier">number</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">blocks</span><span> </span><span class="hs-identifier">greater</span><span>
</span><span id="line-302"></span><span class="hs-identifier">than</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">should</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">considered</span><span> </span><span class="hs-identifier">permanently</span><span> </span><span class="hs-identifier">part</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">chain</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">respect</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-303"></span><span class="hs-identifier">protocol</span><span class="hs-operator">.</span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-identifier">In</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">allow</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-identifier">rollback</span><span class="hs-operator">.</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="hs-identifier">Further</span><span> </span><span class="hs-identifier">reading</span><span> </span><span class="hs-identifier">about</span><span> </span><span class="hs-identifier">Consensus</span><span>
</span><span id="line-308"></span><span class="hs-comment">-------------------------------</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">class</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">dealt</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">detail</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">with</span><span>
</span><span id="line-311"></span><span class="hs-identifier">additional</span><span> </span><span class="hs-identifier">context</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Cardano</span><span> </span><span class="hs-identifier">Consensus</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">Storage</span><span>
</span><span id="line-312"></span><span class="hs-identifier">Layer</span><span class="hs-special">]</span><span class="hs-special">(</span><span class="hs-identifier">https</span><span class="hs-operator">://</span><span class="hs-identifier">hydra</span><span class="hs-operator">.</span><span class="hs-identifier">iohk</span><span class="hs-operator">.</span><span class="hs-identifier">io</span><span class="hs-operator">/</span><span class="hs-identifier">build</span><span class="hs-operator">/</span><span class="hs-number">15874054</span><span class="hs-operator">/</span><span class="hs-identifier">download</span><span class="hs-operator">/</span><span class="hs-number">1</span><span class="hs-operator">/</span><span class="hs-identifier">report</span><span class="hs-operator">.</span><span class="hs-identifier">pdf</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">report</span><span class="hs-operator">.</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ouroboros.Consensus.Protocol.Praos</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">contains</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">instantiation</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-315"></span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">Praos</span><span class="hs-operator">.</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="hs-identifier">Blocks</span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">View</span><span> </span><span class="hs-identifier">From</span><span> </span><span class="hs-identifier">Consensus</span><span>
</span><span id="line-319"></span><span class="hs-operator">===============================</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-identifier">In</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">discussion</span><span> </span><span class="hs-identifier">above</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">reader</span><span> </span><span class="hs-identifier">may</span><span> </span><span class="hs-identifier">have</span><span> </span><span class="hs-identifier">noticed</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">have</span><span> </span><span class="hs-identifier">only</span><span> </span><span class="hs-identifier">presented</span><span>
</span><span id="line-322"></span><span class="hs-identifier">_views_</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">things</span><span> </span><span class="hs-identifier">consensus</span><span> </span><span class="hs-identifier">deals</span><span> </span><span class="hs-identifier">with</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">reduce</span><span> </span><span class="hs-identifier">coupling</span><span>
</span><span id="line-323"></span><span class="hs-identifier">between</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span> </span><span class="hs-identifier">p</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-identifier">particular</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">or</span><span> </span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">implementation</span><span class="hs-operator">.</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="hs-identifier">To</span><span> </span><span class="hs-identifier">enhance</span><span> </span><span class="hs-identifier">our</span><span> </span><span class="hs-identifier">example</span><span> </span><span class="hs-identifier">we'll</span><span> </span><span class="hs-identifier">implement</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">simple</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">can</span><span> </span><span class="hs-identifier">be</span><span>
</span><span id="line-326"></span><span class="hs-identifier">used</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">logically</span><span> </span><span class="hs-identifier">keeps</span><span> </span><span class="hs-identifier">track</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">single</span><span> </span><span class="hs-identifier">number</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Each</span><span> </span><span class="hs-identifier">block</span><span>
</span><span id="line-327"></span><span class="hs-identifier">contains</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">list</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">transactions</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">either</span><span> </span><span class="hs-identifier">increment</span><span> </span><span class="hs-identifier">or</span><span> </span><span class="hs-identifier">decrement</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">number</span><span class="hs-operator">.</span><span>
</span><span id="line-328"></span><span class="hs-identifier">At</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-identifier">point</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">time</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">ledger's</span><span> </span><span class="hs-identifier">state</span><span> </span><span class="hs-identifier">can</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">thought</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">net</span><span> </span><span class="hs-identifier">effect</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">all</span><span>
</span><span id="line-329"></span><span class="hs-identifier">these</span><span> </span><span class="hs-identifier">transactions</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">other</span><span> </span><span class="hs-identifier">words</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">number</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">increment</span><span> </span><span class="hs-identifier">transactions</span><span> </span><span class="hs-identifier">minus</span><span>
</span><span id="line-330"></span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">number</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">decrement</span><span> </span><span class="hs-identifier">transactions</span><span class="hs-operator">.</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="hs-identifier">Defining</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">Block</span><span>
</span><span id="line-333"></span><span class="hs-comment">------------------</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-identifier">We'll</span><span> </span><span class="hs-identifier">start</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">defining</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">transaction</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">what</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">will</span><span>
</span><span id="line-336"></span><span class="hs-identifier">contain</span><span class="hs-glyph">:</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="hs-operator">&gt;</span><span> </span><span id="local-6989586621679131386"><span id="local-6989586621679131387"></span></span><span class="hs-keyword">data</span><span> </span><span id="Tx"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#Tx"><span class="hs-identifier hs-var">Tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Inc"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#Inc"><span class="hs-identifier hs-var">Inc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Dec"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#Dec"><span class="hs-identifier hs-var">Dec</span></a></span></span><span>
</span><span id="line-339"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679131378"><span id="local-6989586621679131380"><span id="local-6989586621679131382"><span class="annot"><span class="annottext">Int -&gt; Tx -&gt; ShowS
[Tx] -&gt; ShowS
Tx -&gt; String
(Int -&gt; Tx -&gt; ShowS)
-&gt; (Tx -&gt; String) -&gt; ([Tx] -&gt; ShowS) -&gt; Show Tx
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Tx] -&gt; ShowS
$cshowList :: [Tx] -&gt; ShowS
show :: Tx -&gt; String
$cshow :: Tx -&gt; String
showsPrec :: Int -&gt; Tx -&gt; ShowS
$cshowsPrec :: Int -&gt; Tx -&gt; ShowS
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131373"><span id="local-6989586621679131375"><span class="annot"><span class="annottext">Tx -&gt; Tx -&gt; Bool
(Tx -&gt; Tx -&gt; Bool) -&gt; (Tx -&gt; Tx -&gt; Bool) -&gt; Eq Tx
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Tx -&gt; Tx -&gt; Bool
$c/= :: Tx -&gt; Tx -&gt; Bool
== :: Tx -&gt; Tx -&gt; Bool
$c== :: Tx -&gt; Tx -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. Tx -&gt; Rep Tx x)
-&gt; (forall x. Rep Tx x -&gt; Tx) -&gt; Generic Tx
forall x. Rep Tx x -&gt; Tx
forall x. Tx -&gt; Rep Tx x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep Tx x -&gt; Tx
$cfrom :: forall x. Tx -&gt; Rep Tx x
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131361"><span id="local-6989586621679131363"><span id="local-6989586621679131365"><span id="local-6989586621679131367"><span class="annot"><span class="annottext">[Tx] -&gt; Encoding
Tx -&gt; Encoding
(Tx -&gt; Encoding)
-&gt; (forall s. Decoder s Tx)
-&gt; ([Tx] -&gt; Encoding)
-&gt; (forall s. Decoder s [Tx])
-&gt; Serialise Tx
forall s. Decoder s [Tx]
forall s. Decoder s Tx
forall a.
(a -&gt; Encoding)
-&gt; (forall s. Decoder s a)
-&gt; ([a] -&gt; Encoding)
-&gt; (forall s. Decoder s [a])
-&gt; Serialise a
decodeList :: Decoder s [Tx]
$cdecodeList :: forall s. Decoder s [Tx]
encodeList :: [Tx] -&gt; Encoding
$cencodeList :: [Tx] -&gt; Encoding
decode :: Decoder s Tx
$cdecode :: forall s. Decoder s Tx
encode :: Tx -&gt; Encoding
$cencode :: Tx -&gt; Encoding
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Serialise</span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="hs-identifier">Next</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we'll</span><span> </span><span class="hs-identifier">define</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">itself</span><span class="hs-glyph">:</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">data</span><span> </span><span id="BlockC"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-var">BlockC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-344"></span><span class="hs-operator">&gt;</span><span>   </span><span id="BlockC"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-var">BlockC</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="bc_header"><span class="annot"><span class="annottext">BlockC -&gt; Header BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#bc_header"><span class="hs-identifier hs-var hs-var">bc_header</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span>
</span><span id="line-345"></span><span class="hs-operator">&gt;</span><span>          </span><span class="hs-special">,</span><span> </span><span id="bc_body"><span class="annot"><span class="annottext">BlockC -&gt; [Tx]
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#bc_body"><span class="hs-identifier hs-var hs-var">bc_body</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-346"></span><span class="hs-operator">&gt;</span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-identifier">Which</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">say</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">just</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">header</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier">Header</span><span> </span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">followed</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">list</span><span>
</span><span id="line-349"></span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">transactions</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-special">[</span><span class="hs-identifier">Tx</span><span class="hs-special">]</span><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">we'll</span><span> </span><span class="hs-identifier">need</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">instantiate</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Header</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">family</span><span> </span><span class="hs-identifier">for</span><span>
</span><span id="line-350"></span><span class="hs-special">`</span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="hs-identifier">We'll</span><span> </span><span class="hs-identifier">deal</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Header</span><span> </span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">next</span><span> </span><span class="hs-identifier">section</span><span class="hs-operator">.</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="hs-identifier">Block</span><span> </span><span class="hs-identifier">Headers</span><span>
</span><span id="line-355"></span><span class="hs-comment">-------------</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">header</span><span> </span><span class="hs-identifier">describes</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">_structure_</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">chain</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">example</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-358"></span><span class="hs-identifier">hash</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">before</span><span> </span><span class="hs-identifier">it</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">As</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">side</span><span> </span><span class="hs-identifier">note</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">case</span><span>
</span><span id="line-359"></span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">genesis</span><span> </span><span class="hs-identifier">block</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-string">&quot;previous&quot;</span><span> </span><span class="hs-identifier">hash</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">its</span><span> </span><span class="hs-identifier">own</span><span> </span><span class="hs-identifier">hash</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">This</span><span>
</span><span id="line-360"></span><span class="hs-identifier">corresponds</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Header</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">family</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">from</span><span>
</span><span id="line-361"></span><span class="hs-special">`</span><span class="hs-identifier">Ouroboros.Consensus.Block.Abstract</span><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">we'll</span><span> </span><span class="hs-identifier">instantiate</span><span> </span><span class="hs-keyword">as</span><span class="hs-glyph">:</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="Header"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Header</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-364"></span><span class="hs-operator">&gt;</span><span>   </span><span id="HdrBlockC"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#HdrBlockC"><span class="hs-identifier hs-var">HdrBlockC</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="hbc_SlotNo"><span class="annot"><span class="annottext">Header BlockC -&gt; SlotNo
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#hbc_SlotNo"><span class="hs-identifier hs-var hs-var">hbc_SlotNo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-365"></span><span class="hs-operator">&gt;</span><span>             </span><span class="hs-special">,</span><span> </span><span id="hbc_BlockNo"><span class="annot"><span class="annottext">Header BlockC -&gt; BlockNo
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#hbc_BlockNo"><span class="hs-identifier hs-var hs-var">hbc_BlockNo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BlockNo</span></span><span>
</span><span id="line-366"></span><span class="hs-operator">&gt;</span><span>             </span><span class="hs-special">,</span><span> </span><span id="hbc_Hash"><span class="annot"><span class="annottext">Header BlockC -&gt; HeaderHash BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#hbc_Hash"><span class="hs-identifier hs-var hs-var">hbc_Hash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span>
</span><span id="line-367"></span><span class="hs-operator">&gt;</span><span>             </span><span class="hs-special">,</span><span> </span><span id="hbc_prev"><span class="annot"><span class="annottext">Header BlockC -&gt; ChainHash BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#hbc_prev"><span class="hs-identifier hs-var hs-var">hbc_prev</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">ChainHash</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span>
</span><span id="line-368"></span><span class="hs-operator">&gt;</span><span>             </span><span class="hs-special">}</span><span>
</span><span id="line-369"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679131344"><span id="local-6989586621679131346"><span id="local-6989586621679131348"><span class="annot"><span class="annottext">Int -&gt; Header BlockC -&gt; ShowS
[Header BlockC] -&gt; ShowS
Header BlockC -&gt; String
(Int -&gt; Header BlockC -&gt; ShowS)
-&gt; (Header BlockC -&gt; String)
-&gt; ([Header BlockC] -&gt; ShowS)
-&gt; Show (Header BlockC)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Header BlockC] -&gt; ShowS
$cshowList :: [Header BlockC] -&gt; ShowS
show :: Header BlockC -&gt; String
$cshow :: Header BlockC -&gt; String
showsPrec :: Int -&gt; Header BlockC -&gt; ShowS
$cshowsPrec :: Int -&gt; Header BlockC -&gt; ShowS
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131340"><span id="local-6989586621679131342"><span class="annot"><span class="annottext">Header BlockC -&gt; Header BlockC -&gt; Bool
(Header BlockC -&gt; Header BlockC -&gt; Bool)
-&gt; (Header BlockC -&gt; Header BlockC -&gt; Bool) -&gt; Eq (Header BlockC)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Header BlockC -&gt; Header BlockC -&gt; Bool
$c/= :: Header BlockC -&gt; Header BlockC -&gt; Bool
== :: Header BlockC -&gt; Header BlockC -&gt; Bool
$c== :: Header BlockC -&gt; Header BlockC -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. Header BlockC -&gt; Rep (Header BlockC) x)
-&gt; (forall x. Rep (Header BlockC) x -&gt; Header BlockC)
-&gt; Generic (Header BlockC)
forall x. Rep (Header BlockC) x -&gt; Header BlockC
forall x. Header BlockC -&gt; Rep (Header BlockC) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep (Header BlockC) x -&gt; Header BlockC
$cfrom :: forall x. Header BlockC -&gt; Rep (Header BlockC) x
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679131330"><span id="local-6989586621679131332"><span id="local-6989586621679131334"><span id="local-6989586621679131336"><span class="annot"><span class="annottext">[Header BlockC] -&gt; Encoding
Header BlockC -&gt; Encoding
(Header BlockC -&gt; Encoding)
-&gt; (forall s. Decoder s (Header BlockC))
-&gt; ([Header BlockC] -&gt; Encoding)
-&gt; (forall s. Decoder s [Header BlockC])
-&gt; Serialise (Header BlockC)
forall s. Decoder s [Header BlockC]
forall s. Decoder s (Header BlockC)
forall a.
(a -&gt; Encoding)
-&gt; (forall s. Decoder s a)
-&gt; ([a] -&gt; Encoding)
-&gt; (forall s. Decoder s [a])
-&gt; Serialise a
decodeList :: Decoder s [Header BlockC]
$cdecodeList :: forall s. Decoder s [Header BlockC]
encodeList :: [Header BlockC] -&gt; Encoding
$cencodeList :: [Header BlockC] -&gt; Encoding
decode :: Decoder s (Header BlockC)
$cdecode :: forall s. Decoder s (Header BlockC)
encode :: Header BlockC -&gt; Encoding
$cencode :: Header BlockC -&gt; Encoding
</span><a href="#local-6989586621679131330"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Serialise</span></a></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">HeaderHash</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span class="hs-identifier">describes</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">represent</span><span> </span><span class="hs-identifier">hashes</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-373"></span><span class="hs-identifier">headers</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">while</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ChainHash</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">either</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">HeaderHash</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">prior</span><span>
</span><span id="line-374"></span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">or</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Genesis</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">genesis</span><span> </span><span class="hs-identifier">block</span><span class="hs-operator">.</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="hs-identifier">Accordingly</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we'll</span><span> </span><span class="hs-identifier">instantiate</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">HeaderHash</span><span> </span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">list</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">bytes</span><span class="hs-glyph">:</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="HeaderHash"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">HeaderHash</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word8</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="hs-identifier">We'll</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">instantiate</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">empty</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">StandardHash</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">class</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">does</span><span> </span><span class="hs-identifier">nothing</span><span> </span><span class="hs-identifier">that</span><span>
</span><span id="line-381"></span><span class="hs-identifier">place</span><span> </span><span class="hs-identifier">additional</span><span> </span><span class="hs-identifier">constraints</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">already</span><span> </span><span class="hs-identifier">fulfilled</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-special">`</span><span class="hs-special">[</span><span class="hs-identifier">Word8</span><span class="hs-special">]</span><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">on</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">HeaderHash</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">StandardHash</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-identifier">Because</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Header</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">family</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">functions</span><span> </span><span class="hs-identifier">using</span><span> </span><span class="hs-identifier">instantiations</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-keyword">family</span><span>
</span><span id="line-386"></span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">know</span><span> </span><span class="hs-identifier">nothing</span><span> </span><span class="hs-identifier">about</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">structure</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">data</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">instead</span><span> </span><span class="hs-identifier">there</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">other</span><span>
</span><span id="line-387"></span><span class="hs-identifier">typeclasses</span><span> </span><span class="hs-identifier">needed</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">build</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">interface</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">derive</span><span> </span><span class="hs-identifier">things</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">needed</span><span> </span><span class="hs-identifier">from</span><span>
</span><span id="line-388"></span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">value</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">We'll</span><span> </span><span class="hs-identifier">implement</span><span> </span><span class="hs-identifier">those</span><span> </span><span class="hs-identifier">typeclasses</span><span> </span><span class="hs-identifier">next</span><span class="hs-operator">.</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="hs-identifier">Interface</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">Block</span><span> </span><span class="hs-identifier">Header</span><span>
</span><span id="line-393"></span><span class="hs-comment">-----------------------------</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="hs-operator">**</span><span class="hs-special">`</span><span class="hs-identifier">GetHeader</span><span class="hs-special">`</span><span class="hs-operator">**</span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">GetHeader</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">class</span><span> </span><span class="hs-identifier">describes</span><span> </span><span class="hs-identifier">how</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">project</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">header</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-398"></span><span class="hs-keyword">type</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Header</span><span> </span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">our</span><span> </span><span class="hs-identifier">example</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">out</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">representation</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">The</span><span>
</span><span id="line-399"></span><span class="hs-identifier">implementation</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">getHeader</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">fairly</span><span> </span><span class="hs-identifier">straightforward</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">can</span><span> </span><span class="hs-identifier">just</span><span> </span><span class="hs-identifier">use</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-400"></span><span class="hs-identifier">record</span><span> </span><span class="hs-identifier">accessor</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">bc_header</span><span class="hs-special">`</span><span class="hs-glyph">:</span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GetHeader</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-403"></span><span class="hs-operator">&gt;</span><span>    </span><span id="local-6989586621679131318"><span class="annot"><span class="annottext">getHeader :: BlockC -&gt; Header BlockC
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">getHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockC -&gt; Header BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#bc_header"><span class="hs-identifier hs-var hs-var">bc_header</span></a></span><span>
</span><span id="line-404"></span><span class="hs-operator">&gt;</span><span>    </span><span id="local-6989586621679131316"><span class="annot"><span class="annottext">blockMatchesHeader :: Header BlockC -&gt; BlockC -&gt; Bool
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">blockMatchesHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Header BlockC
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BlockC
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-405"></span><span class="hs-operator">&gt;</span><span>    </span><span id="local-6989586621679131314"><span class="annot"><span class="annottext">headerIsEBB :: Header BlockC -&gt; Maybe EpochNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">headerIsEBB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe EpochNo -&gt; Header BlockC -&gt; Maybe EpochNo
forall a b. a -&gt; b -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EpochNo
forall a. Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-operator">**</span><span class="hs-special">`</span><span class="hs-identifier">GetPrevHash</span><span class="hs-special">`</span><span class="hs-operator">**</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">GetPrevHash</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">class</span><span> </span><span class="hs-identifier">contains</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">gets</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">hash</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">previous</span><span>
</span><span id="line-411"></span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">header</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">very</span><span> </span><span class="hs-identifier">simple</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Header</span><span> </span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span class="hs-glyph">:</span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GetPrevHash</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-414"></span><span class="hs-operator">&gt;</span><span>  </span><span id="local-6989586621679131307"><span class="annot"><span class="annottext">headerPrevHash :: Header BlockC -&gt; ChainHash BlockC
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">headerPrevHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Header BlockC -&gt; ChainHash BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#hbc_prev"><span class="hs-identifier hs-var hs-var">hbc_prev</span></a></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span class="hs-operator">**</span><span class="hs-special">`</span><span class="hs-identifier">HasHeader</span><span class="hs-special">`</span><span class="hs-operator">**</span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">HasHeader</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">typeclass</span><span> </span><span class="hs-identifier">has</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">getHeaderFields</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">projects</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-419"></span><span class="hs-identifier">information</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">header</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">HeaderFields</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">record</span><span> </span><span class="hs-identifier">containing</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">slot</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">block</span><span>
</span><span id="line-420"></span><span class="hs-identifier">number</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">hash</span><span class="hs-operator">.</span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="hs-identifier">We</span><span> </span><span class="hs-identifier">implement</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">both</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Header</span><span> </span><span class="hs-identifier">Block</span><span class="hs-special">`</span><span class="hs-glyph">:</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">HasHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-425"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131301"><span class="annot"><span class="annottext">getHeaderFields :: Header BlockC -&gt; HeaderFields (Header BlockC)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">getHeaderFields</span></a></span></span><span> </span><span id="local-6989586621679131299"><span class="annot"><span class="annottext">Header BlockC
</span><a href="#local-6989586621679131299"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderFields :: forall b. SlotNo -&gt; BlockNo -&gt; HeaderHash b -&gt; HeaderFields b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">HeaderFields</span></a></span><span>
</span><span id="line-426"></span><span class="hs-operator">&gt;</span><span>                          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">headerFieldSlot :: SlotNo
</span><a href="#local-6989586621679131297"><span class="hs-identifier hs-var">headerFieldSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Header BlockC -&gt; SlotNo
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#hbc_SlotNo"><span class="hs-identifier hs-var hs-var">hbc_SlotNo</span></a></span><span> </span><span class="annot"><span class="annottext">Header BlockC
</span><a href="#local-6989586621679131299"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-427"></span><span class="hs-operator">&gt;</span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">headerFieldBlockNo :: BlockNo
</span><a href="#local-6989586621679131296"><span class="hs-identifier hs-var">headerFieldBlockNo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Header BlockC -&gt; BlockNo
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#hbc_BlockNo"><span class="hs-identifier hs-var hs-var">hbc_BlockNo</span></a></span><span> </span><span class="annot"><span class="annottext">Header BlockC
</span><a href="#local-6989586621679131299"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-428"></span><span class="hs-operator">&gt;</span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">headerFieldHash :: HeaderHash (Header BlockC)
</span><a href="#local-6989586621679131295"><span class="hs-identifier hs-var">headerFieldHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Header BlockC -&gt; HeaderHash BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#hbc_Hash"><span class="hs-identifier hs-var hs-var">hbc_Hash</span></a></span><span> </span><span class="annot"><span class="annottext">Header BlockC
</span><a href="#local-6989586621679131299"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-429"></span><span class="hs-operator">&gt;</span><span>                          </span><span class="hs-special">}</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-identifier">As</span><span> </span><span class="hs-identifier">well</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">itself</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">calls</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">getHeaderFields</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">defined</span><span> </span><span class="hs-identifier">for</span><span>
</span><span id="line-432"></span><span class="hs-special">`</span><span class="hs-identifier">Header</span><span> </span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span class="hs-glyph">:</span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">HasHeader</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-435"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131291"><span class="annot"><span class="annottext">getHeaderFields :: BlockC -&gt; HeaderFields BlockC
</span><a href="#local-6989586621679131291"><span class="hs-identifier hs-var hs-var hs-var hs-var">getHeaderFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HeaderFields (Header BlockC) -&gt; HeaderFields BlockC
forall b b'.
(HeaderHash b ~ HeaderHash b') =&gt;
HeaderFields b -&gt; HeaderFields b'
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">castHeaderFields</span></a></span><span>
</span><span id="line-436"></span><span class="hs-operator">&gt;</span><span>                   </span><span class="annot"><span class="annottext">(HeaderFields (Header BlockC) -&gt; HeaderFields BlockC)
-&gt; (BlockC -&gt; HeaderFields (Header BlockC))
-&gt; BlockC
-&gt; HeaderFields BlockC
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Header BlockC -&gt; HeaderFields (Header BlockC)
forall b. HasHeader b =&gt; b -&gt; HeaderFields b
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">getHeaderFields</span></a></span><span>
</span><span id="line-437"></span><span class="hs-operator">&gt;</span><span>                   </span><span class="annot"><span class="annottext">(Header BlockC -&gt; HeaderFields (Header BlockC))
-&gt; (BlockC -&gt; Header BlockC)
-&gt; BlockC
-&gt; HeaderFields (Header BlockC)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">BlockC -&gt; Header BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#bc_header"><span class="hs-identifier hs-var hs-var">bc_header</span></a></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="hs-operator">**</span><span class="hs-identifier">Validation</span><span class="hs-operator">**</span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span class="hs-identifier">These</span><span> </span><span class="hs-identifier">classes</span><span> </span><span class="hs-identifier">require</span><span> </span><span class="hs-identifier">implementation</span><span> </span><span class="hs-identifier">but</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">tutorial</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">don't</span><span> </span><span class="hs-identifier">really</span><span> </span><span class="hs-identifier">need</span><span>
</span><span id="line-442"></span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">deal</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">them</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">so</span><span> </span><span class="hs-identifier">we'll</span><span> </span><span class="hs-identifier">leave</span><span> </span><span class="hs-identifier">them</span><span> </span><span class="hs-identifier">empty</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">now</span><span class="hs-glyph">:</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679131282"><span id="local-6989586621679131284"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">HasAnnTip</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-445"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679131274"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ValidateEnvelope</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span></span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-446"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679131263"><span id="local-6989586621679131265"><span id="local-6989586621679131267"><span id="local-6989586621679131269"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BasicEnvelopeValidation</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="hs-identifier">Associating</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">Block</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">Protocol</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockSupportsProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockProtocol</span><span class="hs-special">`</span><span>
</span><span id="line-449"></span><span class="hs-comment">------------------------------------------------------------------------------------</span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span class="hs-identifier">So</span><span> </span><span class="hs-identifier">far</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we've</span><span> </span><span class="hs-identifier">made</span><span> </span><span class="hs-identifier">no</span><span> </span><span class="hs-identifier">mention</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">definitions</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">-</span><span>
</span><span id="line-452"></span><span class="hs-identifier">similarly</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we've</span><span> </span><span class="hs-identifier">made</span><span> </span><span class="hs-identifier">no</span><span> </span><span class="hs-identifier">mention</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">definitions</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span>
</span><span id="line-453"></span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">have</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">implement</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">few</span><span> </span><span class="hs-identifier">more</span><span> </span><span class="hs-identifier">typeclasses</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">define</span><span> </span><span class="hs-identifier">how</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">two</span><span> </span><span class="hs-identifier">are</span><span>
</span><span id="line-454"></span><span class="hs-identifier">associated</span><span class="hs-operator">.</span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="hs-identifier">More</span><span> </span><span class="hs-identifier">generally</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">has</span><span> </span><span class="hs-identifier">one</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">only</span><span> </span><span class="hs-identifier">one</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">but</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">converse</span><span>
</span><span id="line-457"></span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">true</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-identifier">may</span><span> </span><span class="hs-identifier">have</span><span> </span><span class="hs-identifier">many</span><span> </span><span class="hs-identifier">types</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">block</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">As</span><span> </span><span class="hs-identifier">such</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">association</span><span>
</span><span id="line-458"></span><span class="hs-identifier">between</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">two</span><span> </span><span class="hs-identifier">specifies</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">particular</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">block</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">The</span><span> </span><span class="hs-keyword">type</span><span>
</span><span id="line-459"></span><span class="hs-keyword">family</span><span> </span><span class="hs-identifier">establishing</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">relationship</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">family</span><span class="hs-operator">.</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span class="hs-identifier">Here</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">define</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span class="hs-glyph">:</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="BlockProtocol"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">BlockProtocol</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-type">SP</span></a></span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span class="hs-identifier">Also</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">other</span><span> </span><span class="hs-identifier">half</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ValidateView</span><span> </span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">needs</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">defined</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">well</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">is</span><span>
</span><span id="line-466"></span><span class="hs-identifier">how</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">create</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ValidateView</span><span> </span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">given</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">To</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">this</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we</span><span>
</span><span id="line-467"></span><span class="hs-identifier">instantiate</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockSupportsProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">typeclass</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Note</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">need</span><span> </span><span class="hs-identifier">to</span><span>
</span><span id="line-468"></span><span class="hs-identifier">say</span><span> </span><span class="hs-identifier">_which_</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">supported</span><span> </span><span class="hs-identifier">since</span><span> </span><span class="hs-identifier">there</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">only</span><span> </span><span class="hs-identifier">ever</span><span> </span><span class="hs-identifier">one</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-469"></span><span class="hs-identifier">block</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">again</span><span> </span><span class="hs-identifier">established</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">our</span><span> </span><span class="hs-identifier">prior</span><span> </span><span class="hs-identifier">instantiation</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockProtocol</span><span class="hs-special">`</span><span class="hs-glyph">:</span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">BlockSupportsProtocol</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-472"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131251"><span class="annot"><span class="annottext">validateView :: BlockConfig BlockC
-&gt; Header BlockC -&gt; ValidateView (BlockProtocol BlockC)
</span><a href="#local-6989586621679131251"><span class="hs-identifier hs-var hs-var hs-var hs-var">validateView</span></a></span></span><span> </span><span class="annot"><span class="annottext">BlockConfig BlockC
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Header BlockC
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131250"><span class="annot"><span class="annottext">selectView :: BlockConfig BlockC
-&gt; Header BlockC -&gt; SelectView (BlockProtocol BlockC)
</span><a href="#local-6989586621679131250"><span class="hs-identifier hs-var hs-var hs-var hs-var">selectView</span></a></span></span><span> </span><span id="local-6989586621679131249"><span class="annot"><span class="annottext">BlockConfig BlockC
</span><a href="#local-6989586621679131249"><span class="hs-identifier hs-var">_bcfg</span></a></span></span><span> </span><span id="local-6989586621679131248"><span class="annot"><span class="annottext">Header BlockC
</span><a href="#local-6989586621679131248"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Header BlockC -&gt; BlockNo
forall b. HasHeader b =&gt; b -&gt; BlockNo
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">blockNo</span></a></span><span> </span><span class="annot"><span class="annottext">Header BlockC
</span><a href="#local-6989586621679131248"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span class="hs-identifier">Given</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ValidateView</span><span> </span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-special">`</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">there</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">only</span><span> </span><span class="hs-identifier">one</span><span> </span><span class="hs-identifier">possible</span><span>
</span><span id="line-476"></span><span class="hs-identifier">implementation</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">typeclass</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Later</span><span> </span><span class="hs-identifier">examples</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">require</span><span> </span><span class="hs-identifier">more</span><span> </span><span class="hs-identifier">interesting</span><span>
</span><span id="line-477"></span><span class="hs-identifier">views</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">block</span><span class="hs-operator">.</span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span class="hs-identifier">Our</span><span> </span><span class="hs-identifier">example</span><span> </span><span class="hs-identifier">requires</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">additional</span><span> </span><span class="hs-identifier">configuration</span><span> </span><span class="hs-identifier">instances</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">defined</span><span> </span><span class="hs-glyph">-</span><span>
</span><span id="line-480"></span><span class="hs-identifier">we'll</span><span> </span><span class="hs-identifier">gloss</span><span> </span><span class="hs-identifier">over</span><span> </span><span class="hs-identifier">these</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">time</span><span> </span><span class="hs-identifier">being</span><span> </span><span class="hs-identifier">but</span><span> </span><span class="hs-identifier">they</span><span> </span><span class="hs-identifier">allow</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">additional</span><span>
</span><span id="line-481"></span><span class="hs-identifier">static</span><span> </span><span class="hs-identifier">configuration</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">different</span><span> </span><span class="hs-identifier">things</span><span> </span><span class="hs-identifier">pertaining</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">blocks</span><span class="hs-glyph">:</span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="BlockConfig"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">BlockConfig</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BCfgBlockC"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BCfgBlockC"><span class="hs-identifier hs-var">BCfgBlockC</span></a></span></span><span>
</span><span id="line-484"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. BlockConfig BlockC -&gt; Rep (BlockConfig BlockC) x)
-&gt; (forall x. Rep (BlockConfig BlockC) x -&gt; BlockConfig BlockC)
-&gt; Generic (BlockConfig BlockC)
forall x. Rep (BlockConfig BlockC) x -&gt; BlockConfig BlockC
forall x. BlockConfig BlockC -&gt; Rep (BlockConfig BlockC) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep (BlockConfig BlockC) x -&gt; BlockConfig BlockC
$cfrom :: forall x. BlockConfig BlockC -&gt; Rep (BlockConfig BlockC) x
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131237"><span id="local-6989586621679131239"><span id="local-6989586621679131241"><span class="annot"><span class="annottext">Context -&gt; BlockConfig BlockC -&gt; IO (Maybe ThunkInfo)
Proxy (BlockConfig BlockC) -&gt; String
(Context -&gt; BlockConfig BlockC -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; BlockConfig BlockC -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (BlockConfig BlockC) -&gt; String)
-&gt; NoThunks (BlockConfig BlockC)
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy (BlockConfig BlockC) -&gt; String
$cshowTypeOf :: Proxy (BlockConfig BlockC) -&gt; String
wNoThunks :: Context -&gt; BlockConfig BlockC -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; BlockConfig BlockC -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; BlockConfig BlockC -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: Context -&gt; BlockConfig BlockC -&gt; IO (Maybe ThunkInfo)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="CodecConfig"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">CodecConfig</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CCfgBlockC"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#CCfgBlockC"><span class="hs-identifier hs-var">CCfgBlockC</span></a></span></span><span>
</span><span id="line-486"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. CodecConfig BlockC -&gt; Rep (CodecConfig BlockC) x)
-&gt; (forall x. Rep (CodecConfig BlockC) x -&gt; CodecConfig BlockC)
-&gt; Generic (CodecConfig BlockC)
forall x. Rep (CodecConfig BlockC) x -&gt; CodecConfig BlockC
forall x. CodecConfig BlockC -&gt; Rep (CodecConfig BlockC) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep (CodecConfig BlockC) x -&gt; CodecConfig BlockC
$cfrom :: forall x. CodecConfig BlockC -&gt; Rep (CodecConfig BlockC) x
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131225"><span id="local-6989586621679131227"><span id="local-6989586621679131229"><span class="annot"><span class="annottext">Context -&gt; CodecConfig BlockC -&gt; IO (Maybe ThunkInfo)
Proxy (CodecConfig BlockC) -&gt; String
(Context -&gt; CodecConfig BlockC -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; CodecConfig BlockC -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (CodecConfig BlockC) -&gt; String)
-&gt; NoThunks (CodecConfig BlockC)
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy (CodecConfig BlockC) -&gt; String
$cshowTypeOf :: Proxy (CodecConfig BlockC) -&gt; String
wNoThunks :: Context -&gt; CodecConfig BlockC -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; CodecConfig BlockC -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; CodecConfig BlockC -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: Context -&gt; CodecConfig BlockC -&gt; IO (Maybe ThunkInfo)
</span><a href="#local-6989586621679131225"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="StorageConfig"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">StorageConfig</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SCfgBlockC"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SCfgBlockC"><span class="hs-identifier hs-var">SCfgBlockC</span></a></span></span><span>
</span><span id="line-488"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. StorageConfig BlockC -&gt; Rep (StorageConfig BlockC) x)
-&gt; (forall x. Rep (StorageConfig BlockC) x -&gt; StorageConfig BlockC)
-&gt; Generic (StorageConfig BlockC)
forall x. Rep (StorageConfig BlockC) x -&gt; StorageConfig BlockC
forall x. StorageConfig BlockC -&gt; Rep (StorageConfig BlockC) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep (StorageConfig BlockC) x -&gt; StorageConfig BlockC
$cfrom :: forall x. StorageConfig BlockC -&gt; Rep (StorageConfig BlockC) x
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131214"><span id="local-6989586621679131216"><span id="local-6989586621679131218"><span class="annot"><span class="annottext">Context -&gt; StorageConfig BlockC -&gt; IO (Maybe ThunkInfo)
Proxy (StorageConfig BlockC) -&gt; String
(Context -&gt; StorageConfig BlockC -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; StorageConfig BlockC -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (StorageConfig BlockC) -&gt; String)
-&gt; NoThunks (StorageConfig BlockC)
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy (StorageConfig BlockC) -&gt; String
$cshowTypeOf :: Proxy (StorageConfig BlockC) -&gt; String
wNoThunks :: Context -&gt; StorageConfig BlockC -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; StorageConfig BlockC -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; StorageConfig BlockC -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: Context -&gt; StorageConfig BlockC -&gt; IO (Maybe ThunkInfo)
</span><a href="#local-6989586621679131214"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="hs-identifier">Consensus</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">Ledger</span><span>
</span><span id="line-492"></span><span class="hs-operator">========================</span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">_ledger_</span><span> </span><span class="hs-identifier">specifies</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">state</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">system</span><span> </span><span class="hs-identifier">represented</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">blocks</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-495"></span><span class="hs-identifier">blockchain</span><span> </span><span class="hs-identifier">but</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">characterizes</span><span> </span><span class="hs-identifier">what</span><span> </span><span class="hs-identifier">transitions</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">valid</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-identifier">particular</span><span>
</span><span id="line-496"></span><span class="hs-identifier">state</span><span class="hs-operator">.</span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="hs-identifier">Below</span><span> </span><span class="hs-identifier">we'll</span><span> </span><span class="hs-identifier">define</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">group</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">typeclasses</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">together</span><span> </span><span class="hs-identifier">implement</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">simple</span><span>
</span><span id="line-499"></span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">uses</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">suitable</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">our</span><span> </span><span class="hs-identifier">consensus</span><span> </span><span class="hs-identifier">protocol</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="hs-special">`</span><span class="hs-identifier">LedgerCfg</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">Ledger</span><span> </span><span class="hs-identifier">Static</span><span> </span><span class="hs-identifier">Configuration</span><span>
</span><span id="line-503"></span><span class="hs-comment">-----------------------------------------</span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="hs-identifier">Much</span><span> </span><span class="hs-identifier">like</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">its</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusConfig</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">configuration</span><span> </span><span class="hs-keyword">class</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-506"></span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">has</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">associated</span><span> </span><span class="hs-identifier">static</span><span> </span><span class="hs-identifier">configuration</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">represented</span><span> </span><span class="hs-identifier">using</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-507"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerCfg</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">For</span><span> </span><span class="hs-identifier">our</span><span> </span><span class="hs-identifier">example</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">have</span><span> </span><span class="hs-identifier">nothing</span><span> </span><span class="hs-identifier">interesting</span><span> </span><span class="hs-identifier">to</span><span>
</span><span id="line-508"></span><span class="hs-identifier">configure</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">thus</span><span class="hs-glyph">:</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="LedgerCfg"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">LedgerCfg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">Value</span><span> </span><span class="hs-identifier">Computed</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">Blockchain</span><span>
</span><span id="line-513"></span><span class="hs-comment">----------------------------------------------------</span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-keyword">family</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">logically</span><span> </span><span class="hs-identifier">represents</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-identifier">computed</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-516"></span><span class="hs-identifier">blockchain</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Put</span><span> </span><span class="hs-identifier">another</span><span> </span><span class="hs-identifier">way</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">it's</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-identifier">derived</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">observing</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-517"></span><span class="hs-identifier">passage</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">time</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">logical</span><span> </span><span class="hs-identifier">clock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">aka</span><span> </span><span class="hs-identifier">slots</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">well</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-identifier">blocks</span><span>
</span><span id="line-518"></span><span class="hs-identifier">inhabiting</span><span> </span><span class="hs-identifier">those</span><span> </span><span class="hs-identifier">slots</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">something</span><span> </span><span class="hs-identifier">like</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">fold</span><span class="hs-operator">.</span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span class="hs-identifier">Given</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">transactions</span><span> </span><span class="hs-identifier">consist</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">incrementing</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">decrementing</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-521"></span><span class="hs-identifier">number</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">materialize</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">number</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">We'll</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">need</span><span> </span><span class="hs-identifier">to</span><span>
</span><span id="line-522"></span><span class="hs-identifier">keep</span><span> </span><span class="hs-identifier">track</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">information</span><span> </span><span class="hs-identifier">about</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">most</span><span> </span><span class="hs-identifier">recent</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">have</span><span> </span><span class="hs-identifier">seen</span><span class="hs-operator">.</span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">data</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="LedgerState"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">LedgerState</span></a></span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-525"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-526"></span><span class="hs-operator">&gt;</span><span>   </span><span id="LedgerC"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#LedgerC"><span class="hs-identifier hs-var">LedgerC</span></a></span></span><span>
</span><span id="line-527"></span><span class="hs-operator">&gt;</span><span>     </span><span class="hs-comment">-- the hash and slot number of the most recent block</span><span>
</span><span id="line-528"></span><span class="hs-operator">&gt;</span><span>     </span><span class="hs-special">{</span><span> </span><span id="lsbc_tip"><span class="annot"><span class="annottext">LedgerState BlockC -&gt; Point BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#lsbc_tip"><span class="hs-identifier hs-var hs-var">lsbc_tip</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">Point</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span>
</span><span id="line-529"></span><span class="hs-operator">&gt;</span><span>     </span><span class="hs-comment">-- the computed result of applying all the transactions</span><span>
</span><span id="line-530"></span><span class="hs-operator">&gt;</span><span>     </span><span class="hs-special">,</span><span> </span><span id="lsbc_count"><span class="annot"><span class="annottext">LedgerState BlockC -&gt; Word64
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#lsbc_count"><span class="hs-identifier hs-var hs-var">lsbc_count</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word64</span></a></span><span>
</span><span id="line-531"></span><span class="hs-operator">&gt;</span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-532"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679131203"><span id="local-6989586621679131205"><span id="local-6989586621679131207"><span class="annot"><span class="annottext">Int -&gt; LedgerState BlockC -&gt; ShowS
[LedgerState BlockC] -&gt; ShowS
LedgerState BlockC -&gt; String
(Int -&gt; LedgerState BlockC -&gt; ShowS)
-&gt; (LedgerState BlockC -&gt; String)
-&gt; ([LedgerState BlockC] -&gt; ShowS)
-&gt; Show (LedgerState BlockC)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [LedgerState BlockC] -&gt; ShowS
$cshowList :: [LedgerState BlockC] -&gt; ShowS
show :: LedgerState BlockC -&gt; String
$cshow :: LedgerState BlockC -&gt; String
showsPrec :: Int -&gt; LedgerState BlockC -&gt; ShowS
$cshowsPrec :: Int -&gt; LedgerState BlockC -&gt; ShowS
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131199"><span id="local-6989586621679131201"><span class="annot"><span class="annottext">LedgerState BlockC -&gt; LedgerState BlockC -&gt; Bool
(LedgerState BlockC -&gt; LedgerState BlockC -&gt; Bool)
-&gt; (LedgerState BlockC -&gt; LedgerState BlockC -&gt; Bool)
-&gt; Eq (LedgerState BlockC)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: LedgerState BlockC -&gt; LedgerState BlockC -&gt; Bool
$c/= :: LedgerState BlockC -&gt; LedgerState BlockC -&gt; Bool
== :: LedgerState BlockC -&gt; LedgerState BlockC -&gt; Bool
$c== :: LedgerState BlockC -&gt; LedgerState BlockC -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. LedgerState BlockC -&gt; Rep (LedgerState BlockC) x)
-&gt; (forall x. Rep (LedgerState BlockC) x -&gt; LedgerState BlockC)
-&gt; Generic (LedgerState BlockC)
forall x. Rep (LedgerState BlockC) x -&gt; LedgerState BlockC
forall x. LedgerState BlockC -&gt; Rep (LedgerState BlockC) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep (LedgerState BlockC) x -&gt; LedgerState BlockC
$cfrom :: forall x. LedgerState BlockC -&gt; Rep (LedgerState BlockC) x
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131189"><span id="local-6989586621679131191"><span id="local-6989586621679131193"><span id="local-6989586621679131195"><span class="annot"><span class="annottext">[LedgerState BlockC] -&gt; Encoding
LedgerState BlockC -&gt; Encoding
(LedgerState BlockC -&gt; Encoding)
-&gt; (forall s. Decoder s (LedgerState BlockC))
-&gt; ([LedgerState BlockC] -&gt; Encoding)
-&gt; (forall s. Decoder s [LedgerState BlockC])
-&gt; Serialise (LedgerState BlockC)
forall s. Decoder s [LedgerState BlockC]
forall s. Decoder s (LedgerState BlockC)
forall a.
(a -&gt; Encoding)
-&gt; (forall s. Decoder s a)
-&gt; ([a] -&gt; Encoding)
-&gt; (forall s. Decoder s [a])
-&gt; Serialise a
decodeList :: Decoder s [LedgerState BlockC]
$cdecodeList :: forall s. Decoder s [LedgerState BlockC]
encodeList :: [LedgerState BlockC] -&gt; Encoding
$cencodeList :: [LedgerState BlockC] -&gt; Encoding
decode :: Decoder s (LedgerState BlockC)
$cdecode :: forall s. Decoder s (LedgerState BlockC)
encode :: LedgerState BlockC -&gt; Encoding
$cencode :: LedgerState BlockC -&gt; Encoding
</span><a href="#local-6989586621679131189"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Serialise</span></a></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>
</span><span id="line-534"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Point</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">defined</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ouroboros.Network.Block</span><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">describes</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">particular</span><span>
</span><span id="line-535"></span><span class="hs-identifier">place</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">blockchain</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">pair</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">hash</span><span class="hs-operator">.</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span class="hs-special">`</span><span class="hs-identifier">Ticked</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">LedgerState</span><span> </span><span class="hs-identifier">BlockC</span><span class="hs-special">)</span><span class="hs-special">`</span><span>
</span><span id="line-538"></span><span class="hs-comment">---------------------------------------</span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span class="hs-identifier">Again</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-identifier">abstraction</span><span> </span><span class="hs-identifier">defines</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">logical</span><span> </span><span class="hs-identifier">clock</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">instances</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-541"></span><span class="hs-special">`</span><span class="hs-identifier">Ticked</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">family</span><span> </span><span class="hs-identifier">describe</span><span> </span><span class="hs-identifier">values</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">evolve</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">respect</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">logical</span><span> </span><span class="hs-identifier">clock</span><span class="hs-operator">.</span><span>
</span><span id="line-542"></span><span class="hs-identifier">As</span><span> </span><span class="hs-identifier">such</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">need</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">define</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ticked</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">our</span><span> </span><span class="hs-identifier">ledger</span><span>
</span><span id="line-543"></span><span class="hs-identifier">state</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">In</span><span> </span><span class="hs-identifier">our</span><span> </span><span class="hs-identifier">example</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">essentially</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Identity</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">functor</span><span class="hs-glyph">:</span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="Ticked"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">Ticked</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-546"></span><span class="hs-operator">&gt;</span><span>   </span><span id="TickedLedgerStateC"><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#TickedLedgerStateC"><span class="hs-identifier hs-var">TickedLedgerStateC</span></a></span></span><span>
</span><span id="line-547"></span><span class="hs-operator">&gt;</span><span>     </span><span class="hs-special">{</span><span> </span><span id="unTickedLedgerStateC"><span class="annot"><span class="annottext">Ticked (LedgerState BlockC) -&gt; LedgerState BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#unTickedLedgerStateC"><span class="hs-identifier hs-var hs-var">unTickedLedgerStateC</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-548"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679131179"><span id="local-6989586621679131181"><span id="local-6989586621679131183"><span class="annot"><span class="annottext">Int -&gt; Ticked (LedgerState BlockC) -&gt; ShowS
[Ticked (LedgerState BlockC)] -&gt; ShowS
Ticked (LedgerState BlockC) -&gt; String
(Int -&gt; Ticked (LedgerState BlockC) -&gt; ShowS)
-&gt; (Ticked (LedgerState BlockC) -&gt; String)
-&gt; ([Ticked (LedgerState BlockC)] -&gt; ShowS)
-&gt; Show (Ticked (LedgerState BlockC))
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Ticked (LedgerState BlockC)] -&gt; ShowS
$cshowList :: [Ticked (LedgerState BlockC)] -&gt; ShowS
show :: Ticked (LedgerState BlockC) -&gt; String
$cshow :: Ticked (LedgerState BlockC) -&gt; String
showsPrec :: Int -&gt; Ticked (LedgerState BlockC) -&gt; ShowS
$cshowsPrec :: Int -&gt; Ticked (LedgerState BlockC) -&gt; ShowS
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131175"><span id="local-6989586621679131177"><span class="annot"><span class="annottext">Ticked (LedgerState BlockC) -&gt; Ticked (LedgerState BlockC) -&gt; Bool
(Ticked (LedgerState BlockC)
 -&gt; Ticked (LedgerState BlockC) -&gt; Bool)
-&gt; (Ticked (LedgerState BlockC)
    -&gt; Ticked (LedgerState BlockC) -&gt; Bool)
-&gt; Eq (Ticked (LedgerState BlockC))
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Ticked (LedgerState BlockC) -&gt; Ticked (LedgerState BlockC) -&gt; Bool
$c/= :: Ticked (LedgerState BlockC) -&gt; Ticked (LedgerState BlockC) -&gt; Bool
== :: Ticked (LedgerState BlockC) -&gt; Ticked (LedgerState BlockC) -&gt; Bool
$c== :: Ticked (LedgerState BlockC) -&gt; Ticked (LedgerState BlockC) -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x.
 Ticked (LedgerState BlockC) -&gt; Rep (Ticked (LedgerState BlockC)) x)
-&gt; (forall x.
    Rep (Ticked (LedgerState BlockC)) x -&gt; Ticked (LedgerState BlockC))
-&gt; Generic (Ticked (LedgerState BlockC))
forall x.
Rep (Ticked (LedgerState BlockC)) x -&gt; Ticked (LedgerState BlockC)
forall x.
Ticked (LedgerState BlockC) -&gt; Rep (Ticked (LedgerState BlockC)) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x.
Rep (Ticked (LedgerState BlockC)) x -&gt; Ticked (LedgerState BlockC)
$cfrom :: forall x.
Ticked (LedgerState BlockC) -&gt; Rep (Ticked (LedgerState BlockC)) x
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679131165"><span id="local-6989586621679131167"><span id="local-6989586621679131169"><span id="local-6989586621679131171"><span class="annot"><span class="annottext">[Ticked (LedgerState BlockC)] -&gt; Encoding
Ticked (LedgerState BlockC) -&gt; Encoding
(Ticked (LedgerState BlockC) -&gt; Encoding)
-&gt; (forall s. Decoder s (Ticked (LedgerState BlockC)))
-&gt; ([Ticked (LedgerState BlockC)] -&gt; Encoding)
-&gt; (forall s. Decoder s [Ticked (LedgerState BlockC)])
-&gt; Serialise (Ticked (LedgerState BlockC))
forall s. Decoder s [Ticked (LedgerState BlockC)]
forall s. Decoder s (Ticked (LedgerState BlockC))
forall a.
(a -&gt; Encoding)
-&gt; (forall s. Decoder s a)
-&gt; ([a] -&gt; Encoding)
-&gt; (forall s. Decoder s [a])
-&gt; Serialise a
decodeList :: Decoder s [Ticked (LedgerState BlockC)]
$cdecodeList :: forall s. Decoder s [Ticked (LedgerState BlockC)]
encodeList :: [Ticked (LedgerState BlockC)] -&gt; Encoding
$cencodeList :: [Ticked (LedgerState BlockC)] -&gt; Encoding
decode :: Decoder s (Ticked (LedgerState BlockC))
$cdecode :: forall s. Decoder s (Ticked (LedgerState BlockC))
encode :: Ticked (LedgerState BlockC) -&gt; Encoding
$cencode :: Ticked (LedgerState BlockC) -&gt; Encoding
</span><a href="#local-6989586621679131165"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Serialise</span></a></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span class="hs-special">`</span><span class="hs-identifier">IsLedger</span><span class="hs-special">`</span><span>
</span><span id="line-552"></span><span class="hs-comment">----------</span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">IsLedger</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">class</span><span> </span><span class="hs-identifier">describes</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">basic</span><span> </span><span class="hs-identifier">functionality</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">associated</span><span>
</span><span id="line-555"></span><span class="hs-identifier">types</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">ledger</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Though</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">here</span><span> </span><span class="hs-identifier">using</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">IsLedger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-558"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="LedgerErr"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">LedgerErr</span></a></span></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span>
</span><span id="line-559"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="AuxLedgerEvent"><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">AuxLedgerEvent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span>
</span><span id="line-560"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-561"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131153"><span class="annot"><span class="annottext">applyChainTickLedgerResult :: LedgerCfg (LedgerState BlockC)
-&gt; SlotNo
-&gt; LedgerState BlockC
-&gt; LedgerResult (LedgerState BlockC) (Ticked (LedgerState BlockC))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">applyChainTickLedgerResult</span></a></span></span><span> </span><span id="local-6989586621679131151"><span class="annot"><span class="annottext">LedgerCfg (LedgerState BlockC)
</span><a href="#local-6989586621679131151"><span class="hs-identifier hs-var">_cfg</span></a></span></span><span> </span><span id="local-6989586621679131150"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679131150"><span class="hs-identifier hs-var">_slot</span></a></span></span><span> </span><span id="local-6989586621679131149"><span class="annot"><span class="annottext">LedgerState BlockC
</span><a href="#local-6989586621679131149"><span class="hs-identifier hs-var">ldgrSt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-562"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">LedgerResult :: forall l a. [AuxLedgerEvent l] -&gt; a -&gt; LedgerResult l a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerResult</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lrEvents :: [AuxLedgerEvent (LedgerState BlockC)]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">lrEvents</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-563"></span><span class="hs-operator">&gt;</span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lrResult :: Ticked (LedgerState BlockC)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">lrResult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerState BlockC -&gt; Ticked (LedgerState BlockC)
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#TickedLedgerStateC"><span class="hs-identifier hs-var">TickedLedgerStateC</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState BlockC
</span><a href="#local-6989586621679131149"><span class="hs-identifier hs-var">ldgrSt</span></a></span><span>
</span><span id="line-564"></span><span class="hs-operator">&gt;</span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerErr</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">errors</span><span> </span><span class="hs-identifier">associated</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">can</span><span>
</span><span id="line-567"></span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">thrown</span><span> </span><span class="hs-identifier">while</span><span> </span><span class="hs-identifier">applying</span><span> </span><span class="hs-identifier">blocks</span><span> </span><span class="hs-identifier">or</span><span> </span><span class="hs-identifier">transactions</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">In</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span>
</span><span id="line-568"></span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">are</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">expecting</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-identifier">errors</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">so</span><span> </span><span class="hs-identifier">we'll</span><span> </span><span class="hs-identifier">use</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Void</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">here</span><span class="hs-operator">.</span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">AuxLedgerEvent</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">describes</span><span> </span><span class="hs-identifier">events</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">can</span><span> </span><span class="hs-identifier">occur</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">output</span><span> </span><span class="hs-identifier">while</span><span>
</span><span id="line-571"></span><span class="hs-identifier">applying</span><span> </span><span class="hs-identifier">blocks</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">We</span><span> </span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">using</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">our</span><span> </span><span class="hs-identifier">example</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">such</span><span> </span><span class="hs-identifier">we</span><span>
</span><span id="line-572"></span><span class="hs-identifier">will</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">use</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Void</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">here</span><span class="hs-operator">.</span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">applyChainTickLedgerResult</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-special">'</span><span class="hs-identifier">ticks'</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span class="hs-special">`</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">resulting</span><span>
</span><span id="line-575"></span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">an</span><span> </span><span class="hs-identifier">updated</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">has</span><span> </span><span class="hs-identifier">witnessed</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">change</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">which</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">again</span><span class="hs-special">,</span><span>
</span><span id="line-576"></span><span class="hs-identifier">corresponds</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">logical</span><span> </span><span class="hs-identifier">clock</span><span class="hs-operator">.</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">Note</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">_does</span><span> </span><span class="hs-identifier">allow</span><span> </span><span class="hs-identifier">failure</span><span class="hs-operator">.</span><span class="hs-identifier">_</span><span>
</span><span id="line-577"></span><span class="hs-identifier">If</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">did</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">means</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">such</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">state</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">will</span><span>
</span><span id="line-578"></span><span class="hs-identifier">eventually</span><span> </span><span class="hs-identifier">fail</span><span> </span><span class="hs-identifier">due</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">passage</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">time</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">such</span><span> </span><span class="hs-identifier">errors</span><span> </span><span class="hs-identifier">should</span><span> </span><span class="hs-identifier">have</span><span> </span><span class="hs-identifier">been</span><span>
</span><span id="line-579"></span><span class="hs-identifier">signalled</span><span> </span><span class="hs-identifier">earlier</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">example</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">when</span><span> </span><span class="hs-identifier">applying</span><span> </span><span class="hs-identifier">blocks</span><span class="hs-operator">.</span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span class="hs-special">`</span><span class="hs-identifier">ApplyBlock</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">Applying</span><span> </span><span class="hs-identifier">Blocks</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span class="hs-special">`</span><span>
</span><span id="line-583"></span><span class="hs-comment">-----------------------------------------------</span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span class="hs-identifier">A</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">b</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">said</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">have</span><span> </span><span class="hs-identifier">been</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">applied</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">that</span><span>
</span><span id="line-586"></span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">having</span><span> </span><span class="hs-identifier">witnessed</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">b</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">at</span><span> </span><span class="hs-identifier">some</span><span> </span><span class="hs-identifier">point</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">We</span><span> </span><span class="hs-identifier">can</span><span>
</span><span id="line-587"></span><span class="hs-identifier">express</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">function</span><span class="hs-glyph">:</span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span class="hs-operator">&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#applyBlockTo"><span class="hs-identifier hs-type">applyBlockTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span>
</span><span id="line-590"></span><span class="hs-operator">&gt;</span><span> </span><span id="applyBlockTo"><span class="annot"><span class="annottext">applyBlockTo :: BlockC -&gt; Ticked (LedgerState BlockC) -&gt; LedgerState BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#applyBlockTo"><span class="hs-identifier hs-var hs-var">applyBlockTo</span></a></span></span><span> </span><span id="local-6989586621679131147"><span class="annot"><span class="annottext">BlockC
</span><a href="#local-6989586621679131147"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621679131146"><span class="annot"><span class="annottext">Ticked (LedgerState BlockC)
</span><a href="#local-6989586621679131146"><span class="hs-identifier hs-var">tickedLedgerState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-591"></span><span class="hs-operator">&gt;</span><span>   </span><span class="annot"><span class="annottext">LedgerState BlockC
R:LedgerStateBlockC
</span><a href="#local-6989586621679131145"><span class="hs-identifier hs-var">ledgerState</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lsbc_tip :: Point BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#lsbc_tip"><span class="hs-identifier hs-var">lsbc_tip</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockC -&gt; Point BlockC
forall block. HasHeader block =&gt; block -&gt; Point block
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">blockPoint</span></a></span><span> </span><span class="annot"><span class="annottext">BlockC
</span><a href="#local-6989586621679131147"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-592"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lsbc_count :: Word64
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#lsbc_count"><span class="hs-identifier hs-var">lsbc_count</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679131144"><span class="hs-identifier hs-var">lsbc_count'</span></a></span><span>
</span><span id="line-593"></span><span class="hs-operator">&gt;</span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-594"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-595"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679131145"><span class="annot"><span class="annottext">ledgerState :: LedgerState BlockC
</span><a href="#local-6989586621679131145"><span class="hs-identifier hs-var hs-var">ledgerState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ticked (LedgerState BlockC) -&gt; LedgerState BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#unTickedLedgerStateC"><span class="hs-identifier hs-var hs-var">unTickedLedgerStateC</span></a></span><span> </span><span class="annot"><span class="annottext">Ticked (LedgerState BlockC)
</span><a href="#local-6989586621679131146"><span class="hs-identifier hs-var">tickedLedgerState</span></a></span><span>
</span><span id="line-596"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679131144"><span class="annot"><span class="annottext">lsbc_count' :: Word64
</span><a href="#local-6989586621679131144"><span class="hs-identifier hs-var hs-var">lsbc_count'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Tx -&gt; Word64) -&gt; Word64 -&gt; [Tx] -&gt; Word64
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Tx -&gt; Word64
forall a. Num a =&gt; a -&gt; Tx -&gt; a
</span><a href="#local-6989586621679131142"><span class="hs-identifier hs-var">txDelta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LedgerState BlockC -&gt; Word64
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#lsbc_count"><span class="hs-identifier hs-var hs-var">lsbc_count</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState BlockC
</span><a href="#local-6989586621679131145"><span class="hs-identifier hs-var">ledgerState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockC -&gt; [Tx]
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#bc_body"><span class="hs-identifier hs-var hs-var">bc_body</span></a></span><span> </span><span class="annot"><span class="annottext">BlockC
</span><a href="#local-6989586621679131147"><span class="hs-identifier hs-var">block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span class="hs-operator">&gt;</span><span>     </span><span id="local-6989586621679131142"><span class="annot"><span class="annottext">txDelta :: a -&gt; Tx -&gt; a
</span><a href="#local-6989586621679131142"><span class="hs-identifier hs-var hs-var">txDelta</span></a></span></span><span> </span><span id="local-6989586621679131141"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679131141"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679131140"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679131140"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-598"></span><span class="hs-operator">&gt;</span><span>       </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679131140"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-599"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="annottext">Tx
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#Inc"><span class="hs-identifier hs-var">Inc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679131141"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span>
</span><span id="line-600"></span><span class="hs-operator">&gt;</span><span>         </span><span class="annot"><span class="annottext">Tx
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#Dec"><span class="hs-identifier hs-var">Dec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679131141"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span class="hs-identifier">We</span><span> </span><span class="hs-identifier">use</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ticked</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">LedgerState</span><span> </span><span class="hs-identifier">BlockC</span><span class="hs-special">)</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">enforce</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">invariant</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">should</span><span>
</span><span id="line-603"></span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">apply</span><span> </span><span class="hs-identifier">two</span><span> </span><span class="hs-identifier">blocks</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">row</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">at</span><span> </span><span class="hs-identifier">least</span><span> </span><span class="hs-identifier">one</span><span> </span><span class="hs-identifier">tick</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">aka</span><span> </span><span class="hs-identifier">slot</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">must</span><span> </span><span class="hs-identifier">have</span><span> </span><span class="hs-identifier">elapsed</span><span>
</span><span id="line-604"></span><span class="hs-identifier">between</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">applications</span><span class="hs-operator">.</span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">interface</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">rest</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">infrastructure</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">access</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">is</span><span>
</span><span id="line-608"></span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ApplyBlock</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">typeclass</span><span class="hs-glyph">:</span><span>
</span><span id="line-609"></span><span>
</span><span id="line-610"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ApplyBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-611"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131131"><span class="annot"><span class="annottext">applyBlockLedgerResult :: LedgerCfg (LedgerState BlockC)
-&gt; BlockC
-&gt; Ticked (LedgerState BlockC)
-&gt; Except
     (LedgerErr (LedgerState BlockC))
     (LedgerResult (LedgerState BlockC) (LedgerState BlockC))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">applyBlockLedgerResult</span></a></span></span><span> </span><span id="local-6989586621679131129"><span class="annot"><span class="annottext">LedgerCfg (LedgerState BlockC)
</span><a href="#local-6989586621679131129"><span class="hs-identifier hs-var">_ldgrCfg</span></a></span></span><span> </span><span id="local-6989586621679131128"><span class="annot"><span class="annottext">BlockC
</span><a href="#local-6989586621679131128"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621679131127"><span class="annot"><span class="annottext">Ticked (LedgerState BlockC)
</span><a href="#local-6989586621679131127"><span class="hs-identifier hs-var">tickedLdgrSt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-612"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">LedgerResult (LedgerState BlockC) (LedgerState BlockC)
-&gt; ExceptT
     Void
     Identity
     (LedgerResult (LedgerState BlockC) (LedgerState BlockC))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(LedgerResult (LedgerState BlockC) (LedgerState BlockC)
 -&gt; ExceptT
      Void
      Identity
      (LedgerResult (LedgerState BlockC) (LedgerState BlockC)))
-&gt; LedgerResult (LedgerState BlockC) (LedgerState BlockC)
-&gt; ExceptT
     Void
     Identity
     (LedgerResult (LedgerState BlockC) (LedgerState BlockC))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerResult :: forall l a. [AuxLedgerEvent l] -&gt; a -&gt; LedgerResult l a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerResult</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lrEvents :: [AuxLedgerEvent (LedgerState BlockC)]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">lrEvents</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-613"></span><span class="hs-operator">&gt;</span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lrResult :: LedgerState BlockC
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">lrResult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockC
</span><a href="#local-6989586621679131128"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">BlockC -&gt; Ticked (LedgerState BlockC) -&gt; LedgerState BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#applyBlockTo"><span class="hs-operator hs-var">`applyBlockTo`</span></a></span><span> </span><span class="annot"><span class="annottext">Ticked (LedgerState BlockC)
</span><a href="#local-6989586621679131127"><span class="hs-identifier hs-var">tickedLdgrSt</span></a></span><span>
</span><span id="line-614"></span><span class="hs-operator">&gt;</span><span>                         </span><span class="hs-special">}</span><span>
</span><span id="line-615"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-616"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131126"><span class="annot"><span class="annottext">reapplyBlockLedgerResult :: LedgerCfg (LedgerState BlockC)
-&gt; BlockC
-&gt; Ticked (LedgerState BlockC)
-&gt; LedgerResult (LedgerState BlockC) (LedgerState BlockC)
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">reapplyBlockLedgerResult</span></a></span></span><span> </span><span id="local-6989586621679131124"><span class="annot"><span class="annottext">LedgerCfg (LedgerState BlockC)
</span><a href="#local-6989586621679131124"><span class="hs-identifier hs-var">_ldgrCfg</span></a></span></span><span> </span><span id="local-6989586621679131123"><span class="annot"><span class="annottext">BlockC
</span><a href="#local-6989586621679131123"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621679131122"><span class="annot"><span class="annottext">Ticked (LedgerState BlockC)
</span><a href="#local-6989586621679131122"><span class="hs-identifier hs-var">tickedLdgrSt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-617"></span><span class="hs-operator">&gt;</span><span>     </span><span class="annot"><span class="annottext">LedgerResult :: forall l a. [AuxLedgerEvent l] -&gt; a -&gt; LedgerResult l a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerResult</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lrEvents :: [AuxLedgerEvent (LedgerState BlockC)]
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">lrEvents</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-618"></span><span class="hs-operator">&gt;</span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lrResult :: LedgerState BlockC
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">lrResult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockC
</span><a href="#local-6989586621679131123"><span class="hs-identifier hs-var">block</span></a></span><span> </span><span class="annot"><span class="annottext">BlockC -&gt; Ticked (LedgerState BlockC) -&gt; LedgerState BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#applyBlockTo"><span class="hs-operator hs-var">`applyBlockTo`</span></a></span><span> </span><span class="annot"><span class="annottext">Ticked (LedgerState BlockC)
</span><a href="#local-6989586621679131122"><span class="hs-identifier hs-var">tickedLdgrSt</span></a></span><span>
</span><span id="line-619"></span><span class="hs-operator">&gt;</span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-620"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-621"></span><span class="hs-operator">&gt;</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span class="hs-special">`</span><span class="hs-identifier">applyBlockLedgerResult</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tries</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">apply</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">fails</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-624"></span><span class="hs-special">`</span><span class="hs-identifier">LedgerErr</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">corresponding</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">particular</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span> </span><span class="hs-identifier">blk</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">whatever</span><span>
</span><span id="line-625"></span><span class="hs-identifier">reason</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">could</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">applied</span><span class="hs-operator">.</span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span class="hs-identifier">We</span><span> </span><span class="hs-identifier">previously</span><span> </span><span class="hs-identifier">defined</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerErr</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">`</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">This</span><span> </span><span class="hs-identifier">might</span><span> </span><span class="hs-identifier">seem</span><span> </span><span class="hs-identifier">troubling</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">for</span><span>
</span><span id="line-628"></span><span class="hs-identifier">example</span><span class="hs-special">,</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">contains</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-identifier">number</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">what</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">try</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">apply</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span>
</span><span id="line-629"></span><span class="hs-identifier">labelled</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">already</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">past</span><span class="hs-operator">?</span><span>  </span><span class="hs-identifier">However</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">something</span><span>
</span><span id="line-630"></span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">should</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">checked</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">callers</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">code</span><span class="hs-operator">.</span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span class="hs-special">`</span><span class="hs-identifier">reapplyBlockLedgerResult</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">similar</span><span> </span><span class="hs-identifier">but</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">meant</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">called</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-identifier">code</span><span> </span><span class="hs-identifier">path</span><span> </span><span class="hs-identifier">that</span><span>
</span><span id="line-633"></span><span class="hs-identifier">has</span><span> </span><span class="hs-identifier">previously</span><span> </span><span class="hs-identifier">established</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">application</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">would</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">fail</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">so</span><span> </span><span class="hs-identifier">it</span><span>
</span><span id="line-634"></span><span class="hs-identifier">admits</span><span> </span><span class="hs-identifier">no</span><span> </span><span class="hs-identifier">possibility</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">failure</span><span class="hs-operator">.</span><span>
</span><span id="line-635"></span><span>
</span><span id="line-636"></span><span class="hs-identifier">Both</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">these</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerResult</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">record</span><span> </span><span class="hs-identifier">containing</span><span> </span><span class="hs-identifier">both</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">updated</span><span> </span><span class="hs-identifier">state</span><span>
</span><span id="line-637"></span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">well</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">list</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">AuxLedgerEvent</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">LedgerState</span><span> </span><span class="hs-identifier">BlockC</span><span class="hs-special">)</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-638"></span><span class="hs-special">`</span><span class="hs-identifier">AuxLedgerEvent</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">intended</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">allow</span><span> </span><span class="hs-identifier">ledgers</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">emit</span><span> </span><span class="hs-identifier">extra</span><span> </span><span class="hs-string">&quot;events&quot;</span><span>
</span><span id="line-639"></span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">part</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">applying</span><span> </span><span class="hs-identifier">blocks</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">but</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">our</span><span> </span><span class="hs-identifier">simple</span><span> </span><span class="hs-identifier">example</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">need</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">use</span><span>
</span><span id="line-640"></span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">feature</span><span class="hs-operator">.</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span class="hs-identifier">Once</span><span> </span><span class="hs-identifier">we've</span><span> </span><span class="hs-identifier">defined</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ApplyBlock</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">can</span><span> </span><span class="hs-identifier">also</span><span> </span><span class="hs-identifier">instantiate</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">empty</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">UpdateLedger</span><span class="hs-special">`</span><span>
</span><span id="line-643"></span><span class="hs-keyword">class</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">captures</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ApplyBlock</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">relationship</span><span> </span><span class="hs-identifier">between</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">block</span><span class="hs-special">`</span><span>
</span><span id="line-644"></span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">its</span><span> </span><span class="hs-identifier">ledger</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span> </span><span class="hs-identifier">block</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">indexes</span><span> </span><span class="hs-identifier">it</span><span> </span><span class="hs-identifier">by</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">block</span><span class="hs-special">`</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">We'll</span><span> </span><span class="hs-identifier">need</span><span> </span><span class="hs-identifier">this</span><span>
</span><span id="line-645"></span><span class="hs-identifier">later</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerSupportsProtocol</span><span class="hs-special">`</span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">UpdateLedger</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span class="hs-special">`</span><span class="hs-identifier">GetTip</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">The</span><span> </span><span class="hs-identifier">Most</span><span> </span><span class="hs-identifier">Recently</span><span> </span><span class="hs-identifier">Applied</span><span> </span><span class="hs-identifier">Block</span><span>
</span><span id="line-650"></span><span class="hs-comment">------------------------------------------</span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">GetTip</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">typeclass</span><span> </span><span class="hs-identifier">describes</span><span> </span><span class="hs-identifier">how</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">get</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Point</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">tip</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">is</span><span>
</span><span id="line-653"></span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">most</span><span> </span><span class="hs-identifier">recently</span><span> </span><span class="hs-identifier">applied</span><span> </span><span class="hs-identifier">block</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">We</span><span> </span><span class="hs-identifier">need</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">implement</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">both</span><span> </span><span class="hs-identifier">for</span><span>
</span><span id="line-654"></span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span> </span><span class="hs-identifier">BlockC</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">well</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">its</span><span> </span><span class="hs-identifier">ticked</span><span> </span><span class="hs-identifier">version</span><span class="hs-glyph">:</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GetTip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-657"></span><span class="hs-operator">&gt;</span><span>    </span><span id="local-6989586621679131117"><span class="annot"><span class="annottext">getTip :: Ticked (LedgerState BlockC) -&gt; Point (Ticked (LedgerState BlockC))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">getTip</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point BlockC -&gt; Point (Ticked (LedgerState BlockC))
forall b b'.
Coercible (HeaderHash b) (HeaderHash b') =&gt;
Point b -&gt; Point b'
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">castPoint</span></a></span><span> </span><span class="annot"><span class="annottext">(Point BlockC -&gt; Point (Ticked (LedgerState BlockC)))
-&gt; (Ticked (LedgerState BlockC) -&gt; Point BlockC)
-&gt; Ticked (LedgerState BlockC)
-&gt; Point (Ticked (LedgerState BlockC))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState BlockC -&gt; Point BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#lsbc_tip"><span class="hs-identifier hs-var hs-var">lsbc_tip</span></a></span><span> </span><span class="annot"><span class="annottext">(LedgerState BlockC -&gt; Point BlockC)
-&gt; (Ticked (LedgerState BlockC) -&gt; LedgerState BlockC)
-&gt; Ticked (LedgerState BlockC)
-&gt; Point BlockC
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Ticked (LedgerState BlockC) -&gt; LedgerState BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#unTickedLedgerStateC"><span class="hs-identifier hs-var hs-var">unTickedLedgerStateC</span></a></span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">GetTip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-660"></span><span class="hs-operator">&gt;</span><span>    </span><span id="local-6989586621679131114"><span class="annot"><span class="annottext">getTip :: LedgerState BlockC -&gt; Point (LedgerState BlockC)
</span><a href="#local-6989586621679131114"><span class="hs-identifier hs-var hs-var hs-var hs-var">getTip</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point BlockC -&gt; Point (LedgerState BlockC)
forall b b'.
Coercible (HeaderHash b) (HeaderHash b') =&gt;
Point b -&gt; Point b'
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">castPoint</span></a></span><span> </span><span class="annot"><span class="annottext">(Point BlockC -&gt; Point (LedgerState BlockC))
-&gt; (LedgerState BlockC -&gt; Point BlockC)
-&gt; LedgerState BlockC
-&gt; Point (LedgerState BlockC)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState BlockC -&gt; Point BlockC
</span><a href="Ouroboros.Consensus.Tutorial.Simple.html#lsbc_tip"><span class="hs-identifier hs-var hs-var">lsbc_tip</span></a></span><span>
</span><span id="line-661"></span><span>
</span><span id="line-662"></span><span class="hs-identifier">Associating</span><span> </span><span class="hs-identifier">Ledgers</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">Protocols</span><span>
</span><span id="line-663"></span><span class="hs-comment">--------------------------------</span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span class="hs-identifier">Similar</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">blocks</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">typeclass</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">used</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">associate</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">protocol</span><span class="hs-operator">.</span><span>
</span><span id="line-666"></span><span class="hs-identifier">Note</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">since</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">associated</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">one</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">only</span><span> </span><span class="hs-identifier">one</span><span> </span><span class="hs-identifier">protocol</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">can</span><span> </span><span class="hs-identifier">use</span><span>
</span><span id="line-667"></span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">block</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">index</span><span> </span><span class="hs-identifier">both</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">protocol</span><span class="hs-operator">.</span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span class="hs-operator">&gt;</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerSupportsProtocol</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-670"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131107"><span class="annot"><span class="annottext">protocolLedgerView :: LedgerCfg (LedgerState BlockC)
-&gt; Ticked (LedgerState BlockC)
-&gt; Ticked (LedgerView (BlockProtocol BlockC))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">protocolLedgerView</span></a></span></span><span> </span><span id="local-6989586621679131105"><span class="annot"><span class="annottext">LedgerCfg (LedgerState BlockC)
</span><a href="#local-6989586621679131105"><span class="hs-identifier hs-var">_lcfg</span></a></span></span><span>  </span><span id="local-6989586621679131104"><span class="annot"><span class="annottext">Ticked (LedgerState BlockC)
</span><a href="#local-6989586621679131104"><span class="hs-identifier hs-var">_tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ticked ()
Ticked (LedgerView (BlockProtocol BlockC))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">TickedTrivial</span></a></span><span>
</span><span id="line-671"></span><span class="hs-operator">&gt;</span><span>   </span><span id="local-6989586621679131103"><span class="annot"><span class="annottext">ledgerViewForecastAt :: LedgerCfg (LedgerState BlockC)
-&gt; LedgerState BlockC
-&gt; Forecast (LedgerView (BlockProtocol BlockC))
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">ledgerViewForecastAt</span></a></span></span><span> </span><span id="local-6989586621679131101"><span class="annot"><span class="annottext">LedgerCfg (LedgerState BlockC)
</span><a href="#local-6989586621679131101"><span class="hs-identifier hs-var">_lccf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerState BlockC -&gt; Forecast (LedgerView (BlockProtocol BlockC))
forall b. GetTip b =&gt; b -&gt; Forecast ()
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-var">trivialForecast</span></a></span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span class="hs-identifier">The</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">protocolLedgerView</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-identifier">describes</span><span> </span><span class="hs-identifier">how</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">project</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-674"></span><span class="hs-identifier">consensus</span><span class="hs-glyph">-</span><span class="hs-identifier">specific</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerView</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">out</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerState</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerCfg</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">together</span><span> </span><span class="hs-glyph">-</span><span>
</span><span id="line-675"></span><span class="hs-identifier">however</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">does</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-identifier">use</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-identifier">information</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">ledger</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">make</span><span> </span><span class="hs-identifier">any</span><span> </span><span class="hs-identifier">decisions</span><span>
</span><span id="line-676"></span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">since</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerView</span><span> </span><span class="hs-identifier">SP</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">simply</span><span> </span><span class="hs-special">`</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">we</span><span> </span><span class="hs-identifier">use</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">TickedTrivial</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">here</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">the</span><span>
</span><span id="line-677"></span><span class="hs-identifier">implementation</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">protocolLedgerView</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">constructs</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Ticked</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">value</span><span class="hs-operator">.</span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span class="hs-special">`</span><span class="hs-identifier">ledgerViewForecastAt</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">returns</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Forecast</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">defined</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-680"></span><span class="hs-special">`</span><span class="hs-identifier">Ouroboros.Consensus.Forecast</span><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerView</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Forecast</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-681"></span><span class="hs-identifier">starting</span><span> </span><span class="hs-identifier">point</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">forecastAt</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">together</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">forecastFor</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">which</span><span> </span><span class="hs-identifier">takes</span><span> </span><span class="hs-identifier">a</span><span>
</span><span id="line-682"></span><span class="hs-identifier">slot</span><span> </span><span class="hs-identifier">number</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">either</span><span> </span><span class="hs-identifier">produces</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">forecasted</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-identifier">for</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-keyword">case</span><span>
</span><span id="line-683"></span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">possible</span><span> </span><span class="hs-identifier">future</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">LedgerView</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">at</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">slot</span><span class="hs-operator">.</span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span class="hs-identifier">This</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">Forecast</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">closely</span><span> </span><span class="hs-identifier">related</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">required</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">consistent</span><span> </span><span class="hs-identifier">with</span><span>
</span><span id="line-686"></span><span class="hs-special">`</span><span class="hs-identifier">tickChainDepState</span><span class="hs-special">`</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">ConsensusProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">documentation</span><span> </span><span class="hs-identifier">for</span><span>
</span><span id="line-687"></span><span class="hs-special">`</span><span class="hs-identifier">LedgerSupportsProtocol</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">explains</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">relationship</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">more</span><span> </span><span class="hs-identifier">detail</span><span class="hs-operator">.</span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span class="hs-identifier">Appendix</span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">NoThunks</span><span> </span><span class="hs-identifier">Instances</span><span>
</span><span id="line-690"></span><span class="hs-operator">============================</span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span class="hs-special">`</span><span class="hs-identifier">NoThunks</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-keyword">class</span><span> </span><span class="hs-identifier">that</span><span> </span><span class="hs-identifier">comes</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">nothunks</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">package</span><span>
</span><span id="line-693"></span><span class="hs-special">(</span><span class="hs-identifier">https</span><span class="hs-operator">://</span><span class="hs-identifier">hackage</span><span class="hs-operator">.</span><span class="hs-identifier">haskell</span><span class="hs-operator">.</span><span class="hs-identifier">org</span><span class="hs-operator">/</span><span class="hs-identifier">package</span><span class="hs-operator">/</span><span class="hs-identifier">nothunks</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">and</span><span> </span><span class="hs-identifier">helps</span><span> </span><span class="hs-identifier">diagnose</span><span> </span><span class="hs-identifier">various</span><span> </span><span class="hs-identifier">kinds</span><span>
</span><span id="line-694"></span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">memory</span><span> </span><span class="hs-identifier">leaks</span><span> </span><span class="hs-identifier">having</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">with</span><span> </span><span class="hs-identifier">thunks</span><span class="hs-operator">.</span><span>  </span><span class="hs-identifier">Many</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">above</span><span> </span><span class="hs-identifier">classes</span><span> </span><span class="hs-identifier">require</span><span>
</span><span id="line-695"></span><span class="hs-identifier">that</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">NoThunks</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">be</span><span> </span><span class="hs-identifier">instantiated</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">prerequisite</span><span class="hs-operator">.</span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span class="hs-identifier">To</span><span> </span><span class="hs-identifier">focus</span><span> </span><span class="hs-identifier">on</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">salient</span><span> </span><span class="hs-identifier">ideas</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier">this</span><span> </span><span class="hs-identifier">document</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">we've</span><span> </span><span class="hs-identifier">put</span><span> </span><span class="hs-identifier">all</span><span> </span><span class="hs-identifier">the</span><span> </span><span class="hs-identifier">derivations</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-698"></span><span class="hs-special">`</span><span class="hs-identifier">NoThunks</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">here</span><span> </span><span class="hs-identifier">instead</span><span class="hs-glyph">:</span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="hs-operator">&gt;</span><span> </span><span id="local-6989586621679131095"><span id="local-6989586621679131097"><span id="local-6989586621679131099"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnlyCheckWhnfNamed</span></span><span> </span><span class="annot"><span class="hs-string">&quot;SP_Config&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ConsensusConfig</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-type">SP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">ConsensusConfig</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#SP"><span class="hs-identifier hs-type">SP</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-702"></span><span class="hs-operator">&gt;</span><span> </span><span id="local-6989586621679131089"><span id="local-6989586621679131091"><span id="local-6989586621679131093"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnlyCheckWhnfNamed</span></span><span> </span><span class="annot"><span class="hs-string">&quot;BlockC&quot;</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span>
</span><span id="line-703"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span></span></span></span><span>
</span><span id="line-704"></span><span class="hs-operator">&gt;</span><span> </span><span id="local-6989586621679131083"><span id="local-6989586621679131085"><span id="local-6989586621679131087"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnlyCheckWhnfNamed</span></span><span> </span><span class="annot"><span class="hs-string">&quot;HdrBlockC&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-705"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Header</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-706"></span><span class="hs-operator">&gt;</span><span> </span><span id="local-6989586621679131077"><span id="local-6989586621679131079"><span id="local-6989586621679131081"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnlyCheckWhnfNamed</span></span><span> </span><span class="annot"><span class="hs-string">&quot;LedgerC&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span class="hs-operator">&gt;</span><span>   </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-708"></span><span class="hs-operator">&gt;</span><span> </span><span id="local-6989586621679131071"><span id="local-6989586621679131073"><span id="local-6989586621679131075"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">Ticked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-consensus-0.3.1.0/noopt/doc/html/ouroboros-consensus/src"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Consensus.Tutorial.Simple.html#BlockC"><span class="hs-identifier hs-type">BlockC</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-709"></span></pre></body></html>