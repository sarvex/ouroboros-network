<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ouroboros.Network.Protocol.LocalTxMonitor.Client</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ouroboros-network-protocols-0.3.0.0: Ouroboros Network Protocols</span><ul class="links" id="page-menu"><li><a href="src/Ouroboros.Network.Protocol.LocalTxMonitor.Client.html">Source</a></li><li><a href="&quot;../index.html&quot;">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ouroboros.Network.Protocol.LocalTxMonitor.Client</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Protocol type for the client</a></li><li><a href="#g:2">Execution as a typed protocol</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>A view of the transaction monitor protocol from the point of view of
 the client.</p><p>This provides simple access to the local mempool snapshots, to allow building
 more monitoring logic from the client side after submitting transactions.</p><p>For execution, <code><a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#v:localTxMonitorClientPeer" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">localTxMonitorClientPeer</a></code> is provided for conversion
 into the typed protocol.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">newtype</span> <a href="#t:LocalTxMonitorClient">LocalTxMonitorClient</a> txid tx slot m a = <a href="#v:LocalTxMonitorClient">LocalTxMonitorClient</a> {<ul class="subs"><li><a href="#v:runLocalTxMonitorClient">runLocalTxMonitorClient</a> &#8759; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStIdle" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStIdle</a> txid tx slot m a)</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:ClientStIdle">ClientStIdle</a> txid tx slot m a <span class="keyword">where</span><ul class="subs"><li><a href="#v:SendMsgAcquire">SendMsgAcquire</a> &#8759; (slot &#8594; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a)) &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStIdle" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStIdle</a> txid tx slot m a</li><li><a href="#v:SendMsgDone">SendMsgDone</a> &#8759; a &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStIdle" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStIdle</a> txid tx slot m a</li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:ClientStAcquired">ClientStAcquired</a> txid tx slot m a <span class="keyword">where</span><ul class="subs"><li><a href="#v:SendMsgNextTx">SendMsgNextTx</a> &#8759; (<a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> tx &#8594; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a)) &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a</li><li><a href="#v:SendMsgHasTx">SendMsgHasTx</a> &#8759; txid &#8594; (<a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> &#8594; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a)) &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a</li><li><a href="#v:SendMsgGetSizes">SendMsgGetSizes</a> &#8759; (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Type.html#t:MempoolSizeAndCapacity" title="Ouroboros.Network.Protocol.LocalTxMonitor.Type">MempoolSizeAndCapacity</a> &#8594; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a)) &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a</li><li><a href="#v:SendMsgAwaitAcquire">SendMsgAwaitAcquire</a> &#8759; (slot &#8594; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a)) &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a</li><li><a href="#v:SendMsgRelease">SendMsgRelease</a> &#8759; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStIdle" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStIdle</a> txid tx slot m a) &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a</li></ul></li><li class="src short"><a href="#v:localTxMonitorClientPeer">localTxMonitorClientPeer</a> &#8759; &#8704; txid tx slot m a. <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:LocalTxMonitorClient" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">LocalTxMonitorClient</a> txid tx slot m a &#8594; Peer (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Type.html#t:LocalTxMonitor" title="Ouroboros.Network.Protocol.LocalTxMonitor.Type">LocalTxMonitor</a> txid tx slot) AsClient <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Type.html#v:StIdle" title="Ouroboros.Network.Protocol.LocalTxMonitor.Type">StIdle</a> m a</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Protocol type for the client</h1></a><div class="doc"><p>The protocol states from the point of view of the client.</p></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:LocalTxMonitorClient" class="def">LocalTxMonitorClient</a> txid tx slot m a <a href="src/Ouroboros.Network.Protocol.LocalTxMonitor.Client.html#LocalTxMonitorClient" class="link">Source</a> <a href="#t:LocalTxMonitorClient" class="selflink">#</a></p><div class="doc"><p>A tx monitor client, on top of some effect <code>m</code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:LocalTxMonitorClient" class="def">LocalTxMonitorClient</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:runLocalTxMonitorClient" class="def">runLocalTxMonitorClient</a> &#8759; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStIdle" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStIdle</a> txid tx slot m a)</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ClientStIdle" class="def">ClientStIdle</a> txid tx slot m a <span class="keyword">where</span> <a href="src/Ouroboros.Network.Protocol.LocalTxMonitor.Client.html#ClientStIdle" class="link">Source</a> <a href="#t:ClientStIdle" class="selflink">#</a></p><div class="doc"><p>In the <code><a href="Ouroboros-Network-Protocol-LocalTxMonitor-Type.html#v:StIdle" title="Ouroboros.Network.Protocol.LocalTxMonitor.Type">StIdle</a></code> protocol state, the client has agency and can proceed to
 acquire a mempool snapshot, or end the protocol.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SendMsgAcquire" class="def">SendMsgAcquire</a> &#8759; (slot &#8594; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a)) &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStIdle" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStIdle</a> txid tx slot m a</td><td class="doc"><p>Send the <code>MsgAcquire</code>, with handlers for the replies.</p><p>This request cannot timeout and cannot fail, it'll acquire the latest
 mempool snapshot available on the server and hang on to it. This allows to
 run any subsequent queries against the same view of the mempool.</p><p>The snapshot is acquired for a particular slot number which materializes
 the 'virtual block' under construction.</p></td></tr><tr><td class="src"><a id="v:SendMsgDone" class="def">SendMsgDone</a> &#8759; a &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStIdle" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStIdle</a> txid tx slot m a</td><td class="doc"><p>The client decided to end the protocol</p></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ClientStAcquired" class="def">ClientStAcquired</a> txid tx slot m a <span class="keyword">where</span> <a href="src/Ouroboros.Network.Protocol.LocalTxMonitor.Client.html#ClientStAcquired" class="link">Source</a> <a href="#t:ClientStAcquired" class="selflink">#</a></p><div class="doc"><p>In the <code><a href="Ouroboros-Network-Protocol-LocalTxMonitor-Type.html#v:StAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Type">StAcquired</a></code> protocol state, the client has agency and can query the
 server against the acquired snapshot. Alternatively, it can also (re)acquire
 a more recent snapshot.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:SendMsgNextTx" class="def">SendMsgNextTx</a> &#8759; (<a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> tx &#8594; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a)) &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a</td><td class="doc"><p>The mempool is modeled as an ordered list of transactions and thus, can
 be traversed linearly. <code>MsgNextTx</code> requests the next transaction from the
 current list. This must be a transaction that was not previously sent to
 the client for this particular snapshot.</p></td></tr><tr><td class="src"><a id="v:SendMsgHasTx" class="def">SendMsgHasTx</a> &#8759; txid &#8594; (<a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> &#8594; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a)) &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a</td><td class="doc"><p>For some cases where clients do not wish to traverse the entire mempool
 but look for a specific transaction, they can assess the presence of such
 transaction directly. Note that, the absence of a transaction does not
 imply anything about how the transaction was processed: it may have been
 dropped, or inserted in a block. <code><a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Bool.html#v:False" title="Data.Bool">False</a></code> simply means that it is no longer
 in the mempool.</p></td></tr><tr><td class="src"><a id="v:SendMsgGetSizes" class="def">SendMsgGetSizes</a> &#8759; (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Type.html#t:MempoolSizeAndCapacity" title="Ouroboros.Network.Protocol.LocalTxMonitor.Type">MempoolSizeAndCapacity</a> &#8594; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a)) &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a</td><td class="doc"><p>Ask the server about the current mempool's capacity and sizes. This is
 fixed in a given snapshot.</p></td></tr><tr><td class="src"><a id="v:SendMsgAwaitAcquire" class="def">SendMsgAwaitAcquire</a> &#8759; (slot &#8594; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a)) &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a</td><td class="doc"><p>Await for a new snapshot and acquire it.</p></td></tr><tr><td class="src"><a id="v:SendMsgRelease" class="def">SendMsgRelease</a> &#8759; m (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStIdle" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStIdle</a> txid tx slot m a) &#8594; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:ClientStAcquired" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">ClientStAcquired</a> txid tx slot m a</td><td class="doc"><p>Release the acquired snapshot, in order to loop back to the idle state.</p></td></tr></table></div></div><a href="#g:2" id="g:2"><h1>Execution as a typed protocol</h1></a><div class="top"><p class="src"><a id="v:localTxMonitorClientPeer" class="def">localTxMonitorClientPeer</a> &#8759; &#8704; txid tx slot m a. <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m &#8658; <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:LocalTxMonitorClient" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">LocalTxMonitorClient</a> txid tx slot m a &#8594; Peer (<a href="Ouroboros-Network-Protocol-LocalTxMonitor-Type.html#t:LocalTxMonitor" title="Ouroboros.Network.Protocol.LocalTxMonitor.Type">LocalTxMonitor</a> txid tx slot) AsClient <a href="Ouroboros-Network-Protocol-LocalTxMonitor-Type.html#v:StIdle" title="Ouroboros.Network.Protocol.LocalTxMonitor.Type">StIdle</a> m a <a href="src/Ouroboros.Network.Protocol.LocalTxMonitor.Client.html#localTxMonitorClientPeer" class="link">Source</a> <a href="#v:localTxMonitorClientPeer" class="selflink">#</a></p><div class="doc"><p>Interpret a <code><a href="Ouroboros-Network-Protocol-LocalTxMonitor-Client.html#t:LocalTxMonitorClient" title="Ouroboros.Network.Protocol.LocalTxMonitor.Client">LocalTxMonitorClient</a></code> action sequence as a <code>Peer</code> on the
 client-side of the <code><a href="Ouroboros-Network-Protocol-LocalTxMonitor-Type.html#t:LocalTxMonitor" title="Ouroboros.Network.Protocol.LocalTxMonitor.Type">LocalTxMonitor</a></code> protocol.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.2</p></div></body></html>