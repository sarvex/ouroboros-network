<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP                 #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns      #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">-- | IP subscription worker implentation.</span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Network.Subscription.Ip</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#SubscriptionParams"><span class="hs-identifier">SubscriptionParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#IPSubscriptionParams"><span class="hs-identifier">IPSubscriptionParams</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#ipSubscriptionWorker"><span class="hs-identifier">ipSubscriptionWorker</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#subscriptionWorker"><span class="hs-identifier">subscriptionWorker</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#IPSubscriptionTarget"><span class="hs-identifier">IPSubscriptionTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#ipSubscriptionTarget"><span class="hs-identifier">ipSubscriptionTarget</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-comment">--  * Traces</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#SubscriptionTrace"><span class="hs-identifier">SubscriptionTrace</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.ErrorPolicy.html#ErrorPolicyTrace"><span class="hs-identifier">ErrorPolicyTrace</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#WithIPList"><span class="hs-identifier">WithIPList</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><span class="hs-comment">-- * 'PeerState' STM transactions</span></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.PeerState.html#BeforeConnect"><span class="hs-identifier">BeforeConnect</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.PeerState.html#runBeforeConnect"><span class="hs-identifier">runBeforeConnect</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.PeerState.html#beforeConnectTx"><span class="hs-identifier">beforeConnectTx</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.ErrorPolicy.html#completeApplicationTx"><span class="hs-identifier">completeApplicationTx</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#socketStateChangeTx"><span class="hs-identifier">socketStateChangeTx</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#mainTx"><span class="hs-identifier">mainTx</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Utilitity functions</span></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#selectSockAddr"><span class="hs-identifier">selectSockAddr</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-comment">{- The parallel connection attemps implemented in this module is inspired by
 - RFC8305, https://tools.ietf.org/html/rfc8305 .
 -}</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Class.MonadSTM.Strict</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadThrow</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadTime</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Tracer</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Void</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Network.Socket</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Socket</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Text.Printf</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.ErrorPolicy.html"><span class="hs-identifier">Ouroboros.Network.ErrorPolicy</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.Snocket.html"><span class="hs-identifier">Ouroboros.Network.Snocket</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Snocket.html#Snocket"><span class="hs-identifier">Snocket</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.Socket.html"><span class="hs-identifier">Ouroboros.Network.Socket</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.Subscription.PeerState.html"><span class="hs-identifier">Ouroboros.Network.Subscription.PeerState</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.Subscription.Subscriber.html"><span class="hs-identifier">Ouroboros.Network.Subscription.Subscriber</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html"><span class="hs-identifier">Ouroboros.Network.Subscription.Worker</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">data</span><span> </span><span id="IPSubscriptionTarget"><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#IPSubscriptionTarget"><span class="hs-identifier hs-var">IPSubscriptionTarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="IPSubscriptionTarget"><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#IPSubscriptionTarget"><span class="hs-identifier hs-var">IPSubscriptionTarget</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-comment">-- | List of destinations to possibly connect to</span><span>
</span><span id="line-54"></span><span>      </span><span id="ispIps"><span class="annot"><span class="annottext">IPSubscriptionTarget -&gt; [SockAddr]
</span><a href="Ouroboros.Network.Subscription.Ip.html#ispIps"><span class="hs-identifier hs-var hs-var">ispIps</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span class="hs-special">]</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-comment">-- | Number of parallel connections to keep actice.</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="ispValency"><span class="annot"><span class="annottext">IPSubscriptionTarget -&gt; Int
</span><a href="Ouroboros.Network.Subscription.Ip.html#ispValency"><span class="hs-identifier hs-var hs-var">ispValency</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679260336"><span id="local-6989586621679260338"><span class="annot"><span class="annottext">IPSubscriptionTarget -&gt; IPSubscriptionTarget -&gt; Bool
(IPSubscriptionTarget -&gt; IPSubscriptionTarget -&gt; Bool)
-&gt; (IPSubscriptionTarget -&gt; IPSubscriptionTarget -&gt; Bool)
-&gt; Eq IPSubscriptionTarget
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: IPSubscriptionTarget -&gt; IPSubscriptionTarget -&gt; Bool
$c/= :: IPSubscriptionTarget -&gt; IPSubscriptionTarget -&gt; Bool
== :: IPSubscriptionTarget -&gt; IPSubscriptionTarget -&gt; Bool
$c== :: IPSubscriptionTarget -&gt; IPSubscriptionTarget -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679260329"><span id="local-6989586621679260331"><span id="local-6989586621679260333"><span class="annot"><span class="annottext">Int -&gt; IPSubscriptionTarget -&gt; ShowS
[IPSubscriptionTarget] -&gt; ShowS
IPSubscriptionTarget -&gt; String
(Int -&gt; IPSubscriptionTarget -&gt; ShowS)
-&gt; (IPSubscriptionTarget -&gt; String)
-&gt; ([IPSubscriptionTarget] -&gt; ShowS)
-&gt; Show IPSubscriptionTarget
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [IPSubscriptionTarget] -&gt; ShowS
$cshowList :: [IPSubscriptionTarget] -&gt; ShowS
show :: IPSubscriptionTarget -&gt; String
$cshow :: IPSubscriptionTarget -&gt; String
showsPrec :: Int -&gt; IPSubscriptionTarget -&gt; ShowS
$cshowsPrec :: Int -&gt; IPSubscriptionTarget -&gt; ShowS
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | 'ipSubscriptionWorker' and 'dnsSubscriptionWorker' parameters</span><span>
</span><span id="line-61"></span><span class="hs-comment">--</span><span>
</span><span id="line-62"></span><span class="hs-keyword">data</span><span> </span><span id="SubscriptionParams"><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#SubscriptionParams"><span class="hs-identifier hs-var">SubscriptionParams</span></a></span></span><span> </span><span id="local-6989586621679260443"><span class="annot"><a href="#local-6989586621679260443"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679260442"><span class="annot"><a href="#local-6989586621679260442"><span class="hs-identifier hs-type">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SubscriptionParams"><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#SubscriptionParams"><span class="hs-identifier hs-var">SubscriptionParams</span></a></span></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="spLocalAddresses"><span class="annot"><span class="annottext">SubscriptionParams a target -&gt; LocalAddresses SockAddr
</span><a href="Ouroboros.Network.Subscription.Ip.html#spLocalAddresses"><span class="hs-identifier hs-var hs-var">spLocalAddresses</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#LocalAddresses"><span class="hs-identifier hs-type">LocalAddresses</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="spConnectionAttemptDelay"><span class="annot"><span class="annottext">SubscriptionParams a target -&gt; SockAddr -&gt; Maybe DiffTime
</span><a href="Ouroboros.Network.Subscription.Ip.html#spConnectionAttemptDelay"><span class="hs-identifier hs-var hs-var">spConnectionAttemptDelay</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-comment">-- ^ should return expected delay for the given address</span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="spErrorPolicies"><span class="annot"><span class="annottext">SubscriptionParams a target -&gt; ErrorPolicies
</span><a href="Ouroboros.Network.Subscription.Ip.html#spErrorPolicies"><span class="hs-identifier hs-var hs-var">spErrorPolicies</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.ErrorPolicy.html#ErrorPolicies"><span class="hs-identifier hs-type">ErrorPolicies</span></a></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="spSubscriptionTarget"><span class="annot"><span class="annottext">SubscriptionParams a target -&gt; target
</span><a href="Ouroboros.Network.Subscription.Ip.html#spSubscriptionTarget"><span class="hs-identifier hs-var hs-var">spSubscriptionTarget</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679260442"><span class="hs-identifier hs-type">target</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">type</span><span> </span><span id="IPSubscriptionParams"><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#IPSubscriptionParams"><span class="hs-identifier hs-var">IPSubscriptionParams</span></a></span></span><span> </span><span id="local-6989586621679260322"><span class="annot"><a href="#local-6989586621679260322"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#SubscriptionParams"><span class="hs-identifier hs-type">SubscriptionParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260322"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#IPSubscriptionTarget"><span class="hs-identifier hs-type">IPSubscriptionTarget</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | Spawns a subscription worker which will attempt to keep the specified</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- number of connections (Valency) active towards the list of IP addresses</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- given in IPSubscriptionTarget.</span><span>
</span><span id="line-75"></span><span class="hs-comment">--</span><span>
</span><span id="line-76"></span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#ipSubscriptionWorker"><span class="hs-identifier hs-type">ipSubscriptionWorker</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679260321"><span class="annot"><a href="#local-6989586621679260321"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-78"></span><span>       </span><span class="annot"><a href="Ouroboros.Network.Snocket.html#Snocket"><span class="hs-identifier hs-type">Snocket</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.Socket</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#WithIPList"><span class="hs-identifier hs-type">WithIPList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#SubscriptionTrace"><span class="hs-identifier hs-type">SubscriptionTrace</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.ErrorPolicy.html#WithAddr"><span class="hs-identifier hs-type">WithAddr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.ErrorPolicy.html#ErrorPolicyTrace"><span class="hs-identifier hs-type">ErrorPolicyTrace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Socket.html#NetworkMutableState"><span class="hs-identifier hs-type">NetworkMutableState</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#IPSubscriptionParams"><span class="hs-identifier hs-type">IPSubscriptionParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260321"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Socket.Socket</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260321"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span>
</span><span id="line-85"></span><span id="ipSubscriptionWorker"><span class="annot"><span class="annottext">ipSubscriptionWorker :: Snocket IO Socket SockAddr
-&gt; Tracer IO (WithIPList (SubscriptionTrace SockAddr))
-&gt; Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
-&gt; NetworkMutableState SockAddr
-&gt; IPSubscriptionParams a
-&gt; (Socket -&gt; IO a)
-&gt; IO Void
</span><a href="Ouroboros.Network.Subscription.Ip.html#ipSubscriptionWorker"><span class="hs-identifier hs-var hs-var">ipSubscriptionWorker</span></a></span></span><span> </span><span id="local-6989586621679260320"><span class="annot"><span class="annottext">Snocket IO Socket SockAddr
</span><a href="#local-6989586621679260320"><span class="hs-identifier hs-var">snocket</span></a></span></span><span> </span><span id="local-6989586621679260319"><span class="annot"><span class="annottext">Tracer IO (WithIPList (SubscriptionTrace SockAddr))
</span><a href="#local-6989586621679260319"><span class="hs-identifier hs-var">subscriptionTracer</span></a></span></span><span> </span><span id="local-6989586621679260318"><span class="annot"><span class="annottext">Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
</span><a href="#local-6989586621679260318"><span class="hs-identifier hs-var">errorPolicyTracer</span></a></span></span><span>
</span><span id="line-86"></span><span>                     </span><span id="local-6989586621679260317"><span class="annot"><span class="annottext">networkState :: NetworkMutableState SockAddr
</span><a href="#local-6989586621679260317"><span class="hs-identifier hs-var">networkState</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Network.Socket.html#NetworkMutableState"><span class="hs-identifier hs-type">NetworkMutableState</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679260315"><span class="annot"><span class="annottext">StrictTVar IO (PeerStates IO SockAddr)
nmsPeerStates :: forall addr.
NetworkMutableState addr -&gt; StrictTVar IO (PeerStates IO addr)
nmsPeerStates :: StrictTVar IO (PeerStates IO SockAddr)
</span><a href="Ouroboros.Network.Socket.html#nmsPeerStates"><span class="hs-identifier hs-var hs-var">nmsPeerStates</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-87"></span><span>                     </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#SubscriptionParams"><span class="hs-identifier hs-type">SubscriptionParams</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679260313"><span class="annot"><span class="annottext">LocalAddresses SockAddr
spLocalAddresses :: LocalAddresses SockAddr
spLocalAddresses :: forall a target.
SubscriptionParams a target -&gt; LocalAddresses SockAddr
</span><a href="#local-6989586621679260313"><span class="hs-identifier hs-var hs-var">spLocalAddresses</span></a></span></span><span>
</span><span id="line-88"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679260312"><span class="annot"><span class="annottext">SockAddr -&gt; Maybe DiffTime
spConnectionAttemptDelay :: SockAddr -&gt; Maybe DiffTime
spConnectionAttemptDelay :: forall a target.
SubscriptionParams a target -&gt; SockAddr -&gt; Maybe DiffTime
</span><a href="#local-6989586621679260312"><span class="hs-identifier hs-var hs-var">spConnectionAttemptDelay</span></a></span></span><span>
</span><span id="line-89"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679260311"><span class="annot"><span class="annottext">IPSubscriptionTarget
spSubscriptionTarget :: IPSubscriptionTarget
spSubscriptionTarget :: forall a target. SubscriptionParams a target -&gt; target
</span><a href="#local-6989586621679260311"><span class="hs-identifier hs-var hs-var">spSubscriptionTarget</span></a></span></span><span>
</span><span id="line-90"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679260310"><span class="annot"><span class="annottext">ErrorPolicies
spErrorPolicies :: ErrorPolicies
spErrorPolicies :: forall a target. SubscriptionParams a target -&gt; ErrorPolicies
</span><a href="#local-6989586621679260310"><span class="hs-identifier hs-var hs-var">spErrorPolicies</span></a></span></span><span>
</span><span id="line-91"></span><span>                                        </span><span class="hs-special">}</span><span>
</span><span id="line-92"></span><span>                     </span><span id="local-6989586621679260309"><span class="annot"><span class="annottext">Socket -&gt; IO a
</span><a href="#local-6989586621679260309"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">Snocket IO Socket SockAddr
-&gt; Tracer IO (SubscriptionTrace SockAddr)
-&gt; Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
-&gt; NetworkMutableState SockAddr
-&gt; WorkerParams IO LocalAddresses SockAddr
-&gt; ErrorPolicies
-&gt; Main IO (PeerStates IO SockAddr) Void
-&gt; (Socket -&gt; IO a)
-&gt; IO Void
forall x a.
Snocket IO Socket SockAddr
-&gt; Tracer IO (SubscriptionTrace SockAddr)
-&gt; Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
-&gt; NetworkMutableState SockAddr
-&gt; WorkerParams IO LocalAddresses SockAddr
-&gt; ErrorPolicies
-&gt; Main IO (PeerStates IO SockAddr) x
-&gt; (Socket -&gt; IO a)
-&gt; IO x
</span><a href="Ouroboros.Network.Subscription.Ip.html#subscriptionWorker"><span class="hs-identifier hs-var">subscriptionWorker</span></a></span><span> </span><span class="annot"><span class="annottext">Snocket IO Socket SockAddr
</span><a href="#local-6989586621679260320"><span class="hs-identifier hs-var">snocket</span></a></span><span>
</span><span id="line-94"></span><span>                       </span><span class="annot"><span class="annottext">Tracer IO (SubscriptionTrace SockAddr)
</span><a href="#local-6989586621679260308"><span class="hs-identifier hs-var">subscriptionTracer'</span></a></span><span>
</span><span id="line-95"></span><span>                       </span><span class="annot"><span class="annottext">Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
</span><a href="#local-6989586621679260318"><span class="hs-identifier hs-var">errorPolicyTracer</span></a></span><span>
</span><span id="line-96"></span><span>                       </span><span class="annot"><span class="annottext">NetworkMutableState SockAddr
</span><a href="#local-6989586621679260317"><span class="hs-identifier hs-var">networkState</span></a></span><span>
</span><span id="line-97"></span><span>                       </span><span class="annot"><span class="annottext">WorkerParams IO LocalAddresses SockAddr
</span><a href="#local-6989586621679260307"><span class="hs-identifier hs-var">workerParams</span></a></span><span>
</span><span id="line-98"></span><span>                       </span><span class="annot"><span class="annottext">ErrorPolicies
</span><a href="#local-6989586621679260310"><span class="hs-identifier hs-var">spErrorPolicies</span></a></span><span>
</span><span id="line-99"></span><span>                       </span><span class="annot"><span class="annottext">Main IO (PeerStates IO SockAddr) Void
forall (m :: * -&gt; *) addr.
(MonadThrow (STM m), MonadSTM m) =&gt;
Main m (PeerStates m addr) Void
</span><a href="Ouroboros.Network.Subscription.Ip.html#mainTx"><span class="hs-identifier hs-var">mainTx</span></a></span><span>
</span><span id="line-100"></span><span>                       </span><span class="annot"><span class="annottext">Socket -&gt; IO a
</span><a href="#local-6989586621679260309"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621679260307"><span class="annot"><span class="annottext">workerParams :: WorkerParams IO LocalAddresses SockAddr
</span><a href="#local-6989586621679260307"><span class="hs-identifier hs-var hs-var">workerParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorkerParams :: forall (m :: * -&gt; *) (localAddrs :: * -&gt; *) addr.
localAddrs addr
-&gt; (addr -&gt; localAddrs addr -&gt; Maybe addr)
-&gt; (addr -&gt; Maybe DiffTime)
-&gt; m (SubscriptionTarget m addr)
-&gt; Int
-&gt; WorkerParams m localAddrs addr
</span><a href="Ouroboros.Network.Subscription.Worker.html#WorkerParams"><span class="hs-identifier hs-type">WorkerParams</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-103"></span><span>        </span><span class="annot"><span class="annottext">wpLocalAddresses :: LocalAddresses SockAddr
</span><a href="Ouroboros.Network.Subscription.Worker.html#wpLocalAddresses"><span class="hs-identifier hs-var">wpLocalAddresses</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalAddresses SockAddr
</span><a href="#local-6989586621679260313"><span class="hs-identifier hs-var">spLocalAddresses</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>        </span><span class="annot"><span class="annottext">wpConnectionAttemptDelay :: SockAddr -&gt; Maybe DiffTime
</span><a href="Ouroboros.Network.Subscription.Worker.html#wpConnectionAttemptDelay"><span class="hs-identifier hs-var">wpConnectionAttemptDelay</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SockAddr -&gt; Maybe DiffTime
</span><a href="#local-6989586621679260312"><span class="hs-identifier hs-var">spConnectionAttemptDelay</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>        </span><span class="annot"><span class="annottext">wpSubscriptionTarget :: IO (SubscriptionTarget IO SockAddr)
</span><a href="Ouroboros.Network.Subscription.Worker.html#wpSubscriptionTarget"><span class="hs-identifier hs-var">wpSubscriptionTarget</span></a></span><span>     </span><span class="hs-glyph">=</span><span>
</span><span id="line-106"></span><span>          </span><span class="annot"><span class="annottext">SubscriptionTarget IO SockAddr
-&gt; IO (SubscriptionTarget IO SockAddr)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(SubscriptionTarget IO SockAddr
 -&gt; IO (SubscriptionTarget IO SockAddr))
-&gt; SubscriptionTarget IO SockAddr
-&gt; IO (SubscriptionTarget IO SockAddr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO (SubscriptionTrace SockAddr)
-&gt; StrictTVar IO (PeerStates IO SockAddr)
-&gt; [SockAddr]
-&gt; SubscriptionTarget IO SockAddr
forall (m :: * -&gt; *) addr.
(MonadSTM m, MonadTime m, Ord addr) =&gt;
Tracer m (SubscriptionTrace addr)
-&gt; StrictTVar m (PeerStates m addr)
-&gt; [addr]
-&gt; SubscriptionTarget m addr
</span><a href="Ouroboros.Network.Subscription.Ip.html#ipSubscriptionTarget"><span class="hs-identifier hs-var">ipSubscriptionTarget</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO (SubscriptionTrace SockAddr)
</span><a href="#local-6989586621679260308"><span class="hs-identifier hs-var">subscriptionTracer'</span></a></span><span> </span><span class="annot"><span class="annottext">StrictTVar IO (PeerStates IO SockAddr)
</span><a href="#local-6989586621679260315"><span class="hs-identifier hs-var">nmsPeerStates</span></a></span><span>
</span><span id="line-107"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IPSubscriptionTarget -&gt; [SockAddr]
</span><a href="Ouroboros.Network.Subscription.Ip.html#ispIps"><span class="hs-identifier hs-var hs-var">ispIps</span></a></span><span> </span><span class="annot"><span class="annottext">IPSubscriptionTarget
</span><a href="#local-6989586621679260311"><span class="hs-identifier hs-var">spSubscriptionTarget</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><span class="annottext">wpValency :: Int
</span><a href="Ouroboros.Network.Subscription.Worker.html#wpValency"><span class="hs-identifier hs-var">wpValency</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IPSubscriptionTarget -&gt; Int
</span><a href="Ouroboros.Network.Subscription.Ip.html#ispValency"><span class="hs-identifier hs-var hs-var">ispValency</span></a></span><span> </span><span class="annot"><span class="annottext">IPSubscriptionTarget
</span><a href="#local-6989586621679260311"><span class="hs-identifier hs-var">spSubscriptionTarget</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><span class="annottext">wpSelectAddress :: SockAddr -&gt; LocalAddresses SockAddr -&gt; Maybe SockAddr
</span><a href="Ouroboros.Network.Subscription.Worker.html#wpSelectAddress"><span class="hs-identifier hs-var">wpSelectAddress</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SockAddr -&gt; LocalAddresses SockAddr -&gt; Maybe SockAddr
</span><a href="Ouroboros.Network.Subscription.Ip.html#selectSockAddr"><span class="hs-identifier hs-var">selectSockAddr</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621679260308"><span class="annot"><span class="annottext">subscriptionTracer' :: Tracer IO (SubscriptionTrace SockAddr)
</span><a href="#local-6989586621679260308"><span class="hs-identifier hs-var hs-var">subscriptionTracer'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalAddresses SockAddr
-&gt; [SockAddr]
-&gt; SubscriptionTrace SockAddr
-&gt; WithIPList (SubscriptionTrace SockAddr)
forall a.
LocalAddresses SockAddr -&gt; [SockAddr] -&gt; a -&gt; WithIPList a
</span><a href="Ouroboros.Network.Subscription.Ip.html#WithIPList"><span class="hs-identifier hs-var">WithIPList</span></a></span><span> </span><span class="annot"><span class="annottext">LocalAddresses SockAddr
</span><a href="#local-6989586621679260313"><span class="hs-identifier hs-var">spLocalAddresses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IPSubscriptionTarget -&gt; [SockAddr]
</span><a href="Ouroboros.Network.Subscription.Ip.html#ispIps"><span class="hs-identifier hs-var hs-var">ispIps</span></a></span><span> </span><span class="annot"><span class="annottext">IPSubscriptionTarget
</span><a href="#local-6989586621679260311"><span class="hs-identifier hs-var">spSubscriptionTarget</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>              </span><span class="annot"><span class="annottext">(SubscriptionTrace SockAddr
 -&gt; WithIPList (SubscriptionTrace SockAddr))
-&gt; Tracer IO (WithIPList (SubscriptionTrace SockAddr))
-&gt; Tracer IO (SubscriptionTrace SockAddr)
forall (f :: * -&gt; *) a b. Contravariant f =&gt; (a -&gt; b) -&gt; f b -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`contramap`</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO (WithIPList (SubscriptionTrace SockAddr))
</span><a href="#local-6989586621679260319"><span class="hs-identifier hs-var">subscriptionTracer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#selectSockAddr"><span class="hs-identifier hs-type">selectSockAddr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span>
</span><span id="line-116"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#LocalAddresses"><span class="hs-identifier hs-type">LocalAddresses</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span>
</span><span id="line-117"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span>
</span><span id="line-118"></span><span id="selectSockAddr"><span class="annot"><span class="annottext">selectSockAddr :: SockAddr -&gt; LocalAddresses SockAddr -&gt; Maybe SockAddr
</span><a href="Ouroboros.Network.Subscription.Ip.html#selectSockAddr"><span class="hs-identifier hs-var hs-var">selectSockAddr</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddrInet</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#LocalAddresses"><span class="hs-identifier hs-type">LocalAddresses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679260296"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260296"><span class="hs-identifier hs-var">localAddr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SockAddr -&gt; Maybe SockAddr
forall a. a -&gt; Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260296"><span class="hs-identifier hs-var">localAddr</span></a></span><span>
</span><span id="line-119"></span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#selectSockAddr"><span class="hs-identifier hs-var">selectSockAddr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddrInet6</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#LocalAddresses"><span class="hs-identifier hs-type">LocalAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679260294"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260294"><span class="hs-identifier hs-var">localAddr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SockAddr -&gt; Maybe SockAddr
forall a. a -&gt; Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260294"><span class="hs-identifier hs-var">localAddr</span></a></span><span>
</span><span id="line-120"></span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#selectSockAddr"><span class="hs-identifier hs-var">selectSockAddr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddrUnix</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#LocalAddresses"><span class="hs-identifier hs-type">LocalAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679260292"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260292"><span class="hs-identifier hs-var">localAddr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SockAddr -&gt; Maybe SockAddr
forall a. a -&gt; Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260292"><span class="hs-identifier hs-var">localAddr</span></a></span><span>
</span><span id="line-121"></span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#selectSockAddr"><span class="hs-identifier hs-var">selectSockAddr</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LocalAddresses SockAddr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
forall a. Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#ipSubscriptionTarget"><span class="hs-identifier hs-type">ipSubscriptionTarget</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679260423"><span class="annot"><a href="#local-6989586621679260423"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679260421"><span class="annot"><a href="#local-6989586621679260421"><span class="hs-identifier hs-type">addr</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-125"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadSTM</span></span><span>  </span><span class="annot"><a href="#local-6989586621679260423"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-126"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTime</span></span><span> </span><span class="annot"><a href="#local-6989586621679260423"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-127"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260421"><span class="hs-identifier hs-type">addr</span></a></span><span>
</span><span id="line-128"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="annot"><a href="#local-6989586621679260423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#SubscriptionTrace"><span class="hs-identifier hs-type">SubscriptionTrace</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260421"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StrictTVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679260423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.PeerState.html#PeerStates"><span class="hs-identifier hs-type">PeerStates</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260421"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679260421"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-132"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Subscriber.html#SubscriptionTarget"><span class="hs-identifier hs-type">SubscriptionTarget</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260421"><span class="hs-identifier hs-type">addr</span></a></span><span>
</span><span id="line-133"></span><span id="ipSubscriptionTarget"><span class="annot"><span class="annottext">ipSubscriptionTarget :: Tracer m (SubscriptionTrace addr)
-&gt; StrictTVar m (PeerStates m addr)
-&gt; [addr]
-&gt; SubscriptionTarget m addr
</span><a href="Ouroboros.Network.Subscription.Ip.html#ipSubscriptionTarget"><span class="hs-identifier hs-var hs-var">ipSubscriptionTarget</span></a></span></span><span> </span><span id="local-6989586621679260291"><span class="annot"><span class="annottext">Tracer m (SubscriptionTrace addr)
</span><a href="#local-6989586621679260291"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span id="local-6989586621679260290"><span class="annot"><span class="annottext">StrictTVar m (PeerStates m addr)
</span><a href="#local-6989586621679260290"><span class="hs-identifier hs-var">peerStatesVar</span></a></span></span><span> </span><span id="local-6989586621679260289"><span class="annot"><span class="annottext">[addr]
</span><a href="#local-6989586621679260289"><span class="hs-identifier hs-var">ips</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[addr] -&gt; SubscriptionTarget m addr
</span><a href="#local-6989586621679260288"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[addr]
</span><a href="#local-6989586621679260289"><span class="hs-identifier hs-var">ips</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="#local-6989586621679260288"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679260421"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-136"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Subscriber.html#SubscriptionTarget"><span class="hs-identifier hs-type">SubscriptionTarget</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260421"><span class="hs-identifier hs-type">addr</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621679260288"><span class="annot"><span class="annottext">go :: [addr] -&gt; SubscriptionTarget m addr
</span><a href="#local-6989586621679260288"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Maybe (addr, SubscriptionTarget m addr))
-&gt; SubscriptionTarget m addr
forall (m :: * -&gt; *) target.
m (Maybe (target, SubscriptionTarget m target))
-&gt; SubscriptionTarget m target
</span><a href="Ouroboros.Network.Subscription.Subscriber.html#SubscriptionTarget"><span class="hs-identifier hs-var">SubscriptionTarget</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (addr, SubscriptionTarget m addr))
 -&gt; SubscriptionTarget m addr)
-&gt; m (Maybe (addr, SubscriptionTarget m addr))
-&gt; SubscriptionTarget m addr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (addr, SubscriptionTarget m addr)
-&gt; m (Maybe (addr, SubscriptionTarget m addr))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (addr, SubscriptionTarget m addr)
forall a. Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><a href="#local-6989586621679260288"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679260286"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679260286"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679260285"><span class="annot"><span class="annottext">[addr]
</span><a href="#local-6989586621679260285"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Maybe (addr, SubscriptionTarget m addr))
-&gt; SubscriptionTarget m addr
forall (m :: * -&gt; *) target.
m (Maybe (target, SubscriptionTarget m target))
-&gt; SubscriptionTarget m target
</span><a href="Ouroboros.Network.Subscription.Subscriber.html#SubscriptionTarget"><span class="hs-identifier hs-var">SubscriptionTarget</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (addr, SubscriptionTarget m addr))
 -&gt; SubscriptionTarget m addr)
-&gt; m (Maybe (addr, SubscriptionTarget m addr))
-&gt; SubscriptionTarget m addr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-139"></span><span>      </span><span id="local-6989586621679260284"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679260284"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StrictTVar m (PeerStates m addr)
-&gt; BeforeConnect m (PeerStates m addr) addr -&gt; addr -&gt; m Bool
forall (m :: * -&gt; *) s addr.
(MonadSTM m, MonadTime m) =&gt;
StrictTVar m s -&gt; BeforeConnect m s addr -&gt; addr -&gt; m Bool
</span><a href="Ouroboros.Network.Subscription.PeerState.html#runBeforeConnect"><span class="hs-identifier hs-var">runBeforeConnect</span></a></span><span> </span><span class="annot"><span class="annottext">StrictTVar m (PeerStates m addr)
</span><a href="#local-6989586621679260290"><span class="hs-identifier hs-var">peerStatesVar</span></a></span><span> </span><span class="annot"><span class="annottext">BeforeConnect m (PeerStates m addr) addr
forall (m :: * -&gt; *) addr.
(MonadSTM m, Ord addr) =&gt;
BeforeConnect m (PeerStates m addr) addr
</span><a href="Ouroboros.Network.Subscription.PeerState.html#beforeConnectTx"><span class="hs-identifier hs-var">beforeConnectTx</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679260286"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-140"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679260284"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-142"></span><span>          </span><span class="annot"><span class="annottext">Tracer m (SubscriptionTrace addr) -&gt; SubscriptionTrace addr -&gt; m ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">traceWith</span></span><span> </span><span class="annot"><span class="annottext">Tracer m (SubscriptionTrace addr)
</span><a href="#local-6989586621679260291"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(SubscriptionTrace addr -&gt; m ()) -&gt; SubscriptionTrace addr -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; SubscriptionTrace addr
forall addr. addr -&gt; SubscriptionTrace addr
</span><a href="Ouroboros.Network.Subscription.Worker.html#SubscriptionTraceTryConnectToPeer"><span class="hs-identifier hs-var">SubscriptionTraceTryConnectToPeer</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679260286"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-143"></span><span>          </span><span class="annot"><span class="annottext">Maybe (addr, SubscriptionTarget m addr)
-&gt; m (Maybe (addr, SubscriptionTarget m addr))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (addr, SubscriptionTarget m addr)
 -&gt; m (Maybe (addr, SubscriptionTarget m addr)))
-&gt; Maybe (addr, SubscriptionTarget m addr)
-&gt; m (Maybe (addr, SubscriptionTarget m addr))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(addr, SubscriptionTarget m addr)
-&gt; Maybe (addr, SubscriptionTarget m addr)
forall a. a -&gt; Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679260286"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[addr] -&gt; SubscriptionTarget m addr
</span><a href="#local-6989586621679260288"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[addr]
</span><a href="#local-6989586621679260285"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>          </span><span class="annot"><span class="annottext">Tracer m (SubscriptionTrace addr) -&gt; SubscriptionTrace addr -&gt; m ()
forall (m :: * -&gt; *) a. Tracer m a -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">traceWith</span></span><span> </span><span class="annot"><span class="annottext">Tracer m (SubscriptionTrace addr)
</span><a href="#local-6989586621679260291"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">(SubscriptionTrace addr -&gt; m ()) -&gt; SubscriptionTrace addr -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; SubscriptionTrace addr
forall addr. addr -&gt; SubscriptionTrace addr
</span><a href="Ouroboros.Network.Subscription.Worker.html#SubscriptionTraceSkippingPeer"><span class="hs-identifier hs-var">SubscriptionTraceSkippingPeer</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679260286"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-146"></span><span>          </span><span class="annot"><span class="annottext">SubscriptionTarget m addr
-&gt; m (Maybe (addr, SubscriptionTarget m addr))
forall (m :: * -&gt; *) target.
SubscriptionTarget m target
-&gt; m (Maybe (target, SubscriptionTarget m target))
</span><a href="Ouroboros.Network.Subscription.Subscriber.html#getSubscriptionTarget"><span class="hs-identifier hs-var hs-var">getSubscriptionTarget</span></a></span><span> </span><span class="annot"><span class="annottext">(SubscriptionTarget m addr
 -&gt; m (Maybe (addr, SubscriptionTarget m addr)))
-&gt; SubscriptionTarget m addr
-&gt; m (Maybe (addr, SubscriptionTarget m addr))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[addr] -&gt; SubscriptionTarget m addr
</span><a href="#local-6989586621679260288"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[addr]
</span><a href="#local-6989586621679260285"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-comment">-- when creating a new socket: register consumer thread</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- when tearing down a socket: unregister consumer thread</span><span>
</span><span id="line-151"></span><span id="local-6989586621679260362"><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#socketStateChangeTx"><span class="hs-identifier hs-type">socketStateChangeTx</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260362"><span class="hs-identifier hs-type">addr</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#SocketStateChange"><span class="hs-identifier hs-type">SocketStateChange</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.PeerState.html#PeerStates"><span class="hs-identifier hs-type">PeerStates</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260362"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>        </span><span class="annot"><a href="#local-6989586621679260362"><span class="hs-identifier hs-type">addr</span></a></span></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span id="socketStateChangeTx"><span class="annot"><span class="annottext">socketStateChangeTx :: SocketStateChange IO (PeerStates IO addr) addr
</span><a href="Ouroboros.Network.Subscription.Ip.html#socketStateChangeTx"><span class="hs-identifier hs-var hs-var">socketStateChangeTx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#CreatedSocket"><span class="hs-identifier hs-type">CreatedSocket</span></a></span><span> </span><span id="local-6989586621679260278"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679260278"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679260277"><span class="annot"><span class="annottext">Async IO ()
</span><a href="#local-6989586621679260277"><span class="hs-identifier hs-var">thread</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679260276"><span class="annot"><span class="annottext">PeerStates IO addr
</span><a href="#local-6989586621679260276"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="annottext">PeerStates IO addr -&gt; STM (PeerStates IO addr)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">addr -&gt; Async IO () -&gt; PeerStates IO addr -&gt; PeerStates IO addr
forall (m :: * -&gt; *) addr.
(Ord addr, Ord (Async m ())) =&gt;
addr -&gt; Async m () -&gt; PeerStates m addr -&gt; PeerStates m addr
</span><a href="Ouroboros.Network.Subscription.PeerState.html#registerConsumer"><span class="hs-identifier hs-var">registerConsumer</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679260278"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Async IO ()
</span><a href="#local-6989586621679260277"><span class="hs-identifier hs-var">thread</span></a></span><span> </span><span class="annot"><span class="annottext">PeerStates IO addr
</span><a href="#local-6989586621679260276"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#socketStateChangeTx"><span class="hs-identifier hs-var">socketStateChangeTx</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#ClosedSocket"><span class="hs-identifier hs-type">ClosedSocket</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621679260273"><span class="annot"><span class="annottext">ps :: PeerStates IO addr
</span><a href="#local-6989586621679260273"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Ouroboros.Network.Subscription.PeerState.html#ThrowException"><span class="hs-identifier hs-type">ThrowException</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><span class="annottext">PeerStates IO addr -&gt; STM (PeerStates IO addr)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">PeerStates IO addr
</span><a href="#local-6989586621679260273"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#socketStateChangeTx"><span class="hs-identifier hs-var">socketStateChangeTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#ClosedSocket"><span class="hs-identifier hs-type">ClosedSocket</span></a></span><span> </span><span id="local-6989586621679260271"><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679260271"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679260270"><span class="annot"><span class="annottext">Async IO ()
</span><a href="#local-6989586621679260270"><span class="hs-identifier hs-var">thread</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679260269"><span class="annot"><span class="annottext">PeerStates IO addr
</span><a href="#local-6989586621679260269"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><span class="annottext">PeerStates IO addr -&gt; STM (PeerStates IO addr)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(PeerStates IO addr -&gt; STM (PeerStates IO addr))
-&gt; PeerStates IO addr -&gt; STM (PeerStates IO addr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">addr -&gt; Async IO () -&gt; PeerStates IO addr -&gt; PeerStates IO addr
forall (m :: * -&gt; *) addr.
(Ord addr, Ord (Async m ())) =&gt;
addr -&gt; Async m () -&gt; PeerStates m addr -&gt; PeerStates m addr
</span><a href="Ouroboros.Network.Subscription.PeerState.html#unregisterConsumer"><span class="hs-identifier hs-var">unregisterConsumer</span></a></span><span> </span><span class="annot"><span class="annottext">addr
</span><a href="#local-6989586621679260271"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Async IO ()
</span><a href="#local-6989586621679260270"><span class="hs-identifier hs-var">thread</span></a></span><span> </span><span class="annot"><span class="annottext">PeerStates IO addr
</span><a href="#local-6989586621679260269"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-comment">-- | Main callback.  It throws an exception when the state becomes</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- 'ThrowException'.  This exception is thrown from the main thread.</span><span>
</span><span id="line-169"></span><span class="hs-comment">--</span><span>
</span><span id="line-170"></span><span id="local-6989586621679260433"><span id="local-6989586621679260437"><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#mainTx"><span class="hs-identifier hs-type">mainTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679260437"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadSTM</span></span><span> </span><span class="annot"><a href="#local-6989586621679260437"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-172"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#Main"><span class="hs-identifier hs-type">Main</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260437"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.PeerState.html#PeerStates"><span class="hs-identifier hs-type">PeerStates</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260437"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260433"><span class="hs-identifier hs-type">addr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span></span></span><span>
</span><span id="line-174"></span><span id="mainTx"><span class="annot"><span class="annottext">mainTx :: Main m (PeerStates m addr) Void
</span><a href="Ouroboros.Network.Subscription.Ip.html#mainTx"><span class="hs-identifier hs-var hs-var">mainTx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.PeerState.html#ThrowException"><span class="hs-identifier hs-type">ThrowException</span></a></span><span> </span><span id="local-6989586621679260267"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679260267"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">e -&gt; STM m Void
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679260267"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-175"></span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#mainTx"><span class="hs-identifier hs-var">mainTx</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.PeerState.html#PeerStates"><span class="hs-identifier hs-type">PeerStates</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM m Void
forall (m :: * -&gt; *) a. MonadSTM m =&gt; STM m a
</span><span class="hs-identifier hs-var">retry</span></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | Like 'worker' but in 'IO'; It provides address selection function,</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- 'SocketStateChange' and 'CompleteApplication' callbacks.  The 'Main'</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- callback is left as it's useful for testing purposes.</span><span>
</span><span id="line-181"></span><span class="hs-comment">--</span><span>
</span><span id="line-182"></span><span id="local-6989586621679260438"><span id="local-6989586621679260439"><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#subscriptionWorker"><span class="hs-identifier hs-type">subscriptionWorker</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.Snocket.html#Snocket"><span class="hs-identifier hs-type">Snocket</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.Socket</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#SubscriptionTrace"><span class="hs-identifier hs-type">SubscriptionTrace</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.ErrorPolicy.html#WithAddr"><span class="hs-identifier hs-type">WithAddr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span> </span><span class="annot"><a href="Ouroboros.Network.ErrorPolicy.html#ErrorPolicyTrace"><span class="hs-identifier hs-type">ErrorPolicyTrace</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Socket.html#NetworkMutableState"><span class="hs-identifier hs-type">NetworkMutableState</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#WorkerParams"><span class="hs-identifier hs-type">WorkerParams</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#LocalAddresses"><span class="hs-identifier hs-type">LocalAddresses</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.ErrorPolicy.html#ErrorPolicies"><span class="hs-identifier hs-type">ErrorPolicies</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#Main"><span class="hs-identifier hs-type">Main</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.PeerState.html#PeerStates"><span class="hs-identifier hs-type">PeerStates</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679260439"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-comment">-- ^ main callback</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Socket.Socket</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260438"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-comment">-- ^ application to run on each connection</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260439"><span class="hs-identifier hs-type">x</span></a></span></span></span><span>
</span><span id="line-194"></span><span id="subscriptionWorker"><span class="annot"><span class="annottext">subscriptionWorker :: Snocket IO Socket SockAddr
-&gt; Tracer IO (SubscriptionTrace SockAddr)
-&gt; Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
-&gt; NetworkMutableState SockAddr
-&gt; WorkerParams IO LocalAddresses SockAddr
-&gt; ErrorPolicies
-&gt; Main IO (PeerStates IO SockAddr) x
-&gt; (Socket -&gt; IO a)
-&gt; IO x
</span><a href="Ouroboros.Network.Subscription.Ip.html#subscriptionWorker"><span class="hs-identifier hs-var hs-var">subscriptionWorker</span></a></span></span><span> </span><span id="local-6989586621679260263"><span class="annot"><span class="annottext">Snocket IO Socket SockAddr
</span><a href="#local-6989586621679260263"><span class="hs-identifier hs-var">snocket</span></a></span></span><span>
</span><span id="line-195"></span><span>                   </span><span id="local-6989586621679260262"><span class="annot"><span class="annottext">Tracer IO (SubscriptionTrace SockAddr)
</span><a href="#local-6989586621679260262"><span class="hs-identifier hs-var">tracer</span></a></span></span><span>
</span><span id="line-196"></span><span>                   </span><span id="local-6989586621679260261"><span class="annot"><span class="annottext">Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
</span><a href="#local-6989586621679260261"><span class="hs-identifier hs-var">errorPolicyTracer</span></a></span></span><span>
</span><span id="line-197"></span><span>                   </span><span class="annot"><a href="Ouroboros.Network.Socket.html#NetworkMutableState"><span class="hs-identifier hs-type">NetworkMutableState</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679260260"><span class="annot"><span class="annottext">ConnectionTable IO SockAddr
nmsConnectionTable :: forall addr. NetworkMutableState addr -&gt; ConnectionTable IO addr
nmsConnectionTable :: ConnectionTable IO SockAddr
</span><a href="Ouroboros.Network.Socket.html#nmsConnectionTable"><span class="hs-identifier hs-var hs-var">nmsConnectionTable</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679260258"><span class="annot"><span class="annottext">StrictTVar IO (PeerStates IO SockAddr)
nmsPeerStates :: StrictTVar IO (PeerStates IO SockAddr)
nmsPeerStates :: forall addr.
NetworkMutableState addr -&gt; StrictTVar IO (PeerStates IO addr)
</span><a href="#local-6989586621679260258"><span class="hs-identifier hs-var hs-var">nmsPeerStates</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-198"></span><span>                   </span><span id="local-6989586621679260257"><span class="annot"><span class="annottext">WorkerParams IO LocalAddresses SockAddr
</span><a href="#local-6989586621679260257"><span class="hs-identifier hs-var">workerParams</span></a></span></span><span>
</span><span id="line-199"></span><span>                   </span><span id="local-6989586621679260256"><span class="annot"><span class="annottext">ErrorPolicies
</span><a href="#local-6989586621679260256"><span class="hs-identifier hs-var">errorPolicies</span></a></span></span><span>
</span><span id="line-200"></span><span>                   </span><span id="local-6989586621679260255"><span class="annot"><span class="annottext">Main IO (PeerStates IO SockAddr) x
</span><a href="#local-6989586621679260255"><span class="hs-identifier hs-var">main</span></a></span></span><span> </span><span id="local-6989586621679260254"><span class="annot"><span class="annottext">Socket -&gt; IO a
</span><a href="#local-6989586621679260254"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><span class="annottext">Tracer IO (SubscriptionTrace SockAddr)
-&gt; Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
-&gt; ConnectionTable IO SockAddr
-&gt; StrictTVar IO (PeerStates IO SockAddr)
-&gt; Snocket IO Socket SockAddr
-&gt; (Socket -&gt; SockAddr -&gt; IO ())
-&gt; WorkerCallbacks IO (PeerStates IO SockAddr) SockAddr a x
-&gt; WorkerParams IO LocalAddresses SockAddr
-&gt; (Socket -&gt; IO a)
-&gt; IO x
forall s sock (localAddrs :: * -&gt; *) addr a x.
Ord addr =&gt;
Tracer IO (SubscriptionTrace addr)
-&gt; Tracer IO (WithAddr addr ErrorPolicyTrace)
-&gt; ConnectionTable IO addr
-&gt; StateVar IO s
-&gt; Snocket IO sock addr
-&gt; (sock -&gt; addr -&gt; IO ())
-&gt; WorkerCallbacks IO s addr a x
-&gt; WorkerParams IO localAddrs addr
-&gt; (sock -&gt; IO a)
-&gt; IO x
</span><a href="Ouroboros.Network.Subscription.Worker.html#worker"><span class="hs-identifier hs-var">worker</span></a></span><span> </span><span class="annot"><span class="annottext">Tracer IO (SubscriptionTrace SockAddr)
</span><a href="#local-6989586621679260262"><span class="hs-identifier hs-var">tracer</span></a></span><span>
</span><span id="line-202"></span><span>           </span><span class="annot"><span class="annottext">Tracer IO (WithAddr SockAddr ErrorPolicyTrace)
</span><a href="#local-6989586621679260261"><span class="hs-identifier hs-var">errorPolicyTracer</span></a></span><span>
</span><span id="line-203"></span><span>           </span><span class="annot"><span class="annottext">ConnectionTable IO SockAddr
</span><a href="#local-6989586621679260260"><span class="hs-identifier hs-var">nmsConnectionTable</span></a></span><span>
</span><span id="line-204"></span><span>           </span><span class="annot"><span class="annottext">StrictTVar IO (PeerStates IO SockAddr)
</span><a href="#local-6989586621679260258"><span class="hs-identifier hs-var">nmsPeerStates</span></a></span><span>
</span><span id="line-205"></span><span>           </span><span class="annot"><span class="annottext">Snocket IO Socket SockAddr
</span><a href="#local-6989586621679260263"><span class="hs-identifier hs-var">snocket</span></a></span><span>
</span><span id="line-206"></span><span>           </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe SockAddr -&gt; IO ())
-&gt; (SockAddr -&gt; Maybe SockAddr) -&gt; SockAddr -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr -&gt; Maybe SockAddr
forall a. a -&gt; Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Maybe SockAddr -&gt; IO ()) -&gt; SockAddr -&gt; IO ())
-&gt; (Socket -&gt; Maybe SockAddr -&gt; IO ())
-&gt; Socket
-&gt; SockAddr
-&gt; IO ()
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Socket -&gt; Maybe SockAddr -&gt; IO ()
</span><a href="Ouroboros.Network.Socket.html#configureSocket"><span class="hs-identifier hs-var">configureSocket</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>           </span><span class="annot"><span class="annottext">WorkerCallbacks :: forall (m :: * -&gt; *) s addr a t.
SocketStateChange m s addr
-&gt; CompleteApplication m s addr a
-&gt; Main m s t
-&gt; WorkerCallbacks m s addr a t
</span><a href="Ouroboros.Network.Subscription.Worker.html#WorkerCallbacks"><span class="hs-identifier hs-type">WorkerCallbacks</span></a></span><span>
</span><span id="line-208"></span><span>             </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">wcSocketStateChangeTx :: SocketStateChange IO (PeerStates IO SockAddr) SockAddr
</span><a href="Ouroboros.Network.Subscription.Worker.html#wcSocketStateChangeTx"><span class="hs-identifier hs-var">wcSocketStateChangeTx</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SocketStateChange IO (PeerStates IO SockAddr) SockAddr
forall addr.
Ord addr =&gt;
SocketStateChange IO (PeerStates IO addr) addr
</span><a href="Ouroboros.Network.Subscription.Ip.html#socketStateChangeTx"><span class="hs-identifier hs-var">socketStateChangeTx</span></a></span><span>
</span><span id="line-209"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wcCompleteApplicationTx :: CompleteApplication IO (PeerStates IO SockAddr) SockAddr a
</span><a href="Ouroboros.Network.Subscription.Worker.html#wcCompleteApplicationTx"><span class="hs-identifier hs-var">wcCompleteApplicationTx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrorPolicies
-&gt; CompleteApplication IO (PeerStates IO SockAddr) SockAddr a
forall (m :: * -&gt; *) addr a.
(MonadAsync m, Ord addr, Ord (Async m ())) =&gt;
ErrorPolicies -&gt; CompleteApplication m (PeerStates m addr) addr a
</span><a href="Ouroboros.Network.ErrorPolicy.html#completeApplicationTx"><span class="hs-identifier hs-var">completeApplicationTx</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorPolicies
</span><a href="#local-6989586621679260256"><span class="hs-identifier hs-var">errorPolicies</span></a></span><span>
</span><span id="line-210"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wcMainTx :: Main IO (PeerStates IO SockAddr) x
</span><a href="Ouroboros.Network.Subscription.Worker.html#wcMainTx"><span class="hs-identifier hs-var">wcMainTx</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Main IO (PeerStates IO SockAddr) x
</span><a href="#local-6989586621679260255"><span class="hs-identifier hs-var">main</span></a></span><span>
</span><span id="line-211"></span><span>             </span><span class="hs-special">}</span><span>
</span><span id="line-212"></span><span>           </span><span class="annot"><span class="annottext">WorkerParams IO LocalAddresses SockAddr
</span><a href="#local-6989586621679260257"><span class="hs-identifier hs-var">workerParams</span></a></span><span>
</span><span id="line-213"></span><span>           </span><span class="annot"><span class="annottext">Socket -&gt; IO a
</span><a href="#local-6989586621679260254"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-keyword">data</span><span> </span><span id="WithIPList"><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#WithIPList"><span class="hs-identifier hs-var">WithIPList</span></a></span></span><span> </span><span id="local-6989586621679260420"><span class="annot"><a href="#local-6989586621679260420"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WithIPList"><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#WithIPList"><span class="hs-identifier hs-var">WithIPList</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-216"></span><span>      </span><span id="wilSrc"><span class="annot"><span class="annottext">WithIPList a -&gt; LocalAddresses SockAddr
</span><a href="Ouroboros.Network.Subscription.Ip.html#wilSrc"><span class="hs-identifier hs-var hs-var">wilSrc</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#LocalAddresses"><span class="hs-identifier hs-type">LocalAddresses</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wilDsts"><span class="annot"><span class="annottext">WithIPList a -&gt; [SockAddr]
</span><a href="Ouroboros.Network.Subscription.Ip.html#wilDsts"><span class="hs-identifier hs-var hs-var">wilDsts</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Socket.SockAddr</span></span><span class="hs-special">]</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="wilEvent"><span class="annot"><span class="annottext">WithIPList a -&gt; a
</span><a href="Ouroboros.Network.Subscription.Ip.html#wilEvent"><span class="hs-identifier hs-var hs-var">wilEvent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679260420"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span id="local-6989586621679260242"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679260237"><span id="local-6989586621679260240"><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260242"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#WithIPList"><span class="hs-identifier hs-type">WithIPList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679260242"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-222"></span><span>    </span><span id="local-6989586621679260236"><span class="annot"><span class="annottext">show :: WithIPList a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#WithIPList"><span class="hs-identifier hs-type">WithIPList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#LocalAddresses"><span class="hs-identifier hs-type">LocalAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679260234"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260234"><span class="hs-identifier hs-var">ipv6</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679260233"><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679260233"><span class="hs-identifier hs-var">wilDsts</span></a></span></span><span> </span><span id="local-6989586621679260232"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679260232"><span class="hs-identifier hs-var">wilEvent</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-223"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; ShowS
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;IPs: %s %s %s&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SockAddr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260234"><span class="hs-identifier hs-var">ipv6</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SockAddr] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679260233"><span class="hs-identifier hs-var">wilDsts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679260232"><span class="hs-identifier hs-var">wilEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#WithIPList"><span class="hs-identifier hs-type">WithIPList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#LocalAddresses"><span class="hs-identifier hs-type">LocalAddresses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679260230"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260230"><span class="hs-identifier hs-var">ipv4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679260229"><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679260229"><span class="hs-identifier hs-var">wilDsts</span></a></span></span><span> </span><span id="local-6989586621679260228"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679260228"><span class="hs-identifier hs-var">wilEvent</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; ShowS
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;IPs: %s %s %s&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SockAddr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260230"><span class="hs-identifier hs-var">ipv4</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SockAddr] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679260229"><span class="hs-identifier hs-var">wilDsts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679260228"><span class="hs-identifier hs-var">wilEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#WithIPList"><span class="hs-identifier hs-type">WithIPList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#LocalAddresses"><span class="hs-identifier hs-type">LocalAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679260227"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260227"><span class="hs-identifier hs-var">unix</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679260226"><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679260226"><span class="hs-identifier hs-var">wilDsts</span></a></span></span><span> </span><span id="local-6989586621679260225"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679260225"><span class="hs-identifier hs-var">wilEvent</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-227"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; ShowS
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;IPs: %s %s %s&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SockAddr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260227"><span class="hs-identifier hs-var">unix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SockAddr] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679260226"><span class="hs-identifier hs-var">wilDsts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679260225"><span class="hs-identifier hs-var">wilEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#WithIPList"><span class="hs-identifier hs-type">WithIPList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Subscription.Worker.html#LocalAddresses"><span class="hs-identifier hs-type">LocalAddresses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679260224"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260224"><span class="hs-identifier hs-var">ipv4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679260223"><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260223"><span class="hs-identifier hs-var">ipv6</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe SockAddr
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679260222"><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679260222"><span class="hs-identifier hs-var">wilDsts</span></a></span></span><span> </span><span id="local-6989586621679260221"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679260221"><span class="hs-identifier hs-var">wilEvent</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; String -&gt; ShowS
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;IPs: %s %s %s %s&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SockAddr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260224"><span class="hs-identifier hs-var">ipv4</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SockAddr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">SockAddr
</span><a href="#local-6989586621679260223"><span class="hs-identifier hs-var">ipv6</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SockAddr] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679260222"><span class="hs-identifier hs-var">wilDsts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679260221"><span class="hs-identifier hs-var">wilEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><a href="Ouroboros.Network.Subscription.Ip.html#WithIPList"><span class="hs-identifier hs-type">WithIPList</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679260220"><span class="annot"><span class="annottext">LocalAddresses SockAddr
wilSrc :: LocalAddresses SockAddr
wilSrc :: forall a. WithIPList a -&gt; LocalAddresses SockAddr
</span><a href="#local-6989586621679260220"><span class="hs-identifier hs-var hs-var">wilSrc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679260219"><span class="annot"><span class="annottext">[SockAddr]
wilDsts :: [SockAddr]
wilDsts :: forall a. WithIPList a -&gt; [SockAddr]
</span><a href="#local-6989586621679260219"><span class="hs-identifier hs-var hs-var">wilDsts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679260218"><span class="annot"><span class="annottext">a
wilEvent :: a
wilEvent :: forall a. WithIPList a -&gt; a
</span><a href="#local-6989586621679260218"><span class="hs-identifier hs-var hs-var">wilEvent</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-232"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; ShowS
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;IPs: %s %s %s&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LocalAddresses SockAddr -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">LocalAddresses SockAddr
</span><a href="#local-6989586621679260220"><span class="hs-identifier hs-var">wilSrc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SockAddr] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">[SockAddr]
</span><a href="#local-6989586621679260219"><span class="hs-identifier hs-var">wilDsts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679260218"><span class="hs-identifier hs-var">wilEvent</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span></pre></body></html>