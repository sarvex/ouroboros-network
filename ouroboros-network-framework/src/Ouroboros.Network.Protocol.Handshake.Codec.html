<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns        #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GADTs               #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures      #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds           #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Network.Protocol.Handshake.Codec</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#codecHandshake"><span class="hs-identifier">codecHandshake</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#byteLimitsHandshake"><span class="hs-identifier">byteLimitsHandshake</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#timeLimitsHandshake"><span class="hs-identifier">timeLimitsHandshake</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#noTimeLimitsHandshake"><span class="hs-identifier">noTimeLimitsHandshake</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#encodeRefuseReason"><span class="hs-identifier">encodeRefuseReason</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#decodeRefuseReason"><span class="hs-identifier">decodeRefuseReason</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Version data codec</span></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#VersionDataCodec"><span class="hs-identifier">VersionDataCodec</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#cborTermVersionDataCodec"><span class="hs-identifier">cborTermVersionDataCodec</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><span class="hs-comment">-- * NodeToNode &amp; NodeToClient Codecs</span></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#nodeToNodeHandshakeCodec"><span class="hs-identifier">nodeToNodeHandshakeCodec</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#nodeToClientHandshakeCodec"><span class="hs-identifier">nodeToClientHandshakeCodec</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">replicateM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">unless</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadST</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadTime</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/bytestring-0.10.12.0/src"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/bytestring-0.10.12.0/src"><span class="hs-identifier">ByteString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/bytestring-0.10.12.0/src"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">partitionEithers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">mapMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/text-1.2.4.1/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/text-1.2.4.1/src"><span class="hs-identifier">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Text.Printf</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Network.TypedProtocol.Codec.CBOR</span></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Decoding</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Encoding</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Read</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Codec.CBOR.Term</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CBOR</span></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">Ouroboros.Network.CodecCBORTerm</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.Driver.Limits.html"><span class="hs-identifier">Ouroboros.Network.Driver.Limits</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html"><span class="hs-identifier">Ouroboros.Network.Protocol.Handshake.Type</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">Ouroboros.Network.Protocol.Limits</span></a></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">Ouroboros.Network.NodeToClient.Version</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">NodeToClientVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>                     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">nodeToClientVersionCodec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">Ouroboros.Network.NodeToNode.Version</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">NodeToNodeVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>                     </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier">nodeToNodeVersionCodec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">-- | Codec for version data ('vData' in code) exchanged by the handshake</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- protocol.</span><span>
</span><span id="line-57"></span><span class="hs-comment">--</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- Note: 'extra' type param is instantiated to 'DictVersion'; 'agreedOptions'</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- is instantiated to 'NodeToNodeVersionData' in &quot;Ouroboros.Network.NodeToNode&quot;</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- or to '()' in &quot;Ouroboros.Network.NodeToClient&quot;.</span><span>
</span><span id="line-61"></span><span class="hs-comment">--</span><span>
</span><span id="line-62"></span><span class="hs-keyword">data</span><span> </span><span id="VersionDataCodec"><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#VersionDataCodec"><span class="hs-identifier hs-var">VersionDataCodec</span></a></span></span><span> </span><span id="local-6989586621679252726"><span class="annot"><a href="#local-6989586621679252726"><span class="hs-identifier hs-type">bytes</span></a></span></span><span> </span><span id="local-6989586621679252728"><span class="annot"><a href="#local-6989586621679252728"><span class="hs-identifier hs-type">vNumber</span></a></span></span><span> </span><span id="local-6989586621679252727"><span class="annot"><a href="#local-6989586621679252727"><span class="hs-identifier hs-type">vData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="VersionDataCodec"><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#VersionDataCodec"><span class="hs-identifier hs-var">VersionDataCodec</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-63"></span><span>    </span><span id="encodeData"><span class="annot"><span class="annottext">VersionDataCodec bytes vNumber vData -&gt; vNumber -&gt; vData -&gt; bytes
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#encodeData"><span class="hs-identifier hs-var hs-var">encodeData</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679252728"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252727"><span class="hs-identifier hs-type">vData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252726"><span class="hs-identifier hs-type">bytes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-comment">-- ^ encoder of 'vData' which has access to 'extra vData' which can bring</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-comment">-- extra instances into the scope (by means of pattern matching on a GADT).</span><span>
</span><span id="line-66"></span><span>    </span><span id="decodeData"><span class="annot"><span class="annottext">VersionDataCodec bytes vNumber vData
-&gt; vNumber -&gt; bytes -&gt; Either Text vData
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#decodeData"><span class="hs-identifier hs-var hs-var">decodeData</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679252728"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679252726"><span class="hs-identifier hs-type">bytes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252727"><span class="hs-identifier hs-type">vData</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-comment">-- ^ decoder of 'vData'.</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- TODO: remove this from top level API, this is the only way we encode or</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- decode version data.</span><span>
</span><span id="line-72"></span><span id="local-6989586621679252546"><span id="local-6989586621679252547"><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#cborTermVersionDataCodec"><span class="hs-identifier hs-type">cborTermVersionDataCodec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252547"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">CodecCBORTerm</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/text-1.2.4.1/src"><span class="hs-identifier hs-type">Text</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252546"><span class="hs-identifier hs-type">vData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#VersionDataCodec"><span class="hs-identifier hs-type">VersionDataCodec</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span> </span><span class="annot"><a href="#local-6989586621679252547"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252546"><span class="hs-identifier hs-type">vData</span></a></span></span></span><span>
</span><span id="line-74"></span><span id="cborTermVersionDataCodec"><span class="annot"><span class="annottext">cborTermVersionDataCodec :: (vNumber -&gt; CodecCBORTerm Text vData)
-&gt; VersionDataCodec Term vNumber vData
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#cborTermVersionDataCodec"><span class="hs-identifier hs-var hs-var">cborTermVersionDataCodec</span></a></span></span><span> </span><span id="local-6989586621679252545"><span class="annot"><span class="annottext">vNumber -&gt; CodecCBORTerm Text vData
</span><a href="#local-6989586621679252545"><span class="hs-identifier hs-var">codec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VersionDataCodec :: forall bytes vNumber vData.
(vNumber -&gt; vData -&gt; bytes)
-&gt; (vNumber -&gt; bytes -&gt; Either Text vData)
-&gt; VersionDataCodec bytes vNumber vData
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#VersionDataCodec"><span class="hs-identifier hs-type">VersionDataCodec</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-75"></span><span>      </span><span class="annot"><span class="annottext">encodeData :: vNumber -&gt; vData -&gt; Term
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#encodeData"><span class="hs-identifier hs-var">encodeData</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm Text vData -&gt; vData -&gt; Term
forall fail a. CodecCBORTerm fail a -&gt; a -&gt; Term
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var">encodeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">(CodecCBORTerm Text vData -&gt; vData -&gt; Term)
-&gt; (vNumber -&gt; CodecCBORTerm Text vData)
-&gt; vNumber
-&gt; vData
-&gt; Term
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">vNumber -&gt; CodecCBORTerm Text vData
</span><a href="#local-6989586621679252545"><span class="hs-identifier hs-var">codec</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>      </span><span class="annot"><span class="annottext">decodeData :: vNumber -&gt; Term -&gt; Either Text vData
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#decodeData"><span class="hs-identifier hs-var">decodeData</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm Text vData -&gt; Term -&gt; Either Text vData
forall fail a. CodecCBORTerm fail a -&gt; Term -&gt; Either fail a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var">decodeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">(CodecCBORTerm Text vData -&gt; Term -&gt; Either Text vData)
-&gt; (vNumber -&gt; CodecCBORTerm Text vData)
-&gt; vNumber
-&gt; Term
-&gt; Either Text vData
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">vNumber -&gt; CodecCBORTerm Text vData
</span><a href="#local-6989586621679252545"><span class="hs-identifier hs-var">codec</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- We assume that a TCP segment size of 1440 bytes with initial window of size</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- 4.  This sets upper limit of 5760 bytes on each message of handshake</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- protocol.</span><span>
</span><span id="line-83"></span><span class="hs-comment">--</span><span>
</span><span id="line-84"></span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#maxTransmissionUnit"><span class="hs-identifier hs-type">maxTransmissionUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Word</span></a></span><span>
</span><span id="line-85"></span><span id="maxTransmissionUnit"><span class="annot"><span class="annottext">maxTransmissionUnit :: Word
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#maxTransmissionUnit"><span class="hs-identifier hs-var hs-var">maxTransmissionUnit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Word -&gt; Word
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1440</span></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-comment">-- | Byte limits</span><span>
</span><span id="line-88"></span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#byteLimitsHandshake"><span class="hs-identifier hs-type">byteLimitsHandshake</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252539"><span class="annot"><a href="#local-6989586621679252539"><span class="hs-identifier hs-type">vNumber</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">ProtocolSizeLimits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252539"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/bytestring-0.10.12.0/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-89"></span><span id="byteLimitsHandshake"><span class="annot"><span class="annottext">byteLimitsHandshake :: ProtocolSizeLimits (Handshake vNumber Term) ByteString
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#byteLimitsHandshake"><span class="hs-identifier hs-var hs-var">byteLimitsHandshake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (pr :: PeerRole) (st :: Handshake vNumber Term).
 PeerHasAgency pr st -&gt; Word)
-&gt; (ByteString -&gt; Word)
-&gt; ProtocolSizeLimits (Handshake vNumber Term) ByteString
forall ps bytes.
(forall (pr :: PeerRole) (st :: ps). PeerHasAgency pr st -&gt; Word)
-&gt; (bytes -&gt; Word) -&gt; ProtocolSizeLimits ps bytes
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">ProtocolSizeLimits</span></a></span><span> </span><span class="annot"><span class="annottext">forall (pr :: PeerRole) (st :: Handshake vNumber Term).
PeerHasAgency pr st -&gt; Word
</span><a href="#local-6989586621679252537"><span class="hs-identifier hs-var">stateToLimit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64 -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int64 -&gt; Word) -&gt; (ByteString -&gt; Int64) -&gt; ByteString -&gt; Word
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Int64
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/bytestring-0.10.12.0/src"><span class="hs-identifier hs-var">BL.length</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="#local-6989586621679252537"><span class="hs-identifier hs-type">stateToLimit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252535"><span class="annot"><a href="#local-6989586621679252535"><span class="hs-identifier hs-type">pr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerRole</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252534"><span class="annot"><a href="#local-6989586621679252534"><span class="hs-identifier hs-type">st</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252539"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-92"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">PeerHasAgency</span></span><span> </span><span class="annot"><a href="#local-6989586621679252535"><span class="hs-identifier hs-type">pr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252534"><span class="hs-identifier hs-type">st</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Word</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621679252537"><span class="annot"><span class="annottext">stateToLimit :: PeerHasAgency pr st -&gt; Word
</span><a href="#local-6989586621679252537"><span class="hs-identifier hs-var hs-var">stateToLimit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClientAgency</span></span><span> </span><span class="annot"><span class="annottext">ClientHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokPropose"><span class="hs-identifier hs-var">TokPropose</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#maxTransmissionUnit"><span class="hs-identifier hs-var">maxTransmissionUnit</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><a href="#local-6989586621679252537"><span class="hs-identifier hs-var">stateToLimit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ServerAgency</span></span><span> </span><span class="annot"><span class="annottext">ServerHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokConfirm"><span class="hs-identifier hs-var">TokConfirm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#maxTransmissionUnit"><span class="hs-identifier hs-var">maxTransmissionUnit</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">-- | Time limits.</span><span>
</span><span id="line-97"></span><span class="hs-comment">--</span><span>
</span><span id="line-98"></span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#timeLimitsHandshake"><span class="hs-identifier hs-type">timeLimitsHandshake</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252529"><span class="annot"><a href="#local-6989586621679252529"><span class="hs-identifier hs-type">vNumber</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">ProtocolTimeLimits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252529"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span id="timeLimitsHandshake"><span class="annot"><span class="annottext">timeLimitsHandshake :: ProtocolTimeLimits (Handshake vNumber Term)
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#timeLimitsHandshake"><span class="hs-identifier hs-var hs-var">timeLimitsHandshake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (pr :: PeerRole) (st :: Handshake vNumber Term).
 PeerHasAgency pr st -&gt; Maybe DiffTime)
-&gt; ProtocolTimeLimits (Handshake vNumber Term)
forall ps.
(forall (pr :: PeerRole) (st :: ps).
 PeerHasAgency pr st -&gt; Maybe DiffTime)
-&gt; ProtocolTimeLimits ps
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">ProtocolTimeLimits</span></a></span><span> </span><span class="annot"><span class="annottext">forall (pr :: PeerRole) (st :: Handshake vNumber Term).
PeerHasAgency pr st -&gt; Maybe DiffTime
</span><a href="#local-6989586621679252527"><span class="hs-identifier hs-var">stateToLimit</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="#local-6989586621679252527"><span class="hs-identifier hs-type">stateToLimit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252526"><span class="annot"><a href="#local-6989586621679252526"><span class="hs-identifier hs-type">pr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerRole</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252525"><span class="annot"><a href="#local-6989586621679252525"><span class="hs-identifier hs-type">st</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252529"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-102"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">PeerHasAgency</span></span><span> </span><span class="annot"><a href="#local-6989586621679252526"><span class="hs-identifier hs-type">pr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252525"><span class="hs-identifier hs-type">st</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621679252527"><span class="annot"><span class="annottext">stateToLimit :: PeerHasAgency pr st -&gt; Maybe DiffTime
</span><a href="#local-6989586621679252527"><span class="hs-identifier hs-var hs-var">stateToLimit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClientAgency</span></span><span> </span><span class="annot"><span class="annottext">ClientHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokPropose"><span class="hs-identifier hs-var">TokPropose</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DiffTime
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">shortWait</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="#local-6989586621679252527"><span class="hs-identifier hs-var">stateToLimit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ServerAgency</span></span><span> </span><span class="annot"><span class="annottext">ServerHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokConfirm"><span class="hs-identifier hs-var">TokConfirm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DiffTime
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">shortWait</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#noTimeLimitsHandshake"><span class="hs-identifier hs-type">noTimeLimitsHandshake</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252523"><span class="annot"><a href="#local-6989586621679252523"><span class="hs-identifier hs-type">vNumber</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">ProtocolTimeLimits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252523"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span id="noTimeLimitsHandshake"><span class="annot"><span class="annottext">noTimeLimitsHandshake :: ProtocolTimeLimits (Handshake vNumber Term)
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#noTimeLimitsHandshake"><span class="hs-identifier hs-var hs-var">noTimeLimitsHandshake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (pr :: PeerRole) (st :: Handshake vNumber Term).
 PeerHasAgency pr st -&gt; Maybe DiffTime)
-&gt; ProtocolTimeLimits (Handshake vNumber Term)
forall ps.
(forall (pr :: PeerRole) (st :: ps).
 PeerHasAgency pr st -&gt; Maybe DiffTime)
-&gt; ProtocolTimeLimits ps
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">ProtocolTimeLimits</span></a></span><span> </span><span class="annot"><span class="annottext">forall (pr :: PeerRole) (st :: Handshake vNumber Term).
PeerHasAgency pr st -&gt; Maybe DiffTime
</span><a href="#local-6989586621679252522"><span class="hs-identifier hs-var">stateToLimit</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><a href="#local-6989586621679252522"><span class="hs-identifier hs-type">stateToLimit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252521"><span class="annot"><a href="#local-6989586621679252521"><span class="hs-identifier hs-type">pr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerRole</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252520"><span class="annot"><a href="#local-6989586621679252520"><span class="hs-identifier hs-type">st</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252523"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-111"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">PeerHasAgency</span></span><span> </span><span class="annot"><a href="#local-6989586621679252521"><span class="hs-identifier hs-type">pr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252520"><span class="hs-identifier hs-type">st</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/time-1.9.3/src"><span class="hs-identifier hs-type">DiffTime</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621679252522"><span class="annot"><span class="annottext">stateToLimit :: PeerHasAgency pr st -&gt; Maybe DiffTime
</span><a href="#local-6989586621679252522"><span class="hs-identifier hs-var hs-var">stateToLimit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClientAgency</span></span><span> </span><span class="annot"><span class="annottext">ClientHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokPropose"><span class="hs-identifier hs-var">TokPropose</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DiffTime
forall a. Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="#local-6989586621679252522"><span class="hs-identifier hs-var">stateToLimit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ServerAgency</span></span><span> </span><span class="annot"><span class="annottext">ServerHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokConfirm"><span class="hs-identifier hs-var">TokConfirm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe DiffTime
forall a. Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- @'Handshake'@ codec.  The @'MsgProposeVersions'@ encodes proposed map in</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- ascending order and it expects to receive them in this order.  This allows</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- to construct the map in linear time.  There is also another limiting factor</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- to the number of versions on can present: the whole message must fit into</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- a single TCP segment.</span><span>
</span><span id="line-122"></span><span class="hs-comment">--</span><span>
</span><span id="line-123"></span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#codecHandshake"><span class="hs-identifier hs-type">codecHandshake</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252569"><span class="annot"><a href="#local-6989586621679252569"><span class="hs-identifier hs-type">vNumber</span></a></span></span><span> </span><span id="local-6989586621679252570"><span class="annot"><a href="#local-6989586621679252570"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679252568"><span class="annot"><a href="#local-6989586621679252568"><span class="hs-identifier hs-type">failure</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-125"></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadST</span></span><span> </span><span class="annot"><a href="#local-6989586621679252570"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-126"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252569"><span class="hs-identifier hs-type">vNumber</span></a></span><span>
</span><span id="line-127"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252568"><span class="hs-identifier hs-type">failure</span></a></span><span>
</span><span id="line-128"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">CodecCBORTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252568"><span class="hs-identifier hs-type">failure</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252569"><span class="hs-identifier hs-type">vNumber</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252569"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.DeserialiseFailure</span></span><span> </span><span class="annot"><a href="#local-6989586621679252570"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/bytestring-0.10.12.0/src"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-131"></span><span id="codecHandshake"><span class="annot"><span class="annottext">codecHandshake :: CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Codec (Handshake vNumber Term) DeserialiseFailure m ByteString
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#codecHandshake"><span class="hs-identifier hs-var hs-var">codecHandshake</span></a></span></span><span> </span><span id="local-6989586621679252519"><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252519"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall (pr :: PeerRole) (st :: Handshake vNumber Term)
        (st' :: Handshake vNumber Term).
 PeerHasAgency pr st
 -&gt; Message (Handshake vNumber Term) st st' -&gt; Encoding)
-&gt; (forall (pr :: PeerRole) (st :: Handshake vNumber Term) s.
    PeerHasAgency pr st -&gt; Decoder s (SomeMessage st))
-&gt; Codec (Handshake vNumber Term) DeserialiseFailure m ByteString
forall ps (m :: * -&gt; *).
MonadST m =&gt;
(forall (pr :: PeerRole) (st :: ps) (st' :: ps).
 PeerHasAgency pr st -&gt; Message ps st st' -&gt; Encoding)
-&gt; (forall (pr :: PeerRole) (st :: ps) s.
    PeerHasAgency pr st -&gt; Decoder s (SomeMessage st))
-&gt; Codec ps DeserialiseFailure m ByteString
</span><span class="hs-identifier hs-var">mkCodecCborLazyBS</span></span><span> </span><span class="annot"><span class="annottext">forall (pr :: PeerRole) (st :: Handshake vNumber Term)
       (st' :: Handshake vNumber Term).
PeerHasAgency pr st
-&gt; Message (Handshake vNumber Term) st st' -&gt; Encoding
</span><a href="#local-6989586621679252517"><span class="hs-identifier hs-var">encodeMsg</span></a></span><span> </span><span class="annot"><span class="annottext">forall (pr :: PeerRole) s (st :: Handshake vNumber Term).
PeerHasAgency pr st -&gt; Decoder s (SomeMessage st)
forall (pr :: PeerRole) (st :: Handshake vNumber Term) s.
PeerHasAgency pr st -&gt; Decoder s (SomeMessage st)
</span><a href="#local-6989586621679252516"><span class="hs-identifier hs-var">decodeMsg</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><a href="#local-6989586621679252517"><span class="hs-identifier hs-type">encodeMsg</span></a></span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252515"><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">pr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerRole</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679252514"><span class="annot"><a href="#local-6989586621679252514"><span class="hs-identifier hs-type">st</span></a></span></span><span> </span><span id="local-6989586621679252513"><span class="annot"><a href="#local-6989586621679252513"><span class="hs-identifier hs-type">st'</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-135"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">PeerHasAgency</span></span><span> </span><span class="annot"><a href="#local-6989586621679252515"><span class="hs-identifier hs-type">pr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252514"><span class="hs-identifier hs-type">st</span></a></span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252569"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252514"><span class="hs-identifier hs-type">st</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252513"><span class="hs-identifier hs-type">st'</span></a></span><span>
</span><span id="line-137"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Encoding</span></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>      </span><span id="local-6989586621679252517"><span class="annot"><span class="annottext">encodeMsg :: PeerHasAgency pr st
-&gt; Message (Handshake vNumber Term) st st' -&gt; Encoding
</span><a href="#local-6989586621679252517"><span class="hs-identifier hs-var hs-var">encodeMsg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClientAgency</span></span><span> </span><span class="annot"><span class="annottext">ClientHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokPropose"><span class="hs-identifier hs-var">TokPropose</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#MsgProposeVersions"><span class="hs-identifier hs-type">MsgProposeVersions</span></a></span><span> </span><span id="local-6989586621679252511"><span class="annot"><a href="#local-6989586621679252511"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>           </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">2</span></span><span>
</span><span id="line-141"></span><span>        </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeWord</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Map vNumber Term -&gt; Encoding
forall failure vNumber.
CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Map vNumber Term -&gt; Encoding
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#encodeVersions"><span class="hs-identifier hs-var">encodeVersions</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252519"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber Term
Map vNumber vParams
</span><a href="#local-6989586621679252511"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>      </span><span class="hs-comment">-- Although `MsgReplyVersions` shall not be sent, for testing purposes it</span><span>
</span><span id="line-145"></span><span>      </span><span class="hs-comment">-- is useful to have an encoder for it.</span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><a href="#local-6989586621679252517"><span class="hs-identifier hs-var">encodeMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ServerAgency</span></span><span> </span><span class="annot"><span class="annottext">ServerHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokConfirm"><span class="hs-identifier hs-var">TokConfirm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#MsgReplyVersions"><span class="hs-identifier hs-type">MsgReplyVersions</span></a></span><span> </span><span id="local-6989586621679252506"><span class="annot"><a href="#local-6989586621679252506"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">2</span></span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeWord</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span>
</span><span id="line-149"></span><span>        </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Map vNumber Term -&gt; Encoding
forall failure vNumber.
CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Map vNumber Term -&gt; Encoding
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#encodeVersions"><span class="hs-identifier hs-var">encodeVersions</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252519"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber Term
Map vNumber vParams
</span><a href="#local-6989586621679252506"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><a href="#local-6989586621679252517"><span class="hs-identifier hs-var">encodeMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ServerAgency</span></span><span> </span><span class="annot"><span class="annottext">ServerHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokConfirm"><span class="hs-identifier hs-var">TokConfirm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#MsgAcceptVersion"><span class="hs-identifier hs-type">MsgAcceptVersion</span></a></span><span> </span><span id="local-6989586621679252504"><span class="annot"><a href="#local-6989586621679252504"><span class="hs-identifier hs-var">vNumber</span></a></span></span><span> </span><span id="local-6989586621679252503"><span class="annot"><a href="#local-6989586621679252503"><span class="hs-identifier hs-var">vParams</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-152"></span><span>           </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">3</span></span><span>
</span><span id="line-153"></span><span>        </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeWord</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span>
</span><span id="line-154"></span><span>        </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeTerm</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber -&gt; vNumber -&gt; Term
forall fail a. CodecCBORTerm fail a -&gt; a -&gt; Term
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var">encodeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252519"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">vNumber
vNumber
</span><a href="#local-6989586621679252504"><span class="hs-identifier hs-var">vNumber</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>        </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeTerm</span></span><span> </span><span class="annot"><span class="annottext">vParams
Term
</span><a href="#local-6989586621679252503"><span class="hs-identifier hs-var">vParams</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>      </span><span class="annot"><a href="#local-6989586621679252517"><span class="hs-identifier hs-var">encodeMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ServerAgency</span></span><span> </span><span class="annot"><span class="annottext">ServerHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokConfirm"><span class="hs-identifier hs-var">TokConfirm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#MsgRefuse"><span class="hs-identifier hs-type">MsgRefuse</span></a></span><span> </span><span id="local-6989586621679252500"><span class="annot"><a href="#local-6989586621679252500"><span class="hs-identifier hs-var">vReason</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-158"></span><span>           </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">2</span></span><span>
</span><span id="line-159"></span><span>        </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeWord</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">2</span></span><span>
</span><span id="line-160"></span><span>        </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; RefuseReason vNumber -&gt; Encoding
forall fail vNumber.
CodecCBORTerm fail vNumber -&gt; RefuseReason vNumber -&gt; Encoding
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#encodeRefuseReason"><span class="hs-identifier hs-var">encodeRefuseReason</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252519"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">RefuseReason vNumber
RefuseReason vNumber
</span><a href="#local-6989586621679252500"><span class="hs-identifier hs-var">vReason</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><a href="#local-6989586621679252516"><span class="hs-identifier hs-type">decodeMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252668"><span class="annot"><a href="#local-6989586621679252668"><span class="hs-identifier hs-type">pr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PeerRole</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679252666"><span class="annot"><a href="#local-6989586621679252666"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679252667"><span class="annot"><a href="#local-6989586621679252667"><span class="hs-identifier hs-type">st</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252569"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-163"></span><span>                   </span><span class="annot"><span class="hs-identifier hs-type">PeerHasAgency</span></span><span> </span><span class="annot"><a href="#local-6989586621679252668"><span class="hs-identifier hs-type">pr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252667"><span class="hs-identifier hs-type">st</span></a></span><span>
</span><span id="line-164"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679252666"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SomeMessage</span></span><span> </span><span class="annot"><a href="#local-6989586621679252667"><span class="hs-identifier hs-type">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>      </span><span id="local-6989586621679252516"><span class="annot"><span class="annottext">decodeMsg :: PeerHasAgency pr st -&gt; Decoder s (SomeMessage st)
</span><a href="#local-6989586621679252516"><span class="hs-identifier hs-var hs-var">decodeMsg</span></a></span></span><span> </span><span id="local-6989586621679252499"><span class="annot"><span class="annottext">PeerHasAgency pr st
</span><a href="#local-6989586621679252499"><span class="hs-identifier hs-var">stok</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-166"></span><span>        </span><span id="local-6989586621679252498"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252498"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Int
forall s. Decoder s Int
</span><span class="hs-identifier hs-var">CBOR.decodeListLen</span></span><span>
</span><span id="line-167"></span><span>        </span><span id="local-6989586621679252496"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679252496"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Word
forall s. Decoder s Word
</span><span class="hs-identifier hs-var">CBOR.decodeWord</span></span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerHasAgency pr st
</span><a href="#local-6989586621679252499"><span class="hs-identifier hs-var">stok</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679252496"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252498"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-169"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClientAgency</span></span><span> </span><span class="annot"><span class="annottext">ClientHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokPropose"><span class="hs-identifier hs-var">TokPropose</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-170"></span><span>            </span><span id="local-6989586621679252494"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252494"><span class="hs-identifier hs-var">l</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Int
forall s. Decoder s Int
</span><span class="hs-identifier hs-var">CBOR.decodeMapLen</span></span><span>
</span><span id="line-171"></span><span>            </span><span id="local-6989586621679252492"><span class="annot"><span class="annottext">Map vNumber Term
</span><a href="#local-6989586621679252492"><span class="hs-identifier hs-var">vMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Int -&gt; Decoder s (Map vNumber Term)
forall vNumber failure s.
Ord vNumber =&gt;
CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Int -&gt; Decoder s (Map vNumber Term)
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#decodeVersions"><span class="hs-identifier hs-var">decodeVersions</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252519"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252494"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-172"></span><span>            </span><span class="annot"><span class="annottext">SomeMessage 'StPropose -&gt; Decoder s (SomeMessage 'StPropose)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeMessage 'StPropose -&gt; Decoder s (SomeMessage 'StPropose))
-&gt; SomeMessage 'StPropose -&gt; Decoder s (SomeMessage 'StPropose)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Message (Handshake vNumber Term) 'StPropose 'StConfirm
-&gt; SomeMessage 'StPropose
forall ps (st :: ps) (st' :: ps).
Message ps st st' -&gt; SomeMessage st
</span><span class="hs-identifier hs-var">SomeMessage</span></span><span> </span><span class="annot"><span class="annottext">(Message (Handshake vNumber Term) 'StPropose 'StConfirm
 -&gt; SomeMessage 'StPropose)
-&gt; Message (Handshake vNumber Term) 'StPropose 'StConfirm
-&gt; SomeMessage 'StPropose
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber Term
-&gt; Message (Handshake vNumber Term) 'StPropose 'StConfirm
forall vNumber vNumber.
Map vNumber vNumber
-&gt; Message (Handshake vNumber vNumber) 'StPropose 'StConfirm
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#MsgProposeVersions"><span class="hs-identifier hs-var">MsgProposeVersions</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber Term
</span><a href="#local-6989586621679252492"><span class="hs-identifier hs-var">vMap</span></a></span><span>
</span><span id="line-173"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ServerAgency</span></span><span> </span><span class="annot"><span class="annottext">ServerHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokConfirm"><span class="hs-identifier hs-var">TokConfirm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-174"></span><span>            </span><span id="local-6989586621679252489"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252489"><span class="hs-identifier hs-var">l</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Int
forall s. Decoder s Int
</span><span class="hs-identifier hs-var">CBOR.decodeMapLen</span></span><span>
</span><span id="line-175"></span><span>            </span><span id="local-6989586621679252488"><span class="annot"><span class="annottext">Map vNumber Term
</span><a href="#local-6989586621679252488"><span class="hs-identifier hs-var">vMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Int -&gt; Decoder s (Map vNumber Term)
forall vNumber failure s.
Ord vNumber =&gt;
CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Int -&gt; Decoder s (Map vNumber Term)
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#decodeVersions"><span class="hs-identifier hs-var">decodeVersions</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252519"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252489"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-176"></span><span>            </span><span class="annot"><span class="annottext">SomeMessage 'StConfirm -&gt; Decoder s (SomeMessage 'StConfirm)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(SomeMessage 'StConfirm -&gt; Decoder s (SomeMessage 'StConfirm))
-&gt; SomeMessage 'StConfirm -&gt; Decoder s (SomeMessage 'StConfirm)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Message (Handshake vNumber Term) 'StConfirm 'StDone
-&gt; SomeMessage 'StConfirm
forall ps (st :: ps) (st' :: ps).
Message ps st st' -&gt; SomeMessage st
</span><span class="hs-identifier hs-var">SomeMessage</span></span><span> </span><span class="annot"><span class="annottext">(Message (Handshake vNumber Term) 'StConfirm 'StDone
 -&gt; SomeMessage 'StConfirm)
-&gt; Message (Handshake vNumber Term) 'StConfirm 'StDone
-&gt; SomeMessage 'StConfirm
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber Term
-&gt; Message (Handshake vNumber Term) 'StConfirm 'StDone
forall vNumber vNumber.
Map vNumber vNumber
-&gt; Message (Handshake vNumber vNumber) 'StConfirm 'StDone
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#MsgReplyVersions"><span class="hs-identifier hs-var">MsgReplyVersions</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber Term
</span><a href="#local-6989586621679252488"><span class="hs-identifier hs-var">vMap</span></a></span><span>
</span><span id="line-177"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ServerAgency</span></span><span> </span><span class="annot"><span class="annottext">ServerHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokConfirm"><span class="hs-identifier hs-var">TokConfirm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>            </span><span id="local-6989586621679252487"><span class="annot"><span class="annottext">Either (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252487"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Term -&gt; Either (failure, Maybe Int) vNumber
forall fail a. CodecCBORTerm fail a -&gt; Term -&gt; Either fail a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var">decodeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252519"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Either (failure, Maybe Int) vNumber)
-&gt; Decoder s Term
-&gt; Decoder s (Either (failure, Maybe Int) vNumber)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Term
forall s. Decoder s Term
</span><span class="hs-identifier hs-var">CBOR.decodeTerm</span></span><span>
</span><span id="line-179"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252487"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-180"></span><span>              </span><span class="hs-comment">-- at this stage we can throw exception when decoding</span><span>
</span><span id="line-181"></span><span>              </span><span class="hs-comment">-- version number: 'MsgAcceptVersion' must send us back</span><span>
</span><span id="line-182"></span><span>              </span><span class="hs-comment">-- version which we know how to decode</span><span>
</span><span id="line-183"></span><span>              </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679252484"><span class="annot"><span class="annottext">(failure, Maybe Int)
</span><a href="#local-6989586621679252484"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Decoder s (SomeMessage st)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;codecHandshake.MsgAcceptVersion: not recognized version: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(failure, Maybe Int) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(failure, Maybe Int)
</span><a href="#local-6989586621679252484"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>              </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679252482"><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252482"><span class="hs-identifier hs-var">vNumber</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-185"></span><span>                </span><span class="annot"><span class="annottext">Message (Handshake vNumber Term) 'StConfirm 'StDone
-&gt; SomeMessage 'StConfirm
forall ps (st :: ps) (st' :: ps).
Message ps st st' -&gt; SomeMessage st
</span><span class="hs-identifier hs-var">SomeMessage</span></span><span> </span><span class="annot"><span class="annottext">(Message (Handshake vNumber Term) 'StConfirm 'StDone
 -&gt; SomeMessage 'StConfirm)
-&gt; (Term -&gt; Message (Handshake vNumber Term) 'StConfirm 'StDone)
-&gt; Term
-&gt; SomeMessage 'StConfirm
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">vNumber
-&gt; Term -&gt; Message (Handshake vNumber Term) 'StConfirm 'StDone
forall vNumber vNumber.
vNumber
-&gt; vNumber
-&gt; Message (Handshake vNumber vNumber) 'StConfirm 'StDone
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#MsgAcceptVersion"><span class="hs-identifier hs-var">MsgAcceptVersion</span></a></span><span> </span><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252482"><span class="hs-identifier hs-var">vNumber</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; SomeMessage 'StConfirm)
-&gt; Decoder s Term -&gt; Decoder s (SomeMessage 'StConfirm)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Term
forall s. Decoder s Term
</span><span class="hs-identifier hs-var">CBOR.decodeTerm</span></span><span>
</span><span id="line-186"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ServerAgency</span></span><span> </span><span class="annot"><span class="annottext">ServerHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokConfirm"><span class="hs-identifier hs-var">TokConfirm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-187"></span><span>            </span><span class="annot"><span class="annottext">Message (Handshake vNumber Term) 'StConfirm 'StDone
-&gt; SomeMessage 'StConfirm
forall ps (st :: ps) (st' :: ps).
Message ps st st' -&gt; SomeMessage st
</span><span class="hs-identifier hs-var">SomeMessage</span></span><span> </span><span class="annot"><span class="annottext">(Message (Handshake vNumber Term) 'StConfirm 'StDone
 -&gt; SomeMessage 'StConfirm)
-&gt; (RefuseReason vNumber
    -&gt; Message (Handshake vNumber Term) 'StConfirm 'StDone)
-&gt; RefuseReason vNumber
-&gt; SomeMessage 'StConfirm
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RefuseReason vNumber
-&gt; Message (Handshake vNumber Term) 'StConfirm 'StDone
forall k vNumber (vParams :: k).
RefuseReason vNumber
-&gt; Message (Handshake vNumber vParams) 'StConfirm 'StDone
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#MsgRefuse"><span class="hs-identifier hs-var">MsgRefuse</span></a></span><span> </span><span class="annot"><span class="annottext">(RefuseReason vNumber -&gt; SomeMessage 'StConfirm)
-&gt; Decoder s (RefuseReason vNumber)
-&gt; Decoder s (SomeMessage 'StConfirm)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Decoder s (RefuseReason vNumber)
forall failure vNumber s.
Show failure =&gt;
CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Decoder s (RefuseReason vNumber)
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#decodeRefuseReason"><span class="hs-identifier hs-var">decodeRefuseReason</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252519"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClientAgency</span></span><span> </span><span class="annot"><span class="annottext">ClientHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokPropose"><span class="hs-identifier hs-var">TokPropose</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-190"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Decoder s (SomeMessage st)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Decoder s (SomeMessage st))
-&gt; String -&gt; Decoder s (SomeMessage st)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Word -&gt; Int -&gt; String
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;codecHandshake (%s) unexpected key (%d, %d)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerHasAgency pr st -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">PeerHasAgency pr st
</span><a href="#local-6989586621679252499"><span class="hs-identifier hs-var">stok</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679252496"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252498"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-191"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ServerAgency</span></span><span> </span><span class="annot"><span class="annottext">ServerHasAgency st
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#TokConfirm"><span class="hs-identifier hs-var">TokConfirm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-192"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Decoder s (SomeMessage st)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Decoder s (SomeMessage st))
-&gt; String -&gt; Decoder s (SomeMessage st)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Word -&gt; Int -&gt; String
forall r. PrintfType r =&gt; String -&gt; r
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">printf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;codecHandshake (%s) unexpected key (%d, %d)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PeerHasAgency pr st -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">PeerHasAgency pr st
</span><a href="#local-6989586621679252499"><span class="hs-identifier hs-var">stok</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679252496"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252498"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-comment">-- | Encode version map preserving the ascending order of keys.</span><span>
</span><span id="line-196"></span><span class="hs-comment">--</span><span>
</span><span id="line-197"></span><span id="local-6989586621679252659"><span id="local-6989586621679252660"><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#encodeVersions"><span class="hs-identifier hs-type">encodeVersions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">CodecCBORTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252660"><span class="hs-identifier hs-type">failure</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252659"><span class="hs-identifier hs-type">vNumber</span></a></span><span>
</span><span id="line-198"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252659"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span>
</span><span id="line-199"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Encoding</span></span></span></span><span>
</span><span id="line-200"></span><span id="encodeVersions"><span class="annot"><span class="annottext">encodeVersions :: CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Map vNumber Term -&gt; Encoding
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#encodeVersions"><span class="hs-identifier hs-var hs-var">encodeVersions</span></a></span></span><span> </span><span id="local-6989586621679252480"><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252480"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span></span><span> </span><span id="local-6989586621679252479"><span class="annot"><span class="annottext">Map vNumber Term
</span><a href="#local-6989586621679252479"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>       </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeMapLen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map vNumber Term -&gt; Int
forall k a. Map k a -&gt; Int
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Map.size</span></a></span><span> </span><span class="annot"><span class="annottext">Map vNumber Term
</span><a href="#local-6989586621679252479"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(vNumber -&gt; Term -&gt; Encoding) -&gt; Map vNumber Term -&gt; Encoding
forall m k a. Monoid m =&gt; (k -&gt; a -&gt; m) -&gt; Map k a -&gt; m
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Map.foldMapWithKey</span></a></span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679252475"><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252475"><span class="hs-identifier hs-var">vNumber</span></a></span></span><span> </span><span id="local-6989586621679252474"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621679252474"><span class="hs-identifier hs-var">vParams</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-204"></span><span>            </span><span class="annot"><span class="annottext">Term -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeTerm</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber -&gt; vNumber -&gt; Term
forall fail a. CodecCBORTerm fail a -&gt; a -&gt; Term
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var">encodeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252480"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252475"><span class="hs-identifier hs-var">vNumber</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>         </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeTerm</span></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621679252474"><span class="hs-identifier hs-var">vParams</span></a></span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><span class="annottext">Map vNumber Term
</span><a href="#local-6989586621679252479"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- | decode a map checking the assumption that</span><span>
</span><span id="line-211"></span><span class="hs-comment">--</span><span>
</span><span id="line-212"></span><span class="hs-comment">-- * keys are different</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- * keys are encoded in ascending order</span><span>
</span><span id="line-214"></span><span class="hs-comment">--</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- fail when one of these assumptions is not met.</span><span>
</span><span id="line-216"></span><span class="hs-comment">--</span><span>
</span><span id="line-217"></span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#decodeVersions"><span class="hs-identifier hs-type">decodeVersions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679252643"><span class="annot"><a href="#local-6989586621679252643"><span class="hs-identifier hs-type">vNumber</span></a></span></span><span> </span><span id="local-6989586621679252642"><span class="annot"><a href="#local-6989586621679252642"><span class="hs-identifier hs-type">failure</span></a></span></span><span> </span><span id="local-6989586621679252641"><span class="annot"><a href="#local-6989586621679252641"><span class="hs-identifier hs-type">s</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-218"></span><span>                  </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252643"><span class="hs-identifier hs-type">vNumber</span></a></span><span>
</span><span id="line-219"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">CodecCBORTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252642"><span class="hs-identifier hs-type">failure</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252643"><span class="hs-identifier hs-type">vNumber</span></a></span><span>
</span><span id="line-220"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-221"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679252641"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252643"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span id="decodeVersions"><span class="annot"><span class="annottext">decodeVersions :: CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Int -&gt; Decoder s (Map vNumber Term)
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#decodeVersions"><span class="hs-identifier hs-var hs-var">decodeVersions</span></a></span></span><span> </span><span id="local-6989586621679252473"><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252473"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span></span><span> </span><span id="local-6989586621679252472"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252472"><span class="hs-identifier hs-var">size</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Maybe vNumber
-&gt; [(vNumber, Term)]
-&gt; Decoder s (Map vNumber Term)
</span><a href="#local-6989586621679252471"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252472"><span class="hs-identifier hs-var">size</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe vNumber
forall a. Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><a href="#local-6989586621679252471"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-225"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252643"><span class="hs-identifier hs-type">vNumber</span></a></span><span>
</span><span id="line-226"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252643"><span class="hs-identifier hs-type">vNumber</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-227"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679252641"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252643"><span class="hs-identifier hs-type">vNumber</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621679252471"><span class="annot"><span class="annottext">go :: Int
-&gt; Maybe vNumber
-&gt; [(vNumber, Term)]
-&gt; Decoder s (Map vNumber Term)
</span><a href="#local-6989586621679252471"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>  </span><span class="annot"><span class="annottext">Maybe vNumber
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">!</span><span id="local-6989586621679252470"><span class="annot"><span class="annottext">[(vNumber, Term)]
</span><a href="#local-6989586621679252470"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map vNumber Term -&gt; Decoder s (Map vNumber Term)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Map vNumber Term -&gt; Decoder s (Map vNumber Term))
-&gt; Map vNumber Term -&gt; Decoder s (Map vNumber Term)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(vNumber, Term)] -&gt; Map vNumber Term
forall k a. [(k, a)] -&gt; Map k a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Map.fromDistinctAscList</span></a></span><span> </span><span class="annot"><span class="annottext">([(vNumber, Term)] -&gt; Map vNumber Term)
-&gt; [(vNumber, Term)] -&gt; Map vNumber Term
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(vNumber, Term)] -&gt; [(vNumber, Term)]
forall a. [a] -&gt; [a]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[(vNumber, Term)]
</span><a href="#local-6989586621679252470"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><a href="#local-6989586621679252471"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679252467"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252467"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679252466"><span class="annot"><span class="annottext">Maybe vNumber
</span><a href="#local-6989586621679252466"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679252465"><span class="annot"><span class="annottext">[(vNumber, Term)]
</span><a href="#local-6989586621679252465"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>      </span><span id="local-6989586621679252464"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621679252464"><span class="hs-identifier hs-var">vNumberTerm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Term
forall s. Decoder s Term
</span><span class="hs-identifier hs-var">CBOR.decodeTerm</span></span><span>
</span><span id="line-231"></span><span>      </span><span id="local-6989586621679252463"><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621679252463"><span class="hs-identifier hs-var">vParams</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Term
forall s. Decoder s Term
</span><span class="hs-identifier hs-var">CBOR.decodeTerm</span></span><span>
</span><span id="line-232"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Term -&gt; Either (failure, Maybe Int) vNumber
forall fail a. CodecCBORTerm fail a -&gt; Term -&gt; Either fail a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var">decodeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252473"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621679252464"><span class="hs-identifier hs-var">vNumberTerm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-233"></span><span>        </span><span class="hs-comment">-- error when decoding un-recognized version; skip the version</span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-comment">-- TODO: include error in the dictionary</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(failure, Maybe Int)
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Maybe vNumber
-&gt; [(vNumber, Term)]
-&gt; Decoder s (Map vNumber Term)
</span><a href="#local-6989586621679252471"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252467"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe vNumber
</span><a href="#local-6989586621679252466"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">[(vNumber, Term)]
</span><a href="#local-6989586621679252465"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>        </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679252461"><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">vNumber</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-238"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679252460"><span class="annot"><span class="annottext">next :: Maybe vNumber
</span><a href="#local-6989586621679252460"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">vNumber -&gt; Maybe vNumber
forall a. a -&gt; Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">vNumber</span></a></span><span>
</span><span id="line-239"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Decoder s () -&gt; Decoder s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe vNumber
</span><a href="#local-6989586621679252460"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe vNumber -&gt; Maybe vNumber -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe vNumber
</span><a href="#local-6989586621679252466"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>            </span><span class="annot"><span class="annottext">(Decoder s () -&gt; Decoder s ()) -&gt; Decoder s () -&gt; Decoder s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Decoder s ()
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;codecHandshake.Propose: unordered version&quot;</span></span><span>
</span><span id="line-241"></span><span>          </span><span class="annot"><span class="annottext">Int
-&gt; Maybe vNumber
-&gt; [(vNumber, Term)]
-&gt; Decoder s (Map vNumber Term)
</span><a href="#local-6989586621679252471"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252467"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe vNumber
</span><a href="#local-6989586621679252460"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252461"><span class="hs-identifier hs-var">vNumber</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term
</span><a href="#local-6989586621679252463"><span class="hs-identifier hs-var">vParams</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(vNumber, Term) -&gt; [(vNumber, Term)] -&gt; [(vNumber, Term)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(vNumber, Term)]
</span><a href="#local-6989586621679252465"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span id="local-6989586621679252650"><span id="local-6989586621679252651"><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#encodeRefuseReason"><span class="hs-identifier hs-type">encodeRefuseReason</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">CodecCBORTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252651"><span class="hs-identifier hs-type">fail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252650"><span class="hs-identifier hs-type">vNumber</span></a></span><span>
</span><span id="line-245"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#RefuseReason"><span class="hs-identifier hs-type">RefuseReason</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252650"><span class="hs-identifier hs-type">vNumber</span></a></span><span>
</span><span id="line-246"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Encoding</span></span></span></span><span>
</span><span id="line-247"></span><span id="encodeRefuseReason"><span class="annot"><span class="annottext">encodeRefuseReason :: CodecCBORTerm fail vNumber -&gt; RefuseReason vNumber -&gt; Encoding
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#encodeRefuseReason"><span class="hs-identifier hs-var hs-var">encodeRefuseReason</span></a></span></span><span> </span><span id="local-6989586621679252458"><span class="annot"><span class="annottext">CodecCBORTerm fail vNumber
</span><a href="#local-6989586621679252458"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#VersionMismatch"><span class="hs-identifier hs-type">VersionMismatch</span></a></span><span> </span><span id="local-6989586621679252456"><span class="annot"><span class="annottext">[vNumber]
</span><a href="#local-6989586621679252456"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>         </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">2</span></span><span>
</span><span id="line-249"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeWord</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span>
</span><span id="line-250"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeListLen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word) -&gt; Int -&gt; Word
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[vNumber] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[vNumber]
</span><a href="#local-6989586621679252456"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(vNumber -&gt; Encoding) -&gt; [vNumber] -&gt; Encoding
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeTerm</span></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Encoding) -&gt; (vNumber -&gt; Term) -&gt; vNumber -&gt; Encoding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm fail vNumber -&gt; vNumber -&gt; Term
forall fail a. CodecCBORTerm fail a -&gt; a -&gt; Term
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var">encodeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm fail vNumber
</span><a href="#local-6989586621679252458"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[vNumber]
</span><a href="#local-6989586621679252456"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-252"></span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#encodeRefuseReason"><span class="hs-identifier hs-var">encodeRefuseReason</span></a></span><span> </span><span id="local-6989586621679252453"><span class="annot"><span class="annottext">CodecCBORTerm fail vNumber
</span><a href="#local-6989586621679252453"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#HandshakeDecodeError"><span class="hs-identifier hs-type">HandshakeDecodeError</span></a></span><span> </span><span id="local-6989586621679252451"><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252451"><span class="hs-identifier hs-var">vNumber</span></a></span></span><span> </span><span id="local-6989586621679252450"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679252450"><span class="hs-identifier hs-var">vError</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-253"></span><span>         </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">3</span></span><span>
</span><span id="line-254"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeWord</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span>
</span><span id="line-255"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeTerm</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecCBORTerm fail vNumber -&gt; vNumber -&gt; Term
forall fail a. CodecCBORTerm fail a -&gt; a -&gt; Term
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var">encodeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm fail vNumber
</span><a href="#local-6989586621679252453"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252451"><span class="hs-identifier hs-var">vNumber</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeString</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679252450"><span class="hs-identifier hs-var">vError</span></a></span><span>
</span><span id="line-257"></span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#encodeRefuseReason"><span class="hs-identifier hs-var">encodeRefuseReason</span></a></span><span> </span><span id="local-6989586621679252448"><span class="annot"><span class="annottext">CodecCBORTerm fail vNumber
</span><a href="#local-6989586621679252448"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Refused"><span class="hs-identifier hs-type">Refused</span></a></span><span> </span><span id="local-6989586621679252446"><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252446"><span class="hs-identifier hs-var">vNumber</span></a></span></span><span> </span><span id="local-6989586621679252445"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679252445"><span class="hs-identifier hs-var">vReason</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>         </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeListLen</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">3</span></span><span>
</span><span id="line-259"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeWord</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">2</span></span><span>
</span><span id="line-260"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeTerm</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecCBORTerm fail vNumber -&gt; vNumber -&gt; Term
forall fail a. CodecCBORTerm fail a -&gt; a -&gt; Term
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var">encodeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm fail vNumber
</span><a href="#local-6989586621679252448"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252446"><span class="hs-identifier hs-var">vNumber</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Encoding
</span><span class="hs-identifier hs-var">CBOR.encodeString</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679252445"><span class="hs-identifier hs-var">vReason</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span id="local-6989586621679252612"><span id="local-6989586621679252613"><span id="local-6989586621679252614"><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#decodeRefuseReason"><span class="hs-identifier hs-type">decodeRefuseReason</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252614"><span class="hs-identifier hs-type">failure</span></a></span><span>
</span><span id="line-265"></span><span>                   </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">CodecCBORTerm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679252614"><span class="hs-identifier hs-type">failure</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679252613"><span class="hs-identifier hs-type">vNumber</span></a></span><span>
</span><span id="line-266"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Decoder</span></span><span> </span><span class="annot"><a href="#local-6989586621679252612"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#RefuseReason"><span class="hs-identifier hs-type">RefuseReason</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679252613"><span class="hs-identifier hs-type">vNumber</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-267"></span><span id="decodeRefuseReason"><span class="annot"><span class="annottext">decodeRefuseReason :: CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Decoder s (RefuseReason vNumber)
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#decodeRefuseReason"><span class="hs-identifier hs-var hs-var">decodeRefuseReason</span></a></span></span><span> </span><span id="local-6989586621679252444"><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252444"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Int
forall s. Decoder s Int
</span><span class="hs-identifier hs-var">CBOR.decodeListLen</span></span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621679252443"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679252443"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Word
forall s. Decoder s Word
</span><span class="hs-identifier hs-var">CBOR.decodeWord</span></span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679252443"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-272"></span><span>        </span><span id="local-6989586621679252442"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252442"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Int
forall s. Decoder s Int
</span><span class="hs-identifier hs-var">CBOR.decodeListLen</span></span><span>
</span><span id="line-273"></span><span>        </span><span id="local-6989586621679252441"><span class="annot"><span class="annottext">[Either (failure, Maybe Int) vNumber]
</span><a href="#local-6989586621679252441"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Decoder s (Either (failure, Maybe Int) vNumber)
-&gt; Decoder s [Either (failure, Maybe Int) vNumber]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">replicateM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679252442"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-274"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Term -&gt; Either (failure, Maybe Int) vNumber
forall fail a. CodecCBORTerm fail a -&gt; Term -&gt; Either fail a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var">decodeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252444"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Either (failure, Maybe Int) vNumber)
-&gt; Decoder s Term
-&gt; Decoder s (Either (failure, Maybe Int) vNumber)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Term
forall s. Decoder s Term
</span><span class="hs-identifier hs-var">CBOR.decodeTerm</span></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Either (failure, Maybe Int) vNumber]
-&gt; ([(failure, Maybe Int)], [vNumber])
forall a b. [Either a b] -&gt; ([a], [b])
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">partitionEithers</span></a></span><span> </span><span class="annot"><span class="annottext">[Either (failure, Maybe Int) vNumber]
</span><a href="#local-6989586621679252441"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-276"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679252440"><span class="annot"><span class="annottext">[(failure, Maybe Int)]
</span><a href="#local-6989586621679252440"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679252439"><span class="annot"><span class="annottext">[vNumber]
</span><a href="#local-6989586621679252439"><span class="hs-identifier hs-var">vNumbers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-277"></span><span>            </span><span class="annot"><span class="annottext">RefuseReason vNumber -&gt; Decoder s (RefuseReason vNumber)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(RefuseReason vNumber -&gt; Decoder s (RefuseReason vNumber))
-&gt; RefuseReason vNumber -&gt; Decoder s (RefuseReason vNumber)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[vNumber] -&gt; [Int] -&gt; RefuseReason vNumber
forall vNumber. [vNumber] -&gt; [Int] -&gt; RefuseReason vNumber
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#VersionMismatch"><span class="hs-identifier hs-var">VersionMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">[vNumber]
</span><a href="#local-6989586621679252439"><span class="hs-identifier hs-var">vNumbers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((failure, Maybe Int) -&gt; Maybe Int)
-&gt; [(failure, Maybe Int)] -&gt; [Int]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(failure, Maybe Int) -&gt; Maybe Int
forall a b. (a, b) -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(failure, Maybe Int)]
</span><a href="#local-6989586621679252440"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>      </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>        </span><span id="local-6989586621679252438"><span class="annot"><span class="annottext">Either (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252438"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Term -&gt; Either (failure, Maybe Int) vNumber
forall fail a. CodecCBORTerm fail a -&gt; Term -&gt; Either fail a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var">decodeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252444"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Either (failure, Maybe Int) vNumber)
-&gt; Decoder s Term
-&gt; Decoder s (Either (failure, Maybe Int) vNumber)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Term
forall s. Decoder s Term
</span><span class="hs-identifier hs-var">CBOR.decodeTerm</span></span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252438"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-281"></span><span>          </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679252437"><span class="annot"><span class="annottext">(failure, Maybe Int)
</span><a href="#local-6989586621679252437"><span class="hs-identifier hs-var">e</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Decoder s (RefuseReason vNumber)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Decoder s (RefuseReason vNumber))
-&gt; String -&gt; Decoder s (RefuseReason vNumber)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;decode HandshakeDecodeError: unknow version: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(failure, Maybe Int) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(failure, Maybe Int)
</span><a href="#local-6989586621679252437"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-282"></span><span>          </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679252436"><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252436"><span class="hs-identifier hs-var">vNumber</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">vNumber -&gt; Text -&gt; RefuseReason vNumber
forall vNumber. vNumber -&gt; Text -&gt; RefuseReason vNumber
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#HandshakeDecodeError"><span class="hs-identifier hs-var">HandshakeDecodeError</span></a></span><span> </span><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252436"><span class="hs-identifier hs-var">vNumber</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; RefuseReason vNumber)
-&gt; Decoder s Text -&gt; Decoder s (RefuseReason vNumber)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Text
forall s. Decoder s Text
</span><span class="hs-identifier hs-var">CBOR.decodeString</span></span><span>
</span><span id="line-283"></span><span>      </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>        </span><span id="local-6989586621679252434"><span class="annot"><span class="annottext">Either (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252434"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Term -&gt; Either (failure, Maybe Int) vNumber
forall fail a. CodecCBORTerm fail a -&gt; Term -&gt; Either fail a
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var hs-var">decodeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252444"><span class="hs-identifier hs-var">versionNumberCodec</span></a></span><span> </span><span class="annot"><span class="annottext">(Term -&gt; Either (failure, Maybe Int) vNumber)
-&gt; Decoder s Term
-&gt; Decoder s (Either (failure, Maybe Int) vNumber)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Term
forall s. Decoder s Term
</span><span class="hs-identifier hs-var">CBOR.decodeTerm</span></span><span>
</span><span id="line-285"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (failure, Maybe Int) vNumber
</span><a href="#local-6989586621679252434"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-286"></span><span>          </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679252433"><span class="annot"><span class="annottext">(failure, Maybe Int)
</span><a href="#local-6989586621679252433"><span class="hs-identifier hs-var">e</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Decoder s (RefuseReason vNumber)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Decoder s (RefuseReason vNumber))
-&gt; String -&gt; Decoder s (RefuseReason vNumber)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;decode Refused: unknonwn version: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(failure, Maybe Int) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(failure, Maybe Int)
</span><a href="#local-6989586621679252433"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-287"></span><span>          </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679252432"><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252432"><span class="hs-identifier hs-var">vNumber</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">vNumber -&gt; Text -&gt; RefuseReason vNumber
forall vNumber. vNumber -&gt; Text -&gt; RefuseReason vNumber
</span><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Refused"><span class="hs-identifier hs-var">Refused</span></a></span><span> </span><span class="annot"><span class="annottext">vNumber
</span><a href="#local-6989586621679252432"><span class="hs-identifier hs-var">vNumber</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; RefuseReason vNumber)
-&gt; Decoder s Text -&gt; Decoder s (RefuseReason vNumber)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Text
forall s. Decoder s Text
</span><span class="hs-identifier hs-var">CBOR.decodeString</span></span><span>
</span><span id="line-288"></span><span>      </span><span class="annot"><span class="annottext">Word
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Decoder s (RefuseReason vNumber)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Decoder s (RefuseReason vNumber))
-&gt; String -&gt; Decoder s (RefuseReason vNumber)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;decode RefuseReason: unknown tag &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679252443"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-comment">-- | 'Handshake' codec for the @node-to-node@ protocol suite.</span><span>
</span><span id="line-292"></span><span class="hs-comment">--</span><span>
</span><span id="line-293"></span><span id="local-6989586621679252431"><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#nodeToNodeHandshakeCodec"><span class="hs-identifier hs-type">nodeToNodeHandshakeCodec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadST</span></span><span> </span><span class="annot"><a href="#local-6989586621679252431"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-294"></span><span>                         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">NodeToNodeVersion</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>                                  </span><span class="annot"><span class="hs-identifier hs-type">CBOR.DeserialiseFailure</span></span><span> </span><span class="annot"><a href="#local-6989586621679252431"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/bytestring-0.10.12.0/src"><span class="hs-identifier hs-type">BL.ByteString</span></a></span></span><span>
</span><span id="line-296"></span><span id="nodeToNodeHandshakeCodec"><span class="annot"><span class="annottext">nodeToNodeHandshakeCodec :: Codec
  (Handshake NodeToNodeVersion Term) DeserialiseFailure m ByteString
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#nodeToNodeHandshakeCodec"><span class="hs-identifier hs-var hs-var">nodeToNodeHandshakeCodec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (Text, Maybe Int) NodeToNodeVersion
-&gt; Codec
     (Handshake NodeToNodeVersion Term) DeserialiseFailure m ByteString
forall vNumber (m :: * -&gt; *) failure.
(MonadST m, Ord vNumber, Show failure) =&gt;
CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Codec (Handshake vNumber Term) DeserialiseFailure m ByteString
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#codecHandshake"><span class="hs-identifier hs-var">codecHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (Text, Maybe Int) NodeToNodeVersion
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">nodeToNodeVersionCodec</span></a></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="hs-comment">-- | 'Handshake' codec for the @node-to-client@ protocol suite.</span><span>
</span><span id="line-300"></span><span class="hs-comment">--</span><span>
</span><span id="line-301"></span><span id="local-6989586621679252430"><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#nodeToClientHandshakeCodec"><span class="hs-identifier hs-type">nodeToClientHandshakeCodec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadST</span></span><span> </span><span class="annot"><a href="#local-6989586621679252430"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-302"></span><span>                           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ouroboros.Network.Protocol.Handshake.Type.html#Handshake"><span class="hs-identifier hs-type">Handshake</span></a></span><span> </span><span class="annot"><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-type">NodeToClientVersion</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBOR.Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>                                    </span><span class="annot"><span class="hs-identifier hs-type">CBOR.DeserialiseFailure</span></span><span> </span><span class="annot"><a href="#local-6989586621679252430"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/bytestring-0.10.12.0/src"><span class="hs-identifier hs-type">BL.ByteString</span></a></span></span><span>
</span><span id="line-304"></span><span id="nodeToClientHandshakeCodec"><span class="annot"><span class="annottext">nodeToClientHandshakeCodec :: Codec
  (Handshake NodeToClientVersion Term)
  DeserialiseFailure
  m
  ByteString
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#nodeToClientHandshakeCodec"><span class="hs-identifier hs-var hs-var">nodeToClientHandshakeCodec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (Text, Maybe Int) NodeToClientVersion
-&gt; Codec
     (Handshake NodeToClientVersion Term)
     DeserialiseFailure
     m
     ByteString
forall vNumber (m :: * -&gt; *) failure.
(MonadST m, Ord vNumber, Show failure) =&gt;
CodecCBORTerm (failure, Maybe Int) vNumber
-&gt; Codec (Handshake vNumber Term) DeserialiseFailure m ByteString
</span><a href="Ouroboros.Network.Protocol.Handshake.Codec.html#codecHandshake"><span class="hs-identifier hs-var">codecHandshake</span></a></span><span> </span><span class="annot"><span class="annottext">CodecCBORTerm (Text, Maybe Int) NodeToClientVersion
</span><a href="../file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/ouroboros-network-api-0.1.0.0/noopt/doc/html/ouroboros-network-api/src"><span class="hs-identifier hs-var">nodeToClientVersionCodec</span></a></span><span>
</span><span id="line-305"></span></pre></body></html>