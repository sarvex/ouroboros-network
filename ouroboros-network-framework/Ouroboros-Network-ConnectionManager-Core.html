<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Ouroboros.Network.ConnectionManager.Core</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">ouroboros-network-framework-0.3.0.0: Ouroboros network framework</span><ul class="links" id="page-menu"><li><a href="src/Ouroboros.Network.ConnectionManager.Core.html">Source</a></li><li><a href="&quot;../index.html&quot;">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Ouroboros.Network.ConnectionManager.Core</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>The implementation of connection manager.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:ConnectionManagerArguments">ConnectionManagerArguments</a> handlerTrace socket peerAddr handle handleError version m = <a href="#v:ConnectionManagerArguments">ConnectionManagerArguments</a> {<ul class="subs"><li><a href="#v:cmTracer">cmTracer</a> &#8759; Tracer m (<a href="Ouroboros-Network-ConnectionManager-Types.html#t:ConnectionManagerTrace" title="Ouroboros.Network.ConnectionManager.Types">ConnectionManagerTrace</a> peerAddr handlerTrace)</li><li><a href="#v:cmTrTracer">cmTrTracer</a> &#8759; Tracer m (<a href="Ouroboros-Network-ConnectionManager-Types.html#t:TransitionTrace" title="Ouroboros.Network.ConnectionManager.Types">TransitionTrace</a> peerAddr (<a href="Ouroboros-Network-ConnectionManager-Core.html#t:ConnectionState" title="Ouroboros.Network.ConnectionManager.Core">ConnectionState</a> peerAddr handle handleError version m))</li><li><a href="#v:cmMuxTracer">cmMuxTracer</a> &#8759; Tracer m (<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/network-mux-0.3.0.0/noopt/doc/html/network-mux/Network-Mux-Trace.html#t:WithMuxBearer" title="Network.Mux.Trace">WithMuxBearer</a> (<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/network-mux-0.3.0.0/noopt/doc/html/network-mux/Network-Mux-Trace.html#t:MuxTrace" title="Network.Mux.Trace">MuxTrace</a>)</li><li><a href="#v:cmIPv4Address">cmIPv4Address</a> &#8759; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> peerAddr</li><li><a href="#v:cmIPv6Address">cmIPv6Address</a> &#8759; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> peerAddr</li><li><a href="#v:cmAddressType">cmAddressType</a> &#8759; peerAddr &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Ouroboros-Network-ConnectionManager-Types.html#t:AddressType" title="Ouroboros.Network.ConnectionManager.Types">AddressType</a></li><li><a href="#v:cmSnocket">cmSnocket</a> &#8759; <a href="Ouroboros-Network-Snocket.html#t:Snocket" title="Ouroboros.Network.Snocket">Snocket</a> m socket peerAddr</li><li><a href="#v:cmMakeBearer">cmMakeBearer</a> &#8759; <a href="Ouroboros-Network-Snocket.html#t:MakeBearer" title="Ouroboros.Network.Snocket">MakeBearer</a> m socket</li><li><a href="#v:cmConfigureSocket">cmConfigureSocket</a> &#8759; socket &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> peerAddr &#8594; m ()</li><li><a href="#v:cmTimeWaitTimeout">cmTimeWaitTimeout</a> &#8759; <a href="Ouroboros-Network-Subscription-PeerState.html#t:DiffTime" title="Ouroboros.Network.Subscription.PeerState">DiffTime</a></li><li><a href="#v:cmOutboundIdleTimeout">cmOutboundIdleTimeout</a> &#8759; <a href="Ouroboros-Network-Subscription-PeerState.html#t:DiffTime" title="Ouroboros.Network.Subscription.PeerState">DiffTime</a></li><li><a href="#v:connectionDataFlow">connectionDataFlow</a> &#8759; version &#8594; <a href="Ouroboros-Network-ConnectionManager-Types.html#t:DataFlow" title="Ouroboros.Network.ConnectionManager.Types">DataFlow</a></li><li><a href="#v:cmPrunePolicy">cmPrunePolicy</a> &#8759; <a href="Ouroboros-Network-ConnectionManager-Types.html#t:PrunePolicy" title="Ouroboros.Network.ConnectionManager.Types">PrunePolicy</a> peerAddr (STM m)</li><li><a href="#v:cmConnectionsLimits">cmConnectionsLimits</a> &#8759; <a href="Ouroboros-Network-Server-RateLimiting.html#t:AcceptedConnectionsLimit" title="Ouroboros.Network.Server.RateLimiting">AcceptedConnectionsLimit</a></li></ul>}</li><li class="src short"><a href="#v:withConnectionManager">withConnectionManager</a> &#8759; &#8704; (muxMode &#8759; <a href="Ouroboros-Network-Mux.html#t:MuxMode" title="Ouroboros.Network.Mux">MuxMode</a>) peerAddr socket handlerTrace handle handleError version m a. (MonadLabelledSTM m, MonadTraceSTM m, MonadFork m, MonadAsync m, MonadEvaluate m, <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Control-Monad-Fix.html#t:MonadFix" title="Control.Monad.Fix">MonadFix</a> m, MonadMask m, MonadMonotonicTime m, MonadThrow (STM m), MonadTimer m, <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peerAddr, <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:Show" title="Text.Show">Show</a> peerAddr, <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Type-Reflection.html#t:Typeable" title="Type.Reflection">Typeable</a> peerAddr) &#8658; <a href="Ouroboros-Network-ConnectionManager-Core.html#t:ConnectionManagerArguments" title="Ouroboros.Network.ConnectionManager.Core">ConnectionManagerArguments</a> handlerTrace socket peerAddr handle handleError version m &#8594; <a href="Ouroboros-Network-ConnectionManager-Types.html#t:ConnectionHandler" title="Ouroboros.Network.ConnectionManager.Types">ConnectionHandler</a> muxMode handlerTrace socket peerAddr handle handleError version m &#8594; (handleError &#8594; <a href="Ouroboros-Network-ConnectionManager-Types.html#t:HandleErrorType" title="Ouroboros.Network.ConnectionManager.Types">HandleErrorType</a>) &#8594; <a href="Ouroboros-Network-MuxMode.html#t:InResponderMode" title="Ouroboros.Network.MuxMode">InResponderMode</a> muxMode (<a href="Ouroboros-Network-InboundGovernor-ControlChannel.html#t:ControlChannel" title="Ouroboros.Network.InboundGovernor.ControlChannel">ControlChannel</a> peerAddr handle m) &#8594; (<a href="Ouroboros-Network-ConnectionManager-Types.html#t:ConnectionManager" title="Ouroboros.Network.ConnectionManager.Types">ConnectionManager</a> muxMode socket peerAddr handle handleError m &#8594; m a) &#8594; m a</li><li class="src short"><a href="#v:defaultTimeWaitTimeout">defaultTimeWaitTimeout</a> &#8759; <a href="Ouroboros-Network-Subscription-PeerState.html#t:DiffTime" title="Ouroboros.Network.Subscription.PeerState">DiffTime</a></li><li class="src short"><a href="#v:defaultProtocolIdleTimeout">defaultProtocolIdleTimeout</a> &#8759; <a href="Ouroboros-Network-Subscription-PeerState.html#t:DiffTime" title="Ouroboros.Network.Subscription.PeerState">DiffTime</a></li><li class="src short"><a href="#v:defaultResetTimeout">defaultResetTimeout</a> &#8759; <a href="Ouroboros-Network-Subscription-PeerState.html#t:DiffTime" title="Ouroboros.Network.Subscription.PeerState">DiffTime</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:ConnectionState">ConnectionState</a> peerAddr handle handleError version m<ul class="subs"><li>= <a href="#v:ReservedOutboundState">ReservedOutboundState</a></li><li>| <a href="#v:UnnegotiatedState">UnnegotiatedState</a> !<a href="Ouroboros-Network-ConnectionManager-Types.html#t:Provenance" title="Ouroboros.Network.ConnectionManager.Types">Provenance</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) (Async m ())</li><li>| <a href="#v:OutboundUniState">OutboundUniState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !handle</li><li>| <a href="#v:OutboundDupState">OutboundDupState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !handle !<a href="Ouroboros-Network-ConnectionManager-Types.html#t:TimeoutExpired" title="Ouroboros.Network.ConnectionManager.Types">TimeoutExpired</a></li><li>| <a href="#v:OutboundIdleState">OutboundIdleState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !handle !<a href="Ouroboros-Network-ConnectionManager-Types.html#t:DataFlow" title="Ouroboros.Network.ConnectionManager.Types">DataFlow</a></li><li>| <a href="#v:InboundIdleState">InboundIdleState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !handle !<a href="Ouroboros-Network-ConnectionManager-Types.html#t:DataFlow" title="Ouroboros.Network.ConnectionManager.Types">DataFlow</a></li><li>| <a href="#v:InboundState">InboundState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !handle !<a href="Ouroboros-Network-ConnectionManager-Types.html#t:DataFlow" title="Ouroboros.Network.ConnectionManager.Types">DataFlow</a></li><li>| <a href="#v:DuplexState">DuplexState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !handle</li><li>| <a href="#v:TerminatingState">TerminatingState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !(<a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> handleError)</li><li>| <a href="#v:TerminatedState">TerminatedState</a> !(<a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> handleError)</li></ul></li><li class="src short"><a href="#v:abstractState">abstractState</a> &#8759; <a href="Ouroboros-Network-ConnectionManager-Types.html#t:MaybeUnknown" title="Ouroboros.Network.ConnectionManager.Types">MaybeUnknown</a> (<a href="Ouroboros-Network-ConnectionManager-Core.html#t:ConnectionState" title="Ouroboros.Network.ConnectionManager.Core">ConnectionState</a> muxMode peerAddr m a b) &#8594; <a href="Ouroboros-Network-ConnectionManager-Types.html#t:AbstractState" title="Ouroboros.Network.ConnectionManager.Types">AbstractState</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ConnectionManagerArguments" class="def">ConnectionManagerArguments</a> handlerTrace socket peerAddr handle handleError version m <a href="src/Ouroboros.Network.ConnectionManager.Core.html#ConnectionManagerArguments" class="link">Source</a> <a href="#t:ConnectionManagerArguments" class="selflink">#</a></p><div class="doc"><p>Arguments for a <code><a href="Ouroboros-Network-ConnectionManager-Types.html#t:ConnectionManager" title="Ouroboros.Network.ConnectionManager.Types">ConnectionManager</a></code> which are independent of <code><a href="Ouroboros-Network-Mux.html#t:MuxMode" title="Ouroboros.Network.Mux">MuxMode</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ConnectionManagerArguments" class="def">ConnectionManagerArguments</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:cmTracer" class="def">cmTracer</a> &#8759; Tracer m (<a href="Ouroboros-Network-ConnectionManager-Types.html#t:ConnectionManagerTrace" title="Ouroboros.Network.ConnectionManager.Types">ConnectionManagerTrace</a> peerAddr handlerTrace)</dfn><div class="doc"><p>Connection manager tracer.</p></div></li><li><dfn class="src"><a id="v:cmTrTracer" class="def">cmTrTracer</a> &#8759; Tracer m (<a href="Ouroboros-Network-ConnectionManager-Types.html#t:TransitionTrace" title="Ouroboros.Network.ConnectionManager.Types">TransitionTrace</a> peerAddr (<a href="Ouroboros-Network-ConnectionManager-Core.html#t:ConnectionState" title="Ouroboros.Network.ConnectionManager.Core">ConnectionState</a> peerAddr handle handleError version m))</dfn><div class="doc"><p>Trace state transitions.</p></div></li><li><dfn class="src"><a id="v:cmMuxTracer" class="def">cmMuxTracer</a> &#8759; Tracer m (<a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/network-mux-0.3.0.0/noopt/doc/html/network-mux/Network-Mux-Trace.html#t:WithMuxBearer" title="Network.Mux.Trace">WithMuxBearer</a> (<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) <a href="file:///home/runner/work/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.10.7/network-mux-0.3.0.0/noopt/doc/html/network-mux/Network-Mux-Trace.html#t:MuxTrace" title="Network.Mux.Trace">MuxTrace</a>)</dfn><div class="doc"><p>Mux trace.</p></div></li><li><dfn class="src"><a id="v:cmIPv4Address" class="def">cmIPv4Address</a> &#8759; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> peerAddr</dfn><div class="doc"><p><code>IPv4</code> address of the connection manager.  If given, outbound
 connections to an <code>IPv4</code> address will bound to it.  To use
 bidirectional <code>TCP</code> connections, it must be the same as the server
 listening <code>IPv4</code> address.</p></div></li><li><dfn class="src"><a id="v:cmIPv6Address" class="def">cmIPv6Address</a> &#8759; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> peerAddr</dfn><div class="doc"><p><code>IPv6</code> address of the connection manager.  If given, outbound
 connections to an <code>IPv6</code> address will bound to it.  To use
 bidirectional <code>TCP</code> connections, it must be the same as the server
 listening <code>IPv6</code> address.</p></div></li><li><dfn class="src"><a id="v:cmAddressType" class="def">cmAddressType</a> &#8759; peerAddr &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="Ouroboros-Network-ConnectionManager-Types.html#t:AddressType" title="Ouroboros.Network.ConnectionManager.Types">AddressType</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:cmSnocket" class="def">cmSnocket</a> &#8759; <a href="Ouroboros-Network-Snocket.html#t:Snocket" title="Ouroboros.Network.Snocket">Snocket</a> m socket peerAddr</dfn><div class="doc"><p>Snocket for the <code>socket</code> type.</p></div></li><li><dfn class="src"><a id="v:cmMakeBearer" class="def">cmMakeBearer</a> &#8759; <a href="Ouroboros-Network-Snocket.html#t:MakeBearer" title="Ouroboros.Network.Snocket">MakeBearer</a> m socket</dfn><div class="doc"><p>Make MuxBearer.</p></div></li><li><dfn class="src"><a id="v:cmConfigureSocket" class="def">cmConfigureSocket</a> &#8759; socket &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> peerAddr &#8594; m ()</dfn><div class="doc"><p>Socket configuration.</p></div></li><li><dfn class="src"><a id="v:cmTimeWaitTimeout" class="def">cmTimeWaitTimeout</a> &#8759; <a href="Ouroboros-Network-Subscription-PeerState.html#t:DiffTime" title="Ouroboros.Network.Subscription.PeerState">DiffTime</a></dfn><div class="doc"><p><code>TCP</code> will held connections in <code>TIME_WAIT</code> state for up to two MSL
 (maximum segment time).  On Linux this is set to '60' seconds on
 other system this might be up to four minutes.</p><p>This is configurable, so we can set different value in tests.</p><p>When this timeout expires a connection will transition from
 <code><a href="Ouroboros-Network-ConnectionManager-Core.html#v:TerminatingState" title="Ouroboros.Network.ConnectionManager.Core">TerminatingState</a></code> to <code><a href="Ouroboros-Network-ConnectionManager-Core.html#v:TerminatedState" title="Ouroboros.Network.ConnectionManager.Core">TerminatedState</a></code>.</p></div></li><li><dfn class="src"><a id="v:cmOutboundIdleTimeout" class="def">cmOutboundIdleTimeout</a> &#8759; <a href="Ouroboros-Network-Subscription-PeerState.html#t:DiffTime" title="Ouroboros.Network.Subscription.PeerState">DiffTime</a></dfn><div class="doc"><p>Inactivity timeout before the connection will be reset.  It is the
 timeout attached to the <code><a href="Ouroboros-Network-ConnectionManager-Core.html#v:OutboundIdleState" title="Ouroboros.Network.ConnectionManager.Core">OutboundIdleState</a></code>.</p></div></li><li><dfn class="src"><a id="v:connectionDataFlow" class="def">connectionDataFlow</a> &#8759; version &#8594; <a href="Ouroboros-Network-ConnectionManager-Types.html#t:DataFlow" title="Ouroboros.Network.ConnectionManager.Types">DataFlow</a></dfn><div class="doc"><p><code>version</code> represents the tuple of <code>versionNumber</code> and
 <code>agreedOptions</code>.</p></div></li><li><dfn class="src"><a id="v:cmPrunePolicy" class="def">cmPrunePolicy</a> &#8759; <a href="Ouroboros-Network-ConnectionManager-Types.html#t:PrunePolicy" title="Ouroboros.Network.ConnectionManager.Types">PrunePolicy</a> peerAddr (STM m)</dfn><div class="doc"><p>Prune policy</p></div></li><li><dfn class="src"><a id="v:cmConnectionsLimits" class="def">cmConnectionsLimits</a> &#8759; <a href="Ouroboros-Network-Server-RateLimiting.html#t:AcceptedConnectionsLimit" title="Ouroboros.Network.Server.RateLimiting">AcceptedConnectionsLimit</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:withConnectionManager" class="def">withConnectionManager</a> <a href="src/Ouroboros.Network.ConnectionManager.Core.html#withConnectionManager" class="link">Source</a> <a href="#v:withConnectionManager" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&#8759; &#8704; (muxMode &#8759; <a href="Ouroboros-Network-Mux.html#t:MuxMode" title="Ouroboros.Network.Mux">MuxMode</a>) peerAddr socket handlerTrace handle handleError version m a. (MonadLabelledSTM m, MonadTraceSTM m, MonadFork m, MonadAsync m, MonadEvaluate m, <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Control-Monad-Fix.html#t:MonadFix" title="Control.Monad.Fix">MonadFix</a> m, MonadMask m, MonadMonotonicTime m, MonadThrow (STM m), MonadTimer m, <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> peerAddr, <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:Show" title="Text.Show">Show</a> peerAddr, <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Type-Reflection.html#t:Typeable" title="Type.Reflection">Typeable</a> peerAddr)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8658; <a href="Ouroboros-Network-ConnectionManager-Core.html#t:ConnectionManagerArguments" title="Ouroboros.Network.ConnectionManager.Core">ConnectionManagerArguments</a> handlerTrace socket peerAddr handle handleError version m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8594; <a href="Ouroboros-Network-ConnectionManager-Types.html#t:ConnectionHandler" title="Ouroboros.Network.ConnectionManager.Types">ConnectionHandler</a> muxMode handlerTrace socket peerAddr handle handleError version m</td><td class="doc"><p>Callback which runs in a thread dedicated for a given connection.</p></td></tr><tr><td class="src">&#8594; (handleError &#8594; <a href="Ouroboros-Network-ConnectionManager-Types.html#t:HandleErrorType" title="Ouroboros.Network.ConnectionManager.Types">HandleErrorType</a>)</td><td class="doc"><p>classify <code>handleError</code>s</p></td></tr><tr><td class="src">&#8594; <a href="Ouroboros-Network-MuxMode.html#t:InResponderMode" title="Ouroboros.Network.MuxMode">InResponderMode</a> muxMode (<a href="Ouroboros-Network-InboundGovernor-ControlChannel.html#t:ControlChannel" title="Ouroboros.Network.InboundGovernor.ControlChannel">ControlChannel</a> peerAddr handle m)</td><td class="doc"><p>On outbound duplex connections we need to notify the server about
 a new connection.</p></td></tr><tr><td class="src">&#8594; (<a href="Ouroboros-Network-ConnectionManager-Types.html#t:ConnectionManager" title="Ouroboros.Network.ConnectionManager.Types">ConnectionManager</a> muxMode socket peerAddr handle handleError m &#8594; m a)</td><td class="doc"><p>Continuation which receives the <code><a href="Ouroboros-Network-ConnectionManager-Types.html#t:ConnectionManager" title="Ouroboros.Network.ConnectionManager.Types">ConnectionManager</a></code>.  It must not leak
 outside of scope of this callback.  Once it returns all resources
 will be closed.</p></td></tr><tr><td class="src">&#8594; m a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Entry point for using the connection manager.  This is a classic <code>with</code> style
 combinator, which cleans resources on exit of the callback (whether cleanly
 or through an exception).</p><p>Including a connection (either inbound or outbound) is an idempotent
 operation on connection manager state.  The connection manager will always
 return the handle that was first to be included in its state.</p><p>Once an inbound connection is passed to the <code><a href="Ouroboros-Network-ConnectionManager-Types.html#t:ConnectionManager" title="Ouroboros.Network.ConnectionManager.Types">ConnectionManager</a></code>, the manager
 is responsible for the resource.</p></div></div><div class="top"><p class="src"><a id="v:defaultTimeWaitTimeout" class="def">defaultTimeWaitTimeout</a> &#8759; <a href="Ouroboros-Network-Subscription-PeerState.html#t:DiffTime" title="Ouroboros.Network.Subscription.PeerState">DiffTime</a> <a href="src/Ouroboros.Network.ConnectionManager.Core.html#defaultTimeWaitTimeout" class="link">Source</a> <a href="#v:defaultTimeWaitTimeout" class="selflink">#</a></p><div class="doc"><p>The default value for <code><a href="Ouroboros-Network-ConnectionManager-Core.html#v:cmTimeWaitTimeout" title="Ouroboros.Network.ConnectionManager.Core">cmTimeWaitTimeout</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:defaultProtocolIdleTimeout" class="def">defaultProtocolIdleTimeout</a> &#8759; <a href="Ouroboros-Network-Subscription-PeerState.html#t:DiffTime" title="Ouroboros.Network.Subscription.PeerState">DiffTime</a> <a href="src/Ouroboros.Network.ConnectionManager.Core.html#defaultProtocolIdleTimeout" class="link">Source</a> <a href="#v:defaultProtocolIdleTimeout" class="selflink">#</a></p><div class="doc"><p>Inactivity timeout.  It configures how long to wait since the local side
 demoted remote peer to <em>cold</em>, before closing the connection.</p></div></div><div class="top"><p class="src"><a id="v:defaultResetTimeout" class="def">defaultResetTimeout</a> &#8759; <a href="Ouroboros-Network-Subscription-PeerState.html#t:DiffTime" title="Ouroboros.Network.Subscription.PeerState">DiffTime</a> <a href="src/Ouroboros.Network.ConnectionManager.Core.html#defaultResetTimeout" class="link">Source</a> <a href="#v:defaultResetTimeout" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ConnectionState" class="def">ConnectionState</a> peerAddr handle handleError version m <a href="src/Ouroboros.Network.ConnectionManager.Core.html#ConnectionState" class="link">Source</a> <a href="#t:ConnectionState" class="selflink">#</a></p><div class="doc"><p>State of a connection.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ReservedOutboundState" class="def">ReservedOutboundState</a></td><td class="doc"><p>Each outbound connections starts in this state.</p></td></tr><tr><td class="src"><a id="v:UnnegotiatedState" class="def">UnnegotiatedState</a> !<a href="Ouroboros-Network-ConnectionManager-Types.html#t:Provenance" title="Ouroboros.Network.ConnectionManager.Types">Provenance</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) (Async m ())</td><td class="doc"><p>Each inbound connection starts in this state, outbound connection
 reach this state once <code><a href="Ouroboros-Network-Snocket.html#v:connect" title="Ouroboros.Network.Snocket">connect</a></code> call returns.</p><p>note: the async handle is lazy, because it's passed with <code><a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Control-Monad-Fix.html#v:mfix" title="Control.Monad.Fix">mfix</a></code>.</p></td></tr><tr><td class="src"><a id="v:OutboundUniState" class="def">OutboundUniState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !handle</td><td class="doc"><p><code>OutboundState Unidirectional</code> state.</p></td></tr><tr><td class="src"><a id="v:OutboundDupState" class="def">OutboundDupState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !handle !<a href="Ouroboros-Network-ConnectionManager-Types.html#t:TimeoutExpired" title="Ouroboros.Network.ConnectionManager.Types">TimeoutExpired</a></td><td class="doc"><p>Either <code>OutboundState Duplex</code> or <code>OutobundState^tau Duplex</code>.</p></td></tr><tr><td class="src"><a id="v:OutboundIdleState" class="def">OutboundIdleState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !handle !<a href="Ouroboros-Network-ConnectionManager-Types.html#t:DataFlow" title="Ouroboros.Network.ConnectionManager.Types">DataFlow</a></td><td class="doc"><p>Before connection is reset it is put in <code><a href="Ouroboros-Network-ConnectionManager-Core.html#v:OutboundIdleState" title="Ouroboros.Network.ConnectionManager.Core">OutboundIdleState</a></code> for the
 duration of <code><a href="Ouroboros-Network-ConnectionManager-Core.html#v:cmOutboundIdleTimeout" title="Ouroboros.Network.ConnectionManager.Core">cmOutboundIdleTimeout</a></code>.</p></td></tr><tr><td class="src"><a id="v:InboundIdleState" class="def">InboundIdleState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !handle !<a href="Ouroboros-Network-ConnectionManager-Types.html#t:DataFlow" title="Ouroboros.Network.ConnectionManager.Types">DataFlow</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:InboundState" class="def">InboundState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !handle !<a href="Ouroboros-Network-ConnectionManager-Types.html#t:DataFlow" title="Ouroboros.Network.ConnectionManager.Types">DataFlow</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:DuplexState" class="def">DuplexState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !handle</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:TerminatingState" class="def">TerminatingState</a> !(<a href="Ouroboros-Network-ConnectionId.html#t:ConnectionId" title="Ouroboros.Network.ConnectionId">ConnectionId</a> peerAddr) !(Async m ()) !(<a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> handleError)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:TerminatedState" class="def">TerminatedState</a> !(<a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> handleError)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><h4 class="instances details-toggle-control details-toggle" data-details-id="i:ConnectionState">Instances</h4><details id="i:ConnectionState" open="open"><summary class="hide-when-js-enabled">Instances details</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ConnectionState:Show:1"></span> (<a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:Show" title="Text.Show">Show</a> peerAddr, <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:Show" title="Text.Show">Show</a> handleError, MonadAsync m) &#8658; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:Show" title="Text.Show">Show</a> (<a href="Ouroboros-Network-ConnectionManager-Core.html#t:ConnectionState" title="Ouroboros.Network.ConnectionManager.Core">ConnectionState</a> peerAddr handle handleError version m)</span> <a href="src/Ouroboros.Network.ConnectionManager.Core.html#line-304" class="link">Source</a> <a href="#t:ConnectionState" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ConnectionState:Show:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Ouroboros-Network-ConnectionManager-Core.html">Ouroboros.Network.ConnectionManager.Core</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> &#8759; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="Ouroboros-Network-ConnectionManager-Core.html#t:ConnectionState" title="Ouroboros.Network.ConnectionManager.Core">ConnectionState</a> peerAddr handle handleError version m &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> &#8759; <a href="Ouroboros-Network-ConnectionManager-Core.html#t:ConnectionState" title="Ouroboros.Network.ConnectionManager.Core">ConnectionState</a> peerAddr handle handleError version m &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Data-String.html#t:String" title="Data.String">String</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> &#8759; [<a href="Ouroboros-Network-ConnectionManager-Core.html#t:ConnectionState" title="Ouroboros.Network.ConnectionManager.Core">ConnectionState</a> peerAddr handle handleError version m] &#8594; <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="file:///usr/local/.ghcup/ghc/8.10.7/share/doc/ghc-8.10.7/html/libraries/base-4.14.3.0/src" class="link">Source</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:abstractState" class="def">abstractState</a> &#8759; <a href="Ouroboros-Network-ConnectionManager-Types.html#t:MaybeUnknown" title="Ouroboros.Network.ConnectionManager.Types">MaybeUnknown</a> (<a href="Ouroboros-Network-ConnectionManager-Core.html#t:ConnectionState" title="Ouroboros.Network.ConnectionManager.Core">ConnectionState</a> muxMode peerAddr m a b) &#8594; <a href="Ouroboros-Network-ConnectionManager-Types.html#t:AbstractState" title="Ouroboros.Network.ConnectionManager.Types">AbstractState</a> <a href="src/Ouroboros.Network.ConnectionManager.Core.html#abstractState" class="link">Source</a> <a href="#v:abstractState" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.24.2</p></div></body></html>